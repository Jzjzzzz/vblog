/*
 Navicat Premium Data Transfer

 Source Server         : localhost
 Source Server Type    : MySQL
 Source Server Version : 50732
 Source Host           : localhost:3306
 Source Schema         : vblog

 Target Server Type    : MySQL
 Target Server Version : 50732
 File Encoding         : 65001

 Date: 31/10/2022 15:21:11
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for admin_user
-- ----------------------------
DROP TABLE IF EXISTS `admin_user`;
CREATE TABLE `admin_user`  (
  `id` bigint(11) UNSIGNED ZEROFILL NOT NULL AUTO_INCREMENT,
  `username` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `password` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `phone` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `avatar` text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL,
  `create_time` datetime NOT NULL,
  `update_time` datetime NOT NULL,
  `roles` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `introduction` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 2 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ç®¡ç†å‘˜ç”¨æˆ·è¡¨' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of admin_user
-- ----------------------------
INSERT INTO `admin_user` VALUES (00000000001, 'admin', '9bda42f78a579ca9e9397936c9558338', '18176702572', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/adminAvatar/2022/08/19/80b086d23aac408c95517bd5ebc4eea3.jpg', '2022-06-07 15:06:24', '2022-09-05 16:42:14', 'admin', 'I am a super administrator');

-- ----------------------------
-- Table structure for article_comment
-- ----------------------------
DROP TABLE IF EXISTS `article_comment`;
CREATE TABLE `article_comment`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `nick_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜µç§°',
  `email` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'é‚®ç®±',
  `content` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å†…å®¹',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `status` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çŠ¶æ€',
  `parent_status` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦ä¸ºçˆ¶èŠ‚ç‚¹',
  `article_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ç« id',
  `comment_type` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'è¯„è®ºç±»å‹(0-ç•™è¨€æ¿,1-æ–‡ç« è¯„è®º)',
  `parent_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çˆ¶èŠ‚ç‚¹id',
  `avatar` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤´åƒ',
  `ip` varchar(15) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'è¯„è®ºipåœ°å€',
  `city` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ‰€å±çœå¸‚',
  `audit_status` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å®¡æ ¸çŠ¶æ€(0-æœªå®¡æ ¸,1-å®¡æ ¸é€šè¿‡,2-å®¡æ ¸æœªé€šè¿‡)',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ç•™è¨€æ¿' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of article_comment
-- ----------------------------

-- ----------------------------
-- Table structure for article_content
-- ----------------------------
DROP TABLE IF EXISTS `article_content`;
CREATE TABLE `article_content`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'æ–‡ç« å†…å®¹id',
  `content` mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL COMMENT 'æ–‡ç« å†…å®¹',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `html_content` mediumtext CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL COMMENT 'æ–‡ç« å†…å®¹è½¬html',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'æ–‡ç« å†…å®¹' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of article_content
-- ----------------------------
INSERT INTO `article_content` VALUES ('33eaafbcb8d03c1eb2de9de8d49a6fe7', '### 1 æœåŠ¡ç«¯ä»£ç \n```java\npublic class ChatServer {\n\n    //æœåŠ¡å™¨ç«¯å¯åŠ¨æ–¹æ³•\n    public void startServer() throws Exception {\n        //åˆ›å»ºSelectoré€‰æ‹©å™¨\n        Selector selector = Selector.open();\n        //åˆ›å»ºServerSocketChannelé€šé“\n        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n        //ä¸ºChannelé€šé“ç»‘å®šç›‘å¬ç«¯å£\n        serverSocketChannel.bind(new InetSocketAddress(8000));\n        //é€šé“è®¾ç½®ä¸ºéé˜»å¡\n        serverSocketChannel.configureBlocking(false);\n        //æŠŠchannelé€šé“æ³¨å†Œåˆ°selectoré€‰æ‹©å™¨ä¸Š\n        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\n        System.out.println(\"æœåŠ¡å™¨å·²ç»å¯åŠ¨æˆåŠŸäº†\");\n        //å¾ªç¯,ç­‰å¾…æ–°é“¾æ¥æ¥å…¥\n        for(;;){\n            //è·å–channelæ•°é‡\n            int readChannels = selector.select();\n            if(readChannels == 0){\n                continue;\n            }\n            //è·å–å¯ç”¨çš„channel\n            Set<SelectionKey> selectionKeys = selector.selectedKeys();\n            //éå†é›†åˆ\n            Iterator<SelectionKey> iterator = selectionKeys.iterator();\n            while (iterator.hasNext()){\n                SelectionKey selectionKey = iterator.next();\n                //ç§»é™¤æ‰seté›†åˆå½“å‰selectionKey\n                iterator.remove();\n                //æ ¹æ®å°±ç»ªçŠ¶æ€,è°ƒç”¨å¯¹åº”æ–¹æ³•å®ç°å…·ä½“ä¸šåŠ¡æ“ä½œ\n                //å¦‚æœacceptçŠ¶æ€\n                if(selectionKey.isAcceptable()){\n                    acceptOperator(serverSocketChannel,selector);\n                }\n                //å¦‚æœå¯è¯»çŠ¶æ€\n                if(selectionKey.isReadable()){\n                    readOperator(selector,selectionKey);\n                }\n            }\n        }\n\n    }\n\n    //å¤„ç†æ¥å…¥çŠ¶æ€æ“ä½œ\n    private void acceptOperator(ServerSocketChannel serverSocketChannel, Selector selector)  throws Exception{\n        //æ¥å…¥çŠ¶æ€ åˆ›å»ºsocketChannel\n        SocketChannel socketChannel = serverSocketChannel.accept();\n        //æŠŠsocketChannelè®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼\n        socketChannel.configureBlocking(false);\n        //æŠŠchannelæ³¨å†Œåˆ°selectoré€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬å¯è¯»çŠ¶æ€\n        socketChannel.register(selector,SelectionKey.OP_READ);\n        //å®¢æˆ·ç«¯å›å¤ä¿¡æ¯\n        socketChannel.write(Charset.forName(\"UTF-8\").encode(\"æ¬¢è¿æ‚¨è¿›å…¥èŠå¤©å®¤\"));\n    }\n\n    //å¤„ç†å¯è¯»çŠ¶æ€æ“ä½œ\n    private void readOperator(Selector selector, SelectionKey selectionKey) throws Exception{\n        //ä»SelectionKeyè·å–åˆ°å·²ç»å°±ç»ªçš„é€šé“\n        SocketChannel socketChannel =(SocketChannel) selectionKey.channel();\n        //åˆ›å»ºbuffer\n        ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n        //å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯\n        int readLength = socketChannel.read(byteBuffer);\n        String message = \"\";\n        if (readLength>0){\n            //åˆ‡æ¢è¯»æ¨¡å¼\n            byteBuffer.flip();\n            message+=Charset.forName(\"UTF-8\").decode(byteBuffer);\n        }\n        //å°†channelå†æ¬¡æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,ç›‘å¬å¯è¯»çŠ¶æ€\n        socketChannel.register(selector,SelectionKey.OP_READ);\n        //æŠŠå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯\n        if(message.length()>0){\n            //å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯\n            castOtherClient(message,selector,socketChannel);\n            System.out.println(message);\n        }\n    }\n\n    //å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯\n    private void castOtherClient(String message, Selector selector, SocketChannel socketChannel) throws Exception{\n        //è·å–æ‰€æœ‰å·²ç»æ¥å…¥çš„å®¢æˆ·ç«¯channel\n        Set<SelectionKey> selectionKeySet = selector.keys();\n        //å¾ªç¯å‘æ‰€æœ‰channelå¹¿æ’­æ¶ˆæ¯\n        for(SelectionKey selectionKey : selectionKeySet){\n            //è·å–æ¯ä¸ªchannel\n            Channel tarChannel = selectionKey.channel();\n            //ä¸éœ€è¦ç»™è‡ªå·±å‘é€\n            if(tarChannel instanceof SocketChannel && tarChannel != socketChannel){\n                ((SocketChannel)tarChannel).write(Charset.forName(\"UTF-8\").encode(message));\n            }\n        }\n    }\n\n    public static void main(String[] args) {\n        try {\n            new ChatServer().startServer();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n\n### 2 å®¢æˆ·ç«¯ä»£ç \n\n```java\npublic class ChatClient {\n\n    //å¯åŠ¨å®¢æˆ·ç«¯æ–¹æ³•\n    public void startClient(String name) throws Exception{\n        //è¿æ¥æœåŠ¡å™¨ç«¯\n        SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\", 8000));\n        //æ¥æ”¶æœåŠ¡å™¨ç«¯å“åº”æ•°æ®\n        Selector selector = Selector.open();\n        socketChannel.configureBlocking(false);\n        socketChannel.register(selector, SelectionKey.OP_READ);\n        //åˆ›å»ºçº¿ç¨‹\n        new Thread(new ClientThread(selector)).start();\n\n        //å‘æœåŠ¡å™¨ç«¯å‘é€æ¶ˆæ¯\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNextLine()){\n            String msg = scanner.nextLine();\n            if(msg.length()>0){\n                socketChannel.write(Charset.forName(\"UTF-8\").encode(name+\":\"+msg));\n            }\n        }\n    }\n    \n}\n```\n\n#### 2.1 ClientThread\n```java\npublic class ClientThread implements Runnable{\n\n    private Selector selector;\n\n    public ClientThread(Selector selector) {\n        this.selector = selector;\n    }\n\n    @Override\n    public void run() {\n        try {\n            for(;;){\n                //è·å–channelæ•°é‡\n                int readChannels = selector.select();\n                if(readChannels == 0){\n                    continue;\n                }\n                //è·å–å¯ç”¨çš„channel\n                Set<SelectionKey> selectionKeys = selector.selectedKeys();\n                //éå†é›†åˆ\n                Iterator<SelectionKey> iterator = selectionKeys.iterator();\n                while (iterator.hasNext()){\n                    SelectionKey selectionKey = iterator.next();\n                    //ç§»é™¤æ‰seté›†åˆå½“å‰selectionKey\n                    iterator.remove();\n                    //æ ¹æ®å°±ç»ªçŠ¶æ€,è°ƒç”¨å¯¹åº”æ–¹æ³•å®ç°å…·ä½“ä¸šåŠ¡æ“ä½œ\n                    //å¦‚æœå¯è¯»çŠ¶æ€\n                    if(selectionKey.isReadable()){\n                        readOperator(selector,selectionKey);\n                    }\n                }\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    //å¤„ç†å¯è¯»çŠ¶æ€æ“ä½œ\n    private void readOperator(Selector selector, SelectionKey selectionKey) throws Exception{\n        //ä»SelectionKeyè·å–åˆ°å·²ç»å°±ç»ªçš„é€šé“\n        SocketChannel socketChannel =(SocketChannel) selectionKey.channel();\n        //åˆ›å»ºbuffer\n        ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n        //å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯\n        int readLength = socketChannel.read(byteBuffer);\n        String message = \"\";\n        if (readLength>0){\n            //åˆ‡æ¢è¯»æ¨¡å¼\n            byteBuffer.flip();\n            message+= Charset.forName(\"UTF-8\").decode(byteBuffer);\n        }\n        //å°†channelå†æ¬¡æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,ç›‘å¬å¯è¯»çŠ¶æ€\n        socketChannel.register(selector,SelectionKey.OP_READ);\n        //æŠŠå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯\n        if(message.length()>0){\n            //å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯\n            System.out.println(message);\n        }\n    }\n}\n```\n\n#### 2.2 AClient\n```java\npublic class AClient {\n    public static void main(String[] args) {\n        try {\n            new ChatClient().startClient(\"lucy\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n#### 2.3 BClient\n```java\npublic class BClient {\n    public static void main(String[] args) {\n        try {\n            new ChatClient().startClient(\"mary\");\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n', '2022-10-12 11:33:21', '2022-10-13 10:29:00', '<h3><a id=\"1__0\"></a>1 æœåŠ¡ç«¯ä»£ç </h3>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ChatServer</span> {\n\n    <span class=\"hljs-comment\">//æœåŠ¡å™¨ç«¯å¯åŠ¨æ–¹æ³•</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">startServer</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//åˆ›å»ºSelectoré€‰æ‹©å™¨</span>\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        <span class=\"hljs-comment\">//åˆ›å»ºServerSocketChannelé€šé“</span>\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">serverSocketChannel</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        <span class=\"hljs-comment\">//ä¸ºChannelé€šé“ç»‘å®šç›‘å¬ç«¯å£</span>\n        serverSocketChannel.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">8000</span>));\n        <span class=\"hljs-comment\">//é€šé“è®¾ç½®ä¸ºéé˜»å¡</span>\n        serverSocketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        <span class=\"hljs-comment\">//æŠŠchannelé€šé“æ³¨å†Œåˆ°selectoré€‰æ‹©å™¨ä¸Š</span>\n        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\n        System.out.println(<span class=\"hljs-string\">&quot;æœåŠ¡å™¨å·²ç»å¯åŠ¨æˆåŠŸäº†&quot;</span>);\n        <span class=\"hljs-comment\">//å¾ªç¯,ç­‰å¾…æ–°é“¾æ¥æ¥å…¥</span>\n        <span class=\"hljs-keyword\">for</span>(;;){\n            <span class=\"hljs-comment\">//è·å–channelæ•°é‡</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">readChannels</span> <span class=\"hljs-operator\">=</span> selector.select();\n            <span class=\"hljs-keyword\">if</span>(readChannels == <span class=\"hljs-number\">0</span>){\n                <span class=\"hljs-keyword\">continue</span>;\n            }\n            <span class=\"hljs-comment\">//è·å–å¯ç”¨çš„channel</span>\n            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();\n            <span class=\"hljs-comment\">//éå†é›†åˆ</span>\n            Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();\n            <span class=\"hljs-keyword\">while</span> (iterator.hasNext()){\n                <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> iterator.next();\n                <span class=\"hljs-comment\">//ç§»é™¤æ‰seté›†åˆå½“å‰selectionKey</span>\n                iterator.remove();\n                <span class=\"hljs-comment\">//æ ¹æ®å°±ç»ªçŠ¶æ€,è°ƒç”¨å¯¹åº”æ–¹æ³•å®ç°å…·ä½“ä¸šåŠ¡æ“ä½œ</span>\n                <span class=\"hljs-comment\">//å¦‚æœacceptçŠ¶æ€</span>\n                <span class=\"hljs-keyword\">if</span>(selectionKey.isAcceptable()){\n                    acceptOperator(serverSocketChannel,selector);\n                }\n                <span class=\"hljs-comment\">//å¦‚æœå¯è¯»çŠ¶æ€</span>\n                <span class=\"hljs-keyword\">if</span>(selectionKey.isReadable()){\n                    readOperator(selector,selectionKey);\n                }\n            }\n        }\n\n    }\n\n    <span class=\"hljs-comment\">//å¤„ç†æ¥å…¥çŠ¶æ€æ“ä½œ</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">acceptOperator</span><span class=\"hljs-params\">(ServerSocketChannel serverSocketChannel, Selector selector)</span>  <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//æ¥å…¥çŠ¶æ€ åˆ›å»ºsocketChannel</span>\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span> serverSocketChannel.accept();\n        <span class=\"hljs-comment\">//æŠŠsocketChannelè®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼</span>\n        socketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        <span class=\"hljs-comment\">//æŠŠchannelæ³¨å†Œåˆ°selectoré€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬å¯è¯»çŠ¶æ€</span>\n        socketChannel.register(selector,SelectionKey.OP_READ);\n        <span class=\"hljs-comment\">//å®¢æˆ·ç«¯å›å¤ä¿¡æ¯</span>\n        socketChannel.write(Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).encode(<span class=\"hljs-string\">&quot;æ¬¢è¿æ‚¨è¿›å…¥èŠå¤©å®¤&quot;</span>));\n    }\n\n    <span class=\"hljs-comment\">//å¤„ç†å¯è¯»çŠ¶æ€æ“ä½œ</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">readOperator</span><span class=\"hljs-params\">(Selector selector, SelectionKey selectionKey)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//ä»SelectionKeyè·å–åˆ°å·²ç»å°±ç»ªçš„é€šé“</span>\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span>(SocketChannel) selectionKey.channel();\n        <span class=\"hljs-comment\">//åˆ›å»ºbuffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-comment\">//å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span>\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">readLength</span> <span class=\"hljs-operator\">=</span> socketChannel.read(byteBuffer);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;&quot;</span>;\n        <span class=\"hljs-keyword\">if</span> (readLength&gt;<span class=\"hljs-number\">0</span>){\n            <span class=\"hljs-comment\">//åˆ‡æ¢è¯»æ¨¡å¼</span>\n            byteBuffer.flip();\n            message+=Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).decode(byteBuffer);\n        }\n        <span class=\"hljs-comment\">//å°†channelå†æ¬¡æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,ç›‘å¬å¯è¯»çŠ¶æ€</span>\n        socketChannel.register(selector,SelectionKey.OP_READ);\n        <span class=\"hljs-comment\">//æŠŠå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯</span>\n        <span class=\"hljs-keyword\">if</span>(message.length()&gt;<span class=\"hljs-number\">0</span>){\n            <span class=\"hljs-comment\">//å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯</span>\n            castOtherClient(message,selector,socketChannel);\n            System.out.println(message);\n        }\n    }\n\n    <span class=\"hljs-comment\">//å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">castOtherClient</span><span class=\"hljs-params\">(String message, Selector selector, SocketChannel socketChannel)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//è·å–æ‰€æœ‰å·²ç»æ¥å…¥çš„å®¢æˆ·ç«¯channel</span>\n        Set&lt;SelectionKey&gt; selectionKeySet = selector.keys();\n        <span class=\"hljs-comment\">//å¾ªç¯å‘æ‰€æœ‰channelå¹¿æ’­æ¶ˆæ¯</span>\n        <span class=\"hljs-keyword\">for</span>(SelectionKey selectionKey : selectionKeySet){\n            <span class=\"hljs-comment\">//è·å–æ¯ä¸ªchannel</span>\n            <span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">tarChannel</span> <span class=\"hljs-operator\">=</span> selectionKey.channel();\n            <span class=\"hljs-comment\">//ä¸éœ€è¦ç»™è‡ªå·±å‘é€</span>\n            <span class=\"hljs-keyword\">if</span>(tarChannel <span class=\"hljs-keyword\">instanceof</span> SocketChannel &amp;&amp; tarChannel != socketChannel){\n                ((SocketChannel)tarChannel).write(Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).encode(message));\n            }\n        }\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChatServer</span>().startServer();\n        } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></div></pre>\n<h3><a id=\"2__108\"></a>2 å®¢æˆ·ç«¯ä»£ç </h3>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ChatClient</span> {\n\n    <span class=\"hljs-comment\">//å¯åŠ¨å®¢æˆ·ç«¯æ–¹æ³•</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">startClient</span><span class=\"hljs-params\">(String name)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//è¿æ¥æœåŠ¡å™¨ç«¯</span>\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8000</span>));\n        <span class=\"hljs-comment\">//æ¥æ”¶æœåŠ¡å™¨ç«¯å“åº”æ•°æ®</span>\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        socketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        socketChannel.register(selector, SelectionKey.OP_READ);\n        <span class=\"hljs-comment\">//åˆ›å»ºçº¿ç¨‹</span>\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ClientThread</span>(selector)).start();\n\n        <span class=\"hljs-comment\">//å‘æœåŠ¡å™¨ç«¯å‘é€æ¶ˆæ¯</span>\n        <span class=\"hljs-type\">Scanner</span> <span class=\"hljs-variable\">scanner</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Scanner</span>(System.in);\n        <span class=\"hljs-keyword\">while</span> (scanner.hasNextLine()){\n            <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">msg</span> <span class=\"hljs-operator\">=</span> scanner.nextLine();\n            <span class=\"hljs-keyword\">if</span>(msg.length()&gt;<span class=\"hljs-number\">0</span>){\n                socketChannel.write(Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).encode(name+<span class=\"hljs-string\">&quot;:&quot;</span>+msg));\n            }\n        }\n    }\n    \n}\n</code></div></pre>\n<h4><a id=\"21_ClientThread_137\"></a>2.1 ClientThread</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ClientThread</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Runnable</span>{\n\n    <span class=\"hljs-keyword\">private</span> Selector selector;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">ClientThread</span><span class=\"hljs-params\">(Selector selector)</span> {\n        <span class=\"hljs-built_in\">this</span>.selector = selector;\n    }\n\n    <span class=\"hljs-meta\">@Override</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-keyword\">for</span>(;;){\n                <span class=\"hljs-comment\">//è·å–channelæ•°é‡</span>\n                <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">readChannels</span> <span class=\"hljs-operator\">=</span> selector.select();\n                <span class=\"hljs-keyword\">if</span>(readChannels == <span class=\"hljs-number\">0</span>){\n                    <span class=\"hljs-keyword\">continue</span>;\n                }\n                <span class=\"hljs-comment\">//è·å–å¯ç”¨çš„channel</span>\n                Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();\n                <span class=\"hljs-comment\">//éå†é›†åˆ</span>\n                Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();\n                <span class=\"hljs-keyword\">while</span> (iterator.hasNext()){\n                    <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">selectionKey</span> <span class=\"hljs-operator\">=</span> iterator.next();\n                    <span class=\"hljs-comment\">//ç§»é™¤æ‰seté›†åˆå½“å‰selectionKey</span>\n                    iterator.remove();\n                    <span class=\"hljs-comment\">//æ ¹æ®å°±ç»ªçŠ¶æ€,è°ƒç”¨å¯¹åº”æ–¹æ³•å®ç°å…·ä½“ä¸šåŠ¡æ“ä½œ</span>\n                    <span class=\"hljs-comment\">//å¦‚æœå¯è¯»çŠ¶æ€</span>\n                    <span class=\"hljs-keyword\">if</span>(selectionKey.isReadable()){\n                        readOperator(selector,selectionKey);\n                    }\n                }\n            }\n        } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    <span class=\"hljs-comment\">//å¤„ç†å¯è¯»çŠ¶æ€æ“ä½œ</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">readOperator</span><span class=\"hljs-params\">(Selector selector, SelectionKey selectionKey)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//ä»SelectionKeyè·å–åˆ°å·²ç»å°±ç»ªçš„é€šé“</span>\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span>(SocketChannel) selectionKey.channel();\n        <span class=\"hljs-comment\">//åˆ›å»ºbuffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-comment\">//å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span>\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">readLength</span> <span class=\"hljs-operator\">=</span> socketChannel.read(byteBuffer);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">message</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;&quot;</span>;\n        <span class=\"hljs-keyword\">if</span> (readLength&gt;<span class=\"hljs-number\">0</span>){\n            <span class=\"hljs-comment\">//åˆ‡æ¢è¯»æ¨¡å¼</span>\n            byteBuffer.flip();\n            message+= Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).decode(byteBuffer);\n        }\n        <span class=\"hljs-comment\">//å°†channelå†æ¬¡æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,ç›‘å¬å¯è¯»çŠ¶æ€</span>\n        socketChannel.register(selector,SelectionKey.OP_READ);\n        <span class=\"hljs-comment\">//æŠŠå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯</span>\n        <span class=\"hljs-keyword\">if</span>(message.length()&gt;<span class=\"hljs-number\">0</span>){\n            <span class=\"hljs-comment\">//å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯</span>\n            System.out.println(message);\n        }\n    }\n}\n</code></div></pre>\n<h4><a id=\"22_AClient_201\"></a>2.2 AClient</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">AClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChatClient</span>().startClient(<span class=\"hljs-string\">&quot;lucy&quot;</span>);\n        } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></div></pre>\n<h4><a id=\"23_BClient_214\"></a>2.3 BClient</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChatClient</span>().startClient(<span class=\"hljs-string\">&quot;mary&quot;</span>);\n        } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></div></pre>\n');
INSERT INTO `article_content` VALUES ('542c782529c33704c5f67d6e03ee939e', '# äºŒ. Netty \n\n\n\n## 1. æ¦‚è¿°\n\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\n\n```\nNetty is an asynchronous event-driven network application framework\nfor rapid development of maintainable high performance protocol servers & clients.\n```\n\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\n\n\n\n### 1.2 Netty çš„ä½œè€…\n\n![](img/0005.png)\n\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\n\n\n\n### 1.3 Netty çš„åœ°ä½\n\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\n\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\n\n* Cassandra - nosql æ•°æ®åº“\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\n* ElasticSearch - æœç´¢å¼•æ“\n* gRPC - rpc æ¡†æ¶\n* Dubbo - rpc æ¡†æ¶\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\n\n\n\n### 1.4 Netty çš„ä¼˜åŠ¿\n\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal => ThreadLocalï¼ŒByteBuf => ByteBuffer\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\n    * 2.x 2004\n    * 3.x 2008\n    * 4.x 2013\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\n\n\n\n## 2. Hello World\n\n### 2.1 ç›®æ ‡\n\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\n\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\n\n\n\nåŠ å…¥ä¾èµ–\n\n```xml\n<dependency>\n    <groupId>io.netty</groupId>\n    <artifactId>netty-all</artifactId>\n    <version>4.1.39.Final</version>\n</dependency>\n```\n\n\n\n\n\n### 2.2 æœåŠ¡å™¨ç«¯\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup()) // 1\n    .channel(NioServerSocketChannel.class) // 2\n    .childHandler(new ChannelInitializer<NioSocketChannel>() { // 3\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new StringDecoder()); // 5\n            ch.pipeline().addLast(new SimpleChannelInboundHandler<String>() { // 6\n                @Override\n                protected void channelRead0(ChannelHandlerContext ctx, String msg) {\n                    System.out.println(msg);\n                }\n            });\n        }\n    })\n    .bind(8080); // 4\n```\n\nä»£ç è§£è¯»\n- 1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º `çº¿ç¨‹æ±  + Selector` åé¢ä¼šè¯¦ç»†å±•å¼€\n- 2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰\n- 3 å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨\n- 4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£\n- 5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf => String\n- 6 å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ\n\n\n\n### 2.3 å®¢æˆ·ç«¯\n\n```java\nnew Bootstrap()\n    .group(new NioEventLoopGroup()) // 1\n    .channel(NioSocketChannel.class) // 2\n    .handler(new ChannelInitializer<Channel>() { // 3\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder()); // 8\n        }\n    })\n    .connect(\"127.0.0.1\", 8080) // 4\n    .sync() // 5\n    .channel() // 6\n    .writeAndFlush(new Date() + \": hello world!\"); // 7\n```\n\nä»£ç è§£è¯»\n- 1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server\n- 2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰\n- 3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨\n- 4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£\n- 5 å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•\n- 6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ\n- 7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº\n- 8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String => ByteBuf å‘å‡º\n- æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹\n\n### 2.4 æµç¨‹æ¢³ç†\n\n#### ğŸ’¡ æç¤º\n\n> ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ\n>\n> * æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“\n> * æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf\n> * æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº\n>   * å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆ...ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰\n>   * handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»\n> * æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº\n>   * å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰\n>   * å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡\n>   * å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº\n\n\n\n## 3. ç»„ä»¶\n\n### 3.1 EventLoop\n\näº‹ä»¶å¾ªç¯å¯¹è±¡\n\nEventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚\n\nå®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚\n\n* ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•\n* å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ\n  * æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop\n  * æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup\n\n\n\näº‹ä»¶å¾ªç¯ç»„\n\nEventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰\n\n* ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup\n  * å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›\n  * å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop\n\n\n\nä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š\n\n```java\n// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹\nDefaultEventLoopGroup group = new DefaultEventLoopGroup(2);\nSystem.out.println(group.next());\nSystem.out.println(group.next());\nSystem.out.println(group.next());\n```\n\nè¾“å‡º\n\n```\nio.netty.channel.DefaultEventLoop@60f82f98\nio.netty.channel.DefaultEventLoop@35f983a6\nio.netty.channel.DefaultEventLoop@60f82f98\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯\n\n```java\nDefaultEventLoopGroup group = new DefaultEventLoopGroup(2);\nfor (EventExecutor eventLoop : group) {\n    System.out.println(eventLoop);\n}\n```\n\nè¾“å‡º\n\n```\nio.netty.channel.DefaultEventLoop@60f82f98\nio.netty.channel.DefaultEventLoop@35f983a6\n```\n\n\n\n#### ğŸ’¡ ä¼˜é›…å…³é—­\n\nä¼˜é›…å…³é—­ `shutdownGracefully` æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ `EventLoopGroup` åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„\n\n\n\n#### æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶\n\næœåŠ¡å™¨ç«¯ä¸¤ä¸ª nio worker å·¥äºº\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup(1), new NioEventLoopGroup(2))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer<NioSocketChannel>() {\n        @Override\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf byteBuf = msg instanceof ByteBuf ? ((ByteBuf) msg) : null;\n                    if (byteBuf != null) {\n                        byte[] buf = new byte[16];\n                        ByteBuf len = byteBuf.readBytes(buf, 0, byteBuf.readableBytes());\n                        log.debug(new String(buf));\n                    }\n                }\n            });\n        }\n    }).bind(8080).sync();\n```\n\nå®¢æˆ·ç«¯ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰\n\n```java\npublic static void main(String[] args) throws InterruptedException {\n    Channel channel = new Bootstrap()\n            .group(new NioEventLoopGroup(1))\n            .handler(new ChannelInitializer<NioSocketChannel>() {\n                @Override\n                protected void initChannel(NioSocketChannel ch) throws Exception {\n                    System.out.println(\"init...\");\n                    ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                }\n            })\n            .channel(NioSocketChannel.class).connect(\"localhost\", 8080)\n            .sync()\n            .channel();\n\n    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(\"wangwu\".getBytes()));\n    Thread.sleep(2000);\n    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(\"wangwu\".getBytes()));\n```\n\næœ€åè¾“å‡º\n\n```\n22:03:34 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       \n22:03:36 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       \n22:05:36 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           \n22:05:38 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           \n22:06:09 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu        \n22:06:11 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu         \n```\n\nå¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå·¥äººè½®æµå¤„ç† channelï¼Œä½†å·¥äººä¸ channel ä¹‹é—´è¿›è¡Œäº†ç»‘å®š\n\n![](img/0042.png)\n\n\n\nå†å¢åŠ ä¸¤ä¸ªé nio å·¥äºº\n\n```java\nDefaultEventLoopGroup normalWorkers = new DefaultEventLoopGroup(2);\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup(1), new NioEventLoopGroup(2))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer<NioSocketChannel>() {\n        @Override\n        protected void initChannel(NioSocketChannel ch)  {\n            ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n            ch.pipeline().addLast(normalWorkers,\"myhandler\",\n              new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf byteBuf = msg instanceof ByteBuf ? ((ByteBuf) msg) : null;\n                    if (byteBuf != null) {\n                        byte[] buf = new byte[16];\n                        ByteBuf len = byteBuf.readBytes(buf, 0, byteBuf.readableBytes());\n                        log.debug(new String(buf));\n                    }\n                }\n            });\n        }\n    }).bind(8080).sync();\n```\n\nå®¢æˆ·ç«¯ä»£ç ä¸å˜ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰\n\nè¾“å‡º\n\n```\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] REGISTERED\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] ACTIVE\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |\n+--------+-------------------------------------------------+----------------+\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE\n22:19:48 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        \n22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |\n+--------+-------------------------------------------------+----------------+\n22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE\n22:19:50 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        \n22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] REGISTERED\n22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] ACTIVE\n22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6c 69 73 69                                     |lisi            |\n+--------+-------------------------------------------------+----------------+\n22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE\n22:20:25 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            \n22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6c 69 73 69                                     |lisi            |\n+--------+-------------------------------------------------+----------------+\n22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE\n22:20:27 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            \n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] REGISTERED\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] ACTIVE\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 61 6e 67 77 75                               |wangwu          |\n+--------+-------------------------------------------------+----------------+\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE\n22:20:38 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          \n22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 61 6e 67 77 75                               |wangwu          |\n+--------+-------------------------------------------------+----------------+\n22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE\n22:20:40 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          \n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œnio å·¥äººå’Œ é nio å·¥äººä¹Ÿåˆ†åˆ«ç»‘å®šäº† channelï¼ˆLoggingHandler ç”± nio å·¥äººæ‰§è¡Œï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„ handler ç”±é nio å·¥äººæ‰§è¡Œï¼‰\n\n\n\n![](img/0041.png)\n\n\n\n#### ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ\n\nå…³é”®ä»£ç  `io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()`\n\n```java\nstatic void invokeChannelRead(final AbstractChannelHandlerContext next, Object msg) {\n    final Object m = next.pipeline.touch(ObjectUtil.checkNotNull(msg, \"msg\"), next);\n    // ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹\n    EventExecutor executor = next.executor();\n    \n    // æ˜¯ï¼Œç›´æ¥è°ƒç”¨\n    if (executor.inEventLoop()) {\n        next.invokeChannelRead(m);\n    } \n    // ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰\n    else {\n        executor.execute(new Runnable() {\n            @Override\n            public void run() {\n                next.invokeChannelRead(m);\n            }\n        });\n    }\n}\n```\n\n* å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨\n* å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨\n\n\n\n#### æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡\n\nNioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡\n\n```java\nNioEventLoopGroup nioWorkers = new NioEventLoopGroup(2);\n\nlog.debug(\"server start...\");\nThread.sleep(2000);\nnioWorkers.execute(()->{\n    log.debug(\"normal task...\");\n});\n```\n\nè¾“å‡º\n\n```\n22:30:36 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...\n22:30:38 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - normal task...\n```\n\n> å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡\n\n\n\n#### æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡\n\n```java\nNioEventLoopGroup nioWorkers = new NioEventLoopGroup(2);\n\nlog.debug(\"server start...\");\nThread.sleep(2000);\nnioWorkers.scheduleAtFixedRate(() -> {\n    log.debug(\"running...\");\n}, 0, 1, TimeUnit.SECONDS);\n```\n\nè¾“å‡º\n\n```\n22:35:15 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...\n22:35:17 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:19 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:20 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n...\n```\n\n> å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡\n\n\n\n### 3.2 Channel\n\nchannel çš„ä¸»è¦ä½œç”¨\n\n* close() å¯ä»¥ç”¨æ¥å…³é—­ channel\n* closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­\n  * sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­\n  * è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­\n* pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨\n* write() æ–¹æ³•å°†æ•°æ®å†™å…¥\n* writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º\n\n\n\n#### ChannelFuture\n\nè¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç \n\n```java\nnew Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer<Channel>() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080)\n    .sync()\n    .channel()\n    .writeAndFlush(new Date() + \": hello world!\");\n```\n\nç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹\n\n```java\nChannelFuture channelFuture = new Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer<Channel>() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080); // 1\n\nchannelFuture.sync().channel().writeAndFlush(new Date() + \": hello world!\");\n```\n\n* 1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡\n\n**æ³¨æ„** connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡\n\nå®éªŒå¦‚ä¸‹ï¼š\n\n```java\nChannelFuture channelFuture = new Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer<Channel>() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080);\n\nSystem.out.println(channelFuture.channel()); // 1\nchannelFuture.sync(); // 2\nSystem.out.println(channelFuture.channel()); // 3\n```\n\n* æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° `[id: 0x2e1884dd]`\n* æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ\n* æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° `[id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080]`\n\né™¤äº†ç”¨ sync æ–¹æ³•å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼š\n\n```java\nChannelFuture channelFuture = new Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer<Channel>() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080);\nSystem.out.println(channelFuture.channel()); // 1\nchannelFuture.addListener((ChannelFutureListener) future -> {\n    System.out.println(future.channel()); // 2\n});\n```\n\n* æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° `[id: 0x749124ba]`\n* ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° `[id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080]`\n\n\n\n#### CloseFuture\n\n```java\n@Slf4j\npublic class CloseFutureClient {\n    public static void main(String[] args) throws InterruptedException {\n        NioEventLoopGroup group new NioEventLoopGroup();\n        ChannelFuture channelFuture = new Bootstrap()\n                .group(group)\n                .channel(NioSocketChannel.class)\n                .handler(new ChannelInitializer<NioSocketChannel>() {\n                    @Override // åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨\n                    protected void initChannel(NioSocketChannel ch) throws Exception {\n                        ch.pipeline().addLast(new LoggingHandler(LogLevel.DEBUG));\n                        ch.pipeline().addLast(new StringEncoder());\n                    }\n                })\n                .connect(new InetSocketAddress(\"localhost\", 8080));\n        Channel channel = channelFuture.sync().channel();\n        log.debug(\"{}\", channel);\n        new Thread(()->{\n            Scanner scanner = new Scanner(System.in);\n            while (true) {\n                String line = scanner.nextLine();\n                if (\"q\".equals(line)) {\n                    channel.close(); // close å¼‚æ­¥æ“ä½œ 1s ä¹‹å\n//                    log.debug(\"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ\"); // ä¸èƒ½åœ¨è¿™é‡Œå–„å\n                    break;\n                }\n                channel.writeAndFlush(line);\n            }\n        }, \"input\").start();\n\n        // è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­\n        ChannelFuture closeFuture = channel.closeFuture();\n        /*log.debug(\"waiting close...\");\n        closeFuture.sync();\n        log.debug(\"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ\");*/\n        closeFuture.addListener(new ChannelFutureListener() {\n            @Override\n            public void operationComplete(ChannelFuture future) throws Exception {\n                log.debug(\"å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ\");\n                group.shutdownGracefully();\n            }\n        });\n    }\n}\n```\n\n\n\n\n\n#### ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ\n- æœ‰äº›åŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥ã€‚\n- è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„ã€‚\n\næ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š`4 * 8 * 3 = 96`\n\nç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹\n\nå› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† `4 * 8 * 12` æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€\n\nè¦ç‚¹\n\n* å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿\n* å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ \n* åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®\n\n\n\n### 3.3 Future & Promise\n\nåœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£\n\né¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±•\n\n* jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ\n* netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ\n* netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨\n\n| åŠŸèƒ½/åç§°    | jdk Future                     | netty Future                                                 | Promise      |\n| ------------ | ------------------------------ | ------------------------------------------------------------ | ------------ |\n| cancel       | å–æ¶ˆä»»åŠ¡                       | -                                                            | -            |\n| isCanceled   | ä»»åŠ¡æ˜¯å¦å–æ¶ˆ                   | -                                                            | -            |\n| isDone       | ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥ | -                                                            | -            |\n| get          | è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…         | -                                                            | -            |\n| getNow       | -                              | è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null                | -            |\n| await        | -                              | ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­ | -            |\n| sync         | -                              | ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸                         | -            |\n| isSuccess    | -                              | åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ                                             | -            |\n| cause        | -                              | è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null                 | -            |\n| addLinstener | -                              | æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ                                       | -            |\n| setSuccess   | -                              | -                                                            | è®¾ç½®æˆåŠŸç»“æœ |\n| setFailure   | -                              | -                                                            | è®¾ç½®å¤±è´¥ç»“æœ |\n\n\n\n#### ä¾‹1\n\nåŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise<Integer> promise = new DefaultPromise<>(eventExecutors);\n\neventExecutors.execute(()->{\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(\"set success, {}\",10);\n    promise.setSuccess(10);\n});\n\nlog.debug(\"start...\");\nlog.debug(\"{}\",promise.getNow()); // è¿˜æ²¡æœ‰ç»“æœ\nlog.debug(\"{}\",promise.get());\n```\n\nè¾“å‡º\n\n```\n11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n11:51:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10\n11:51:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - 10\n```\n\n\n\n#### ä¾‹2\n\nå¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise<Integer> promise = new DefaultPromise<>(eventExecutors);\n\n// è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ\npromise.addListener(future -> {\n    // è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise\n    log.debug(\"{}\",future.getNow());\n});\n\n// ç­‰å¾… 1000 åè®¾ç½®æˆåŠŸç»“æœ\neventExecutors.execute(()->{\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(\"set success, {}\",10);\n    promise.setSuccess(10);\n});\n\nlog.debug(\"start...\");\n```\n\nè¾“å‡º\n\n```\n11:49:30 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10\n11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - 10\n```\n\n\n\n#### ä¾‹3\n\nåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync & get\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\n        DefaultPromise<Integer> promise = new DefaultPromise<>(eventExecutors);\n\n        eventExecutors.execute(() -> {\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            RuntimeException e = new RuntimeException(\"error...\");\n            log.debug(\"set failure, {}\", e.toString());\n            promise.setFailure(e);\n        });\n\n        log.debug(\"start...\");\n        log.debug(\"{}\", promise.getNow());\n        promise.get(); // sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸\n```\n\nè¾“å‡º\n\n```\n12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n12:11:08 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\nException in thread \"main\" java.util.concurrent.ExecutionException: java.lang.RuntimeException: error...\n	at io.netty.util.concurrent.AbstractFuture.get(AbstractFuture.java:41)\n	at com.itcast.oio.DefaultPromiseTest2.main(DefaultPromiseTest2.java:34)\nCaused by: java.lang.RuntimeException: error...\n	at com.itcast.oio.DefaultPromiseTest2.lambda$main$0(DefaultPromiseTest2.java:27)\n	at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n	at java.lang.Thread.run(Thread.java:745)\n```\n\n\n\n#### ä¾‹4\n\nåŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise<Integer> promise = new DefaultPromise<>(eventExecutors);\n\neventExecutors.execute(() -> {\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    RuntimeException e = new RuntimeException(\"error...\");\n    log.debug(\"set failure, {}\", e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(\"start...\");\nlog.debug(\"{}\", promise.getNow());\npromise.await(); // ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸\nlog.debug(\"result {}\", (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n```\n\nè¾“å‡º\n\n```\n12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n12:18:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\n12:18:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...\n```\n\n\n\n#### ä¾‹5\n\nå¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise<Integer> promise = new DefaultPromise<>(eventExecutors);\n\npromise.addListener(future -> {\n    log.debug(\"result {}\", (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n});\n\neventExecutors.execute(() -> {\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    RuntimeException e = new RuntimeException(\"error...\");\n    log.debug(\"set failure, {}\", e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(\"start...\");\n```\n\nè¾“å‡º\n\n```\n12:04:57 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\n12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...\n```\n\n\n\n#### ä¾‹6\n\nawait æ­»é”æ£€æŸ¥\n\n```java\nDefaultEventLoop eventExecutors = new DefaultEventLoop();\nDefaultPromise<Integer> promise = new DefaultPromise<>(eventExecutors);\n\neventExecutors.submit(()->{\n    System.out.println(\"1\");\n    try {\n        promise.await();\n        // æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸\n        // å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­\n        // è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º\n    } catch (Exception e) { \n        e.printStackTrace();\n    }\n    System.out.println(\"2\");\n});\neventExecutors.submit(()->{\n    System.out.println(\"3\");\n    try {\n        promise.await();\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n    System.out.println(\"4\");\n});\n```\n\nè¾“å‡º\n\n```\n1\n2\n3\n4\nio.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)\n	at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)\n	at io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)\n	at com.itcast.oio.DefaultPromiseTest.lambda$main$0(DefaultPromiseTest.java:27)\n	at io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\n	at io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)\n	at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n	at java.lang.Thread.run(Thread.java:745)\nio.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)\n	at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)\n	at io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)\n	at com.itcast.oio.DefaultPromiseTest.lambda$main$1(DefaultPromiseTest.java:36)\n	at io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\n	at io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)\n	at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n	at java.lang.Thread.run(Thread.java:745)\n\n```\n\n\n\n\n\n### 3.4 Handler & Pipeline\n\nChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥ç«™ã€å‡ºç«™ä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline\n\n* å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ\n* å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥\n\næ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“\n\n\n\nå…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer<NioSocketChannel>() {\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    System.out.println(1);\n                    ctx.fireChannelRead(msg); // 1\n                }\n            });\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    System.out.println(2);\n                    ctx.fireChannelRead(msg); // 2\n                }\n            });\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    System.out.println(3);\n                    ctx.channel().write(msg); // 3\n                }\n            });\n            ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){\n                @Override\n                public void write(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise) {\n                    System.out.println(4);\n                    ctx.write(msg, promise); // 4\n                }\n            });\n            ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){\n                @Override\n                public void write(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise) {\n                    System.out.println(5);\n                    ctx.write(msg, promise); // 5\n                }\n            });\n            ch.pipeline().addLast(new ChannelOutboundHandlerAdapter(){\n                @Override\n                public void write(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise) {\n                    System.out.println(6);\n                    ctx.write(msg, promise); // 6\n                }\n            });\n        }\n    })\n    .bind(8080);\n```\n\nå®¢æˆ·ç«¯\n\n```java\nnew Bootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer<Channel>() {\n        @Override\n        protected void initChannel(Channel ch) {\n            ch.pipeline().addLast(new StringEncoder());\n        }\n    })\n    .connect(\"127.0.0.1\", 8080)\n    .addListener((ChannelFutureListener) future -> {\n        future.channel().writeAndFlush(\"hello,world\");\n    });\n```\n\næœåŠ¡å™¨ç«¯æ‰“å°ï¼š\n\n```\n1\n2\n3\n6\n5\n4\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒChannelInboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ ChannelOutboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é€†åºæ‰§è¡Œçš„ã€‚ChannelPipeline çš„å®ç°æ˜¯ä¸€ä¸ª ChannelHandlerContextï¼ˆåŒ…è£…äº† ChannelHandlerï¼‰ ç»„æˆçš„åŒå‘é“¾è¡¨\n\n![](img/0008.png)\n\n* å…¥ç«™å¤„ç†å™¨ä¸­ï¼Œctx.fireChannelRead(msg) æ˜¯ **è°ƒç”¨ä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨**\n  * å¦‚æœæ³¨é‡Šæ‰ 1 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1\n  * å¦‚æœæ³¨é‡Šæ‰ 2 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2\n* 3 å¤„çš„ ctx.channel().write(msg) ä¼š **ä»å°¾éƒ¨å¼€å§‹è§¦å‘** åç»­å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ\n  * å¦‚æœæ³¨é‡Šæ‰ 3 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3\n* ç±»ä¼¼çš„ï¼Œå‡ºç«™å¤„ç†å™¨ä¸­ï¼Œctx.write(msg, promise) çš„è°ƒç”¨ä¹Ÿä¼š **è§¦å‘ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨**\n  * å¦‚æœæ³¨é‡Šæ‰ 6 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3 6\n* ctx.channel().write(msg) vs ctx.write(msg)\n  * éƒ½æ˜¯è§¦å‘å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ\n  * ctx.channel().write(msg) ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾å‡ºç«™å¤„ç†å™¨\n  * ctx.write(msg) æ˜¯ä»å½“å‰èŠ‚ç‚¹æ‰¾ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨\n  * 3 å¤„çš„ ctx.channel().write(msg) å¦‚æœæ”¹ä¸º ctx.write(msg) ä»…ä¼šæ‰“å° 1 2 3ï¼Œå› ä¸ºèŠ‚ç‚¹3 ä¹‹å‰æ²¡æœ‰å…¶å®ƒå‡ºç«™å¤„ç†å™¨äº†\n  * 6 å¤„çš„ ctx.write(msg, promise) å¦‚æœæ”¹ä¸º ctx.channel().write(msg) ä¼šæ‰“å° 1 2 3 6 6 6... å› ä¸º ctx.channel().write() æ˜¯ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾ï¼Œç»“æœåˆæ˜¯èŠ‚ç‚¹6 è‡ªå·±\n\n\n\nå›¾1 - æœåŠ¡ç«¯ pipeline è§¦å‘çš„åŸå§‹æµç¨‹ï¼Œå›¾ä¸­æ•°å­—ä»£è¡¨äº†å¤„ç†æ­¥éª¤çš„å…ˆåæ¬¡åº\n\n![](img/0009.png)\n\n\n\n### 3.5 ByteBuf\n\næ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…\n\n#### 1ï¼‰åˆ›å»º\n\n```java\nByteBuf buffer = ByteBufAllocator.DEFAULT.buffer(10);\nlog(buffer);\n```\n\nä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„ ByteBufï¼ˆæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBufï¼‰ï¼Œåˆå§‹å®¹é‡æ˜¯ 10\n\nè¾“å‡º\n\n```\nread index:0 write index:0 capacity:10\n```\n\nå…¶ä¸­ log æ–¹æ³•å‚è€ƒå¦‚ä¸‹\n\n```java\nprivate static void log(ByteBuf buffer) {\n    int length = buffer.readableBytes();\n    int rows = length / 16 + (length % 15 == 0 ? 0 : 1) + 4;\n    StringBuilder buf = new StringBuilder(rows * 80 * 2)\n        .append(\"read index:\").append(buffer.readerIndex())\n        .append(\" write index:\").append(buffer.writerIndex())\n        .append(\" capacity:\").append(buffer.capacity())\n        .append(NEWLINE);\n    appendPrettyHexDump(buf, buffer);\n    System.out.println(buf.toString());\n}\n```\n\n\n\n#### 2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜\n\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºå †çš„ ByteBuf\n\n```java\nByteBuf buffer = ByteBufAllocator.DEFAULT.heapBuffer(10);\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBuf\n\n```java\nByteBuf buffer = ByteBufAllocator.DEFAULT.directBuffer(10);\n```\n\n* ç›´æ¥å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½é«˜ï¼ˆå°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶ï¼‰ï¼Œé€‚åˆé…åˆæ± åŒ–åŠŸèƒ½ä¸€èµ·ç”¨\n* ç›´æ¥å†…å­˜å¯¹ GC å‹åŠ›å°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å­˜ä¸å— JVM åƒåœ¾å›æ”¶çš„ç®¡ç†ï¼Œä½†ä¹Ÿè¦æ³¨æ„åŠæ—¶ä¸»åŠ¨é‡Šæ”¾\n\n\n\n#### 3ï¼‰æ± åŒ– vs éæ± åŒ–\n\næ± åŒ–çš„æœ€å¤§æ„ä¹‰åœ¨äºå¯ä»¥é‡ç”¨ ByteBufï¼Œä¼˜ç‚¹æœ‰\n\n* æ²¡æœ‰æ± åŒ–ï¼Œåˆ™æ¯æ¬¡éƒ½å¾—åˆ›å»ºæ–°çš„ ByteBuf å®ä¾‹ï¼Œè¿™ä¸ªæ“ä½œå¯¹ç›´æ¥å†…å­˜ä»£ä»·æ˜‚è´µï¼Œå°±ç®—æ˜¯å †å†…å­˜ï¼Œä¹Ÿä¼šå¢åŠ  GC å‹åŠ›\n* æœ‰äº†æ± åŒ–ï¼Œåˆ™å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸ jemalloc ç±»ä¼¼çš„å†…å­˜åˆ†é…ç®—æ³•æå‡åˆ†é…æ•ˆç‡\n* é«˜å¹¶å‘æ—¶ï¼Œæ± åŒ–åŠŸèƒ½æ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½\n\næ± åŒ–åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è®¾ç½®\n\n```java\n-Dio.netty.allocator.type={unpooled|pooled}\n```\n\n* 4.1 ä»¥åï¼Œé Android å¹³å°é»˜è®¤å¯ç”¨æ± åŒ–å®ç°ï¼ŒAndroid å¹³å°å¯ç”¨éæ± åŒ–å®ç°\n* 4.1 ä¹‹å‰ï¼Œæ± åŒ–åŠŸèƒ½è¿˜ä¸æˆç†Ÿï¼Œé»˜è®¤æ˜¯éæ± åŒ–å®ç°\n\n\n\n#### 4ï¼‰ç»„æˆ\n\nByteBuf ç”±å››éƒ¨åˆ†ç»„æˆ\n\n![](img/0010.png)\n\næœ€å¼€å§‹è¯»å†™æŒ‡é’ˆéƒ½åœ¨ 0 ä½ç½®\n\n\n\n#### 5ï¼‰å†™å…¥\n\næ–¹æ³•åˆ—è¡¨ï¼Œçœç•¥ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•\n\n| æ–¹æ³•ç­¾å                                                     | å«ä¹‰                   | å¤‡æ³¨                                        |\n| ------------------------------------------------------------ | ---------------------- | ------------------------------------------- |\n| writeBoolean(boolean value)                                  | å†™å…¥ boolean å€¼        | ç”¨ä¸€å­—èŠ‚ 01\\|00 ä»£è¡¨ true\\|false            |\n| writeByte(int value)                                         | å†™å…¥ byte å€¼           |                                             |\n| writeShort(int value)                                        | å†™å…¥ short å€¼          |                                             |\n| writeInt(int value)                                          | å†™å…¥ int å€¼            | Big Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 00 00 02 50    |\n| writeIntLE(int value)                                        | å†™å…¥ int å€¼            | Little Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 50 02 00 00 |\n| writeLong(long value)                                        | å†™å…¥ long å€¼           |                                             |\n| writeChar(int value)                                         | å†™å…¥ char å€¼           |                                             |\n| writeFloat(float value)                                      | å†™å…¥ float å€¼          |                                             |\n| writeDouble(double value)                                    | å†™å…¥ double å€¼         |                                             |\n| writeBytes(ByteBuf src)                                      | å†™å…¥ netty çš„ ByteBuf  |                                             |\n| writeBytes(byte[] src)                                       | å†™å…¥ byte[]            |                                             |\n| writeBytes(ByteBuffer src)                                   | å†™å…¥ nio çš„ ByteBuffer |                                             |\n| int writeCharSequence(CharSequence sequence, Charset charset) | å†™å…¥å­—ç¬¦ä¸²             |                                             |\n\n> æ³¨æ„\n>\n> * è¿™äº›æ–¹æ³•çš„æœªæŒ‡æ˜è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼éƒ½æ˜¯ ByteBufï¼Œæ„å‘³ç€å¯ä»¥é“¾å¼è°ƒç”¨\n> * ç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä¹ æƒ¯æ˜¯ Big Endian\n\n\n\nå…ˆå†™å…¥ 4 ä¸ªå­—èŠ‚\n\n```java\nbuffer.writeBytes(new byte[]{1, 2, 3, 4});\nlog(buffer);\n```\n\nç»“æœæ˜¯\n\n```\nread index:0 write index:4 capacity:10\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04                                     |....            |\n+--------+-------------------------------------------------+----------------+\n```\n\nå†å†™å…¥ä¸€ä¸ª int æ•´æ•°ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚\n\n```java\nbuffer.writeInt(5);\nlog(buffer);\n```\n\nç»“æœæ˜¯\n\n```\nread index:0 write index:8 capacity:10\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 00 00 00 05                         |........        |\n+--------+-------------------------------------------------+----------------+\n```\n\n\n\nè¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯ set å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ï¼Œä½†ä¸ä¼šæ”¹å˜å†™æŒ‡é’ˆä½ç½®\n\n\n\n#### 6ï¼‰æ‰©å®¹\n\nå†å†™å…¥ä¸€ä¸ª int æ•´æ•°æ—¶ï¼Œå®¹é‡ä¸å¤Ÿäº†ï¼ˆåˆå§‹å®¹é‡æ˜¯ 10ï¼‰ï¼Œè¿™æ—¶ä¼šå¼•å‘æ‰©å®¹\n\n```java\nbuffer.writeInt(6);\nlog(buffer);\n```\n\næ‰©å®¹è§„åˆ™æ˜¯\n\n* å¦‚ä½•å†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 16 çš„æ•´æ•°å€ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 12 ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 16\n* å¦‚æœå†™å…¥åæ•°æ®å¤§å°è¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 2^nï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 513ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 2^10=1024ï¼ˆ2^9=512 å·²ç»ä¸å¤Ÿäº†ï¼‰\n* æ‰©å®¹ä¸èƒ½è¶…è¿‡ max capacity ä¼šæŠ¥é”™\n\nç»“æœæ˜¯\n\n```\nread index:0 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |\n+--------+-------------------------------------------------+----------------+\n```\n\n\n\n#### 7ï¼‰è¯»å–\n\nä¾‹å¦‚è¯»äº† 4 æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªå­—èŠ‚\n\n```java\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nlog(buffer);\n```\n\nè¯»è¿‡çš„å†…å®¹ï¼Œå°±å±äºåºŸå¼ƒéƒ¨åˆ†äº†ï¼Œå†è¯»åªèƒ½è¯»é‚£äº›å°šæœªè¯»å–çš„éƒ¨åˆ†\n\n```\n1\n2\n3\n4\nread index:4 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¦‚æœéœ€è¦é‡å¤è¯»å– int æ•´æ•° 5ï¼Œæ€ä¹ˆåŠï¼Ÿ\n\nå¯ä»¥åœ¨ read å‰å…ˆåšä¸ªæ ‡è®° mark\n\n```java\nbuffer.markReaderIndex();\nSystem.out.println(buffer.readInt());\nlog(buffer);\n```\n\nç»“æœ\n\n```\n5\nread index:8 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 06                                     |....            |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶è¦é‡å¤è¯»å–çš„è¯ï¼Œé‡ç½®åˆ°æ ‡è®°ä½ç½® reset\n\n```java\nbuffer.resetReaderIndex();\nlog(buffer);\n```\n\nè¿™æ—¶\n\n```\nread index:4 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿˜æœ‰ç§åŠæ³•æ˜¯é‡‡ç”¨ get å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šæ”¹å˜ read index\n\n\n\n#### 8ï¼‰retain & release\n\nç”±äº Netty ä¸­æœ‰å †å¤–å†…å­˜çš„ ByteBuf å®ç°ï¼Œå †å¤–å†…å­˜æœ€å¥½æ˜¯æ‰‹åŠ¨æ¥é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç­‰ GC åƒåœ¾å›æ”¶ã€‚\n\n* UnpooledHeapByteBuf ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ï¼Œåªéœ€ç­‰ GC å›æ”¶å†…å­˜å³å¯\n* UnpooledDirectByteBuf ä½¿ç”¨çš„å°±æ˜¯ç›´æ¥å†…å­˜äº†ï¼Œéœ€è¦ç‰¹æ®Šçš„æ–¹æ³•æ¥å›æ”¶å†…å­˜\n* PooledByteBuf å’Œå®ƒçš„å­ç±»ä½¿ç”¨äº†æ± åŒ–æœºåˆ¶ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜\n\n\n\n> å›æ”¶å†…å­˜çš„æºç å®ç°ï¼Œè¯·å…³æ³¨ä¸‹é¢æ–¹æ³•çš„ä¸åŒå®ç°\n>\n> `protected abstract void deallocate()`\n\n\n\nNetty è¿™é‡Œé‡‡ç”¨äº†å¼•ç”¨è®¡æ•°æ³•æ¥æ§åˆ¶å›æ”¶å†…å­˜ï¼Œæ¯ä¸ª ByteBuf éƒ½å®ç°äº† ReferenceCounted æ¥å£\n\n* æ¯ä¸ª ByteBuf å¯¹è±¡çš„åˆå§‹è®¡æ•°ä¸º 1\n* è°ƒç”¨ release æ–¹æ³•è®¡æ•°å‡ 1ï¼Œå¦‚æœè®¡æ•°ä¸º 0ï¼ŒByteBuf å†…å­˜è¢«å›æ”¶\n* è°ƒç”¨ retain æ–¹æ³•è®¡æ•°åŠ  1ï¼Œè¡¨ç¤ºè°ƒç”¨è€…æ²¡ç”¨å®Œä¹‹å‰ï¼Œå…¶å®ƒ handler å³ä½¿è°ƒç”¨äº† release ä¹Ÿä¸ä¼šé€ æˆå›æ”¶\n* å½“è®¡æ•°ä¸º 0 æ—¶ï¼Œåº•å±‚å†…å­˜ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å³ä½¿ ByteBuf å¯¹è±¡è¿˜åœ¨ï¼Œå…¶å„ä¸ªæ–¹æ³•å‡æ— æ³•æ­£å¸¸ä½¿ç”¨\n\n\n\nè°æ¥è´Ÿè´£ release å‘¢ï¼Ÿ\n\nä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰\n\n```java\nByteBuf buf = ...\ntry {\n    ...\n} finally {\n    buf.release();\n}\n```\n\nè¯·æ€è€ƒï¼Œå› ä¸º pipeline çš„å­˜åœ¨ï¼Œä¸€èˆ¬éœ€è¦å°† ByteBuf ä¼ é€’ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¦‚æœåœ¨ finally ä¸­ release äº†ï¼Œå°±å¤±å»äº†ä¼ é€’æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™ä¸ª ChannelHandler å†…è¿™ä¸ª ByteBuf å·²å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œé‚£ä¹ˆä¾¿æ— é¡»å†ä¼ é€’ï¼‰\n\nåŸºæœ¬è§„åˆ™æ˜¯ï¼Œ**è°æ˜¯æœ€åä½¿ç”¨è€…ï¼Œè°è´Ÿè´£ release**ï¼Œè¯¦ç»†åˆ†æå¦‚ä¸‹\n\n* èµ·ç‚¹ï¼Œå¯¹äº NIO å®ç°æ¥è®²ï¼Œåœ¨ io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read æ–¹æ³•ä¸­é¦–æ¬¡åˆ›å»º ByteBuf æ”¾å…¥ pipelineï¼ˆline 163 pipeline.fireChannelRead(byteBuf)ï¼‰\n* å…¥ç«™ ByteBuf å¤„ç†åŸåˆ™\n  * å¯¹åŸå§‹ ByteBuf ä¸åšå¤„ç†ï¼Œè°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œè¿™æ—¶æ— é¡» release\n  * å°†åŸå§‹ ByteBuf è½¬æ¢ä¸ºå…¶å®ƒç±»å‹çš„ Java å¯¹è±¡ï¼Œè¿™æ—¶ ByteBuf å°±æ²¡ç”¨äº†ï¼Œå¿…é¡» release\n  * å¦‚æœä¸è°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡» release\n  * æ³¨æ„å„ç§å¼‚å¸¸ï¼Œå¦‚æœ ByteBuf æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¿…é¡» release\n  * å‡è®¾æ¶ˆæ¯ä¸€ç›´å‘åä¼ ï¼Œé‚£ä¹ˆ TailContext ä¼šè´Ÿè´£é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯ï¼ˆåŸå§‹çš„ ByteBufï¼‰\n* å‡ºç«™ ByteBuf å¤„ç†åŸåˆ™\n  * å‡ºç«™æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè½¬ä¸º ByteBuf è¾“å‡ºï¼Œä¸€ç›´å‘å‰ä¼ ï¼Œç”± HeadContext flush å release\n* å¼‚å¸¸å¤„ç†åŸåˆ™\n  * æœ‰æ—¶å€™ä¸æ¸…æ¥š ByteBuf è¢«å¼•ç”¨äº†å¤šå°‘æ¬¡ï¼Œä½†åˆå¿…é¡»å½»åº•é‡Šæ”¾ï¼Œå¯ä»¥å¾ªç¯è°ƒç”¨ release ç›´åˆ°è¿”å› true\n\n\n\nTailContext é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯é€»è¾‘\n\n```java\n// io.netty.channel.DefaultChannelPipeline#onUnhandledInboundMessage(java.lang.Object)\nprotected void onUnhandledInboundMessage(Object msg) {\n    try {\n        logger.debug(\n            \"Discarded inbound message {} that reached at the tail of the pipeline. \" +\n            \"Please check your pipeline configuration.\", msg);\n    } finally {\n        ReferenceCountUtil.release(msg);\n    }\n}\n```\n\nå…·ä½“ä»£ç \n\n```java\n// io.netty.util.ReferenceCountUtil#release(java.lang.Object)\npublic static boolean release(Object msg) {\n    if (msg instanceof ReferenceCounted) {\n        return ((ReferenceCounted) msg).release();\n    }\n    return false;\n}\n```\n\n\n\n#### 9ï¼‰slice\n\nã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯¹åŸå§‹ ByteBuf è¿›è¡Œåˆ‡ç‰‡æˆå¤šä¸ª ByteBufï¼Œåˆ‡ç‰‡åçš„ ByteBuf å¹¶æ²¡æœ‰å‘ç”Ÿå†…å­˜å¤åˆ¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸå§‹ ByteBuf çš„å†…å­˜ï¼Œåˆ‡ç‰‡åçš„ ByteBuf ç»´æŠ¤ç‹¬ç«‹çš„ readï¼Œwrite æŒ‡é’ˆ\n\n![](img/0011.png)\n\nä¾‹ï¼ŒåŸå§‹ ByteBuf è¿›è¡Œä¸€äº›åˆå§‹æ“ä½œ\n\n```java\nByteBuf origin = ByteBufAllocator.DEFAULT.buffer(10);\norigin.writeBytes(new byte[]{1, 2, 3, 4});\norigin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶è°ƒç”¨ slice è¿›è¡Œåˆ‡ç‰‡ï¼Œæ— å‚ slice æ˜¯ä»åŸå§‹ ByteBuf çš„ read index åˆ° write index ä¹‹é—´çš„å†…å®¹è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡åçš„ max capacity è¢«å›ºå®šä¸ºè¿™ä¸ªåŒºé—´çš„å¤§å°ï¼Œå› æ­¤ä¸èƒ½è¿½åŠ  write\n\n```java\nByteBuf slice = origin.slice();\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n// slice.writeByte(5); å¦‚æœæ‰§è¡Œï¼Œä¼šæŠ¥ IndexOutOfBoundsException å¼‚å¸¸\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¦‚æœåŸå§‹ ByteBuf å†æ¬¡è¯»æ“ä½œï¼ˆåˆè¯»äº†ä¸€ä¸ªå­—èŠ‚ï¼‰\n\n```java\norigin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 03 04                                           |..              |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶çš„ slice ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒæœ‰ç‹¬ç«‹çš„è¯»å†™æŒ‡é’ˆ\n\n```java\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nå¦‚æœ slice çš„å†…å®¹å‘ç”Ÿäº†æ›´æ”¹\n\n```java\nslice.setByte(2, 5);\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 05                                        |...             |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™æ—¶ï¼ŒåŸå§‹ ByteBuf ä¹Ÿä¼šå—å½±å“ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯åŒä¸€å—å†…å­˜\n\n```\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 03 05                                           |..              |\n+--------+-------------------------------------------------+----------------+\n```\n\n\n\n#### 10ï¼‰duplicate\n\nã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå°±å¥½æ¯”æˆªå–äº†åŸå§‹ ByteBuf æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰ max capacity çš„é™åˆ¶ï¼Œä¹Ÿæ˜¯ä¸åŸå§‹ ByteBuf ä½¿ç”¨åŒä¸€å—åº•å±‚å†…å­˜ï¼Œåªæ˜¯è¯»å†™æŒ‡é’ˆæ˜¯ç‹¬ç«‹çš„\n\n![](img/0012.png)\n\n\n\n#### 11ï¼‰copy\n\nä¼šå°†åº•å±‚å†…å­˜æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œå› æ­¤æ— è®ºè¯»å†™ï¼Œéƒ½ä¸åŸå§‹ ByteBuf æ— å…³\n\n\n\n#### 12ï¼‰CompositeByteBuf\n\nã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯ä»¥å°†å¤šä¸ª ByteBuf åˆå¹¶ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„ ByteBufï¼Œé¿å…æ‹·è´\n\næœ‰ä¸¤ä¸ª ByteBuf å¦‚ä¸‹\n\n```java\nByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf1.writeBytes(new byte[]{1, 2, 3, 4, 5});\nByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf2.writeBytes(new byte[]{6, 7, 8, 9, 10});\nSystem.out.println(ByteBufUtil.prettyHexDump(buf1));\nSystem.out.println(ByteBufUtil.prettyHexDump(buf2));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05                                  |.....           |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 06 07 08 09 0a                                  |.....           |\n+--------+-------------------------------------------------+----------------+\n```\n\nç°åœ¨éœ€è¦ä¸€ä¸ªæ–°çš„ ByteBufï¼Œå†…å®¹æ¥è‡ªäºåˆšæ‰çš„ buf1 å’Œ buf2ï¼Œå¦‚ä½•å®ç°ï¼Ÿ\n\næ–¹æ³•1ï¼š\n\n```java\nByteBuf buf3 = ByteBufAllocator.DEFAULT\n    .buffer(buf1.readableBytes()+buf2.readableBytes());\nbuf3.writeBytes(buf1);\nbuf3.writeBytes(buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n```\n\nç»“æœ\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n```\n\nè¿™ç§æ–¹æ³•å¥½ä¸å¥½ï¼Ÿå›ç­”æ˜¯ä¸å¤ªå¥½ï¼Œå› ä¸ºè¿›è¡Œäº†æ•°æ®çš„å†…å­˜å¤åˆ¶æ“ä½œ\n\n\n\næ–¹æ³•2ï¼š\n\n```java\nCompositeByteBuf buf3 = ByteBufAllocator.DEFAULT.compositeBuffer();\n// true è¡¨ç¤ºå¢åŠ æ–°çš„ ByteBuf è‡ªåŠ¨é€’å¢ write index, å¦åˆ™ write index ä¼šå§‹ç»ˆä¸º 0\nbuf3.addComponents(true, buf1, buf2);\n```\n\nç»“æœæ˜¯ä¸€æ ·çš„\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n```\n\nCompositeByteBuf æ˜¯ä¸€ä¸ªç»„åˆçš„ ByteBufï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Component æ•°ç»„ï¼Œæ¯ä¸ª Component ç®¡ç†ä¸€ä¸ª ByteBufï¼Œè®°å½•äº†è¿™ä¸ª ByteBuf ç›¸å¯¹äºæ•´ä½“åç§»é‡ç­‰ä¿¡æ¯ï¼Œä»£è¡¨ç€æ•´ä½“ä¸­æŸä¸€æ®µçš„æ•°æ®ã€‚\n\n* ä¼˜ç‚¹ï¼Œå¯¹å¤–æ˜¯ä¸€ä¸ªè™šæ‹Ÿè§†å›¾ï¼Œç»„åˆè¿™äº› ByteBuf ä¸ä¼šäº§ç”Ÿå†…å­˜å¤åˆ¶\n* ç¼ºç‚¹ï¼Œå¤æ‚äº†å¾ˆå¤šï¼Œå¤šæ¬¡æ“ä½œä¼šå¸¦æ¥æ€§èƒ½çš„æŸè€—\n\n\n\n#### 13ï¼‰Unpooled\n\nUnpooled æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»å¦‚å…¶åï¼Œæä¾›äº†éæ± åŒ–çš„ ByteBuf åˆ›å»ºã€ç»„åˆã€å¤åˆ¶ç­‰æ“ä½œ\n\nè¿™é‡Œä»…ä»‹ç»å…¶è·Ÿã€é›¶æ‹·è´ã€‘ç›¸å…³çš„ wrappedBuffer æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£… ByteBuf\n\n```java\nByteBuf buf1 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf1.writeBytes(new byte[]{1, 2, 3, 4, 5});\nByteBuf buf2 = ByteBufAllocator.DEFAULT.buffer(5);\nbuf2.writeBytes(new byte[]{6, 7, 8, 9, 10});\n\n// å½“åŒ…è£… ByteBuf ä¸ªæ•°è¶…è¿‡ä¸€ä¸ªæ—¶, åº•å±‚ä½¿ç”¨äº† CompositeByteBuf\nByteBuf buf3 = Unpooled.wrappedBuffer(buf1, buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n```\n\nè¾“å‡º\n\n```\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n```\n\nä¹Ÿå¯ä»¥ç”¨æ¥åŒ…è£…æ™®é€šå­—èŠ‚æ•°ç»„ï¼Œåº•å±‚ä¹Ÿä¸ä¼šæœ‰æ‹·è´æ“ä½œ\n\n```java\nByteBuf buf4 = Unpooled.wrappedBuffer(new byte[]{1, 2, 3}, new byte[]{4, 5, 6});\nSystem.out.println(buf4.getClass());\nSystem.out.println(ByteBufUtil.prettyHexDump(buf4));\n```\n\nè¾“å‡º\n\n```\nclass io.netty.buffer.CompositeByteBuf\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06                               |......          |\n+--------+-------------------------------------------------+----------------+\n```\n\n\n\n#### ğŸ’¡ ByteBuf ä¼˜åŠ¿\n\n* æ± åŒ– - å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½\n* è¯»å†™æŒ‡é’ˆåˆ†ç¦»ï¼Œä¸éœ€è¦åƒ ByteBuffer ä¸€æ ·åˆ‡æ¢è¯»å†™æ¨¡å¼\n* å¯ä»¥è‡ªåŠ¨æ‰©å®¹\n* æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨æ›´æµç•…\n* å¾ˆå¤šåœ°æ–¹ä½“ç°é›¶æ‹·è´ï¼Œä¾‹å¦‚ sliceã€duplicateã€CompositeByteBuf\n\n\n\n## 4. åŒå‘é€šä¿¡\n\n### 4.1 ç»ƒä¹ \n\nå®ç°ä¸€ä¸ª echo server\n\nç¼–å†™ server\n\n```java\nnew ServerBootstrap()\n    .group(new NioEventLoopGroup())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(new ChannelInitializer<NioSocketChannel>() {\n        @Override\n        protected void initChannel(NioSocketChannel ch) {\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter(){\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf buffer = (ByteBuf) msg;\n                    System.out.println(buffer.toString(Charset.defaultCharset()));\n\n                    // å»ºè®®ä½¿ç”¨ ctx.alloc() åˆ›å»º ByteBuf\n                    ByteBuf response = ctx.alloc().buffer();\n                    response.writeBytes(buffer);\n                    ctx.writeAndFlush(response);\n\n                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—\n                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ response å—\n                }\n            });\n        }\n    }).bind(8080);\n```\n\nç¼–å†™ client\n\n```java\nNioEventLoopGroup group = new NioEventLoopGroup();\nChannel channel = new Bootstrap()\n    .group(group)\n    .channel(NioSocketChannel.class)\n    .handler(new ChannelInitializer<NioSocketChannel>() {\n        @Override\n        protected void initChannel(NioSocketChannel ch) throws Exception {\n            ch.pipeline().addLast(new StringEncoder());\n            ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {\n                @Override\n                public void channelRead(ChannelHandlerContext ctx, Object msg) {\n                    ByteBuf buffer = (ByteBuf) msg;\n                    System.out.println(buffer.toString(Charset.defaultCharset()));\n\n                    // æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—\n                }\n            });\n        }\n    }).connect(\"127.0.0.1\", 8080).sync().channel();\n\nchannel.closeFuture().addListener(future -> {\n    group.shutdownGracefully();\n});\n\nnew Thread(() -> {\n    Scanner scanner = new Scanner(System.in);\n    while (true) {\n        String line = scanner.nextLine();\n        if (\"q\".equals(line)) {\n            channel.close();\n            break;\n        }\n        channel.writeAndFlush(line);\n    }\n}).start();\n```\n\n\n\n### ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£\n\n\n\næˆ‘æœ€åˆåœ¨è®¤è¯†ä¸Šæœ‰è¿™æ ·çš„è¯¯åŒºï¼Œè®¤ä¸ºåªæœ‰åœ¨ nettyï¼Œnio è¿™æ ·çš„å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ—¶ï¼Œè¯»å†™æ‰ä¸ä¼šç›¸äº’é˜»å¡ï¼Œæ‰å¯ä»¥å®ç°é«˜æ•ˆçš„åŒå‘é€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒJava Socket æ˜¯å…¨åŒå·¥çš„ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨`A åˆ° B` å’Œ `B åˆ° A` çš„åŒå‘ä¿¡å·ä¼ è¾“ã€‚å³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»\n\n\n\nä¾‹å¦‚\n\n```java\npublic class TestServer {\n    public static void main(String[] args) throws IOException {\n        ServerSocket ss = new ServerSocket(8888);\n        Socket s = ss.accept();\n\n        new Thread(() -> {\n            try {\n                BufferedReader reader = new BufferedReader(new InputStreamReader(s.getInputStream()));\n                while (true) {\n                    System.out.println(reader.readLine());\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        new Thread(() -> {\n            try {\n                BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(s.getOutputStream()));\n                // ä¾‹å¦‚åœ¨è¿™ä¸ªä½ç½®åŠ å…¥ thread çº§åˆ«æ–­ç‚¹ï¼Œå¯ä»¥å‘ç°å³ä½¿ä¸å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸å¦¨ç¢å‰é¢çº¿ç¨‹è¯»å–å®¢æˆ·ç«¯æ•°æ®\n                for (int i = 0; i < 100; i++) {\n                    writer.write(String.valueOf(i));\n                    writer.newLine();\n                    writer.flush();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n```\n\nå®¢æˆ·ç«¯\n\n```java\npublic class TestClient {\n    public static void main(String[] args) throws IOException {\n        Socket s = new Socket(\"localhost\", 8888);\n\n        new Thread(() -> {\n            try {\n                BufferedReader reader = new BufferedReader(new InputStreamReader(s.getInputStream()));\n                while (true) {\n                    System.out.println(reader.readLine());\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        new Thread(() -> {\n            try {\n                BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(s.getOutputStream()));\n                for (int i = 0; i < 100; i++) {\n                    writer.write(String.valueOf(i));\n                    writer.newLine();\n                    writer.flush();\n                }\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n```\n\n\n\n\n\n\n\n\n\n', '2022-10-14 15:23:35', '2022-10-14 15:32:23', '<h1><a id=\"_Netty_0\"></a>äºŒ. Netty</h1>\n<h2><a id=\"1__4\"></a>1. æ¦‚è¿°</h2>\n<h3><a id=\"11_Netty__6\"></a>1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ</h3>\n<pre><code class=\"lang-\">Netty is an asynchronous event-driven network application framework\nfor rapid development of maintainable high performance protocol servers &amp; clients.\n</code></pre>\n<p>Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</p>\n<h3><a id=\"12_Netty__17\"></a>1.2 Netty çš„ä½œè€…</h3>\n<p><img src=\"img/0005.png\" alt=\"\" /></p>\n<p>ä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…</p>\n<h3><a id=\"13_Netty__25\"></a>1.3 Netty çš„åœ°ä½</h3>\n<p>Netty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½</p>\n<p>ä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼</p>\n<ul>\n<li>Cassandra - nosql æ•°æ®åº“</li>\n<li>Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶</li>\n<li>Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶</li>\n<li>RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—</li>\n<li>ElasticSearch - æœç´¢å¼•æ“</li>\n<li>gRPC - rpc æ¡†æ¶</li>\n<li>Dubbo - rpc æ¡†æ¶</li>\n<li>Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯</li>\n<li>Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶</li>\n</ul>\n<h3><a id=\"14_Netty__43\"></a>1.4 Netty çš„ä¼˜åŠ¿</h3>\n<ul>\n<li>Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\n<ul>\n<li>éœ€è¦è‡ªå·±æ„å»ºåè®®</li>\n<li>è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…</li>\n<li>epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%</li>\n<li>å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal =&gt; ThreadLocalï¼ŒByteBuf =&gt; ByteBuffer</li>\n</ul>\n</li>\n<li>Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\n<ul>\n<li>Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€</li>\n<li>ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\n<ul>\n<li>2.x 2004</li>\n<li>3.x 2008</li>\n<li>4.x 2013</li>\n<li>5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2><a id=\"2_Hello_World_60\"></a>2. Hello World</h2>\n<h3><a id=\"21__62\"></a>2.1 ç›®æ ‡</h3>\n<p>å¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯</p>\n<ul>\n<li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world</li>\n<li>æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›</li>\n</ul>\n<p>åŠ å…¥ä¾èµ–</p>\n<pre><div class=\"hljs\"><code class=\"lang-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>io.netty<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>netty-all<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.1.39.Final<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></div></pre>\n<h3><a id=\"22__85\"></a>2.2 æœåŠ¡å™¨ç«¯</h3>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>()) <span class=\"hljs-comment\">// 1</span>\n    .channel(NioServerSocketChannel.class) <span class=\"hljs-comment\">// 2</span>\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() { <span class=\"hljs-comment\">// 3</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringDecoder</span>()); <span class=\"hljs-comment\">// 5</span>\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleChannelInboundHandler</span>&lt;String&gt;() { <span class=\"hljs-comment\">// 6</span>\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead0</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, String msg)</span> {\n                    System.out.println(msg);\n                }\n            });\n        }\n    })\n    .bind(<span class=\"hljs-number\">8080</span>); <span class=\"hljs-comment\">// 4</span>\n</code></div></pre>\n<p>ä»£ç è§£è¯»</p>\n<ul>\n<li>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼Œå¯ä»¥ç®€å•ç†è§£ä¸º <code>çº¿ç¨‹æ±  + Selector</code> åé¢ä¼šè¯¦ç»†å±•å¼€</li>\n<li>2 å¤„ï¼Œé€‰æ‹©æœåŠ¡ Scoket å®ç°ç±»ï¼Œå…¶ä¸­ NioServerSocketChannel è¡¨ç¤ºåŸºäº NIO çš„æœåŠ¡å™¨ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</li>\n<li>3 å¤„ï¼Œä¸ºå•¥æ–¹æ³•å« childHandlerï¼Œæ˜¯æ¥ä¸‹æ¥æ·»åŠ çš„å¤„ç†å™¨éƒ½æ˜¯ç»™ SocketChannel ç”¨çš„ï¼Œè€Œä¸æ˜¯ç»™ ServerSocketChannelã€‚ChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</li>\n<li>4 å¤„ï¼ŒServerSocketChannel ç»‘å®šçš„ç›‘å¬ç«¯å£</li>\n<li>5 å¤„ï¼ŒSocketChannel çš„å¤„ç†å™¨ï¼Œè§£ç  ByteBuf =&gt; String</li>\n<li>6 å¤„ï¼ŒSocketChannel çš„ä¸šåŠ¡å¤„ç†å™¨ï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªå¤„ç†å™¨çš„å¤„ç†ç»“æœ</li>\n</ul>\n<h3><a id=\"23__115\"></a>2.3 å®¢æˆ·ç«¯</h3>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>()) <span class=\"hljs-comment\">// 1</span>\n    .channel(NioSocketChannel.class) <span class=\"hljs-comment\">// 2</span>\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() { <span class=\"hljs-comment\">// 3</span>\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>()); <span class=\"hljs-comment\">// 8</span>\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>) <span class=\"hljs-comment\">// 4</span>\n    .sync() <span class=\"hljs-comment\">// 5</span>\n    .channel() <span class=\"hljs-comment\">// 6</span>\n    .writeAndFlush(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>() + <span class=\"hljs-string\">&quot;: hello world!&quot;</span>); <span class=\"hljs-comment\">// 7</span>\n</code></div></pre>\n<p>ä»£ç è§£è¯»</p>\n<ul>\n<li>1 å¤„ï¼Œåˆ›å»º NioEventLoopGroupï¼ŒåŒ Server</li>\n<li>2 å¤„ï¼Œé€‰æ‹©å®¢æˆ· Socket å®ç°ç±»ï¼ŒNioSocketChannel è¡¨ç¤ºåŸºäº NIO çš„å®¢æˆ·ç«¯å®ç°ï¼Œå…¶å®ƒå®ç°è¿˜æœ‰</li>\n<li>3 å¤„ï¼Œæ·»åŠ  SocketChannel çš„å¤„ç†å™¨ï¼ŒChannelInitializer å¤„ç†å™¨ï¼ˆä»…æ‰§è¡Œä¸€æ¬¡ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¾…å®¢æˆ·ç«¯ SocketChannel å»ºç«‹è¿æ¥åï¼Œæ‰§è¡Œ initChannel ä»¥ä¾¿æ·»åŠ æ›´å¤šçš„å¤„ç†å™¨</li>\n<li>4 å¤„ï¼ŒæŒ‡å®šè¦è¿æ¥çš„æœåŠ¡å™¨å’Œç«¯å£</li>\n<li>5 å¤„ï¼ŒNetty ä¸­å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¦‚ connectï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨ sync æ–¹æ³•ç­‰å¾… connect å»ºç«‹è¿æ¥å®Œæ¯•</li>\n<li>6 å¤„ï¼Œè·å– channel å¯¹è±¡ï¼Œå®ƒå³ä¸ºé€šé“æŠ½è±¡ï¼Œå¯ä»¥è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œ</li>\n<li>7 å¤„ï¼Œå†™å…¥æ¶ˆæ¯å¹¶æ¸…ç©ºç¼“å†²åŒº</li>\n<li>8 å¤„ï¼Œæ¶ˆæ¯ä¼šç»è¿‡é€šé“ handler å¤„ç†ï¼Œè¿™é‡Œæ˜¯å°† String =&gt; ByteBuf å‘å‡º</li>\n<li>æ•°æ®ç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œåˆ°è¾¾æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯ 5 å’Œ 6 å¤„çš„ handler å…ˆåè¢«è§¦å‘ï¼Œèµ°å®Œä¸€ä¸ªæµç¨‹</li>\n</ul>\n<h3><a id=\"24__144\"></a>2.4 æµç¨‹æ¢³ç†</h3>\n<h4><a id=\"__146\"></a>ğŸ’¡ æç¤º</h4>\n<blockquote>\n<p>ä¸€å¼€å§‹éœ€è¦æ ‘ç«‹æ­£ç¡®çš„è§‚å¿µ</p>\n<ul>\n<li>æŠŠ channel ç†è§£ä¸ºæ•°æ®çš„é€šé“</li>\n<li>æŠŠ msg ç†è§£ä¸ºæµåŠ¨çš„æ•°æ®ï¼Œæœ€å¼€å§‹è¾“å…¥æ˜¯ ByteBufï¼Œä½†ç»è¿‡ pipeline çš„åŠ å·¥ï¼Œä¼šå˜æˆå…¶å®ƒç±»å‹å¯¹è±¡ï¼Œæœ€åè¾“å‡ºåˆå˜æˆ ByteBuf</li>\n<li>æŠŠ handler ç†è§£ä¸ºæ•°æ®çš„å¤„ç†å·¥åº\n<ul>\n<li>å·¥åºæœ‰å¤šé“ï¼Œåˆåœ¨ä¸€èµ·å°±æ˜¯ pipelineï¼Œpipeline è´Ÿè´£å‘å¸ƒäº‹ä»¶ï¼ˆè¯»ã€è¯»å–å®Œæˆâ€¦ï¼‰ä¼ æ’­ç»™æ¯ä¸ª handlerï¼Œ handler å¯¹è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡Œå¤„ç†ï¼ˆé‡å†™äº†ç›¸åº”äº‹ä»¶å¤„ç†æ–¹æ³•ï¼‰</li>\n<li>handler åˆ† Inbound å’Œ Outbound ä¸¤ç±»</li>\n</ul>\n</li>\n<li>æŠŠ eventLoop ç†è§£ä¸ºå¤„ç†æ•°æ®çš„å·¥äºº\n<ul>\n<li>å·¥äººå¯ä»¥ç®¡ç†å¤šä¸ª channel çš„ io æ“ä½œï¼Œå¹¶ä¸”ä¸€æ—¦å·¥äººè´Ÿè´£äº†æŸä¸ª channelï¼Œå°±è¦è´Ÿè´£åˆ°åº•ï¼ˆç»‘å®šï¼‰</li>\n<li>å·¥äººæ—¢å¯ä»¥æ‰§è¡Œ io æ“ä½œï¼Œä¹Ÿå¯ä»¥è¿›è¡Œä»»åŠ¡å¤„ç†ï¼Œæ¯ä½å·¥äººæœ‰ä»»åŠ¡é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—é‡Œå¯ä»¥å †æ”¾å¤šä¸ª channel çš„å¾…å¤„ç†ä»»åŠ¡ï¼Œä»»åŠ¡åˆ†ä¸ºæ™®é€šä»»åŠ¡ã€å®šæ—¶ä»»åŠ¡</li>\n<li>å·¥äººæŒ‰ç…§ pipeline é¡ºåºï¼Œä¾æ¬¡æŒ‰ç…§ handler çš„è§„åˆ’ï¼ˆä»£ç ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥ä¸ºæ¯é“å·¥åºæŒ‡å®šä¸åŒçš„å·¥äºº</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<h2><a id=\"3__162\"></a>3. ç»„ä»¶</h2>\n<h3><a id=\"31_EventLoop_164\"></a>3.1 EventLoop</h3>\n<p>äº‹ä»¶å¾ªç¯å¯¹è±¡</p>\n<p>EventLoop æœ¬è´¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ‰§è¡Œå™¨ï¼ˆåŒæ—¶ç»´æŠ¤äº†ä¸€ä¸ª Selectorï¼‰ï¼Œé‡Œé¢æœ‰ run æ–¹æ³•å¤„ç† Channel ä¸Šæºæºä¸æ–­çš„ io äº‹ä»¶ã€‚</p>\n<p>å®ƒçš„ç»§æ‰¿å…³ç³»æ¯”è¾ƒå¤æ‚</p>\n<ul>\n<li>ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª j.u.c.ScheduledExecutorService å› æ­¤åŒ…å«äº†çº¿ç¨‹æ± ä¸­æ‰€æœ‰çš„æ–¹æ³•</li>\n<li>å¦ä¸€æ¡çº¿æ˜¯ç»§æ‰¿è‡ª netty è‡ªå·±çš„ OrderedEventExecutorï¼Œ\n<ul>\n<li>æä¾›äº† boolean inEventLoop(Thread thread) æ–¹æ³•åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å±äºæ­¤ EventLoop</li>\n<li>æä¾›äº† parent æ–¹æ³•æ¥çœ‹çœ‹è‡ªå·±å±äºå“ªä¸ª EventLoopGroup</li>\n</ul>\n</li>\n</ul>\n<p>äº‹ä»¶å¾ªç¯ç»„</p>\n<p>EventLoopGroup æ˜¯ä¸€ç»„ EventLoopï¼ŒChannel ä¸€èˆ¬ä¼šè°ƒç”¨ EventLoopGroup çš„ register æ–¹æ³•æ¥ç»‘å®šå…¶ä¸­ä¸€ä¸ª EventLoopï¼Œåç»­è¿™ä¸ª Channel ä¸Šçš„ io äº‹ä»¶éƒ½ç”±æ­¤ EventLoop æ¥å¤„ç†ï¼ˆä¿è¯äº† io äº‹ä»¶å¤„ç†æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼‰</p>\n<ul>\n<li>ç»§æ‰¿è‡ª netty è‡ªå·±çš„ EventExecutorGroup\n<ul>\n<li>å®ç°äº† Iterable æ¥å£æä¾›éå† EventLoop çš„èƒ½åŠ›</li>\n<li>å¦æœ‰ next æ–¹æ³•è·å–é›†åˆä¸­ä¸‹ä¸€ä¸ª EventLoop</li>\n</ul>\n</li>\n</ul>\n<p>ä»¥ä¸€ä¸ªç®€å•çš„å®ç°ä¸ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">// å†…éƒ¨åˆ›å»ºäº†ä¸¤ä¸ª EventLoop, æ¯ä¸ª EventLoop ç»´æŠ¤ä¸€ä¸ªçº¿ç¨‹</span>\n<span class=\"hljs-type\">DefaultEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\nSystem.out.println(group.next());\nSystem.out.println(group.next());\nSystem.out.println(group.next());\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">io.netty.channel.DefaultEventLoop@60f82f98\nio.netty.channel.DefaultEventLoop@35f983a6\nio.netty.channel.DefaultEventLoop@60f82f98\n</code></pre>\n<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ for å¾ªç¯</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n<span class=\"hljs-keyword\">for</span> (EventExecutor eventLoop : group) {\n    System.out.println(eventLoop);\n}\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">io.netty.channel.DefaultEventLoop@60f82f98\nio.netty.channel.DefaultEventLoop@35f983a6\n</code></pre>\n<h4><a id=\"__225\"></a>ğŸ’¡ ä¼˜é›…å…³é—­</h4>\n<p>ä¼˜é›…å…³é—­ <code>shutdownGracefully</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šé¦–å…ˆåˆ‡æ¢ <code>EventLoopGroup</code> åˆ°å…³é—­çŠ¶æ€ä»è€Œæ‹’ç»æ–°çš„ä»»åŠ¡çš„åŠ å…¥ï¼Œç„¶ååœ¨ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡éƒ½å¤„ç†å®Œæˆåï¼Œåœæ­¢çº¿ç¨‹çš„è¿è¡Œã€‚ä»è€Œç¡®ä¿æ•´ä½“åº”ç”¨æ˜¯åœ¨æ­£å¸¸æœ‰åºçš„çŠ¶æ€ä¸‹é€€å‡ºçš„</p>\n<h4><a id=\"_NioEventLoop__io__231\"></a>æ¼”ç¤º NioEventLoop å¤„ç† io äº‹ä»¶</h4>\n<p>æœåŠ¡å™¨ç«¯ä¸¤ä¸ª nio worker å·¥äºº</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">1</span>), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">byteBuf</span> <span class=\"hljs-operator\">=</span> msg <span class=\"hljs-keyword\">instanceof</span> ByteBuf ? ((ByteBuf) msg) : <span class=\"hljs-literal\">null</span>;\n                    <span class=\"hljs-keyword\">if</span> (byteBuf != <span class=\"hljs-literal\">null</span>) {\n                        <span class=\"hljs-type\">byte</span>[] buf = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[<span class=\"hljs-number\">16</span>];\n                        <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">len</span> <span class=\"hljs-operator\">=</span> byteBuf.readBytes(buf, <span class=\"hljs-number\">0</span>, byteBuf.readableBytes());\n                        log.debug(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(buf));\n                    }\n                }\n            });\n        }\n    }).bind(<span class=\"hljs-number\">8080</span>).sync();\n</code></div></pre>\n<p>å®¢æˆ·ç«¯ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n    <span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n            .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">1</span>))\n            .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                    System.out.println(<span class=\"hljs-string\">&quot;init...&quot;</span>);\n                    ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                }\n            })\n            .channel(NioSocketChannel.class).connect(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>)\n            .sync()\n            .channel();\n\n    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(<span class=\"hljs-string\">&quot;wangwu&quot;</span>.getBytes()));\n    Thread.sleep(<span class=\"hljs-number\">2000</span>);\n    channel.writeAndFlush(ByteBufAllocator.DEFAULT.buffer().writeBytes(<span class=\"hljs-string\">&quot;wangwu&quot;</span>.getBytes()));\n</code></div></pre>\n<p>æœ€åè¾“å‡º</p>\n<pre><code class=\"lang-\">22:03:34 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       \n22:03:36 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - zhangsan       \n22:05:36 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           \n22:05:38 [DEBUG] [nioEventLoopGroup-3-2] c.i.o.EventLoopTest - lisi           \n22:06:09 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu        \n22:06:11 [DEBUG] [nioEventLoopGroup-3-1] c.i.o.EventLoopTest - wangwu         \n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå·¥äººè½®æµå¤„ç† channelï¼Œä½†å·¥äººä¸ channel ä¹‹é—´è¿›è¡Œäº†ç»‘å®š</p>\n<p><img src=\"img/0042.png\" alt=\"\" /></p>\n<p>å†å¢åŠ ä¸¤ä¸ªé nio å·¥äºº</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoopGroup</span> <span class=\"hljs-variable\">normalWorkers</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">1</span>), <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>))\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span>  {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n            ch.pipeline().addLast(normalWorkers,<span class=\"hljs-string\">&quot;myhandler&quot;</span>,\n              <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">byteBuf</span> <span class=\"hljs-operator\">=</span> msg <span class=\"hljs-keyword\">instanceof</span> ByteBuf ? ((ByteBuf) msg) : <span class=\"hljs-literal\">null</span>;\n                    <span class=\"hljs-keyword\">if</span> (byteBuf != <span class=\"hljs-literal\">null</span>) {\n                        <span class=\"hljs-type\">byte</span>[] buf = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[<span class=\"hljs-number\">16</span>];\n                        <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">len</span> <span class=\"hljs-operator\">=</span> byteBuf.readBytes(buf, <span class=\"hljs-number\">0</span>, byteBuf.readableBytes());\n                        log.debug(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(buf));\n                    }\n                }\n            });\n        }\n    }).bind(<span class=\"hljs-number\">8080</span>).sync();\n</code></div></pre>\n<p>å®¢æˆ·ç«¯ä»£ç ä¸å˜ï¼Œå¯åŠ¨ä¸‰æ¬¡ï¼Œåˆ†åˆ«ä¿®æ”¹å‘é€å­—ç¬¦ä¸²ä¸º zhangsanï¼ˆç¬¬ä¸€æ¬¡ï¼‰ï¼Œlisiï¼ˆç¬¬äºŒæ¬¡ï¼‰ï¼Œwangwuï¼ˆç¬¬ä¸‰æ¬¡ï¼‰</p>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] REGISTERED\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] ACTIVE\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |\n+--------+-------------------------------------------------+----------------+\n22:19:48 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE\n22:19:48 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        \n22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ: 8B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 7a 68 61 6e 67 73 61 6e                         |zhangsan        |\n+--------+-------------------------------------------------+----------------+\n22:19:50 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x251562d5, L:/127.0.0.1:8080 - R:/127.0.0.1:52588] READ COMPLETE\n22:19:50 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - zhangsan        \n22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] REGISTERED\n22:20:24 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] ACTIVE\n22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6c 69 73 69                                     |lisi            |\n+--------+-------------------------------------------------+----------------+\n22:20:25 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE\n22:20:25 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            \n22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ: 4B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 6c 69 73 69                                     |lisi            |\n+--------+-------------------------------------------------+----------------+\n22:20:27 [DEBUG] [nioEventLoopGroup-4-2] i.n.h.l.LoggingHandler - [id: 0x94b2a840, L:/127.0.0.1:8080 - R:/127.0.0.1:52612] READ COMPLETE\n22:20:27 [DEBUG] [defaultEventLoopGroup-2-2] c.i.o.EventLoopTest - lisi            \n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] REGISTERED\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] ACTIVE\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 61 6e 67 77 75                               |wangwu          |\n+--------+-------------------------------------------------+----------------+\n22:20:38 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE\n22:20:38 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          \n22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ: 6B\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 77 61 6e 67 77 75                               |wangwu          |\n+--------+-------------------------------------------------+----------------+\n22:20:40 [DEBUG] [nioEventLoopGroup-4-1] i.n.h.l.LoggingHandler - [id: 0x79a26af9, L:/127.0.0.1:8080 - R:/127.0.0.1:52625] READ COMPLETE\n22:20:40 [DEBUG] [defaultEventLoopGroup-2-1] c.i.o.EventLoopTest - wangwu          \n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œnio å·¥äººå’Œ é nio å·¥äººä¹Ÿåˆ†åˆ«ç»‘å®šäº† channelï¼ˆLoggingHandler ç”± nio å·¥äººæ‰§è¡Œï¼Œè€Œæˆ‘ä»¬è‡ªå·±çš„ handler ç”±é nio å·¥äººæ‰§è¡Œï¼‰</p>\n<p><img src=\"img/0041.png\" alt=\"\" /></p>\n<h4><a id=\"_handler__392\"></a>ğŸ’¡ handler æ‰§è¡Œä¸­å¦‚ä½•æ¢äººï¼Ÿ</h4>\n<p>å…³é”®ä»£ç  <code>io.netty.channel.AbstractChannelHandlerContext#invokeChannelRead()</code></p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">invokeChannelRead</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">final</span> AbstractChannelHandlerContext next, Object msg)</span> {\n    <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Object</span> <span class=\"hljs-variable\">m</span> <span class=\"hljs-operator\">=</span> next.pipeline.touch(ObjectUtil.checkNotNull(msg, <span class=\"hljs-string\">&quot;msg&quot;</span>), next);\n    <span class=\"hljs-comment\">// ä¸‹ä¸€ä¸ª handler çš„äº‹ä»¶å¾ªç¯æ˜¯å¦ä¸å½“å‰çš„äº‹ä»¶å¾ªç¯æ˜¯åŒä¸€ä¸ªçº¿ç¨‹</span>\n    <span class=\"hljs-type\">EventExecutor</span> <span class=\"hljs-variable\">executor</span> <span class=\"hljs-operator\">=</span> next.executor();\n    \n    <span class=\"hljs-comment\">// æ˜¯ï¼Œç›´æ¥è°ƒç”¨</span>\n    <span class=\"hljs-keyword\">if</span> (executor.inEventLoop()) {\n        next.invokeChannelRead(m);\n    } \n    <span class=\"hljs-comment\">// ä¸æ˜¯ï¼Œå°†è¦æ‰§è¡Œçš„ä»£ç ä½œä¸ºä»»åŠ¡æäº¤ç»™ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å¤„ç†ï¼ˆæ¢äººï¼‰</span>\n    <span class=\"hljs-keyword\">else</span> {\n        executor.execute(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Runnable</span>() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> {\n                next.invokeChannelRead(m);\n            }\n        });\n    }\n}\n</code></div></pre>\n<ul>\n<li>å¦‚æœä¸¤ä¸ª handler ç»‘å®šçš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è°ƒç”¨</li>\n<li>å¦åˆ™ï¼ŒæŠŠè¦è°ƒç”¨çš„ä»£ç å°è£…ä¸ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œç”±ä¸‹ä¸€ä¸ª handler çš„çº¿ç¨‹æ¥è°ƒç”¨</li>\n</ul>\n<h4><a id=\"_NioEventLoop__423\"></a>æ¼”ç¤º NioEventLoop å¤„ç†æ™®é€šä»»åŠ¡</h4>\n<p>NioEventLoop é™¤äº†å¯ä»¥å¤„ç† io äº‹ä»¶ï¼ŒåŒæ ·å¯ä»¥å‘å®ƒæäº¤æ™®é€šä»»åŠ¡</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">nioWorkers</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n\nlog.debug(<span class=\"hljs-string\">&quot;server start...&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nnioWorkers.execute(()-&gt;{\n    log.debug(<span class=\"hljs-string\">&quot;normal task...&quot;</span>);\n});\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">22:30:36 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...\n22:30:38 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - normal task...\n</code></pre>\n<blockquote>\n<p>å¯ä»¥ç”¨æ¥æ‰§è¡Œè€—æ—¶è¾ƒé•¿çš„ä»»åŠ¡</p>\n</blockquote>\n<h4><a id=\"_NioEventLoop__448\"></a>æ¼”ç¤º NioEventLoop å¤„ç†å®šæ—¶ä»»åŠ¡</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">nioWorkers</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>(<span class=\"hljs-number\">2</span>);\n\nlog.debug(<span class=\"hljs-string\">&quot;server start...&quot;</span>);\nThread.sleep(<span class=\"hljs-number\">2000</span>);\nnioWorkers.scheduleAtFixedRate(() -&gt; {\n    log.debug(<span class=\"hljs-string\">&quot;running...&quot;</span>);\n}, <span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">1</span>, TimeUnit.SECONDS);\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">22:35:15 [DEBUG] [main] c.i.o.EventLoopTest2 - server start...\n22:35:17 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:18 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:19 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n22:35:20 [DEBUG] [nioEventLoopGroup-2-1] c.i.o.EventLoopTest2 - running...\n...\n</code></pre>\n<blockquote>\n<p>å¯ä»¥ç”¨æ¥æ‰§è¡Œå®šæ—¶ä»»åŠ¡</p>\n</blockquote>\n<h3><a id=\"32_Channel_475\"></a>3.2 Channel</h3>\n<p>channel çš„ä¸»è¦ä½œç”¨</p>\n<ul>\n<li>close() å¯ä»¥ç”¨æ¥å…³é—­ channel</li>\n<li>closeFuture() ç”¨æ¥å¤„ç† channel çš„å…³é—­\n<ul>\n<li>sync æ–¹æ³•ä½œç”¨æ˜¯åŒæ­¥ç­‰å¾… channel å…³é—­</li>\n<li>è€Œ addListener æ–¹æ³•æ˜¯å¼‚æ­¥ç­‰å¾… channel å…³é—­</li>\n</ul>\n</li>\n<li>pipeline() æ–¹æ³•æ·»åŠ å¤„ç†å™¨</li>\n<li>write() æ–¹æ³•å°†æ•°æ®å†™å…¥</li>\n<li>writeAndFlush() æ–¹æ³•å°†æ•°æ®å†™å…¥å¹¶åˆ·å‡º</li>\n</ul>\n<h4><a id=\"ChannelFuture_489\"></a>ChannelFuture</h4>\n<p>è¿™æ—¶åˆšæ‰çš„å®¢æˆ·ç«¯ä»£ç </p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>)\n    .sync()\n    .channel()\n    .writeAndFlush(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>() + <span class=\"hljs-string\">&quot;: hello world!&quot;</span>);\n</code></div></pre>\n<p>ç°åœ¨æŠŠå®ƒæ‹†å¼€æ¥çœ‹</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>); <span class=\"hljs-comment\">// 1</span>\n\nchannelFuture.sync().channel().writeAndFlush(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>() + <span class=\"hljs-string\">&quot;: hello world!&quot;</span>);\n</code></div></pre>\n<ul>\n<li>1 å¤„è¿”å›çš„æ˜¯ ChannelFuture å¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯åˆ©ç”¨ channel() æ–¹æ³•æ¥è·å– Channel å¯¹è±¡</li>\n</ul>\n<p><strong>æ³¨æ„</strong> connect æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œæ„å‘³ç€ä¸ç­‰è¿æ¥å»ºç«‹ï¼Œæ–¹æ³•æ‰§è¡Œå°±è¿”å›äº†ã€‚å› æ­¤ channelFuture å¯¹è±¡ä¸­ä¸èƒ½ã€ç«‹åˆ»ã€‘è·å¾—åˆ°æ­£ç¡®çš„ Channel å¯¹è±¡</p>\n<p>å®éªŒå¦‚ä¸‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>);\n\nSystem.out.println(channelFuture.channel()); <span class=\"hljs-comment\">// 1</span>\nchannelFuture.sync(); <span class=\"hljs-comment\">// 2</span>\nSystem.out.println(channelFuture.channel()); <span class=\"hljs-comment\">// 3</span>\n</code></div></pre>\n<ul>\n<li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x2e1884dd]</code></li>\n<li>æ‰§è¡Œåˆ° 2 æ—¶ï¼Œsync æ–¹æ³•æ˜¯åŒæ­¥ç­‰å¾…è¿æ¥å»ºç«‹å®Œæˆ</li>\n<li>æ‰§è¡Œåˆ° 3 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x2e1884dd, L:/127.0.0.1:57191 - R:/127.0.0.1:8080]</code></li>\n</ul>\n<p>é™¤äº†ç”¨ sync æ–¹æ³•å¯ä»¥è®©å¼‚æ­¥æ“ä½œåŒæ­¥ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å›è°ƒçš„æ–¹å¼ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>);\nSystem.out.println(channelFuture.channel()); <span class=\"hljs-comment\">// 1</span>\nchannelFuture.addListener((ChannelFutureListener) future -&gt; {\n    System.out.println(future.channel()); <span class=\"hljs-comment\">// 2</span>\n});\n</code></div></pre>\n<ul>\n<li>æ‰§è¡Œåˆ° 1 æ—¶ï¼Œè¿æ¥æœªå»ºç«‹ï¼Œæ‰“å° <code>[id: 0x749124ba]</code></li>\n<li>ChannelFutureListener ä¼šåœ¨è¿æ¥å»ºç«‹æ—¶è¢«è°ƒç”¨ï¼ˆå…¶ä¸­ operationComplete æ–¹æ³•ï¼‰ï¼Œå› æ­¤æ‰§è¡Œåˆ° 2 æ—¶ï¼Œè¿æ¥è‚¯å®šå»ºç«‹äº†ï¼Œæ‰“å° <code>[id: 0x749124ba, L:/127.0.0.1:57351 - R:/127.0.0.1:8080]</code></li>\n</ul>\n<h4><a id=\"CloseFuture_577\"></a>CloseFuture</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-meta\">@Slf4j</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">CloseFutureClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> InterruptedException {\n        NioEventLoopGroup group <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n        <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">channelFuture</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n                .group(group)\n                .channel(NioSocketChannel.class)\n                .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n                    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-comment\">// åœ¨è¿æ¥å»ºç«‹åè¢«è°ƒç”¨</span>\n                    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                        ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">LoggingHandler</span>(LogLevel.DEBUG));\n                        ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n                    }\n                })\n                .connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8080</span>));\n        <span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> channelFuture.sync().channel();\n        log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, channel);\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(()-&gt;{\n            <span class=\"hljs-type\">Scanner</span> <span class=\"hljs-variable\">scanner</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Scanner</span>(System.in);\n            <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">line</span> <span class=\"hljs-operator\">=</span> scanner.nextLine();\n                <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;q&quot;</span>.equals(line)) {\n                    channel.close(); <span class=\"hljs-comment\">// close å¼‚æ­¥æ“ä½œ 1s ä¹‹å</span>\n<span class=\"hljs-comment\">//                    log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;); // ä¸èƒ½åœ¨è¿™é‡Œå–„å</span>\n                    <span class=\"hljs-keyword\">break</span>;\n                }\n                channel.writeAndFlush(line);\n            }\n        }, <span class=\"hljs-string\">&quot;input&quot;</span>).start();\n\n        <span class=\"hljs-comment\">// è·å– CloseFuture å¯¹è±¡ï¼Œ 1) åŒæ­¥å¤„ç†å…³é—­ï¼Œ 2) å¼‚æ­¥å¤„ç†å…³é—­</span>\n        <span class=\"hljs-type\">ChannelFuture</span> <span class=\"hljs-variable\">closeFuture</span> <span class=\"hljs-operator\">=</span> channel.closeFuture();\n        <span class=\"hljs-comment\">/*log.debug(&quot;waiting close...&quot;);\n        closeFuture.sync();\n        log.debug(&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;);*/</span>\n        closeFuture.addListener(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelFutureListener</span>() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">operationComplete</span><span class=\"hljs-params\">(ChannelFuture future)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n                log.debug(<span class=\"hljs-string\">&quot;å¤„ç†å…³é—­ä¹‹åçš„æ“ä½œ&quot;</span>);\n                group.shutdownGracefully();\n            }\n        });\n    }\n}\n</code></div></pre>\n<h4><a id=\"__630\"></a>ğŸ’¡ å¼‚æ­¥æå‡çš„æ˜¯ä»€ä¹ˆ</h4>\n<ul>\n<li>æœ‰äº›åŒå­¦çœ‹åˆ°è¿™é‡Œä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å»æ‰§è¡Œå»ºç«‹è¿æ¥ã€å»æ‰§è¡Œå…³é—­ channelï¼Œé‚£æ ·ä¸æ˜¯ä¹Ÿå¯ä»¥å—ï¼Ÿéè¦ç”¨è¿™ä¹ˆå¤æ‚çš„å¼‚æ­¥æ–¹å¼ï¼šæ¯”å¦‚ä¸€ä¸ªçº¿ç¨‹å‘èµ·å»ºç«‹è¿æ¥ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å»çœŸæ­£å»ºç«‹è¿æ¥ã€‚</li>\n<li>è¿˜æœ‰åŒå­¦ä¼šç¬¼ç»Ÿåœ°å›ç­”ï¼Œå› ä¸º netty å¼‚æ­¥æ–¹å¼ç”¨äº†å¤šçº¿ç¨‹ã€å¤šçº¿ç¨‹å°±æ•ˆç‡é«˜ã€‚å…¶å®è¿™äº›è®¤è¯†éƒ½æ¯”è¾ƒç‰‡é¢ï¼Œå¤šçº¿ç¨‹å’Œå¼‚æ­¥æ‰€æå‡çš„æ•ˆç‡å¹¶ä¸æ˜¯æ‰€è®¤ä¸ºçš„ã€‚</li>\n</ul>\n<p>æ€è€ƒä¸‹é¢çš„åœºæ™¯ï¼Œ4 ä¸ªåŒ»ç”Ÿç»™äººçœ‹ç—…ï¼Œæ¯ä¸ªç—…äººèŠ±è´¹ 20 åˆ†é’Ÿï¼Œè€Œä¸”åŒ»ç”Ÿçœ‹ç—…çš„è¿‡ç¨‹ä¸­æ˜¯ä»¥ç—…äººä¸ºå•ä½çš„ï¼Œä¸€ä¸ªç—…äººçœ‹å®Œäº†ï¼Œæ‰èƒ½çœ‹ä¸‹ä¸€ä¸ªç—…äººã€‚å‡è®¾ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œå¯ä»¥è®¡ç®—ä¸€ä¸‹ 4 ä¸ªåŒ»ç”Ÿä¸€å¤©å·¥ä½œ 8 å°æ—¶ï¼Œå¤„ç†çš„ç—…äººæ€»æ•°æ˜¯ï¼š<code>4 * 8 * 3 = 96</code></p>\n<p>ç»ç ”ç©¶å‘ç°ï¼Œçœ‹ç—…å¯ä»¥ç»†åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼Œç»æ‹†åˆ†åæ¯ä¸ªæ­¥éª¤éœ€è¦ 5 åˆ†é’Ÿï¼Œå¦‚ä¸‹</p>\n<p>å› æ­¤å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼Œåªæœ‰ä¸€å¼€å§‹ï¼ŒåŒ»ç”Ÿ 2ã€3ã€4 åˆ†åˆ«è¦ç­‰å¾… 5ã€10ã€15 åˆ†é’Ÿæ‰èƒ½æ‰§è¡Œå·¥ä½œï¼Œä½†åªè¦åç»­ç—…äººæºæºä¸æ–­åœ°æ¥ï¼Œä»–ä»¬å°±èƒ½å¤Ÿæ»¡è´Ÿè·å·¥ä½œï¼Œå¹¶ä¸”å¤„ç†ç—…äººçš„èƒ½åŠ›æé«˜åˆ°äº† <code>4 * 8 * 12</code> æ•ˆç‡å‡ ä¹æ˜¯åŸæ¥çš„å››å€</p>\n<p>è¦ç‚¹</p>\n<ul>\n<li>å•çº¿ç¨‹æ²¡æ³•å¼‚æ­¥æé«˜æ•ˆç‡ï¼Œå¿…é¡»é…åˆå¤šçº¿ç¨‹ã€å¤šæ ¸ cpu æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„ä¼˜åŠ¿</li>\n<li>å¼‚æ­¥å¹¶æ²¡æœ‰ç¼©çŸ­å“åº”æ—¶é—´ï¼Œåè€Œæœ‰æ‰€å¢åŠ </li>\n<li>åˆç†è¿›è¡Œä»»åŠ¡æ‹†åˆ†ï¼Œä¹Ÿæ˜¯åˆ©ç”¨å¼‚æ­¥çš„å…³é”®</li>\n</ul>\n<h3><a id=\"33_Future__Promise_648\"></a>3.3 Future &amp; Promise</h3>\n<p>åœ¨å¼‚æ­¥å¤„ç†æ—¶ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸¤ä¸ªæ¥å£</p>\n<p>é¦–å…ˆè¦è¯´æ˜ netty ä¸­çš„ Future ä¸ jdk ä¸­çš„ Future åŒåï¼Œä½†æ˜¯æ˜¯ä¸¤ä¸ªæ¥å£ï¼Œnetty çš„ Future ç»§æ‰¿è‡ª jdk çš„ Futureï¼Œè€Œ Promise åˆå¯¹ netty Future è¿›è¡Œäº†æ‰©å±•</p>\n<ul>\n<li>jdk Future åªèƒ½åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸï¼ˆæˆ–æˆåŠŸã€æˆ–å¤±è´¥ï¼‰æ‰èƒ½å¾—åˆ°ç»“æœ</li>\n<li>netty Future å¯ä»¥åŒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸå¾—åˆ°ç»“æœï¼Œä¹Ÿå¯ä»¥å¼‚æ­¥æ–¹å¼å¾—åˆ°ç»“æœï¼Œä½†éƒ½æ˜¯è¦ç­‰ä»»åŠ¡ç»“æŸ</li>\n<li>netty Promise ä¸ä»…æœ‰ netty Future çš„åŠŸèƒ½ï¼Œè€Œä¸”è„±ç¦»äº†ä»»åŠ¡ç‹¬ç«‹å­˜åœ¨ï¼Œåªä½œä¸ºä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’ç»“æœçš„å®¹å™¨</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>åŠŸèƒ½/åç§°</th>\n<th>jdk Future</th>\n<th>netty Future</th>\n<th>Promise</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>cancel</td>\n<td>å–æ¶ˆä»»åŠ¡</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>isCanceled</td>\n<td>ä»»åŠ¡æ˜¯å¦å–æ¶ˆ</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>isDone</td>\n<td>ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œä¸èƒ½åŒºåˆ†æˆåŠŸå¤±è´¥</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>get</td>\n<td>è·å–ä»»åŠ¡ç»“æœï¼Œé˜»å¡ç­‰å¾…</td>\n<td>-</td>\n<td>-</td>\n</tr>\n<tr>\n<td>getNow</td>\n<td>-</td>\n<td>è·å–ä»»åŠ¡ç»“æœï¼Œéé˜»å¡ï¼Œè¿˜æœªäº§ç”Ÿç»“æœæ—¶è¿”å› null</td>\n<td>-</td>\n</tr>\n<tr>\n<td>await</td>\n<td>-</td>\n<td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ isSuccess åˆ¤æ–­</td>\n<td>-</td>\n</tr>\n<tr>\n<td>sync</td>\n<td>-</td>\n<td>ç­‰å¾…ä»»åŠ¡ç»“æŸï¼Œå¦‚æœä»»åŠ¡å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</td>\n<td>-</td>\n</tr>\n<tr>\n<td>isSuccess</td>\n<td>-</td>\n<td>åˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</td>\n<td>-</td>\n</tr>\n<tr>\n<td>cause</td>\n<td>-</td>\n<td>è·å–å¤±è´¥ä¿¡æ¯ï¼Œéé˜»å¡ï¼Œå¦‚æœæ²¡æœ‰å¤±è´¥ï¼Œè¿”å›null</td>\n<td>-</td>\n</tr>\n<tr>\n<td>addLinstener</td>\n<td>-</td>\n<td>æ·»åŠ å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</td>\n<td>-</td>\n</tr>\n<tr>\n<td>setSuccess</td>\n<td>-</td>\n<td>-</td>\n<td>è®¾ç½®æˆåŠŸç»“æœ</td>\n</tr>\n<tr>\n<td>setFailure</td>\n<td>-</td>\n<td>-</td>\n<td>è®¾ç½®å¤±è´¥ç»“æœ</td>\n</tr>\n</tbody>\n</table>\n<h4><a id=\"1_675\"></a>ä¾‹1</h4>\n<p>åŒæ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.execute(()-&gt;{\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(<span class=\"hljs-string\">&quot;set success, {}&quot;</span>,<span class=\"hljs-number\">10</span>);\n    promise.setSuccess(<span class=\"hljs-number\">10</span>);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>,promise.getNow()); <span class=\"hljs-comment\">// è¿˜æ²¡æœ‰ç»“æœ</span>\nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>,promise.get());\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n11:51:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n11:51:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10\n11:51:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - 10\n</code></pre>\n<h4><a id=\"2_709\"></a>ä¾‹2</h4>\n<p>å¼‚æ­¥å¤„ç†ä»»åŠ¡æˆåŠŸ</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\n<span class=\"hljs-comment\">// è®¾ç½®å›è°ƒï¼Œå¼‚æ­¥æ¥æ”¶ç»“æœ</span>\npromise.addListener(future -&gt; {\n    <span class=\"hljs-comment\">// è¿™é‡Œçš„ future å°±æ˜¯ä¸Šé¢çš„ promise</span>\n    log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>,future.getNow());\n});\n\n<span class=\"hljs-comment\">// ç­‰å¾… 1000 åè®¾ç½®æˆåŠŸç»“æœ</span>\neventExecutors.execute(()-&gt;{\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    log.debug(<span class=\"hljs-string\">&quot;set success, {}&quot;</span>,<span class=\"hljs-number\">10</span>);\n    promise.setSuccess(<span class=\"hljs-number\">10</span>);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">11:49:30 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set success, 10\n11:49:31 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - 10\n</code></pre>\n<h4><a id=\"3_747\"></a>ä¾‹3</h4>\n<p>åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - sync &amp; get</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\n        DefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\n        eventExecutors.execute(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                Thread.sleep(<span class=\"hljs-number\">1000</span>);\n            } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n                e.printStackTrace();\n            }\n            <span class=\"hljs-type\">RuntimeException</span> <span class=\"hljs-variable\">e</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(<span class=\"hljs-string\">&quot;error...&quot;</span>);\n            log.debug(<span class=\"hljs-string\">&quot;set failure, {}&quot;</span>, e.toString());\n            promise.setFailure(e);\n        });\n\n        log.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\n        log.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, promise.getNow());\n        promise.get(); <span class=\"hljs-comment\">// sync() ä¹Ÿä¼šå‡ºç°å¼‚å¸¸ï¼Œåªæ˜¯ get ä¼šå†ç”¨ ExecutionException åŒ…ä¸€å±‚å¼‚å¸¸</span>\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:11:07 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n12:11:08 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\nException in thread &quot;main&quot; java.util.concurrent.ExecutionException: java.lang.RuntimeException: error...\n	at io.netty.util.concurrent.AbstractFuture.get(AbstractFuture.java:41)\n	at com.itcast.oio.DefaultPromiseTest2.main(DefaultPromiseTest2.java:34)\nCaused by: java.lang.RuntimeException: error...\n	at com.itcast.oio.DefaultPromiseTest2.lambda$main$0(DefaultPromiseTest2.java:27)\n	at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n	at java.lang.Thread.run(Thread.java:745)\n</code></pre>\n<h4><a id=\"4_791\"></a>ä¾‹4</h4>\n<p>åŒæ­¥å¤„ç†ä»»åŠ¡å¤±è´¥ - await</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.execute(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-type\">RuntimeException</span> <span class=\"hljs-variable\">e</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(<span class=\"hljs-string\">&quot;error...&quot;</span>);\n    log.debug(<span class=\"hljs-string\">&quot;set failure, {}&quot;</span>, e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\nlog.debug(<span class=\"hljs-string\">&quot;{}&quot;</span>, promise.getNow());\npromise.await(); <span class=\"hljs-comment\">// ä¸ sync å’Œ get åŒºåˆ«åœ¨äºï¼Œä¸ä¼šæŠ›å¼‚å¸¸</span>\nlog.debug(<span class=\"hljs-string\">&quot;result {}&quot;</span>, (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:18:53 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - null\n12:18:54 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\n12:18:54 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...\n</code></pre>\n<h4><a id=\"5_827\"></a>ä¾‹5</h4>\n<p>å¼‚æ­¥å¤„ç†ä»»åŠ¡å¤±è´¥</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\npromise.addListener(future -&gt; {\n    log.debug(<span class=\"hljs-string\">&quot;result {}&quot;</span>, (promise.isSuccess() ? promise.getNow() : promise.cause()).toString());\n});\n\neventExecutors.execute(() -&gt; {\n    <span class=\"hljs-keyword\">try</span> {\n        Thread.sleep(<span class=\"hljs-number\">1000</span>);\n    } <span class=\"hljs-keyword\">catch</span> (InterruptedException e) {\n        e.printStackTrace();\n    }\n    <span class=\"hljs-type\">RuntimeException</span> <span class=\"hljs-variable\">e</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RuntimeException</span>(<span class=\"hljs-string\">&quot;error...&quot;</span>);\n    log.debug(<span class=\"hljs-string\">&quot;set failure, {}&quot;</span>, e.toString());\n    promise.setFailure(e);\n});\n\nlog.debug(<span class=\"hljs-string\">&quot;start...&quot;</span>);\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">12:04:57 [DEBUG] [main] c.i.o.DefaultPromiseTest2 - start...\n12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - set failure, java.lang.RuntimeException: error...\n12:04:58 [DEBUG] [defaultEventLoop-1-1] c.i.o.DefaultPromiseTest2 - result java.lang.RuntimeException: error...\n</code></pre>\n<h4><a id=\"6_863\"></a>ä¾‹6</h4>\n<p>await æ­»é”æ£€æŸ¥</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DefaultEventLoop</span> <span class=\"hljs-variable\">eventExecutors</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultEventLoop</span>();\nDefaultPromise&lt;Integer&gt; promise = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">DefaultPromise</span>&lt;&gt;(eventExecutors);\n\neventExecutors.submit(()-&gt;{\n    System.out.println(<span class=\"hljs-string\">&quot;1&quot;</span>);\n    <span class=\"hljs-keyword\">try</span> {\n        promise.await();\n        <span class=\"hljs-comment\">// æ³¨æ„ä¸èƒ½ä»…æ•è· InterruptedException å¼‚å¸¸</span>\n        <span class=\"hljs-comment\">// å¦åˆ™ æ­»é”æ£€æŸ¥æŠ›å‡ºçš„ BlockingOperationException ä¼šç»§ç»­å‘ä¸Šä¼ æ’­</span>\n        <span class=\"hljs-comment\">// è€Œæäº¤çš„ä»»åŠ¡ä¼šè¢«åŒ…è£…ä¸º PromiseTaskï¼Œå®ƒçš„ run æ–¹æ³•ä¸­ä¼š catch æ‰€æœ‰å¼‚å¸¸ç„¶åè®¾ç½®ä¸º Promise çš„å¤±è´¥ç»“æœè€Œä¸ä¼šæŠ›å‡º</span>\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) { \n        e.printStackTrace();\n    }\n    System.out.println(<span class=\"hljs-string\">&quot;2&quot;</span>);\n});\neventExecutors.submit(()-&gt;{\n    System.out.println(<span class=\"hljs-string\">&quot;3&quot;</span>);\n    <span class=\"hljs-keyword\">try</span> {\n        promise.await();\n    } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n        e.printStackTrace();\n    }\n    System.out.println(<span class=\"hljs-string\">&quot;4&quot;</span>);\n});\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">1\n2\n3\n4\nio.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)\n	at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)\n	at io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)\n	at com.itcast.oio.DefaultPromiseTest.lambda$main$0(DefaultPromiseTest.java:27)\n	at io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\n	at io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)\n	at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n	at java.lang.Thread.run(Thread.java:745)\nio.netty.util.concurrent.BlockingOperationException: DefaultPromise@47499c2a(incomplete)\n	at io.netty.util.concurrent.DefaultPromise.checkDeadLock(DefaultPromise.java:384)\n	at io.netty.util.concurrent.DefaultPromise.await(DefaultPromise.java:212)\n	at com.itcast.oio.DefaultPromiseTest.lambda$main$1(DefaultPromiseTest.java:36)\n	at io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\n	at io.netty.util.concurrent.PromiseTask.run(PromiseTask.java:73)\n	at io.netty.channel.DefaultEventLoop.run(DefaultEventLoop.java:54)\n	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:918)\n	at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n	at java.lang.Thread.run(Thread.java:745)\n\n</code></pre>\n<h3><a id=\"34_Handler__Pipeline_930\"></a>3.4 Handler &amp; Pipeline</h3>\n<p>ChannelHandler ç”¨æ¥å¤„ç† Channel ä¸Šçš„å„ç§äº‹ä»¶ï¼Œåˆ†ä¸ºå…¥ç«™ã€å‡ºç«™ä¸¤ç§ã€‚æ‰€æœ‰ ChannelHandler è¢«è¿æˆä¸€ä¸²ï¼Œå°±æ˜¯ Pipeline</p>\n<ul>\n<li>å…¥ç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelInboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦ç”¨æ¥è¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼Œå†™å›ç»“æœ</li>\n<li>å‡ºç«™å¤„ç†å™¨é€šå¸¸æ˜¯ ChannelOutboundHandlerAdapter çš„å­ç±»ï¼Œä¸»è¦å¯¹å†™å›ç»“æœè¿›è¡ŒåŠ å·¥</li>\n</ul>\n<p>æ‰“ä¸ªæ¯”å–»ï¼Œæ¯ä¸ª Channel æ˜¯ä¸€ä¸ªäº§å“çš„åŠ å·¥è½¦é—´ï¼ŒPipeline æ˜¯è½¦é—´ä¸­çš„æµæ°´çº¿ï¼ŒChannelHandler å°±æ˜¯æµæ°´çº¿ä¸Šçš„å„é“å·¥åºï¼Œè€Œåé¢è¦è®²çš„ ByteBuf æ˜¯åŸææ–™ï¼Œç»è¿‡å¾ˆå¤šå·¥åºçš„åŠ å·¥ï¼šå…ˆç»è¿‡ä¸€é“é“å…¥ç«™å·¥åºï¼Œå†ç»è¿‡ä¸€é“é“å‡ºç«™å·¥åºæœ€ç»ˆå˜æˆäº§å“</p>\n<p>å…ˆææ¸…æ¥šé¡ºåºï¼ŒæœåŠ¡ç«¯</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    System.out.println(<span class=\"hljs-number\">1</span>);\n                    ctx.fireChannelRead(msg); <span class=\"hljs-comment\">// 1</span>\n                }\n            });\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    System.out.println(<span class=\"hljs-number\">2</span>);\n                    ctx.fireChannelRead(msg); <span class=\"hljs-comment\">// 2</span>\n                }\n            });\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    System.out.println(<span class=\"hljs-number\">3</span>);\n                    ctx.channel().write(msg); <span class=\"hljs-comment\">// 3</span>\n                }\n            });\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelOutboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise)</span> {\n                    System.out.println(<span class=\"hljs-number\">4</span>);\n                    ctx.write(msg, promise); <span class=\"hljs-comment\">// 4</span>\n                }\n            });\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelOutboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise)</span> {\n                    System.out.println(<span class=\"hljs-number\">5</span>);\n                    ctx.write(msg, promise); <span class=\"hljs-comment\">// 5</span>\n                }\n            });\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelOutboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">write</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg, \n                                  ChannelPromise promise)</span> {\n                    System.out.println(<span class=\"hljs-number\">6</span>);\n                    ctx.write(msg, promise); <span class=\"hljs-comment\">// 6</span>\n                }\n            });\n        }\n    })\n    .bind(<span class=\"hljs-number\">8080</span>);\n</code></div></pre>\n<p>å®¢æˆ·ç«¯</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;Channel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(Channel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n        }\n    })\n    .connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>)\n    .addListener((ChannelFutureListener) future -&gt; {\n        future.channel().writeAndFlush(<span class=\"hljs-string\">&quot;hello,world&quot;</span>);\n    });\n</code></div></pre>\n<p>æœåŠ¡å™¨ç«¯æ‰“å°ï¼š</p>\n<pre><code class=\"lang-\">1\n2\n3\n6\n5\n4\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°ï¼ŒChannelInboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ ChannelOutboundHandlerAdapter æ˜¯æŒ‰ç…§ addLast çš„é€†åºæ‰§è¡Œçš„ã€‚ChannelPipeline çš„å®ç°æ˜¯ä¸€ä¸ª ChannelHandlerContextï¼ˆåŒ…è£…äº† ChannelHandlerï¼‰ ç»„æˆçš„åŒå‘é“¾è¡¨</p>\n<p><img src=\"img/0008.png\" alt=\"\" /></p>\n<ul>\n<li>å…¥ç«™å¤„ç†å™¨ä¸­ï¼Œctx.fireChannelRead(msg) æ˜¯ <strong>è°ƒç”¨ä¸‹ä¸€ä¸ªå…¥ç«™å¤„ç†å™¨</strong>\n<ul>\n<li>å¦‚æœæ³¨é‡Šæ‰ 1 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1</li>\n<li>å¦‚æœæ³¨é‡Šæ‰ 2 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2</li>\n</ul>\n</li>\n<li>3 å¤„çš„ ctx.channel().write(msg) ä¼š <strong>ä»å°¾éƒ¨å¼€å§‹è§¦å‘</strong> åç»­å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ\n<ul>\n<li>å¦‚æœæ³¨é‡Šæ‰ 3 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3</li>\n</ul>\n</li>\n<li>ç±»ä¼¼çš„ï¼Œå‡ºç«™å¤„ç†å™¨ä¸­ï¼Œctx.write(msg, promise) çš„è°ƒç”¨ä¹Ÿä¼š <strong>è§¦å‘ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</strong>\n<ul>\n<li>å¦‚æœæ³¨é‡Šæ‰ 6 å¤„ä»£ç ï¼Œåˆ™ä»…ä¼šæ‰“å° 1 2 3 6</li>\n</ul>\n</li>\n<li>ctx.channel().write(msg) vs ctx.write(msg)\n<ul>\n<li>éƒ½æ˜¯è§¦å‘å‡ºç«™å¤„ç†å™¨çš„æ‰§è¡Œ</li>\n<li>ctx.channel().write(msg) ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾å‡ºç«™å¤„ç†å™¨</li>\n<li>ctx.write(msg) æ˜¯ä»å½“å‰èŠ‚ç‚¹æ‰¾ä¸Šä¸€ä¸ªå‡ºç«™å¤„ç†å™¨</li>\n<li>3 å¤„çš„ ctx.channel().write(msg) å¦‚æœæ”¹ä¸º ctx.write(msg) ä»…ä¼šæ‰“å° 1 2 3ï¼Œå› ä¸ºèŠ‚ç‚¹3 ä¹‹å‰æ²¡æœ‰å…¶å®ƒå‡ºç«™å¤„ç†å™¨äº†</li>\n<li>6 å¤„çš„ ctx.write(msg, promise) å¦‚æœæ”¹ä¸º ctx.channel().write(msg) ä¼šæ‰“å° 1 2 3 6 6 6â€¦ å› ä¸º ctx.channel().write() æ˜¯ä»å°¾éƒ¨å¼€å§‹æŸ¥æ‰¾ï¼Œç»“æœåˆæ˜¯èŠ‚ç‚¹6 è‡ªå·±</li>\n</ul>\n</li>\n</ul>\n<p>å›¾1 - æœåŠ¡ç«¯ pipeline è§¦å‘çš„åŸå§‹æµç¨‹ï¼Œå›¾ä¸­æ•°å­—ä»£è¡¨äº†å¤„ç†æ­¥éª¤çš„å…ˆåæ¬¡åº</p>\n<p><img src=\"img/0009.png\" alt=\"\" /></p>\n<h3><a id=\"35_ByteBuf_1054\"></a>3.5 ByteBuf</h3>\n<p>æ˜¯å¯¹å­—èŠ‚æ•°æ®çš„å°è£…</p>\n<h4><a id=\"1_1058\"></a>1ï¼‰åˆ›å»º</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">10</span>);\nlog(buffer);\n</code></div></pre>\n<p>ä¸Šé¢ä»£ç åˆ›å»ºäº†ä¸€ä¸ªé»˜è®¤çš„ ByteBufï¼ˆæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBufï¼‰ï¼Œåˆå§‹å®¹é‡æ˜¯ 10</p>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">read index:0 write index:0 capacity:10\n</code></pre>\n<p>å…¶ä¸­ log æ–¹æ³•å‚è€ƒå¦‚ä¸‹</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">log</span><span class=\"hljs-params\">(ByteBuf buffer)</span> {\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> buffer.readableBytes();\n    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">rows</span> <span class=\"hljs-operator\">=</span> length / <span class=\"hljs-number\">16</span> + (length % <span class=\"hljs-number\">15</span> == <span class=\"hljs-number\">0</span> ? <span class=\"hljs-number\">0</span> : <span class=\"hljs-number\">1</span>) + <span class=\"hljs-number\">4</span>;\n    <span class=\"hljs-type\">StringBuilder</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringBuilder</span>(rows * <span class=\"hljs-number\">80</span> * <span class=\"hljs-number\">2</span>)\n        .append(<span class=\"hljs-string\">&quot;read index:&quot;</span>).append(buffer.readerIndex())\n        .append(<span class=\"hljs-string\">&quot; write index:&quot;</span>).append(buffer.writerIndex())\n        .append(<span class=\"hljs-string\">&quot; capacity:&quot;</span>).append(buffer.capacity())\n        .append(NEWLINE);\n    appendPrettyHexDump(buf, buffer);\n    System.out.println(buf.toString());\n}\n</code></div></pre>\n<h4><a id=\"2_vs__1091\"></a>2ï¼‰ç›´æ¥å†…å­˜ vs å †å†…å­˜</h4>\n<p>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºå †çš„ ByteBuf</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.heapBuffer(<span class=\"hljs-number\">10</span>);\n</code></div></pre>\n<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥åˆ›å»ºæ± åŒ–åŸºäºç›´æ¥å†…å­˜çš„ ByteBuf</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.directBuffer(<span class=\"hljs-number\">10</span>);\n</code></div></pre>\n<ul>\n<li>ç›´æ¥å†…å­˜åˆ›å»ºå’Œé”€æ¯çš„ä»£ä»·æ˜‚è´µï¼Œä½†è¯»å†™æ€§èƒ½é«˜ï¼ˆå°‘ä¸€æ¬¡å†…å­˜å¤åˆ¶ï¼‰ï¼Œé€‚åˆé…åˆæ± åŒ–åŠŸèƒ½ä¸€èµ·ç”¨</li>\n<li>ç›´æ¥å†…å­˜å¯¹ GC å‹åŠ›å°ï¼Œå› ä¸ºè¿™éƒ¨åˆ†å†…å­˜ä¸å— JVM åƒåœ¾å›æ”¶çš„ç®¡ç†ï¼Œä½†ä¹Ÿè¦æ³¨æ„åŠæ—¶ä¸»åŠ¨é‡Šæ”¾</li>\n</ul>\n<h4><a id=\"3_vs__1110\"></a>3ï¼‰æ± åŒ– vs éæ± åŒ–</h4>\n<p>æ± åŒ–çš„æœ€å¤§æ„ä¹‰åœ¨äºå¯ä»¥é‡ç”¨ ByteBufï¼Œä¼˜ç‚¹æœ‰</p>\n<ul>\n<li>æ²¡æœ‰æ± åŒ–ï¼Œåˆ™æ¯æ¬¡éƒ½å¾—åˆ›å»ºæ–°çš„ ByteBuf å®ä¾‹ï¼Œè¿™ä¸ªæ“ä½œå¯¹ç›´æ¥å†…å­˜ä»£ä»·æ˜‚è´µï¼Œå°±ç®—æ˜¯å †å†…å­˜ï¼Œä¹Ÿä¼šå¢åŠ  GC å‹åŠ›</li>\n<li>æœ‰äº†æ± åŒ–ï¼Œåˆ™å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸ jemalloc ç±»ä¼¼çš„å†…å­˜åˆ†é…ç®—æ³•æå‡åˆ†é…æ•ˆç‡</li>\n<li>é«˜å¹¶å‘æ—¶ï¼Œæ± åŒ–åŠŸèƒ½æ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½</li>\n</ul>\n<p>æ± åŒ–åŠŸèƒ½æ˜¯å¦å¼€å¯ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è®¾ç½®</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">-Dio.netty.allocator.type={unpooled|pooled}\n</code></div></pre>\n<ul>\n<li>4.1 ä»¥åï¼Œé Android å¹³å°é»˜è®¤å¯ç”¨æ± åŒ–å®ç°ï¼ŒAndroid å¹³å°å¯ç”¨éæ± åŒ–å®ç°</li>\n<li>4.1 ä¹‹å‰ï¼Œæ± åŒ–åŠŸèƒ½è¿˜ä¸æˆç†Ÿï¼Œé»˜è®¤æ˜¯éæ± åŒ–å®ç°</li>\n</ul>\n<h4><a id=\"4_1129\"></a>4ï¼‰ç»„æˆ</h4>\n<p>ByteBuf ç”±å››éƒ¨åˆ†ç»„æˆ</p>\n<p><img src=\"img/0010.png\" alt=\"\" /></p>\n<p>æœ€å¼€å§‹è¯»å†™æŒ‡é’ˆéƒ½åœ¨ 0 ä½ç½®</p>\n<h4><a id=\"5_1139\"></a>5ï¼‰å†™å…¥</h4>\n<p>æ–¹æ³•åˆ—è¡¨ï¼Œçœç•¥ä¸€äº›ä¸é‡è¦çš„æ–¹æ³•</p>\n<table>\n<thead>\n<tr>\n<th>æ–¹æ³•ç­¾å</th>\n<th>å«ä¹‰</th>\n<th>å¤‡æ³¨</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>writeBoolean(boolean value)</td>\n<td>å†™å…¥ boolean å€¼</td>\n<td>ç”¨ä¸€å­—èŠ‚ 01|00 ä»£è¡¨ true|false</td>\n</tr>\n<tr>\n<td>writeByte(int value)</td>\n<td>å†™å…¥ byte å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>writeShort(int value)</td>\n<td>å†™å…¥ short å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>writeInt(int value)</td>\n<td>å†™å…¥ int å€¼</td>\n<td>Big Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 00 00 02 50</td>\n</tr>\n<tr>\n<td>writeIntLE(int value)</td>\n<td>å†™å…¥ int å€¼</td>\n<td>Little Endianï¼Œå³ 0x250ï¼Œå†™å…¥å 50 02 00 00</td>\n</tr>\n<tr>\n<td>writeLong(long value)</td>\n<td>å†™å…¥ long å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>writeChar(int value)</td>\n<td>å†™å…¥ char å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>writeFloat(float value)</td>\n<td>å†™å…¥ float å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>writeDouble(double value)</td>\n<td>å†™å…¥ double å€¼</td>\n<td></td>\n</tr>\n<tr>\n<td>writeBytes(ByteBuf src)</td>\n<td>å†™å…¥ netty çš„ ByteBuf</td>\n<td></td>\n</tr>\n<tr>\n<td>writeBytes(byte[] src)</td>\n<td>å†™å…¥ byte[]</td>\n<td></td>\n</tr>\n<tr>\n<td>writeBytes(ByteBuffer src)</td>\n<td>å†™å…¥ nio çš„ ByteBuffer</td>\n<td></td>\n</tr>\n<tr>\n<td>int writeCharSequence(CharSequence sequence, Charset charset)</td>\n<td>å†™å…¥å­—ç¬¦ä¸²</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>æ³¨æ„</p>\n<ul>\n<li>è¿™äº›æ–¹æ³•çš„æœªæŒ‡æ˜è¿”å›å€¼çš„ï¼Œå…¶è¿”å›å€¼éƒ½æ˜¯ ByteBufï¼Œæ„å‘³ç€å¯ä»¥é“¾å¼è°ƒç”¨</li>\n<li>ç½‘ç»œä¼ è¾“ï¼Œé»˜è®¤ä¹ æƒ¯æ˜¯ Big Endian</li>\n</ul>\n</blockquote>\n<p>å…ˆå†™å…¥ 4 ä¸ªå­—èŠ‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buffer.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>});\nlog(buffer);\n</code></div></pre>\n<p>ç»“æœæ˜¯</p>\n<pre><code class=\"lang-\">read index:0 write index:4 capacity:10\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04                                     |....            |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>å†å†™å…¥ä¸€ä¸ª int æ•´æ•°ï¼Œä¹Ÿæ˜¯ 4 ä¸ªå­—èŠ‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buffer.writeInt(<span class=\"hljs-number\">5</span>);\nlog(buffer);\n</code></div></pre>\n<p>ç»“æœæ˜¯</p>\n<pre><code class=\"lang-\">read index:0 write index:8 capacity:10\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 00 00 00 05                         |........        |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿˜æœ‰ä¸€ç±»æ–¹æ³•æ˜¯ set å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å†™å…¥æ•°æ®ï¼Œä½†ä¸ä¼šæ”¹å˜å†™æŒ‡é’ˆä½ç½®</p>\n<h4><a id=\"6_1208\"></a>6ï¼‰æ‰©å®¹</h4>\n<p>å†å†™å…¥ä¸€ä¸ª int æ•´æ•°æ—¶ï¼Œå®¹é‡ä¸å¤Ÿäº†ï¼ˆåˆå§‹å®¹é‡æ˜¯ 10ï¼‰ï¼Œè¿™æ—¶ä¼šå¼•å‘æ‰©å®¹</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buffer.writeInt(<span class=\"hljs-number\">6</span>);\nlog(buffer);\n</code></div></pre>\n<p>æ‰©å®¹è§„åˆ™æ˜¯</p>\n<ul>\n<li>å¦‚ä½•å†™å…¥åæ•°æ®å¤§å°æœªè¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 16 çš„æ•´æ•°å€ï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 12 ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 16</li>\n<li>å¦‚æœå†™å…¥åæ•°æ®å¤§å°è¶…è¿‡ 512ï¼Œåˆ™é€‰æ‹©ä¸‹ä¸€ä¸ª 2^nï¼Œä¾‹å¦‚å†™å…¥åå¤§å°ä¸º 513ï¼Œåˆ™æ‰©å®¹å capacity æ˜¯ 2<sup>10=1024ï¼ˆ2</sup>9=512 å·²ç»ä¸å¤Ÿäº†ï¼‰</li>\n<li>æ‰©å®¹ä¸èƒ½è¶…è¿‡ max capacity ä¼šæŠ¥é”™</li>\n</ul>\n<p>ç»“æœæ˜¯</p>\n<pre><code class=\"lang-\">read index:0 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 00 00 00 05 00 00 00 06             |............    |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<h4><a id=\"7_1236\"></a>7ï¼‰è¯»å–</h4>\n<p>ä¾‹å¦‚è¯»äº† 4 æ¬¡ï¼Œæ¯æ¬¡ä¸€ä¸ªå­—èŠ‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">System.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nSystem.out.println(buffer.readByte());\nlog(buffer);\n</code></div></pre>\n<p>è¯»è¿‡çš„å†…å®¹ï¼Œå°±å±äºåºŸå¼ƒéƒ¨åˆ†äº†ï¼Œå†è¯»åªèƒ½è¯»é‚£äº›å°šæœªè¯»å–çš„éƒ¨åˆ†</p>\n<pre><code class=\"lang-\">1\n2\n3\n4\nread index:4 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>å¦‚æœéœ€è¦é‡å¤è¯»å– int æ•´æ•° 5ï¼Œæ€ä¹ˆåŠï¼Ÿ</p>\n<p>å¯ä»¥åœ¨ read å‰å…ˆåšä¸ªæ ‡è®° mark</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buffer.markReaderIndex();\nSystem.out.println(buffer.readInt());\nlog(buffer);\n</code></div></pre>\n<p>ç»“æœ</p>\n<pre><code class=\"lang-\">5\nread index:8 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 06                                     |....            |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿™æ—¶è¦é‡å¤è¯»å–çš„è¯ï¼Œé‡ç½®åˆ°æ ‡è®°ä½ç½® reset</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buffer.resetReaderIndex();\nlog(buffer);\n</code></div></pre>\n<p>è¿™æ—¶</p>\n<pre><code class=\"lang-\">read index:4 write index:12 capacity:16\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 00 00 00 05 00 00 00 06                         |........        |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿˜æœ‰ç§åŠæ³•æ˜¯é‡‡ç”¨ get å¼€å¤´çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä¼šæ”¹å˜ read index</p>\n<h4><a id=\"8retain__release_1307\"></a>8ï¼‰retain &amp; release</h4>\n<p>ç”±äº Netty ä¸­æœ‰å †å¤–å†…å­˜çš„ ByteBuf å®ç°ï¼Œå †å¤–å†…å­˜æœ€å¥½æ˜¯æ‰‹åŠ¨æ¥é‡Šæ”¾ï¼Œè€Œä¸æ˜¯ç­‰ GC åƒåœ¾å›æ”¶ã€‚</p>\n<ul>\n<li>UnpooledHeapByteBuf ä½¿ç”¨çš„æ˜¯ JVM å†…å­˜ï¼Œåªéœ€ç­‰ GC å›æ”¶å†…å­˜å³å¯</li>\n<li>UnpooledDirectByteBuf ä½¿ç”¨çš„å°±æ˜¯ç›´æ¥å†…å­˜äº†ï¼Œéœ€è¦ç‰¹æ®Šçš„æ–¹æ³•æ¥å›æ”¶å†…å­˜</li>\n<li>PooledByteBuf å’Œå®ƒçš„å­ç±»ä½¿ç”¨äº†æ± åŒ–æœºåˆ¶ï¼Œéœ€è¦æ›´å¤æ‚çš„è§„åˆ™æ¥å›æ”¶å†…å­˜</li>\n</ul>\n<blockquote>\n<p>å›æ”¶å†…å­˜çš„æºç å®ç°ï¼Œè¯·å…³æ³¨ä¸‹é¢æ–¹æ³•çš„ä¸åŒå®ç°</p>\n<p><code>protected abstract void deallocate()</code></p>\n</blockquote>\n<p>Netty è¿™é‡Œé‡‡ç”¨äº†å¼•ç”¨è®¡æ•°æ³•æ¥æ§åˆ¶å›æ”¶å†…å­˜ï¼Œæ¯ä¸ª ByteBuf éƒ½å®ç°äº† ReferenceCounted æ¥å£</p>\n<ul>\n<li>æ¯ä¸ª ByteBuf å¯¹è±¡çš„åˆå§‹è®¡æ•°ä¸º 1</li>\n<li>è°ƒç”¨ release æ–¹æ³•è®¡æ•°å‡ 1ï¼Œå¦‚æœè®¡æ•°ä¸º 0ï¼ŒByteBuf å†…å­˜è¢«å›æ”¶</li>\n<li>è°ƒç”¨ retain æ–¹æ³•è®¡æ•°åŠ  1ï¼Œè¡¨ç¤ºè°ƒç”¨è€…æ²¡ç”¨å®Œä¹‹å‰ï¼Œå…¶å®ƒ handler å³ä½¿è°ƒç”¨äº† release ä¹Ÿä¸ä¼šé€ æˆå›æ”¶</li>\n<li>å½“è®¡æ•°ä¸º 0 æ—¶ï¼Œåº•å±‚å†…å­˜ä¼šè¢«å›æ”¶ï¼Œè¿™æ—¶å³ä½¿ ByteBuf å¯¹è±¡è¿˜åœ¨ï¼Œå…¶å„ä¸ªæ–¹æ³•å‡æ— æ³•æ­£å¸¸ä½¿ç”¨</li>\n</ul>\n<p>è°æ¥è´Ÿè´£ release å‘¢ï¼Ÿ</p>\n<p>ä¸æ˜¯æˆ‘ä»¬æƒ³è±¡çš„ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ...\n<span class=\"hljs-keyword\">try</span> {\n    ...\n} <span class=\"hljs-keyword\">finally</span> {\n    buf.release();\n}\n</code></div></pre>\n<p>è¯·æ€è€ƒï¼Œå› ä¸º pipeline çš„å­˜åœ¨ï¼Œä¸€èˆ¬éœ€è¦å°† ByteBuf ä¼ é€’ç»™ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¦‚æœåœ¨ finally ä¸­ release äº†ï¼Œå°±å¤±å»äº†ä¼ é€’æ€§ï¼ˆå½“ç„¶ï¼Œå¦‚æœåœ¨è¿™ä¸ª ChannelHandler å†…è¿™ä¸ª ByteBuf å·²å®Œæˆäº†å®ƒçš„ä½¿å‘½ï¼Œé‚£ä¹ˆä¾¿æ— é¡»å†ä¼ é€’ï¼‰</p>\n<p>åŸºæœ¬è§„åˆ™æ˜¯ï¼Œ<strong>è°æ˜¯æœ€åä½¿ç”¨è€…ï¼Œè°è´Ÿè´£ release</strong>ï¼Œè¯¦ç»†åˆ†æå¦‚ä¸‹</p>\n<ul>\n<li>èµ·ç‚¹ï¼Œå¯¹äº NIO å®ç°æ¥è®²ï¼Œåœ¨ io.netty.channel.nio.AbstractNioByteChannel.NioByteUnsafe#read æ–¹æ³•ä¸­é¦–æ¬¡åˆ›å»º ByteBuf æ”¾å…¥ pipelineï¼ˆline 163 pipeline.fireChannelRead(byteBuf)ï¼‰</li>\n<li>å…¥ç«™ ByteBuf å¤„ç†åŸåˆ™\n<ul>\n<li>å¯¹åŸå§‹ ByteBuf ä¸åšå¤„ç†ï¼Œè°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œè¿™æ—¶æ— é¡» release</li>\n<li>å°†åŸå§‹ ByteBuf è½¬æ¢ä¸ºå…¶å®ƒç±»å‹çš„ Java å¯¹è±¡ï¼Œè¿™æ—¶ ByteBuf å°±æ²¡ç”¨äº†ï¼Œå¿…é¡» release</li>\n<li>å¦‚æœä¸è°ƒç”¨ ctx.fireChannelRead(msg) å‘åä¼ é€’ï¼Œé‚£ä¹ˆä¹Ÿå¿…é¡» release</li>\n<li>æ³¨æ„å„ç§å¼‚å¸¸ï¼Œå¦‚æœ ByteBuf æ²¡æœ‰æˆåŠŸä¼ é€’åˆ°ä¸‹ä¸€ä¸ª ChannelHandlerï¼Œå¿…é¡» release</li>\n<li>å‡è®¾æ¶ˆæ¯ä¸€ç›´å‘åä¼ ï¼Œé‚£ä¹ˆ TailContext ä¼šè´Ÿè´£é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯ï¼ˆåŸå§‹çš„ ByteBufï¼‰</li>\n</ul>\n</li>\n<li>å‡ºç«™ ByteBuf å¤„ç†åŸåˆ™\n<ul>\n<li>å‡ºç«™æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè½¬ä¸º ByteBuf è¾“å‡ºï¼Œä¸€ç›´å‘å‰ä¼ ï¼Œç”± HeadContext flush å release</li>\n</ul>\n</li>\n<li>å¼‚å¸¸å¤„ç†åŸåˆ™\n<ul>\n<li>æœ‰æ—¶å€™ä¸æ¸…æ¥š ByteBuf è¢«å¼•ç”¨äº†å¤šå°‘æ¬¡ï¼Œä½†åˆå¿…é¡»å½»åº•é‡Šæ”¾ï¼Œå¯ä»¥å¾ªç¯è°ƒç”¨ release ç›´åˆ°è¿”å› true</li>\n</ul>\n</li>\n</ul>\n<p>TailContext é‡Šæ”¾æœªå¤„ç†æ¶ˆæ¯é€»è¾‘</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">// io.netty.channel.DefaultChannelPipeline#onUnhandledInboundMessage(java.lang.Object)</span>\n<span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">onUnhandledInboundMessage</span><span class=\"hljs-params\">(Object msg)</span> {\n    <span class=\"hljs-keyword\">try</span> {\n        logger.debug(\n            <span class=\"hljs-string\">&quot;Discarded inbound message {} that reached at the tail of the pipeline. &quot;</span> +\n            <span class=\"hljs-string\">&quot;Please check your pipeline configuration.&quot;</span>, msg);\n    } <span class=\"hljs-keyword\">finally</span> {\n        ReferenceCountUtil.release(msg);\n    }\n}\n</code></div></pre>\n<p>å…·ä½“ä»£ç </p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">// io.netty.util.ReferenceCountUtil#release(java.lang.Object)</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">release</span><span class=\"hljs-params\">(Object msg)</span> {\n    <span class=\"hljs-keyword\">if</span> (msg <span class=\"hljs-keyword\">instanceof</span> ReferenceCounted) {\n        <span class=\"hljs-keyword\">return</span> ((ReferenceCounted) msg).release();\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n}\n</code></div></pre>\n<h4><a id=\"9slice_1392\"></a>9ï¼‰slice</h4>\n<p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯¹åŸå§‹ ByteBuf è¿›è¡Œåˆ‡ç‰‡æˆå¤šä¸ª ByteBufï¼Œåˆ‡ç‰‡åçš„ ByteBuf å¹¶æ²¡æœ‰å‘ç”Ÿå†…å­˜å¤åˆ¶ï¼Œè¿˜æ˜¯ä½¿ç”¨åŸå§‹ ByteBuf çš„å†…å­˜ï¼Œåˆ‡ç‰‡åçš„ ByteBuf ç»´æŠ¤ç‹¬ç«‹çš„ readï¼Œwrite æŒ‡é’ˆ</p>\n<p><img src=\"img/0011.png\" alt=\"\" /></p>\n<p>ä¾‹ï¼ŒåŸå§‹ ByteBuf è¿›è¡Œä¸€äº›åˆå§‹æ“ä½œ</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">origin</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">10</span>);\norigin.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>});\norigin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿™æ—¶è°ƒç”¨ slice è¿›è¡Œåˆ‡ç‰‡ï¼Œæ— å‚ slice æ˜¯ä»åŸå§‹ ByteBuf çš„ read index åˆ° write index ä¹‹é—´çš„å†…å®¹è¿›è¡Œåˆ‡ç‰‡ï¼Œåˆ‡ç‰‡åçš„ max capacity è¢«å›ºå®šä¸ºè¿™ä¸ªåŒºé—´çš„å¤§å°ï¼Œå› æ­¤ä¸èƒ½è¿½åŠ  write</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">slice</span> <span class=\"hljs-operator\">=</span> origin.slice();\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n<span class=\"hljs-comment\">// slice.writeByte(5); å¦‚æœæ‰§è¡Œï¼Œä¼šæŠ¥ IndexOutOfBoundsException å¼‚å¸¸</span>\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>å¦‚æœåŸå§‹ ByteBuf å†æ¬¡è¯»æ“ä½œï¼ˆåˆè¯»äº†ä¸€ä¸ªå­—èŠ‚ï¼‰</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">origin.readByte();\nSystem.out.println(ByteBufUtil.prettyHexDump(origin));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 03 04                                           |..              |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿™æ—¶çš„ slice ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒæœ‰ç‹¬ç«‹çš„è¯»å†™æŒ‡é’ˆ</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">System.out.println(ByteBufUtil.prettyHexDump(slice));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 04                                        |...             |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>å¦‚æœ slice çš„å†…å®¹å‘ç”Ÿäº†æ›´æ”¹</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">slice.setByte(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">5</span>);\nSystem.out.println(ByteBufUtil.prettyHexDump(slice));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 02 03 05                                        |...             |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿™æ—¶ï¼ŒåŸå§‹ ByteBuf ä¹Ÿä¼šå—å½±å“ï¼Œå› ä¸ºåº•å±‚éƒ½æ˜¯åŒä¸€å—å†…å­˜</p>\n<pre><code class=\"lang-\">System.out.println(ByteBufUtil.prettyHexDump(origin));\n</code></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 03 05                                           |..              |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<h4><a id=\"10duplicate_1503\"></a>10ï¼‰duplicate</h4>\n<p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå°±å¥½æ¯”æˆªå–äº†åŸå§‹ ByteBuf æ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰ max capacity çš„é™åˆ¶ï¼Œä¹Ÿæ˜¯ä¸åŸå§‹ ByteBuf ä½¿ç”¨åŒä¸€å—åº•å±‚å†…å­˜ï¼Œåªæ˜¯è¯»å†™æŒ‡é’ˆæ˜¯ç‹¬ç«‹çš„</p>\n<p><img src=\"img/0012.png\" alt=\"\" /></p>\n<h4><a id=\"11copy_1511\"></a>11ï¼‰copy</h4>\n<p>ä¼šå°†åº•å±‚å†…å­˜æ•°æ®è¿›è¡Œæ·±æ‹·è´ï¼Œå› æ­¤æ— è®ºè¯»å†™ï¼Œéƒ½ä¸åŸå§‹ ByteBuf æ— å…³</p>\n<h4><a id=\"12CompositeByteBuf_1517\"></a>12ï¼‰CompositeByteBuf</h4>\n<p>ã€é›¶æ‹·è´ã€‘çš„ä½“ç°ä¹‹ä¸€ï¼Œå¯ä»¥å°†å¤šä¸ª ByteBuf åˆå¹¶ä¸ºä¸€ä¸ªé€»è¾‘ä¸Šçš„ ByteBufï¼Œé¿å…æ‹·è´</p>\n<p>æœ‰ä¸¤ä¸ª ByteBuf å¦‚ä¸‹</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf1</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf1.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>});\n<span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf2</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf2.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>});\nSystem.out.println(ByteBufUtil.prettyHexDump(buf1));\nSystem.out.println(ByteBufUtil.prettyHexDump(buf2));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05                                  |.....           |\n+--------+-------------------------------------------------+----------------+\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 06 07 08 09 0a                                  |.....           |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>ç°åœ¨éœ€è¦ä¸€ä¸ªæ–°çš„ ByteBufï¼Œå†…å®¹æ¥è‡ªäºåˆšæ‰çš„ buf1 å’Œ buf2ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</p>\n<p>æ–¹æ³•1ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf3</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT\n    .buffer(buf1.readableBytes()+buf2.readableBytes());\nbuf3.writeBytes(buf1);\nbuf3.writeBytes(buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n</code></div></pre>\n<p>ç»“æœ</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>è¿™ç§æ–¹æ³•å¥½ä¸å¥½ï¼Ÿå›ç­”æ˜¯ä¸å¤ªå¥½ï¼Œå› ä¸ºè¿›è¡Œäº†æ•°æ®çš„å†…å­˜å¤åˆ¶æ“ä½œ</p>\n<p>æ–¹æ³•2ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">CompositeByteBuf</span> <span class=\"hljs-variable\">buf3</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.compositeBuffer();\n<span class=\"hljs-comment\">// true è¡¨ç¤ºå¢åŠ æ–°çš„ ByteBuf è‡ªåŠ¨é€’å¢ write index, å¦åˆ™ write index ä¼šå§‹ç»ˆä¸º 0</span>\nbuf3.addComponents(<span class=\"hljs-literal\">true</span>, buf1, buf2);\n</code></div></pre>\n<p>ç»“æœæ˜¯ä¸€æ ·çš„</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>CompositeByteBuf æ˜¯ä¸€ä¸ªç»„åˆçš„ ByteBufï¼Œå®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª Component æ•°ç»„ï¼Œæ¯ä¸ª Component ç®¡ç†ä¸€ä¸ª ByteBufï¼Œè®°å½•äº†è¿™ä¸ª ByteBuf ç›¸å¯¹äºæ•´ä½“åç§»é‡ç­‰ä¿¡æ¯ï¼Œä»£è¡¨ç€æ•´ä½“ä¸­æŸä¸€æ®µçš„æ•°æ®ã€‚</p>\n<ul>\n<li>ä¼˜ç‚¹ï¼Œå¯¹å¤–æ˜¯ä¸€ä¸ªè™šæ‹Ÿè§†å›¾ï¼Œç»„åˆè¿™äº› ByteBuf ä¸ä¼šäº§ç”Ÿå†…å­˜å¤åˆ¶</li>\n<li>ç¼ºç‚¹ï¼Œå¤æ‚äº†å¾ˆå¤šï¼Œå¤šæ¬¡æ“ä½œä¼šå¸¦æ¥æ€§èƒ½çš„æŸè€—</li>\n</ul>\n<h4><a id=\"13Unpooled_1598\"></a>13ï¼‰Unpooled</h4>\n<p>Unpooled æ˜¯ä¸€ä¸ªå·¥å…·ç±»ï¼Œç±»å¦‚å…¶åï¼Œæä¾›äº†éæ± åŒ–çš„ ByteBuf åˆ›å»ºã€ç»„åˆã€å¤åˆ¶ç­‰æ“ä½œ</p>\n<p>è¿™é‡Œä»…ä»‹ç»å…¶è·Ÿã€é›¶æ‹·è´ã€‘ç›¸å…³çš„ wrappedBuffer æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åŒ…è£… ByteBuf</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf1</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf1.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>});\n<span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf2</span> <span class=\"hljs-operator\">=</span> ByteBufAllocator.DEFAULT.buffer(<span class=\"hljs-number\">5</span>);\nbuf2.writeBytes(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">6</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">8</span>, <span class=\"hljs-number\">9</span>, <span class=\"hljs-number\">10</span>});\n\n<span class=\"hljs-comment\">// å½“åŒ…è£… ByteBuf ä¸ªæ•°è¶…è¿‡ä¸€ä¸ªæ—¶, åº•å±‚ä½¿ç”¨äº† CompositeByteBuf</span>\n<span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf3</span> <span class=\"hljs-operator\">=</span> Unpooled.wrappedBuffer(buf1, buf2);\nSystem.out.println(ByteBufUtil.prettyHexDump(buf3));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06 07 08 09 0a                   |..........      |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<p>ä¹Ÿå¯ä»¥ç”¨æ¥åŒ…è£…æ™®é€šå­—èŠ‚æ•°ç»„ï¼Œåº•å±‚ä¹Ÿä¸ä¼šæœ‰æ‹·è´æ“ä½œ</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buf4</span> <span class=\"hljs-operator\">=</span> Unpooled.wrappedBuffer(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">3</span>}, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[]{<span class=\"hljs-number\">4</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">6</span>});\nSystem.out.println(buf4.getClass());\nSystem.out.println(ByteBufUtil.prettyHexDump(buf4));\n</code></div></pre>\n<p>è¾“å‡º</p>\n<pre><code class=\"lang-\">class io.netty.buffer.CompositeByteBuf\n         +-------------------------------------------------+\n         |  0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f |\n+--------+-------------------------------------------------+----------------+\n|00000000| 01 02 03 04 05 06                               |......          |\n+--------+-------------------------------------------------+----------------+\n</code></pre>\n<h4><a id=\"_ByteBuf__1646\"></a>ğŸ’¡ ByteBuf ä¼˜åŠ¿</h4>\n<ul>\n<li>æ± åŒ– - å¯ä»¥é‡ç”¨æ± ä¸­ ByteBuf å®ä¾‹ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼Œå‡å°‘å†…å­˜æº¢å‡ºçš„å¯èƒ½</li>\n<li>è¯»å†™æŒ‡é’ˆåˆ†ç¦»ï¼Œä¸éœ€è¦åƒ ByteBuffer ä¸€æ ·åˆ‡æ¢è¯»å†™æ¨¡å¼</li>\n<li>å¯ä»¥è‡ªåŠ¨æ‰©å®¹</li>\n<li>æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿ç”¨æ›´æµç•…</li>\n<li>å¾ˆå¤šåœ°æ–¹ä½“ç°é›¶æ‹·è´ï¼Œä¾‹å¦‚ sliceã€duplicateã€CompositeByteBuf</li>\n</ul>\n<h2><a id=\"4__1656\"></a>4. åŒå‘é€šä¿¡</h2>\n<h3><a id=\"41__1658\"></a>4.1 ç»ƒä¹ </h3>\n<p>å®ç°ä¸€ä¸ª echo server</p>\n<p>ç¼–å†™ server</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerBootstrap</span>()\n    .group(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>())\n    .channel(NioServerSocketChannel.class)\n    .childHandler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> (ByteBuf) msg;\n                    System.out.println(buffer.toString(Charset.defaultCharset()));\n\n                    <span class=\"hljs-comment\">// å»ºè®®ä½¿ç”¨ ctx.alloc() åˆ›å»º ByteBuf</span>\n                    <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">response</span> <span class=\"hljs-operator\">=</span> ctx.alloc().buffer();\n                    response.writeBytes(buffer);\n                    ctx.writeAndFlush(response);\n\n                    <span class=\"hljs-comment\">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—</span>\n                    <span class=\"hljs-comment\">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ response å—</span>\n                }\n            });\n        }\n    }).bind(<span class=\"hljs-number\">8080</span>);\n</code></div></pre>\n<p>ç¼–å†™ client</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">NioEventLoopGroup</span> <span class=\"hljs-variable\">group</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">NioEventLoopGroup</span>();\n<span class=\"hljs-type\">Channel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Bootstrap</span>()\n    .group(group)\n    .channel(NioSocketChannel.class)\n    .handler(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInitializer</span>&lt;NioSocketChannel&gt;() {\n        <span class=\"hljs-meta\">@Override</span>\n        <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">initChannel</span><span class=\"hljs-params\">(NioSocketChannel ch)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">StringEncoder</span>());\n            ch.pipeline().addLast(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ChannelInboundHandlerAdapter</span>() {\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">channelRead</span><span class=\"hljs-params\">(ChannelHandlerContext ctx, Object msg)</span> {\n                    <span class=\"hljs-type\">ByteBuf</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> (ByteBuf) msg;\n                    System.out.println(buffer.toString(Charset.defaultCharset()));\n\n                    <span class=\"hljs-comment\">// æ€è€ƒï¼šéœ€è¦é‡Šæ”¾ buffer å—</span>\n                }\n            });\n        }\n    }).connect(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">8080</span>).sync().channel();\n\nchannel.closeFuture().addListener(future -&gt; {\n    group.shutdownGracefully();\n});\n\n<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n    <span class=\"hljs-type\">Scanner</span> <span class=\"hljs-variable\">scanner</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Scanner</span>(System.in);\n    <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">line</span> <span class=\"hljs-operator\">=</span> scanner.nextLine();\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">&quot;q&quot;</span>.equals(line)) {\n            channel.close();\n            <span class=\"hljs-keyword\">break</span>;\n        }\n        channel.writeAndFlush(line);\n    }\n}).start();\n</code></div></pre>\n<h3><a id=\"__1732\"></a>ğŸ’¡ è¯»å’Œå†™çš„è¯¯è§£</h3>\n<p>æˆ‘æœ€åˆåœ¨è®¤è¯†ä¸Šæœ‰è¿™æ ·çš„è¯¯åŒºï¼Œè®¤ä¸ºåªæœ‰åœ¨ nettyï¼Œnio è¿™æ ·çš„å¤šè·¯å¤ç”¨ IO æ¨¡å‹æ—¶ï¼Œè¯»å†™æ‰ä¸ä¼šç›¸äº’é˜»å¡ï¼Œæ‰å¯ä»¥å®ç°é«˜æ•ˆçš„åŒå‘é€šä¿¡ï¼Œä½†å®é™…ä¸Šï¼ŒJava Socket æ˜¯å…¨åŒå·¥çš„ï¼šåœ¨ä»»æ„æ—¶åˆ»ï¼Œçº¿è·¯ä¸Šå­˜åœ¨<code>A åˆ° B</code> å’Œ <code>B åˆ° A</code> çš„åŒå‘ä¿¡å·ä¼ è¾“ã€‚å³ä½¿æ˜¯é˜»å¡ IOï¼Œè¯»å’Œå†™æ˜¯å¯ä»¥åŒæ—¶è¿›è¡Œçš„ï¼Œåªè¦åˆ†åˆ«é‡‡ç”¨è¯»çº¿ç¨‹å’Œå†™çº¿ç¨‹å³å¯ï¼Œè¯»ä¸ä¼šé˜»å¡å†™ã€å†™ä¹Ÿä¸ä¼šé˜»å¡è¯»</p>\n<p>ä¾‹å¦‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestServer</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">ServerSocket</span> <span class=\"hljs-variable\">ss</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ServerSocket</span>(<span class=\"hljs-number\">8888</span>);\n        <span class=\"hljs-type\">Socket</span> <span class=\"hljs-variable\">s</span> <span class=\"hljs-operator\">=</span> ss.accept();\n\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                <span class=\"hljs-type\">BufferedReader</span> <span class=\"hljs-variable\">reader</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BufferedReader</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InputStreamReader</span>(s.getInputStream()));\n                <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                    System.out.println(reader.readLine());\n                }\n            } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                <span class=\"hljs-type\">BufferedWriter</span> <span class=\"hljs-variable\">writer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BufferedWriter</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">OutputStreamWriter</span>(s.getOutputStream()));\n                <span class=\"hljs-comment\">// ä¾‹å¦‚åœ¨è¿™ä¸ªä½ç½®åŠ å…¥ thread çº§åˆ«æ–­ç‚¹ï¼Œå¯ä»¥å‘ç°å³ä½¿ä¸å†™å…¥æ•°æ®ï¼Œä¹Ÿä¸å¦¨ç¢å‰é¢çº¿ç¨‹è¯»å–å®¢æˆ·ç«¯æ•°æ®</span>\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100</span>; i++) {\n                    writer.write(String.valueOf(i));\n                    writer.newLine();\n                    writer.flush();\n                }\n            } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n</code></div></pre>\n<p>å®¢æˆ·ç«¯</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">TestClient</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n        <span class=\"hljs-type\">Socket</span> <span class=\"hljs-variable\">s</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Socket</span>(<span class=\"hljs-string\">&quot;localhost&quot;</span>, <span class=\"hljs-number\">8888</span>);\n\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                <span class=\"hljs-type\">BufferedReader</span> <span class=\"hljs-variable\">reader</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BufferedReader</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InputStreamReader</span>(s.getInputStream()));\n                <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>) {\n                    System.out.println(reader.readLine());\n                }\n            } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Thread</span>(() -&gt; {\n            <span class=\"hljs-keyword\">try</span> {\n                <span class=\"hljs-type\">BufferedWriter</span> <span class=\"hljs-variable\">writer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BufferedWriter</span>(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">OutputStreamWriter</span>(s.getOutputStream()));\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100</span>; i++) {\n                    writer.write(String.valueOf(i));\n                    writer.newLine();\n                    writer.flush();\n                }\n            } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n                e.printStackTrace();\n            }\n        }).start();\n    }\n}\n</code></div></pre>\n');
INSERT INTO `article_content` VALUES ('57f718d5122663a93110cf52264e929b', '### èƒŒæ™¯\nå…¬å¸é¡¹ç›®æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œéƒ¨åˆ†è¡¨æ‹¥æœ‰åƒä¸‡æ•°æ®é‡ï¼Œä½†æ˜¯é¡¹ç›®é‡Œé¢å¯¼å‡ºåŠŸèƒ½é™ˆæ—§ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„POIå¯¼å‡ºï¼Œé™åˆ¶äº†å•æ¬¡å¯¼å‡ºæ•°é‡ä¸º6Wæ¡ï¼Œæ¯æ¬¡ç”¨æˆ·éœ€è¦åˆ†æ‰¹æ¬¡å¯¼å‡ºã€‚æ—¢ç„¶æœ‰éœ€æ±‚é‚£æˆ‘å°±å°è¯•èƒ½å¦è§£å†³å§ã€‚\n\n\n### æœªæŠ½å–æ¨¡æ¿ç‰ˆæœ¬\n\nè¿™æ®µå¹¶æœªæŠ½å–æˆé€šç”¨æ¨¡æ¿ï¼Œæ³›ç”¨æ€§ä¸å¼ºï¼Œä»…æµ‹è¯•åœ¨æŒ‡å®šç±»å‹ä¸éœ€è¦è½¬æ¢ä¸‹å¯èŠ‚çœå¤šå°‘æ—¶é—´ã€‚\n```java\npublic void export(HttpServletRequest request, HttpServletResponse response, JSONObject params) {\n        long start = System.currentTimeMillis();\n        OutputStream outputStream = null;\n        try {\n            outputStream = response.getOutputStream();\n            ExcelWriter writer = new ExcelWriter(outputStream, ExcelTypeEnum.XLSX);\n            String fileName = new String((\"excel100w\").getBytes(), \"UTF-8\");\n            //title\n            WriteTable writeTable = new WriteTable();\n            List<List<String>> titles = new ArrayList<>();\n            titles.add(Arrays.asList(\"id\"));\n            titles.add(Arrays.asList(\"å§“å\"));\n            writeTable.setHead(titles);\n            //è®°å½•æ€»æ•°:å®é™…ä¸­éœ€è¦æ ¹æ®æŸ¥è¯¢æ¡ä»¶è¿›è¡Œç»Ÿè®¡å³å¯\n            Integer totalCount = baseMapper.selectCount(null);\n            //æ¯ä¸€ä¸ªSheetå­˜æ”¾100wæ¡æ•°æ®\n            Integer sheetDataRows = 1000000;\n            //æ¯æ¬¡å†™å…¥çš„æ•°æ®é‡20w\n            int writeDataRows = 200000;\n            //è®¡ç®—éœ€è¦çš„Sheetæ•°é‡\n            int sheetNum = totalCount % sheetDataRows == 0 ? (totalCount / sheetDataRows) : (totalCount / sheetDataRows + 1);\n            //è®¡ç®—ä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ä¸ªSheetéœ€è¦å†™å…¥çš„æ¬¡æ•°(ä¸€èˆ¬æƒ…å†µä¸åŒ…å«æœ€åä¸€ä¸ªsheet,å› ä¸ºæœ€åä¸€ä¸ªsheetä¸ç¡®å®šä¼šå†™å…¥å¤šå°‘æ¡æ•°æ®)\n            int oneSheetWriteCount = sheetDataRows / writeDataRows;\n            //è®¡ç®—æœ€åä¸€ä¸ªsheetéœ€è¦å†™å…¥çš„æ¬¡æ•°\n            int lastSheetWriteCount = totalCount % sheetDataRows == 0 ? oneSheetWriteCount : (totalCount % sheetDataRows % writeDataRows == 0 ? (totalCount % sheetDataRows / writeDataRows) : (totalCount % sheetDataRows / writeDataRows + 1));\n\n            //å¼€å§‹åˆ†æ‰¹æŸ¥è¯¢åˆ†æ¬¡å†™å…¥\n            //æ³¨æ„è¿™æ¬¡çš„å¾ªç¯å°±éœ€è¦è¿›è¡ŒåµŒå¥—å¾ªç¯äº†,å¤–å±‚å¾ªç¯æ˜¯Sheetæ•°ç›®,å†…å±‚å¾ªç¯æ˜¯å†™å…¥æ¬¡æ•°\n            List<List<String>> dataList = new ArrayList<>();\n            for (int i = 0; i < sheetNum; i++) {\n                //åˆ›å»ºSheet\n                WriteSheet writeSheet = new WriteSheet();\n                writeSheet.setSheetName(\"é¡µæ•°\"+i);\n                //å¾ªç¯å†™å…¥æ¬¡æ•°: jçš„è‡ªå¢æ¡ä»¶æ˜¯å½“ä¸æ˜¯æœ€åä¸€ä¸ªSheetçš„æ—¶å€™å†™å…¥æ¬¡æ•°ä¸ºæ­£å¸¸çš„æ¯ä¸ªSheetå†™å…¥çš„æ¬¡æ•°,å¦‚æœæ˜¯æœ€åä¸€ä¸ªå°±éœ€è¦ä½¿ç”¨è®¡ç®—çš„æ¬¡æ•°lastSheetWriteCount\n                for (int j = 0; j < (i != sheetNum - 1 ? oneSheetWriteCount : lastSheetWriteCount); j++) {\n                    //é›†åˆå¤ç”¨,ä¾¿äºGCæ¸…ç†\n                    dataList.clear();\n                    //åˆ†é¡µæŸ¥è¯¢ä¸€æ¬¡20w\n                    List<CheckTeenage> resultList = baseMapper.selectPage(new Page<>(j + 1 + oneSheetWriteCount * i, writeDataRows), null).getRecords();\n                    if (!CollectionUtils.isEmpty(resultList)) {\n                        resultList.forEach(item -> {\n                            dataList.add(Arrays.asList(item.getId(),item.getName()));\n                        });\n                    }\n                    //å†™æ•°æ®\n                    writer.write(dataList, writeSheet, writeTable);\n                }\n            }\n            // ä¸‹è½½EXCEL\n            response.setHeader(\"Content-Disposition\", \"attachment;filename=\" + new String((fileName).getBytes(\"gb2312\"), \"ISO-8859-1\") + \".xlsx\");\n            response.setContentType(\"multipart/form-data\");\n            response.setCharacterEncoding(\"utf-8\");\n            writer.finish();\n            outputStream.flush();\n            long end = System.currentTimeMillis();\n            System.out.println(String.format(\"å¯¼å‡ºæ¡æ•°:\"+totalCount+\"ç”¨æ—¶ï¼š%d ms\", end - start));\n        } catch (FileNotFoundException e) {\n            e.printStackTrace();\n        } catch (IOException e) {\n            e.printStackTrace();\n        } finally {\n            if (outputStream != null) {\n                try {\n                    outputStream.close();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n```\n\næœ€ç»ˆæ‰§è¡Œç»“æœï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/31/2fc01ee15bfd4675bac84e6af65195fd.png)\n\n\n:::\n\né€šè¿‡ç»“æœå¯çœ‹å‡º250Wæ•°æ®ç”¨æ—¶50ç§’ï¼Œæµ‹è¯•ä½¿ç”¨Mybatisè¿›è¡Œçš„æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥ä½¿ç”¨JDBCè¿æ¥è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦ã€‚\n\næ³¨æ„ï¼š==æ¯å°è¿è¡Œçš„ç”µè„‘é…ç½®ä¸åŒä¼šå½±å“æœ€ç»ˆç”¨æ—¶==\n\n### æŠ½å–æˆæ¨¡æ¿å·¥å…·ç±»\n```java\npublic class EasyExcelUtil {\n\n    private static final int SHEET_DATA_ROWS = 1000000;\n\n    private static final int WRITE_DATA_ROWS = 200000;\n\n    private BaseMapper mapper;\n\n    public EasyExcelUtil(BaseMapper mapper) {\n        //é€šè¿‡ä¼ å…¥éœ€è¦å¯¼å‡ºçš„Mapperæ¥è°ƒç”¨æ–¹æ³•\n        this.mapper = mapper;\n    }\n    \n    /**\n     * \n     * @param fileName å¯¼å‡ºæ–‡ä»¶å\n     * @param response \n     * @param titles è¡¨å¤´åç§°\n     * @param wrapper æŸ¥è¯¢æ¡ä»¶\n     * @param totalCount æ€»æ¡æ•°\n     * @param <T>\n     */\n    public <T> void export(String fileName, HttpServletResponse response, List<List<String>> titles, QueryWrapper<T> wrapper,Integer totalCount){\n        long start = System.currentTimeMillis();\n        OutputStream outputStream = null;\n        try {\n            outputStream = response.getOutputStream();\n            WriteWorkbook workbook = new WriteWorkbook();\n            workbook.setOutputStream(outputStream);\n            workbook.setExcelType(ExcelTypeEnum.XLSX);\n            ExcelWriter writer = new ExcelWriter(workbook);\n            WriteTable writeTable = new WriteTable();\n            writeTable.setHead(titles);\n            //æ¯ä¸€ä¸ªSheetå­˜æ”¾100wæ¡æ•°æ®\n            Integer sheetDataRows = SHEET_DATA_ROWS;\n            //æ¯æ¬¡å†™å…¥çš„æ•°æ®é‡20w\n            int writeDataRows = WRITE_DATA_ROWS;\n            //è®¡ç®—éœ€è¦çš„Sheetæ•°é‡\n            int sheetNum = totalCount % sheetDataRows == 0 ? (totalCount / sheetDataRows) : (totalCount / sheetDataRows + 1);\n            //è®¡ç®—ä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ä¸ªSheetéœ€è¦å†™å…¥çš„æ¬¡æ•°(ä¸€èˆ¬æƒ…å†µä¸åŒ…å«æœ€åä¸€ä¸ªsheet,å› ä¸ºæœ€åä¸€ä¸ªsheetä¸ç¡®å®šä¼šå†™å…¥å¤šå°‘æ¡æ•°æ®)\n            int oneSheetWriteCount = sheetDataRows / writeDataRows;\n            //è®¡ç®—æœ€åä¸€ä¸ªsheetéœ€è¦å†™å…¥çš„æ¬¡æ•°\n            int lastSheetWriteCount = totalCount % sheetDataRows == 0 ? oneSheetWriteCount : (totalCount % sheetDataRows % writeDataRows == 0 ? (totalCount % sheetDataRows / writeDataRows) : (totalCount % sheetDataRows / writeDataRows + 1));\n\n            //å¼€å§‹åˆ†æ‰¹æŸ¥è¯¢åˆ†æ¬¡å†™å…¥\n            //æ³¨æ„è¿™æ¬¡çš„å¾ªç¯å°±éœ€è¦è¿›è¡ŒåµŒå¥—å¾ªç¯äº†,å¤–å±‚å¾ªç¯æ˜¯Sheetæ•°ç›®,å†…å±‚å¾ªç¯æ˜¯å†™å…¥æ¬¡æ•°\n            List dataList = new ArrayList<>(writeDataRows);\n            for (int i = 0; i < sheetNum; i++) {\n                //åˆ›å»ºSheet\n                WriteSheet writeSheet = new WriteSheet();\n                writeSheet.setSheetName(\"é¡µæ•°\"+i);\n                //å¾ªç¯å†™å…¥æ¬¡æ•°: jçš„è‡ªå¢æ¡ä»¶æ˜¯å½“ä¸æ˜¯æœ€åä¸€ä¸ªSheetçš„æ—¶å€™å†™å…¥æ¬¡æ•°ä¸ºæ­£å¸¸çš„æ¯ä¸ªSheetå†™å…¥çš„æ¬¡æ•°,å¦‚æœæ˜¯æœ€åä¸€ä¸ªå°±éœ€è¦ä½¿ç”¨è®¡ç®—çš„æ¬¡æ•°lastSheetWriteCount\n                for (int j = 0; j < (i != sheetNum - 1 ? oneSheetWriteCount : lastSheetWriteCount); j++) {\n                    //é›†åˆå¤ç”¨,ä¾¿äºGCæ¸…ç†\n                    dataList.clear();\n                    //åˆ†é¡µæŸ¥è¯¢ä¸€æ¬¡20w\n                    dataList = mapper.selectPage(new Page<>(j + 1 + oneSheetWriteCount * i, writeDataRows), wrapper).getRecords();\n                    //å†™æ•°æ®\n                    writer.write(dataList, writeSheet, writeTable);\n                }\n            }\n            // ä¸‹è½½EXCEL\n            response.setHeader(\"Content-Disposition\", \"attachment;filename=\" + new String((fileName).getBytes(\"gb2312\"), \"ISO-8859-1\") + \".xlsx\");\n            response.setContentType(\"multipart/form-data\");\n            response.setCharacterEncoding(\"utf-8\");\n            writer.finish();\n            outputStream.flush();\n            long end = System.currentTimeMillis();\n            System.out.println(String.format(\"å¯¼å‡ºæ¡æ•°:\"+totalCount+\"ç”¨æ—¶ï¼š%d ms\", end - start));\n        } catch (IOException e){\n            e.printStackTrace();\n        } finally {\n            if (outputStream != null) {\n                try {\n                    outputStream.close();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n}\n```\n\nä½¿ç”¨ï¼š\n```java\npublic void export(HttpServletRequest request, HttpServletResponse response, JSONObject params) {\n        Date startTime = params.getDate(\"startTime\");\n        Date endTime = params.getDate(\"endTime\");\n        String fileName = params.getString(\"fileName\");\n\n        //è¡¨å¤´å®šä¹‰\n        List<List<String>> titles = new ArrayList<>();\n        titles.add(Collections.singletonList(\"id\"));\n        titles.add(Collections.singletonList(\"å§“å\"));\n        //æŸ¥è¯¢æ¡ä»¶\n        QueryWrapper<CheckTeenage> wrapper = new QueryWrapper<>();\n        if (null != startTime && null != endTime) {\n            wrapper.between(\"create_time\",startTime,endTime);\n        }\n        //æ€»æ¡æ•°\n        Integer count = baseMapper.selectCount(wrapper);\n        //æŸ¥è¯¢å­—æ®µ\n        wrapper.select(\"id\",\"name\");\n        //æŸ¥è¯¢\n        new EasyExcelUtil(baseMapper).export(fileName,response,titles,wrapper,count);\n    }\n```\nè¿è¡Œç»“æœï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/31/b94f713088c449559b4cc9c49a79bb2a.png)\n\n:::\n\næ¨¡æ¿å› ç±»å‹è½¬æ¢åŸå› æ¯”æŒ‡å®šæ…¢ï¼Œåç»­ä¼šä¼˜åŒ–ã€‚', '2022-10-31 15:17:57', '2022-10-31 15:17:57', '<h3><a id=\"_0\"></a>èƒŒæ™¯</h3>\n<p>å…¬å¸é¡¹ç›®æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œéƒ¨åˆ†è¡¨æ‹¥æœ‰åƒä¸‡æ•°æ®é‡ï¼Œä½†æ˜¯é¡¹ç›®é‡Œé¢å¯¼å‡ºåŠŸèƒ½é™ˆæ—§ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„POIå¯¼å‡ºï¼Œé™åˆ¶äº†å•æ¬¡å¯¼å‡ºæ•°é‡ä¸º6Wæ¡ï¼Œæ¯æ¬¡ç”¨æˆ·éœ€è¦åˆ†æ‰¹æ¬¡å¯¼å‡ºã€‚æ—¢ç„¶æœ‰éœ€æ±‚é‚£æˆ‘å°±å°è¯•èƒ½å¦è§£å†³å§ã€‚</p>\n<h3><a id=\"_4\"></a>æœªæŠ½å–æ¨¡æ¿ç‰ˆæœ¬</h3>\n<p>è¿™æ®µå¹¶æœªæŠ½å–æˆé€šç”¨æ¨¡æ¿ï¼Œæ³›ç”¨æ€§ä¸å¼ºï¼Œä»…æµ‹è¯•åœ¨æŒ‡å®šç±»å‹ä¸éœ€è¦è½¬æ¢ä¸‹å¯èŠ‚çœå¤šå°‘æ—¶é—´ã€‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">export</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, JSONObject params)</span> {\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">start</span> <span class=\"hljs-operator\">=</span> System.currentTimeMillis();\n        <span class=\"hljs-type\">OutputStream</span> <span class=\"hljs-variable\">outputStream</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            outputStream = response.getOutputStream();\n            <span class=\"hljs-type\">ExcelWriter</span> <span class=\"hljs-variable\">writer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ExcelWriter</span>(outputStream, ExcelTypeEnum.XLSX);\n            <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">fileName</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>((<span class=\"hljs-string\">&quot;excel100w&quot;</span>).getBytes(), <span class=\"hljs-string\">&quot;UTF-8&quot;</span>);\n            <span class=\"hljs-comment\">//title</span>\n            <span class=\"hljs-type\">WriteTable</span> <span class=\"hljs-variable\">writeTable</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WriteTable</span>();\n            List&lt;List&lt;String&gt;&gt; titles = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n            titles.add(Arrays.asList(<span class=\"hljs-string\">&quot;id&quot;</span>));\n            titles.add(Arrays.asList(<span class=\"hljs-string\">&quot;å§“å&quot;</span>));\n            writeTable.setHead(titles);\n            <span class=\"hljs-comment\">//è®°å½•æ€»æ•°:å®é™…ä¸­éœ€è¦æ ¹æ®æŸ¥è¯¢æ¡ä»¶è¿›è¡Œç»Ÿè®¡å³å¯</span>\n            <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">totalCount</span> <span class=\"hljs-operator\">=</span> baseMapper.selectCount(<span class=\"hljs-literal\">null</span>);\n            <span class=\"hljs-comment\">//æ¯ä¸€ä¸ªSheetå­˜æ”¾100wæ¡æ•°æ®</span>\n            <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">sheetDataRows</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1000000</span>;\n            <span class=\"hljs-comment\">//æ¯æ¬¡å†™å…¥çš„æ•°æ®é‡20w</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">writeDataRows</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">200000</span>;\n            <span class=\"hljs-comment\">//è®¡ç®—éœ€è¦çš„Sheetæ•°é‡</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">sheetNum</span> <span class=\"hljs-operator\">=</span> totalCount % sheetDataRows == <span class=\"hljs-number\">0</span> ? (totalCount / sheetDataRows) : (totalCount / sheetDataRows + <span class=\"hljs-number\">1</span>);\n            <span class=\"hljs-comment\">//è®¡ç®—ä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ä¸ªSheetéœ€è¦å†™å…¥çš„æ¬¡æ•°(ä¸€èˆ¬æƒ…å†µä¸åŒ…å«æœ€åä¸€ä¸ªsheet,å› ä¸ºæœ€åä¸€ä¸ªsheetä¸ç¡®å®šä¼šå†™å…¥å¤šå°‘æ¡æ•°æ®)</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">oneSheetWriteCount</span> <span class=\"hljs-operator\">=</span> sheetDataRows / writeDataRows;\n            <span class=\"hljs-comment\">//è®¡ç®—æœ€åä¸€ä¸ªsheetéœ€è¦å†™å…¥çš„æ¬¡æ•°</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">lastSheetWriteCount</span> <span class=\"hljs-operator\">=</span> totalCount % sheetDataRows == <span class=\"hljs-number\">0</span> ? oneSheetWriteCount : (totalCount % sheetDataRows % writeDataRows == <span class=\"hljs-number\">0</span> ? (totalCount % sheetDataRows / writeDataRows) : (totalCount % sheetDataRows / writeDataRows + <span class=\"hljs-number\">1</span>));\n\n            <span class=\"hljs-comment\">//å¼€å§‹åˆ†æ‰¹æŸ¥è¯¢åˆ†æ¬¡å†™å…¥</span>\n            <span class=\"hljs-comment\">//æ³¨æ„è¿™æ¬¡çš„å¾ªç¯å°±éœ€è¦è¿›è¡ŒåµŒå¥—å¾ªç¯äº†,å¤–å±‚å¾ªç¯æ˜¯Sheetæ•°ç›®,å†…å±‚å¾ªç¯æ˜¯å†™å…¥æ¬¡æ•°</span>\n            List&lt;List&lt;String&gt;&gt; dataList = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; sheetNum; i++) {\n                <span class=\"hljs-comment\">//åˆ›å»ºSheet</span>\n                <span class=\"hljs-type\">WriteSheet</span> <span class=\"hljs-variable\">writeSheet</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WriteSheet</span>();\n                writeSheet.setSheetName(<span class=\"hljs-string\">&quot;é¡µæ•°&quot;</span>+i);\n                <span class=\"hljs-comment\">//å¾ªç¯å†™å…¥æ¬¡æ•°: jçš„è‡ªå¢æ¡ä»¶æ˜¯å½“ä¸æ˜¯æœ€åä¸€ä¸ªSheetçš„æ—¶å€™å†™å…¥æ¬¡æ•°ä¸ºæ­£å¸¸çš„æ¯ä¸ªSheetå†™å…¥çš„æ¬¡æ•°,å¦‚æœæ˜¯æœ€åä¸€ä¸ªå°±éœ€è¦ä½¿ç”¨è®¡ç®—çš„æ¬¡æ•°lastSheetWriteCount</span>\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; (i != sheetNum - <span class=\"hljs-number\">1</span> ? oneSheetWriteCount : lastSheetWriteCount); j++) {\n                    <span class=\"hljs-comment\">//é›†åˆå¤ç”¨,ä¾¿äºGCæ¸…ç†</span>\n                    dataList.clear();\n                    <span class=\"hljs-comment\">//åˆ†é¡µæŸ¥è¯¢ä¸€æ¬¡20w</span>\n                    List&lt;CheckTeenage&gt; resultList = baseMapper.selectPage(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Page</span>&lt;&gt;(j + <span class=\"hljs-number\">1</span> + oneSheetWriteCount * i, writeDataRows), <span class=\"hljs-literal\">null</span>).getRecords();\n                    <span class=\"hljs-keyword\">if</span> (!CollectionUtils.isEmpty(resultList)) {\n                        resultList.forEach(item -&gt; {\n                            dataList.add(Arrays.asList(item.getId(),item.getName()));\n                        });\n                    }\n                    <span class=\"hljs-comment\">//å†™æ•°æ®</span>\n                    writer.write(dataList, writeSheet, writeTable);\n                }\n            }\n            <span class=\"hljs-comment\">// ä¸‹è½½EXCEL</span>\n            response.setHeader(<span class=\"hljs-string\">&quot;Content-Disposition&quot;</span>, <span class=\"hljs-string\">&quot;attachment;filename=&quot;</span> + <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>((fileName).getBytes(<span class=\"hljs-string\">&quot;gb2312&quot;</span>), <span class=\"hljs-string\">&quot;ISO-8859-1&quot;</span>) + <span class=\"hljs-string\">&quot;.xlsx&quot;</span>);\n            response.setContentType(<span class=\"hljs-string\">&quot;multipart/form-data&quot;</span>);\n            response.setCharacterEncoding(<span class=\"hljs-string\">&quot;utf-8&quot;</span>);\n            writer.finish();\n            outputStream.flush();\n            <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">end</span> <span class=\"hljs-operator\">=</span> System.currentTimeMillis();\n            System.out.println(String.format(<span class=\"hljs-string\">&quot;å¯¼å‡ºæ¡æ•°:&quot;</span>+totalCount+<span class=\"hljs-string\">&quot;ç”¨æ—¶ï¼š%d ms&quot;</span>, end - start));\n        } <span class=\"hljs-keyword\">catch</span> (FileNotFoundException e) {\n            e.printStackTrace();\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            e.printStackTrace();\n        } <span class=\"hljs-keyword\">finally</span> {\n            <span class=\"hljs-keyword\">if</span> (outputStream != <span class=\"hljs-literal\">null</span>) {\n                <span class=\"hljs-keyword\">try</span> {\n                    outputStream.close();\n                } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n</code></div></pre>\n<p>æœ€ç»ˆæ‰§è¡Œç»“æœï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/31/2fc01ee15bfd4675bac84e6af65195fd.png\" alt=\"image.png\" /></p>\n</div>\n<p>é€šè¿‡ç»“æœå¯çœ‹å‡º250Wæ•°æ®ç”¨æ—¶50ç§’ï¼Œæµ‹è¯•ä½¿ç”¨Mybatisè¿›è¡Œçš„æ•°æ®åº“æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥ä½¿ç”¨JDBCè¿æ¥è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–æŸ¥è¯¢é€Ÿåº¦ã€‚</p>\n<p>æ³¨æ„ï¼š<mark>æ¯å°è¿è¡Œçš„ç”µè„‘é…ç½®ä¸åŒä¼šå½±å“æœ€ç»ˆç”¨æ—¶</mark></p>\n<h3><a id=\"_92\"></a>æŠ½å–æˆæ¨¡æ¿å·¥å…·ç±»</h3>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">EasyExcelUtil</span> {\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">SHEET_DATA_ROWS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1000000</span>;\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">WRITE_DATA_ROWS</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">200000</span>;\n\n    <span class=\"hljs-keyword\">private</span> BaseMapper mapper;\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-title function_\">EasyExcelUtil</span><span class=\"hljs-params\">(BaseMapper mapper)</span> {\n        <span class=\"hljs-comment\">//é€šè¿‡ä¼ å…¥éœ€è¦å¯¼å‡ºçš„Mapperæ¥è°ƒç”¨æ–¹æ³•</span>\n        <span class=\"hljs-built_in\">this</span>.mapper = mapper;\n    }\n    \n    <span class=\"hljs-comment\">/**\n     * \n     * <span class=\"hljs-doctag\">@param</span> fileName å¯¼å‡ºæ–‡ä»¶å\n     * <span class=\"hljs-doctag\">@param</span> response \n     * <span class=\"hljs-doctag\">@param</span> titles è¡¨å¤´åç§°\n     * <span class=\"hljs-doctag\">@param</span> wrapper æŸ¥è¯¢æ¡ä»¶\n     * <span class=\"hljs-doctag\">@param</span> totalCount æ€»æ¡æ•°\n     * <span class=\"hljs-doctag\">@param</span> &lt;T&gt;\n     */</span>\n    <span class=\"hljs-keyword\">public</span> &lt;T&gt; <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">export</span><span class=\"hljs-params\">(String fileName, HttpServletResponse response, List&lt;List&lt;String&gt;&gt; titles, QueryWrapper&lt;T&gt; wrapper,Integer totalCount)</span>{\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">start</span> <span class=\"hljs-operator\">=</span> System.currentTimeMillis();\n        <span class=\"hljs-type\">OutputStream</span> <span class=\"hljs-variable\">outputStream</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            outputStream = response.getOutputStream();\n            <span class=\"hljs-type\">WriteWorkbook</span> <span class=\"hljs-variable\">workbook</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WriteWorkbook</span>();\n            workbook.setOutputStream(outputStream);\n            workbook.setExcelType(ExcelTypeEnum.XLSX);\n            <span class=\"hljs-type\">ExcelWriter</span> <span class=\"hljs-variable\">writer</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ExcelWriter</span>(workbook);\n            <span class=\"hljs-type\">WriteTable</span> <span class=\"hljs-variable\">writeTable</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WriteTable</span>();\n            writeTable.setHead(titles);\n            <span class=\"hljs-comment\">//æ¯ä¸€ä¸ªSheetå­˜æ”¾100wæ¡æ•°æ®</span>\n            <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">sheetDataRows</span> <span class=\"hljs-operator\">=</span> SHEET_DATA_ROWS;\n            <span class=\"hljs-comment\">//æ¯æ¬¡å†™å…¥çš„æ•°æ®é‡20w</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">writeDataRows</span> <span class=\"hljs-operator\">=</span> WRITE_DATA_ROWS;\n            <span class=\"hljs-comment\">//è®¡ç®—éœ€è¦çš„Sheetæ•°é‡</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">sheetNum</span> <span class=\"hljs-operator\">=</span> totalCount % sheetDataRows == <span class=\"hljs-number\">0</span> ? (totalCount / sheetDataRows) : (totalCount / sheetDataRows + <span class=\"hljs-number\">1</span>);\n            <span class=\"hljs-comment\">//è®¡ç®—ä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ä¸ªSheetéœ€è¦å†™å…¥çš„æ¬¡æ•°(ä¸€èˆ¬æƒ…å†µä¸åŒ…å«æœ€åä¸€ä¸ªsheet,å› ä¸ºæœ€åä¸€ä¸ªsheetä¸ç¡®å®šä¼šå†™å…¥å¤šå°‘æ¡æ•°æ®)</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">oneSheetWriteCount</span> <span class=\"hljs-operator\">=</span> sheetDataRows / writeDataRows;\n            <span class=\"hljs-comment\">//è®¡ç®—æœ€åä¸€ä¸ªsheetéœ€è¦å†™å…¥çš„æ¬¡æ•°</span>\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">lastSheetWriteCount</span> <span class=\"hljs-operator\">=</span> totalCount % sheetDataRows == <span class=\"hljs-number\">0</span> ? oneSheetWriteCount : (totalCount % sheetDataRows % writeDataRows == <span class=\"hljs-number\">0</span> ? (totalCount % sheetDataRows / writeDataRows) : (totalCount % sheetDataRows / writeDataRows + <span class=\"hljs-number\">1</span>));\n\n            <span class=\"hljs-comment\">//å¼€å§‹åˆ†æ‰¹æŸ¥è¯¢åˆ†æ¬¡å†™å…¥</span>\n            <span class=\"hljs-comment\">//æ³¨æ„è¿™æ¬¡çš„å¾ªç¯å°±éœ€è¦è¿›è¡ŒåµŒå¥—å¾ªç¯äº†,å¤–å±‚å¾ªç¯æ˜¯Sheetæ•°ç›®,å†…å±‚å¾ªç¯æ˜¯å†™å…¥æ¬¡æ•°</span>\n            <span class=\"hljs-type\">List</span> <span class=\"hljs-variable\">dataList</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;(writeDataRows);\n            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; sheetNum; i++) {\n                <span class=\"hljs-comment\">//åˆ›å»ºSheet</span>\n                <span class=\"hljs-type\">WriteSheet</span> <span class=\"hljs-variable\">writeSheet</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">WriteSheet</span>();\n                writeSheet.setSheetName(<span class=\"hljs-string\">&quot;é¡µæ•°&quot;</span>+i);\n                <span class=\"hljs-comment\">//å¾ªç¯å†™å…¥æ¬¡æ•°: jçš„è‡ªå¢æ¡ä»¶æ˜¯å½“ä¸æ˜¯æœ€åä¸€ä¸ªSheetçš„æ—¶å€™å†™å…¥æ¬¡æ•°ä¸ºæ­£å¸¸çš„æ¯ä¸ªSheetå†™å…¥çš„æ¬¡æ•°,å¦‚æœæ˜¯æœ€åä¸€ä¸ªå°±éœ€è¦ä½¿ç”¨è®¡ç®—çš„æ¬¡æ•°lastSheetWriteCount</span>\n                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; j &lt; (i != sheetNum - <span class=\"hljs-number\">1</span> ? oneSheetWriteCount : lastSheetWriteCount); j++) {\n                    <span class=\"hljs-comment\">//é›†åˆå¤ç”¨,ä¾¿äºGCæ¸…ç†</span>\n                    dataList.clear();\n                    <span class=\"hljs-comment\">//åˆ†é¡µæŸ¥è¯¢ä¸€æ¬¡20w</span>\n                    dataList = mapper.selectPage(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Page</span>&lt;&gt;(j + <span class=\"hljs-number\">1</span> + oneSheetWriteCount * i, writeDataRows), wrapper).getRecords();\n                    <span class=\"hljs-comment\">//å†™æ•°æ®</span>\n                    writer.write(dataList, writeSheet, writeTable);\n                }\n            }\n            <span class=\"hljs-comment\">// ä¸‹è½½EXCEL</span>\n            response.setHeader(<span class=\"hljs-string\">&quot;Content-Disposition&quot;</span>, <span class=\"hljs-string\">&quot;attachment;filename=&quot;</span> + <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>((fileName).getBytes(<span class=\"hljs-string\">&quot;gb2312&quot;</span>), <span class=\"hljs-string\">&quot;ISO-8859-1&quot;</span>) + <span class=\"hljs-string\">&quot;.xlsx&quot;</span>);\n            response.setContentType(<span class=\"hljs-string\">&quot;multipart/form-data&quot;</span>);\n            response.setCharacterEncoding(<span class=\"hljs-string\">&quot;utf-8&quot;</span>);\n            writer.finish();\n            outputStream.flush();\n            <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">end</span> <span class=\"hljs-operator\">=</span> System.currentTimeMillis();\n            System.out.println(String.format(<span class=\"hljs-string\">&quot;å¯¼å‡ºæ¡æ•°:&quot;</span>+totalCount+<span class=\"hljs-string\">&quot;ç”¨æ—¶ï¼š%d ms&quot;</span>, end - start));\n        } <span class=\"hljs-keyword\">catch</span> (IOException e){\n            e.printStackTrace();\n        } <span class=\"hljs-keyword\">finally</span> {\n            <span class=\"hljs-keyword\">if</span> (outputStream != <span class=\"hljs-literal\">null</span>) {\n                <span class=\"hljs-keyword\">try</span> {\n                    outputStream.close();\n                } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n}\n</code></div></pre>\n<p>ä½¿ç”¨ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">export</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, JSONObject params)</span> {\n        <span class=\"hljs-type\">Date</span> <span class=\"hljs-variable\">startTime</span> <span class=\"hljs-operator\">=</span> params.getDate(<span class=\"hljs-string\">&quot;startTime&quot;</span>);\n        <span class=\"hljs-type\">Date</span> <span class=\"hljs-variable\">endTime</span> <span class=\"hljs-operator\">=</span> params.getDate(<span class=\"hljs-string\">&quot;endTime&quot;</span>);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">fileName</span> <span class=\"hljs-operator\">=</span> params.getString(<span class=\"hljs-string\">&quot;fileName&quot;</span>);\n\n        <span class=\"hljs-comment\">//è¡¨å¤´å®šä¹‰</span>\n        List&lt;List&lt;String&gt;&gt; titles = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">ArrayList</span>&lt;&gt;();\n        titles.add(Collections.singletonList(<span class=\"hljs-string\">&quot;id&quot;</span>));\n        titles.add(Collections.singletonList(<span class=\"hljs-string\">&quot;å§“å&quot;</span>));\n        <span class=\"hljs-comment\">//æŸ¥è¯¢æ¡ä»¶</span>\n        QueryWrapper&lt;CheckTeenage&gt; wrapper = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">QueryWrapper</span>&lt;&gt;();\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-literal\">null</span> != startTime &amp;&amp; <span class=\"hljs-literal\">null</span> != endTime) {\n            wrapper.between(<span class=\"hljs-string\">&quot;create_time&quot;</span>,startTime,endTime);\n        }\n        <span class=\"hljs-comment\">//æ€»æ¡æ•°</span>\n        <span class=\"hljs-type\">Integer</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> baseMapper.selectCount(wrapper);\n        <span class=\"hljs-comment\">//æŸ¥è¯¢å­—æ®µ</span>\n        wrapper.select(<span class=\"hljs-string\">&quot;id&quot;</span>,<span class=\"hljs-string\">&quot;name&quot;</span>);\n        <span class=\"hljs-comment\">//æŸ¥è¯¢</span>\n        <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">EasyExcelUtil</span>(baseMapper).export(fileName,response,titles,wrapper,count);\n    }\n</code></div></pre>\n<p>è¿è¡Œç»“æœï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/31/b94f713088c449559b4cc9c49a79bb2a.png\" alt=\"image.png\" /></p>\n</div>\n<p>æ¨¡æ¿å› ç±»å‹è½¬æ¢åŸå› æ¯”æŒ‡å®šæ…¢ï¼Œåç»­ä¼šä¼˜åŒ–ã€‚</p>\n');
INSERT INTO `article_content` VALUES ('5dc9ccb15fe3224878945a842f7f6427', '1. SocketChannel å°±æ˜¯ NIO å¯¹äºéé˜»å¡ socket æ“ä½œçš„æ”¯æŒçš„ç»„ä»¶ï¼Œå…¶åœ¨ socket ä¸Š å°è£…äº†ä¸€å±‚ï¼Œä¸»è¦æ˜¯æ”¯æŒäº†éé˜»å¡çš„è¯»å†™ã€‚åŒæ—¶æ”¹è¿›äº†ä¼ ç»Ÿçš„å•å‘æµ API,ï¼ŒChannel åŒæ—¶æ”¯æŒè¯»å†™ã€‚\n2. socket é€šé“ç±»ä¸»è¦åˆ†ä¸º DatagramChannelã€SocketChannel å’Œ ServerSocketChannelï¼Œå®ƒä»¬åœ¨è¢«å®ä¾‹åŒ–æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹ç­‰ socket å¯¹è±¡ã€‚è¦æŠŠä¸€ä¸ª socket é€šé“ç½®äºéé˜»å¡æ¨¡å¼ï¼Œæˆ‘ä»¬è¦ä¾é æ‰€æœ‰ socket é€šé“ç±»çš„å…¬æœ‰è¶…çº§ç±»ï¼š SelectableChannelã€‚å°±ç»ªé€‰æ‹©ï¼ˆreadiness selectionï¼‰æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥æŸ¥è¯¢é€šé“çš„ æœºåˆ¶ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥åˆ¤æ–­é€šé“æ˜¯å¦å‡†å¤‡å¥½æ‰§è¡Œä¸€ä¸ªç›®æ ‡æ“ä½œï¼Œå¦‚è¯»æˆ–å†™ã€‚éé˜»å¡ I/O å’Œ å¯é€‰æ‹©æ€§æ˜¯ç´§å¯†ç›¸è¿çš„ï¼Œé‚£ä¹Ÿæ­£æ˜¯ç®¡ç†é˜»å¡æ¨¡å¼çš„ API ä»£ç è¦åœ¨ SelectableChannel è¶…çº§ç±»ä¸­å®šä¹‰çš„åŸå› ã€‚\n3. è®¾ç½®æˆ–é‡æ–°è®¾ç½®ä¸€ä¸ªé€šé“çš„é˜»å¡æ¨¡å¼æ˜¯å¾ˆç®€å•çš„ï¼Œåªè¦è°ƒç”¨ configureBlocking( )æ–¹æ³•å³å¯ï¼Œä¼ é€’å‚æ•°å€¼ä¸º true åˆ™è®¾ä¸ºé˜»å¡æ¨¡å¼ï¼Œå‚æ•°å€¼ä¸º false å€¼è®¾ä¸ºéé˜»å¡æ¨¡å¼ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ isBlocking( )æ–¹æ³•æ¥åˆ¤æ–­æŸä¸ª socket é€šé“å½“å‰å¤„äº å“ªç§æ¨¡å¼ã€‚\n\n\nAbstractSelectableChannel.java ä¸­å®ç°çš„ configureBlocking()æ–¹æ³•å¦‚ä¸‹ï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/13ce8ae8652a4cafa8312081c19f7adc.png)\n\n:::\n\nä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ 3 ä¸ªé€šé“\n\n### 1 ServerSocketChannel\nServerSocketChannel æ˜¯ä¸€ä¸ªåŸºäºé€šé“çš„ socket ç›‘å¬å™¨ã€‚å®ƒåŒæˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ java.net.ServerSocket æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œä¸è¿‡å®ƒå¢åŠ äº†é€šé“è¯­ä¹‰ï¼Œå› æ­¤èƒ½å¤Ÿåœ¨éé˜»å¡ æ¨¡å¼ä¸‹è¿è¡Œã€‚\n\nç”±äº ServerSocketChannel æ²¡æœ‰ bind()æ–¹æ³•ï¼Œå› æ­¤æœ‰å¿…è¦å–å‡ºå¯¹ç­‰çš„ socket å¹¶ä½¿ç”¨ å®ƒæ¥ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ä»¥å¼€å§‹ç›‘å¬è¿æ¥ã€‚æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨å¯¹ç­‰ ServerSocket çš„ API æ¥æ ¹ æ®éœ€è¦è®¾ç½®å…¶ä»–çš„ socket é€‰é¡¹ã€‚\n\nåŒ java.net.ServerSocket ä¸€æ ·ï¼ŒServerSocketChannel ä¹Ÿæœ‰ accept( )æ–¹æ³•ã€‚ ServerSocketChannel çš„ accept()æ–¹æ³•ä¼šè¿”å› SocketChannel ç±»å‹å¯¹è±¡ï¼Œ SocketChannel å¯ä»¥åœ¨éé˜»å¡æ¨¡å¼ä¸‹è¿è¡Œã€‚\n\nä»¥ä¸‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªéé˜»å¡çš„ accept( )æ–¹æ³•ï¼š\n```java\npublic class ServerSocketChannelDemo {\n    public static void main(String[] args) throws Exception {\n        //ç«¯å£å·\n        int port = 9999;\n        //buffer\n        ByteBuffer buffer = ByteBuffer.wrap(\"hello word\".getBytes(StandardCharsets.UTF_8));\n\n        //ServerSocketChannel\n        ServerSocketChannel ssc = ServerSocketChannel.open();\n        //ç»‘å®š\n        ssc.socket().bind(new InetSocketAddress(port));\n        //è®¾ç½®éé˜»å¡æ¨¡å¼\n        ssc.configureBlocking(false);\n\n        //ç›‘å¬æ˜¯å¦æœ‰æ–°é“¾æ¥ä¼ å…¥\n        while (true){\n            System.out.println(\"Waiting for connections\");\n            SocketChannel sc = ssc.accept();\n            if(sc == null){\n                //æ²¡æœ‰é“¾æ¥ä¼ å…¥\n                System.out.println(\"null\");\n                Thread.sleep(2000);\n            }else {\n                System.out.println(\"Incoming connection from:\"+sc.socket().getRemoteSocketAddress());\n                buffer.rewind(); //æŒ‡é’ˆ0\n                sc.write(buffer);\n                sc.close();\n            }\n        }\n    }\n}\n```\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/57a63832c66f45c5bbff395c36d92be7.png)\n\n:::\n\n- æ‰“å¼€ ServerSocketChannel\né€šè¿‡è°ƒç”¨ ServerSocketChannel.open() æ–¹æ³•æ¥æ‰“å¼€ ServerSocketChannel.\n```java\nServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n```\n- å…³é—­ ServerSocketChannel\né€šè¿‡è°ƒç”¨ ServerSocketChannel.close() æ–¹æ³•æ¥å…³é—­ ServerSocketChannel.\n```java\nserverSocketChannel.close();\n```\n\n\n- ç›‘å¬æ–°çš„è¿æ¥\né€šè¿‡ ServerSocketChannel.accept() æ–¹æ³•ç›‘å¬æ–°è¿›çš„è¿æ¥ã€‚å½“ accept()æ–¹æ³•è¿”å›æ—¶ å€™,å®ƒè¿”å›ä¸€ä¸ªåŒ…å«æ–°è¿›æ¥çš„è¿æ¥çš„ SocketChannelã€‚å› æ­¤, accept()æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ åˆ°æœ‰æ–°è¿æ¥åˆ°è¾¾ã€‚\né€šå¸¸ä¸ä¼šä»…ä»…åªç›‘å¬ä¸€ä¸ªè¿æ¥,åœ¨ while å¾ªç¯ä¸­è°ƒç”¨ accept()æ–¹æ³•. å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/3e5b7a01f90e49efa8f1f6ad814858cd.png)\n\n:::\n\n- é˜»å¡æ¨¡å¼\nä¼šåœ¨ SocketChannel sc = ssc.accept();è¿™é‡Œé˜»å¡ä½è¿›ç¨‹ã€‚\n\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/3b10263a28184fa199557f6f2aeaa674.png)\n\n:::\n\n\n- éé˜»å¡æ¨¡å¼\nServerSocketChannel å¯ä»¥è®¾ç½®æˆéé˜»å¡æ¨¡å¼ã€‚åœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œaccept() æ–¹æ³•ä¼šç«‹ åˆ»è¿”å›ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ–°è¿›æ¥çš„è¿æ¥,è¿”å›çš„å°†æ˜¯ nullã€‚ å› æ­¤ï¼Œéœ€è¦æ£€æŸ¥è¿”å›çš„ SocketChannel æ˜¯å¦æ˜¯ null.å¦‚ï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/07e22f9e39af427b817c698bdc089c43.png)\n\n:::\n\n### 2 SocketChannel\n#### 2.1 SocketChannel ä»‹ç»\nJava NIO ä¸­çš„ SocketChannel æ˜¯ä¸€ä¸ªè¿æ¥åˆ° TCP ç½‘ç»œå¥—æ¥å­—çš„é€šé“ã€‚\n> A selectable channel for stream-oriented connecting sockets.\n\nä»¥ä¸Šæ˜¯ Java docs ä¸­å¯¹äº SocketChannel çš„æè¿°ï¼šSocketChannel æ˜¯ä¸€ç§é¢å‘æµè¿æ¥ sockets å¥—æ¥å­—çš„å¯é€‰æ‹©é€šé“ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼š\n-  SocketChannel æ˜¯ç”¨æ¥è¿æ¥ Socket å¥—æ¥å­—\n- SocketChannel ä¸»è¦ç”¨é€”ç”¨æ¥å¤„ç†ç½‘ç»œ I/O çš„é€šé“\n- SocketChannel æ˜¯åŸºäº TCP è¿æ¥ä¼ è¾“\n- SocketChannel å®ç°äº†å¯é€‰æ‹©é€šé“ï¼Œå¯ä»¥è¢«å¤šè·¯å¤ç”¨çš„\n\n#### 2.2 SocketChannel ç‰¹å¾\n- å¯¹äºå·²ç»å­˜åœ¨çš„ socket ä¸èƒ½åˆ›å»º SocketChannel\n- SocketChannel ä¸­æä¾›çš„ open æ¥å£åˆ›å»ºçš„ Channel å¹¶æ²¡æœ‰è¿›è¡Œç½‘ç»œçº§è”ï¼Œéœ€è¦ä½¿ ç”¨ connect æ¥å£è¿æ¥åˆ°æŒ‡å®šåœ°å€\n- æœªè¿›è¡Œè¿æ¥çš„ SocketChannle æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œä¼šæŠ›å‡º NotYetConnectedException\n- SocketChannel æ”¯æŒä¸¤ç§ I/O æ¨¡å¼ï¼šé˜»å¡å¼å’Œéé˜»å¡å¼\n- SocketChannel æ”¯æŒå¼‚æ­¥å…³é—­ã€‚å¦‚æœ SocketChannel åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Š read é˜»å¡ï¼Œå¦ ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥ SocketChannel è°ƒç”¨ shutdownInputï¼Œåˆ™è¯»é˜»å¡çš„çº¿ç¨‹å°†è¿”å›-1 è¡¨ç¤ºæ²¡æœ‰ è¯»å–ä»»ä½•æ•°æ®ï¼›å¦‚æœ SocketChannel åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Š write é˜»å¡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥ SocketChannel è°ƒç”¨ shutdownWriteï¼Œåˆ™å†™é˜»å¡çš„çº¿ç¨‹å°†æŠ›å‡º AsynchronousCloseException\n- SocketChannel æ”¯æŒè®¾å®šå‚æ•° SO_SNDBUF å¥—æ¥å­—å‘é€ç¼“å†²åŒºå¤§å°, SO_RCVBUF å¥—æ¥å­—æ¥æ”¶ç¼“å†²åŒºå¤§å°, SO_KEEPALIVE ä¿æ´»è¿æ¥ O_REUSEADDR å¤ç”¨åœ°å€, SO_LINGER æœ‰æ•°æ®ä¼ è¾“æ—¶å»¶ç¼“å…³é—­ Channel (åªæœ‰åœ¨éé˜»å¡æ¨¡å¼ä¸‹æœ‰ç”¨), TCP_NODELAY ç¦ç”¨ Nagle ç®—æ³•\n\n#### 2.3 SocketChannel çš„ä½¿ç”¨\n- åˆ›å»º SocketChannel\n\n\nç¬¬ä¸€ç§ï¼š\n```java\nSocketChannel socketChannel = SocketChannel.open(new InetSocketAddress(\"www.baidu.com\", 80));\n```\nç¬¬äºŒç§ï¼š\n```java\nSocketChannel socketChanne2 = SocketChannel.open(); \nsocketChanne2.connect(new InetSocketAddress(\"www.baidu.com\", 80));\n```\nç›´æ¥ä½¿ç”¨æœ‰å‚ open api æˆ–è€…ä½¿ç”¨æ— å‚ open apiï¼Œä½†æ˜¯åœ¨æ— å‚ open åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª SocketChannel å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå®è´¨çš„ tcp è¿æ¥ã€‚\n- è¿æ¥æ ¡éªŒ\n```java\nsocketChannel.isOpen(); // æµ‹è¯• SocketChannel æ˜¯å¦ä¸º open çŠ¶æ€ \nsocketChannel.isConnected(); //æµ‹è¯• SocketChannel æ˜¯å¦å·²ç»è¢«è¿æ¥ \nsocketChannel.isConnectionPending(); //æµ‹è¯• SocketChannel æ˜¯å¦æ­£åœ¨è¿›è¡Œ è¿æ¥\nsocketChannel.finishConnect(); //æ ¡éªŒæ­£åœ¨è¿›è¡Œå¥—æ¥å­—è¿æ¥çš„ SocketChannel æ˜¯å¦å·²ç»å®Œæˆè¿æ¥\n```\n- è¯»å†™æ¨¡å¼\nå‰é¢æåˆ° SocketChannel æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ï¼š\n```java\nsocketChannel.configureBlocking(false);\n```\né€šè¿‡ä»¥ä¸Šæ–¹æ³•è®¾ç½® SocketChannel çš„è¯»å†™æ¨¡å¼ã€‚false è¡¨ç¤ºéé˜»å¡ï¼Œtrue è¡¨ç¤ºé˜»å¡ã€‚\n- è¯»å†™\n```java\nSocketChannel socketChannel = SocketChannel.open( new InetSocketAddress(\"www.baidu.com\", 80)); \nByteBuffer byteBuffer = ByteBuffer.allocate(16); \nsocketChannel.read(byteBuffer); socketChannel.close(); \nSystem.out.println(\"read over\");\n```\nä»¥ä¸Šä¸ºé˜»å¡å¼è¯»ï¼Œå½“æ‰§è¡Œåˆ° read å‡ºï¼Œçº¿ç¨‹å°†é˜»å¡ï¼Œæ§åˆ¶å°å°†æ— æ³•æ‰“å° read over\n```java\nSocketChannel socketChannel = SocketChannel.open( new InetSocketAddress(\"www.baidu.com\", 80)); \nsocketChannel.configureBlocking(false); ByteBuffer byteBuffer = ByteBuffer.allocate(16); \nsocketChannel.read(byteBuffer); socketChannel.close();\nSystem.out.println(\"read over\");\n```\nä»¥ä¸Šä¸ºéé˜»å¡è¯»ï¼Œæ§åˆ¶å°å°†æ‰“å° read over\nè¯»å†™éƒ½æ˜¯é¢å‘ç¼“å†²åŒºï¼Œè¿™ä¸ªè¯»å†™æ–¹å¼ä¸å‰æ–‡ä¸­çš„ FileChannel ç›¸åŒã€‚\n- è®¾ç½®å’Œè·å–å‚æ•°\n```java\nsocketChannel.setOption(StandardSocketOptions.SO_KEEPALIVE, Boolean.TRUE)\n.setOption(StandardSocketOptions.TCP_NODELAY, Boolean.TRUE);\n```\né€šè¿‡ setOptions æ–¹æ³•å¯ä»¥è®¾ç½® socket å¥—æ¥å­—çš„ç›¸å…³å‚æ•°\n```java\nsocketChannel.getOption(StandardSocketOptions.SO_KEEPALIVE); \nsocketChannel.getOption(StandardSocketOptions.SO_RCVBUF);\n```\nå¯ä»¥é€šè¿‡ getOption è·å–ç›¸å…³å‚æ•°çš„å€¼ã€‚å¦‚é»˜è®¤çš„æ¥æ”¶ç¼“å†²åŒºå¤§å°æ˜¯ 8192byteã€‚\nSocketChannel è¿˜æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œä½†æ˜¯å¤šè·¯å¤ç”¨åœ¨åç»­å†…å®¹ä¸­ä¼šä»‹ç»åˆ°ã€‚\n\n### 3 DatagramChannel\næ­£å¦‚ SocketChannel å¯¹åº” Socketï¼ŒServerSocketChannel å¯¹åº” ServerSocketï¼Œæ¯ ä¸€ä¸ª DatagramChannel å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªå…³è”çš„ DatagramSocket å¯¹è±¡ã€‚æ­£å¦‚ SocketChannel æ¨¡æ‹Ÿè¿æ¥å¯¼å‘çš„æµåè®®ï¼ˆå¦‚ TCP/IPï¼‰ï¼ŒDatagramChannel åˆ™æ¨¡æ‹ŸåŒ… å¯¼å‘çš„æ— è¿æ¥åè®®ï¼ˆå¦‚ UDP/IPï¼‰ã€‚DatagramChannel æ˜¯æ— è¿æ¥çš„ï¼Œæ¯ä¸ªæ•°æ®æŠ¥ ï¼ˆdatagramï¼‰éƒ½æ˜¯ä¸€ä¸ªè‡ªåŒ…å«çš„å®ä½“ï¼Œæ‹¥æœ‰å®ƒè‡ªå·±çš„ç›®çš„åœ°å€åŠä¸ä¾èµ–å…¶ä»–æ•°æ®æŠ¥çš„ æ•°æ®è´Ÿè½½ã€‚ä¸é¢å‘æµçš„çš„ socket ä¸åŒï¼ŒDatagramChannel å¯ä»¥å‘é€å•ç‹¬çš„æ•°æ®æŠ¥ç»™ ä¸åŒçš„ç›®çš„åœ°å€ã€‚åŒæ ·ï¼ŒDatagramChannel å¯¹è±¡ä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªä»»æ„åœ°å€çš„æ•°æ®åŒ…ã€‚ æ¯ä¸ªåˆ°è¾¾çš„æ•°æ®æŠ¥éƒ½å«æœ‰å…³äºå®ƒæ¥è‡ªä½•å¤„çš„ä¿¡æ¯ï¼ˆæºåœ°å€ï¼‰ã€‚\n\n#### 3.1 æ‰“å¼€ DatagramChannel\n```java\nDatagramChannel server = DatagramChannel.open(); \nserver.socket().bind(new InetSocketAddress(10086));\n```\næ­¤ä¾‹å­æ˜¯æ‰“å¼€ 10086 ç«¯å£æ¥æ”¶ UDP æ•°æ®åŒ…\n\n#### 3.2 æ¥æ”¶æ•°æ®\né€šè¿‡ receive()æ¥æ”¶ UDP åŒ…\n```java\nByteBuffer receiveBuffer = ByteBuffer.allocate(64); \nreceiveBuffer.clear(); \nSocketAddress receiveAddr = server.receive(receiveBuffer);\n```\nSocketAddress å¯ä»¥è·å¾—å‘åŒ…çš„ ipã€ç«¯å£ç­‰ä¿¡æ¯ï¼Œç”¨ toString æŸ¥çœ‹\n\n#### 3.3 å‘é€æ•°æ®\né€šè¿‡ send()å‘é€ UDP åŒ…\n```java\nDatagramChannel server = DatagramChannel.open(); \nByteBuffer sendBuffer = ByteBuffer.wrap(\"client send\".getBytes()); \nserver.send(sendBuffer, new InetSocketAddress(\"127.0.0.1\",10086));\n```\n\n#### 3.4 è¿æ¥\nUDP ä¸å­˜åœ¨çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥ï¼Œè¿™é‡Œçš„è¿æ¥æ˜¯å‘ç‰¹å®šæœåŠ¡åœ°å€ç”¨ read å’Œ write æ¥æ”¶ å‘é€æ•°æ®åŒ…ã€‚\n```java\nclient.connect(new InetSocketAddress(\"127.0.0.1\",10086)); \nint readSize= client.read(sendBuffer); \nserver.write(sendBuffer);\n```\nread()å’Œ write()åªæœ‰åœ¨ connect()åæ‰èƒ½ä½¿ç”¨ï¼Œä¸ç„¶ä¼šæŠ› NotYetConnectedException å¼‚å¸¸ã€‚ç”¨ read()æ¥æ”¶æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°åŒ…ï¼Œä¼šæŠ› PortUnreachableException å¼‚å¸¸ã€‚\n\n#### 3.4 DatagramChannel ç¤ºä¾‹\nå®¢æˆ·ç«¯å‘é€ï¼ŒæœåŠ¡ç«¯æ¥æ”¶çš„ä¾‹å­\n```java\npublic class DatagramChannelDemo {\n\n    //å‘é€å®ç°\n    @Test\n    public void sendDatagram() throws Exception {\n        //æ‰“å¼€DatagramChannel\n        DatagramChannel sendChannel = DatagramChannel.open();\n        InetSocketAddress sendAddress = new InetSocketAddress(\"127.0.0.1\", 9999);\n\n        //å‘é€\n        while (true){\n            ByteBuffer buffer = ByteBuffer.wrap(\"å‘é€Jzj\".getBytes(StandardCharsets.UTF_8));\n            sendChannel.send(buffer,sendAddress);\n            System.out.println(\"å·²ç»å®Œæˆå‘é€\");\n            Thread.sleep(1000);\n        }\n    }\n\n\n    //æ¥æ”¶å®ç°\n    @Test\n    public void receiveDatagram() throws Exception{\n        //æ‰“å¼€DatagramChannel\n        DatagramChannel receiveChannel = DatagramChannel.open();\n        InetSocketAddress receiveAddress = new InetSocketAddress(9999);\n        //ç»‘å®š\n        receiveChannel.bind(receiveAddress);\n        //Buffer\n        ByteBuffer receiveBuffer = ByteBuffer.allocate(1024);\n        while (true){\n            receiveBuffer.clear();\n            SocketAddress socketAddress = receiveChannel.receive(receiveBuffer);\n            receiveBuffer.flip();\n            System.out.println(socketAddress.toString());\n            System.out.println(Charset.forName(\"UTF-8\").decode(receiveBuffer));\n        }\n    }\n\n    //è¿æ¥ read å’Œ write\n    @Test\n    public void testConnect() throws Exception {\n        //æ‰“å¼€DatagramChannel\n        DatagramChannel connChannel = DatagramChannel.open();\n        //ç»‘å®š\n        connChannel.bind(new InetSocketAddress(9999));\n        //è¿æ¥\n        connChannel.connect(new InetSocketAddress(\"127.0.0.1\",9999));\n        //writeæ–¹æ³•\n        connChannel.write(ByteBuffer.wrap(\"å‘é€Jzj\".getBytes(StandardCharsets.UTF_8)));\n        //buffer\n        ByteBuffer readBuffer = ByteBuffer.allocate(1024);\n        while (true){\n            readBuffer.clear();\n            connChannel.read(readBuffer);\n            readBuffer.flip();\n            System.out.println(Charset.forName(\"UTF-8\").decode(readBuffer));\n        }\n    }\n}\n```\n', '2022-09-30 16:30:45', '2022-10-08 16:26:27', '<ol>\n<li>SocketChannel å°±æ˜¯ NIO å¯¹äºéé˜»å¡ socket æ“ä½œçš„æ”¯æŒçš„ç»„ä»¶ï¼Œå…¶åœ¨ socket ä¸Š å°è£…äº†ä¸€å±‚ï¼Œä¸»è¦æ˜¯æ”¯æŒäº†éé˜»å¡çš„è¯»å†™ã€‚åŒæ—¶æ”¹è¿›äº†ä¼ ç»Ÿçš„å•å‘æµ API,ï¼ŒChannel åŒæ—¶æ”¯æŒè¯»å†™ã€‚</li>\n<li>socket é€šé“ç±»ä¸»è¦åˆ†ä¸º DatagramChannelã€SocketChannel å’Œ ServerSocketChannelï¼Œå®ƒä»¬åœ¨è¢«å®ä¾‹åŒ–æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹ç­‰ socket å¯¹è±¡ã€‚è¦æŠŠä¸€ä¸ª socket é€šé“ç½®äºéé˜»å¡æ¨¡å¼ï¼Œæˆ‘ä»¬è¦ä¾é æ‰€æœ‰ socket é€šé“ç±»çš„å…¬æœ‰è¶…çº§ç±»ï¼š SelectableChannelã€‚å°±ç»ªé€‰æ‹©ï¼ˆreadiness selectionï¼‰æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥æŸ¥è¯¢é€šé“çš„ æœºåˆ¶ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥åˆ¤æ–­é€šé“æ˜¯å¦å‡†å¤‡å¥½æ‰§è¡Œä¸€ä¸ªç›®æ ‡æ“ä½œï¼Œå¦‚è¯»æˆ–å†™ã€‚éé˜»å¡ I/O å’Œ å¯é€‰æ‹©æ€§æ˜¯ç´§å¯†ç›¸è¿çš„ï¼Œé‚£ä¹Ÿæ­£æ˜¯ç®¡ç†é˜»å¡æ¨¡å¼çš„ API ä»£ç è¦åœ¨ SelectableChannel è¶…çº§ç±»ä¸­å®šä¹‰çš„åŸå› ã€‚</li>\n<li>è®¾ç½®æˆ–é‡æ–°è®¾ç½®ä¸€ä¸ªé€šé“çš„é˜»å¡æ¨¡å¼æ˜¯å¾ˆç®€å•çš„ï¼Œåªè¦è°ƒç”¨ configureBlocking( )æ–¹æ³•å³å¯ï¼Œä¼ é€’å‚æ•°å€¼ä¸º true åˆ™è®¾ä¸ºé˜»å¡æ¨¡å¼ï¼Œå‚æ•°å€¼ä¸º false å€¼è®¾ä¸ºéé˜»å¡æ¨¡å¼ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ isBlocking( )æ–¹æ³•æ¥åˆ¤æ–­æŸä¸ª socket é€šé“å½“å‰å¤„äº å“ªç§æ¨¡å¼ã€‚</li>\n</ol>\n<p>AbstractSelectableChannel.java ä¸­å®ç°çš„ configureBlocking()æ–¹æ³•å¦‚ä¸‹ï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/13ce8ae8652a4cafa8312081c19f7adc.png\" alt=\"image.png\" /></p>\n</div>\n<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»è¿™ 3 ä¸ªé€šé“</p>\n<h3><a id=\"1_ServerSocketChannel_14\"></a>1 ServerSocketChannel</h3>\n<p>ServerSocketChannel æ˜¯ä¸€ä¸ªåŸºäºé€šé“çš„ socket ç›‘å¬å™¨ã€‚å®ƒåŒæˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ java.net.ServerSocket æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œä¸è¿‡å®ƒå¢åŠ äº†é€šé“è¯­ä¹‰ï¼Œå› æ­¤èƒ½å¤Ÿåœ¨éé˜»å¡ æ¨¡å¼ä¸‹è¿è¡Œã€‚</p>\n<p>ç”±äº ServerSocketChannel æ²¡æœ‰ bind()æ–¹æ³•ï¼Œå› æ­¤æœ‰å¿…è¦å–å‡ºå¯¹ç­‰çš„ socket å¹¶ä½¿ç”¨ å®ƒæ¥ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ä»¥å¼€å§‹ç›‘å¬è¿æ¥ã€‚æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨å¯¹ç­‰ ServerSocket çš„ API æ¥æ ¹ æ®éœ€è¦è®¾ç½®å…¶ä»–çš„ socket é€‰é¡¹ã€‚</p>\n<p>åŒ java.net.ServerSocket ä¸€æ ·ï¼ŒServerSocketChannel ä¹Ÿæœ‰ accept( )æ–¹æ³•ã€‚ ServerSocketChannel çš„ accept()æ–¹æ³•ä¼šè¿”å› SocketChannel ç±»å‹å¯¹è±¡ï¼Œ SocketChannel å¯ä»¥åœ¨éé˜»å¡æ¨¡å¼ä¸‹è¿è¡Œã€‚</p>\n<p>ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªéé˜»å¡çš„ accept( )æ–¹æ³•ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ServerSocketChannelDemo</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//ç«¯å£å·</span>\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">port</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">9999</span>;\n        <span class=\"hljs-comment\">//buffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.wrap(<span class=\"hljs-string\">&quot;hello word&quot;</span>.getBytes(StandardCharsets.UTF_8));\n\n        <span class=\"hljs-comment\">//ServerSocketChannel</span>\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">ssc</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        <span class=\"hljs-comment\">//ç»‘å®š</span>\n        ssc.socket().bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(port));\n        <span class=\"hljs-comment\">//è®¾ç½®éé˜»å¡æ¨¡å¼</span>\n        ssc.configureBlocking(<span class=\"hljs-literal\">false</span>);\n\n        <span class=\"hljs-comment\">//ç›‘å¬æ˜¯å¦æœ‰æ–°é“¾æ¥ä¼ å…¥</span>\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>){\n            System.out.println(<span class=\"hljs-string\">&quot;Waiting for connections&quot;</span>);\n            <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">sc</span> <span class=\"hljs-operator\">=</span> ssc.accept();\n            <span class=\"hljs-keyword\">if</span>(sc == <span class=\"hljs-literal\">null</span>){\n                <span class=\"hljs-comment\">//æ²¡æœ‰é“¾æ¥ä¼ å…¥</span>\n                System.out.println(<span class=\"hljs-string\">&quot;null&quot;</span>);\n                Thread.sleep(<span class=\"hljs-number\">2000</span>);\n            }<span class=\"hljs-keyword\">else</span> {\n                System.out.println(<span class=\"hljs-string\">&quot;Incoming connection from:&quot;</span>+sc.socket().getRemoteSocketAddress());\n                buffer.rewind(); <span class=\"hljs-comment\">//æŒ‡é’ˆ0</span>\n                sc.write(buffer);\n                sc.close();\n            }\n        }\n    }\n}\n</code></div></pre>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/57a63832c66f45c5bbff395c36d92be7.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>æ‰“å¼€ ServerSocketChannel<br />\né€šè¿‡è°ƒç”¨ ServerSocketChannel.open() æ–¹æ³•æ¥æ‰“å¼€ ServerSocketChannel.</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">serverSocketChannel</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n</code></div></pre>\n<ul>\n<li>å…³é—­ ServerSocketChannel<br />\né€šè¿‡è°ƒç”¨ ServerSocketChannel.close() æ–¹æ³•æ¥å…³é—­ ServerSocketChannel.</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\">serverSocketChannel.close();\n</code></div></pre>\n<ul>\n<li>ç›‘å¬æ–°çš„è¿æ¥<br />\né€šè¿‡ ServerSocketChannel.accept() æ–¹æ³•ç›‘å¬æ–°è¿›çš„è¿æ¥ã€‚å½“ accept()æ–¹æ³•è¿”å›æ—¶ å€™,å®ƒè¿”å›ä¸€ä¸ªåŒ…å«æ–°è¿›æ¥çš„è¿æ¥çš„ SocketChannelã€‚å› æ­¤, accept()æ–¹æ³•ä¼šä¸€ç›´é˜»å¡ åˆ°æœ‰æ–°è¿æ¥åˆ°è¾¾ã€‚<br />\né€šå¸¸ä¸ä¼šä»…ä»…åªç›‘å¬ä¸€ä¸ªè¿æ¥,åœ¨ while å¾ªç¯ä¸­è°ƒç”¨ accept()æ–¹æ³•. å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/3e5b7a01f90e49efa8f1f6ad814858cd.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>é˜»å¡æ¨¡å¼<br />\nä¼šåœ¨ SocketChannel sc = ssc.accept();è¿™é‡Œé˜»å¡ä½è¿›ç¨‹ã€‚</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/3b10263a28184fa199557f6f2aeaa674.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>éé˜»å¡æ¨¡å¼<br />\nServerSocketChannel å¯ä»¥è®¾ç½®æˆéé˜»å¡æ¨¡å¼ã€‚åœ¨éé˜»å¡æ¨¡å¼ä¸‹ï¼Œaccept() æ–¹æ³•ä¼šç«‹ åˆ»è¿”å›ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ–°è¿›æ¥çš„è¿æ¥,è¿”å›çš„å°†æ˜¯ nullã€‚ å› æ­¤ï¼Œéœ€è¦æ£€æŸ¥è¿”å›çš„ SocketChannel æ˜¯å¦æ˜¯ null.å¦‚ï¼š</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/07e22f9e39af427b817c698bdc089c43.png\" alt=\"image.png\" /></p>\n</div>\n<h3><a id=\"2_SocketChannel_100\"></a>2 SocketChannel</h3>\n<h4><a id=\"21_SocketChannel__101\"></a>2.1 SocketChannel ä»‹ç»</h4>\n<p>Java NIO ä¸­çš„ SocketChannel æ˜¯ä¸€ä¸ªè¿æ¥åˆ° TCP ç½‘ç»œå¥—æ¥å­—çš„é€šé“ã€‚</p>\n<blockquote>\n<p>A selectable channel for stream-oriented connecting sockets.</p>\n</blockquote>\n<p>ä»¥ä¸Šæ˜¯ Java docs ä¸­å¯¹äº SocketChannel çš„æè¿°ï¼šSocketChannel æ˜¯ä¸€ç§é¢å‘æµè¿æ¥ sockets å¥—æ¥å­—çš„å¯é€‰æ‹©é€šé“ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼š</p>\n<ul>\n<li>SocketChannel æ˜¯ç”¨æ¥è¿æ¥ Socket å¥—æ¥å­—</li>\n<li>SocketChannel ä¸»è¦ç”¨é€”ç”¨æ¥å¤„ç†ç½‘ç»œ I/O çš„é€šé“</li>\n<li>SocketChannel æ˜¯åŸºäº TCP è¿æ¥ä¼ è¾“</li>\n<li>SocketChannel å®ç°äº†å¯é€‰æ‹©é€šé“ï¼Œå¯ä»¥è¢«å¤šè·¯å¤ç”¨çš„</li>\n</ul>\n<h4><a id=\"22_SocketChannel__111\"></a>2.2 SocketChannel ç‰¹å¾</h4>\n<ul>\n<li>å¯¹äºå·²ç»å­˜åœ¨çš„ socket ä¸èƒ½åˆ›å»º SocketChannel</li>\n<li>SocketChannel ä¸­æä¾›çš„ open æ¥å£åˆ›å»ºçš„ Channel å¹¶æ²¡æœ‰è¿›è¡Œç½‘ç»œçº§è”ï¼Œéœ€è¦ä½¿ ç”¨ connect æ¥å£è¿æ¥åˆ°æŒ‡å®šåœ°å€</li>\n<li>æœªè¿›è¡Œè¿æ¥çš„ SocketChannle æ‰§è¡Œ I/O æ“ä½œæ—¶ï¼Œä¼šæŠ›å‡º NotYetConnectedException</li>\n<li>SocketChannel æ”¯æŒä¸¤ç§ I/O æ¨¡å¼ï¼šé˜»å¡å¼å’Œéé˜»å¡å¼</li>\n<li>SocketChannel æ”¯æŒå¼‚æ­¥å…³é—­ã€‚å¦‚æœ SocketChannel åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Š read é˜»å¡ï¼Œå¦ ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥ SocketChannel è°ƒç”¨ shutdownInputï¼Œåˆ™è¯»é˜»å¡çš„çº¿ç¨‹å°†è¿”å›-1 è¡¨ç¤ºæ²¡æœ‰ è¯»å–ä»»ä½•æ•°æ®ï¼›å¦‚æœ SocketChannel åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Š write é˜»å¡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥ SocketChannel è°ƒç”¨ shutdownWriteï¼Œåˆ™å†™é˜»å¡çš„çº¿ç¨‹å°†æŠ›å‡º AsynchronousCloseException</li>\n<li>SocketChannel æ”¯æŒè®¾å®šå‚æ•° SO_SNDBUF å¥—æ¥å­—å‘é€ç¼“å†²åŒºå¤§å°, SO_RCVBUF å¥—æ¥å­—æ¥æ”¶ç¼“å†²åŒºå¤§å°, SO_KEEPALIVE ä¿æ´»è¿æ¥ O_REUSEADDR å¤ç”¨åœ°å€, SO_LINGER æœ‰æ•°æ®ä¼ è¾“æ—¶å»¶ç¼“å…³é—­ Channel (åªæœ‰åœ¨éé˜»å¡æ¨¡å¼ä¸‹æœ‰ç”¨), TCP_NODELAY ç¦ç”¨ Nagle ç®—æ³•</li>\n</ul>\n<h4><a id=\"23_SocketChannel__119\"></a>2.3 SocketChannel çš„ä½¿ç”¨</h4>\n<ul>\n<li>åˆ›å»º SocketChannel</li>\n</ul>\n<p>ç¬¬ä¸€ç§ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;www.baidu.com&quot;</span>, <span class=\"hljs-number\">80</span>));\n</code></div></pre>\n<p>ç¬¬äºŒç§ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChanne2</span> <span class=\"hljs-operator\">=</span> SocketChannel.open(); \nsocketChanne2.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;www.baidu.com&quot;</span>, <span class=\"hljs-number\">80</span>));\n</code></div></pre>\n<p>ç›´æ¥ä½¿ç”¨æœ‰å‚ open api æˆ–è€…ä½¿ç”¨æ— å‚ open apiï¼Œä½†æ˜¯åœ¨æ— å‚ open åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ª SocketChannel å¯¹è±¡ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå®è´¨çš„ tcp è¿æ¥ã€‚</p>\n<ul>\n<li>è¿æ¥æ ¡éªŒ</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\">socketChannel.isOpen(); <span class=\"hljs-comment\">// æµ‹è¯• SocketChannel æ˜¯å¦ä¸º open çŠ¶æ€ </span>\nsocketChannel.isConnected(); <span class=\"hljs-comment\">//æµ‹è¯• SocketChannel æ˜¯å¦å·²ç»è¢«è¿æ¥ </span>\nsocketChannel.isConnectionPending(); <span class=\"hljs-comment\">//æµ‹è¯• SocketChannel æ˜¯å¦æ­£åœ¨è¿›è¡Œ è¿æ¥</span>\nsocketChannel.finishConnect(); <span class=\"hljs-comment\">//æ ¡éªŒæ­£åœ¨è¿›è¡Œå¥—æ¥å­—è¿æ¥çš„ SocketChannel æ˜¯å¦å·²ç»å®Œæˆè¿æ¥</span>\n</code></div></pre>\n<ul>\n<li>è¯»å†™æ¨¡å¼<br />\nå‰é¢æåˆ° SocketChannel æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ï¼š</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\">socketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n</code></div></pre>\n<p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•è®¾ç½® SocketChannel çš„è¯»å†™æ¨¡å¼ã€‚false è¡¨ç¤ºéé˜»å¡ï¼Œtrue è¡¨ç¤ºé˜»å¡ã€‚</p>\n<ul>\n<li>è¯»å†™</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open( <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;www.baidu.com&quot;</span>, <span class=\"hljs-number\">80</span>)); \n<span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>); \nsocketChannel.read(byteBuffer); socketChannel.close(); \nSystem.out.println(<span class=\"hljs-string\">&quot;read over&quot;</span>);\n</code></div></pre>\n<p>ä»¥ä¸Šä¸ºé˜»å¡å¼è¯»ï¼Œå½“æ‰§è¡Œåˆ° read å‡ºï¼Œçº¿ç¨‹å°†é˜»å¡ï¼Œæ§åˆ¶å°å°†æ— æ³•æ‰“å° read over</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open( <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;www.baidu.com&quot;</span>, <span class=\"hljs-number\">80</span>)); \nsocketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>); <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">16</span>); \nsocketChannel.read(byteBuffer); socketChannel.close();\nSystem.out.println(<span class=\"hljs-string\">&quot;read over&quot;</span>);\n</code></div></pre>\n<p>ä»¥ä¸Šä¸ºéé˜»å¡è¯»ï¼Œæ§åˆ¶å°å°†æ‰“å° read over<br />\nè¯»å†™éƒ½æ˜¯é¢å‘ç¼“å†²åŒºï¼Œè¿™ä¸ªè¯»å†™æ–¹å¼ä¸å‰æ–‡ä¸­çš„ FileChannel ç›¸åŒã€‚</p>\n<ul>\n<li>è®¾ç½®å’Œè·å–å‚æ•°</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\">socketChannel.setOption(StandardSocketOptions.SO_KEEPALIVE, Boolean.TRUE)\n.setOption(StandardSocketOptions.TCP_NODELAY, Boolean.TRUE);\n</code></div></pre>\n<p>é€šè¿‡ setOptions æ–¹æ³•å¯ä»¥è®¾ç½® socket å¥—æ¥å­—çš„ç›¸å…³å‚æ•°</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">socketChannel.getOption(StandardSocketOptions.SO_KEEPALIVE); \nsocketChannel.getOption(StandardSocketOptions.SO_RCVBUF);\n</code></div></pre>\n<p>å¯ä»¥é€šè¿‡ getOption è·å–ç›¸å…³å‚æ•°çš„å€¼ã€‚å¦‚é»˜è®¤çš„æ¥æ”¶ç¼“å†²åŒºå¤§å°æ˜¯ 8192byteã€‚<br />\nSocketChannel è¿˜æ”¯æŒå¤šè·¯å¤ç”¨ï¼Œä½†æ˜¯å¤šè·¯å¤ç”¨åœ¨åç»­å†…å®¹ä¸­ä¼šä»‹ç»åˆ°ã€‚</p>\n<h3><a id=\"3_DatagramChannel_175\"></a>3 DatagramChannel</h3>\n<p>æ­£å¦‚ SocketChannel å¯¹åº” Socketï¼ŒServerSocketChannel å¯¹åº” ServerSocketï¼Œæ¯ ä¸€ä¸ª DatagramChannel å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªå…³è”çš„ DatagramSocket å¯¹è±¡ã€‚æ­£å¦‚ SocketChannel æ¨¡æ‹Ÿè¿æ¥å¯¼å‘çš„æµåè®®ï¼ˆå¦‚ TCP/IPï¼‰ï¼ŒDatagramChannel åˆ™æ¨¡æ‹ŸåŒ… å¯¼å‘çš„æ— è¿æ¥åè®®ï¼ˆå¦‚ UDP/IPï¼‰ã€‚DatagramChannel æ˜¯æ— è¿æ¥çš„ï¼Œæ¯ä¸ªæ•°æ®æŠ¥ ï¼ˆdatagramï¼‰éƒ½æ˜¯ä¸€ä¸ªè‡ªåŒ…å«çš„å®ä½“ï¼Œæ‹¥æœ‰å®ƒè‡ªå·±çš„ç›®çš„åœ°å€åŠä¸ä¾èµ–å…¶ä»–æ•°æ®æŠ¥çš„ æ•°æ®è´Ÿè½½ã€‚ä¸é¢å‘æµçš„çš„ socket ä¸åŒï¼ŒDatagramChannel å¯ä»¥å‘é€å•ç‹¬çš„æ•°æ®æŠ¥ç»™ ä¸åŒçš„ç›®çš„åœ°å€ã€‚åŒæ ·ï¼ŒDatagramChannel å¯¹è±¡ä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªä»»æ„åœ°å€çš„æ•°æ®åŒ…ã€‚ æ¯ä¸ªåˆ°è¾¾çš„æ•°æ®æŠ¥éƒ½å«æœ‰å…³äºå®ƒæ¥è‡ªä½•å¤„çš„ä¿¡æ¯ï¼ˆæºåœ°å€ï¼‰ã€‚</p>\n<h4><a id=\"31__DatagramChannel_178\"></a>3.1 æ‰“å¼€ DatagramChannel</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DatagramChannel</span> <span class=\"hljs-variable\">server</span> <span class=\"hljs-operator\">=</span> DatagramChannel.open(); \nserver.socket().bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">10086</span>));\n</code></div></pre>\n<p>æ­¤ä¾‹å­æ˜¯æ‰“å¼€ 10086 ç«¯å£æ¥æ”¶ UDP æ•°æ®åŒ…</p>\n<h4><a id=\"32__185\"></a>3.2 æ¥æ”¶æ•°æ®</h4>\n<p>é€šè¿‡ receive()æ¥æ”¶ UDP åŒ…</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">receiveBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">64</span>); \nreceiveBuffer.clear(); \n<span class=\"hljs-type\">SocketAddress</span> <span class=\"hljs-variable\">receiveAddr</span> <span class=\"hljs-operator\">=</span> server.receive(receiveBuffer);\n</code></div></pre>\n<p>SocketAddress å¯ä»¥è·å¾—å‘åŒ…çš„ ipã€ç«¯å£ç­‰ä¿¡æ¯ï¼Œç”¨ toString æŸ¥çœ‹</p>\n<h4><a id=\"33__194\"></a>3.3 å‘é€æ•°æ®</h4>\n<p>é€šè¿‡ send()å‘é€ UDP åŒ…</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">DatagramChannel</span> <span class=\"hljs-variable\">server</span> <span class=\"hljs-operator\">=</span> DatagramChannel.open(); \n<span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">sendBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.wrap(<span class=\"hljs-string\">&quot;client send&quot;</span>.getBytes()); \nserver.send(sendBuffer, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>,<span class=\"hljs-number\">10086</span>));\n</code></div></pre>\n<h4><a id=\"34__202\"></a>3.4 è¿æ¥</h4>\n<p>UDP ä¸å­˜åœ¨çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥ï¼Œè¿™é‡Œçš„è¿æ¥æ˜¯å‘ç‰¹å®šæœåŠ¡åœ°å€ç”¨ read å’Œ write æ¥æ”¶ å‘é€æ•°æ®åŒ…ã€‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">client.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>,<span class=\"hljs-number\">10086</span>)); \n<span class=\"hljs-type\">int</span> readSize= client.read(sendBuffer); \nserver.write(sendBuffer);\n</code></div></pre>\n<p>read()å’Œ write()åªæœ‰åœ¨ connect()åæ‰èƒ½ä½¿ç”¨ï¼Œä¸ç„¶ä¼šæŠ› NotYetConnectedException å¼‚å¸¸ã€‚ç”¨ read()æ¥æ”¶æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°åŒ…ï¼Œä¼šæŠ› PortUnreachableException å¼‚å¸¸ã€‚</p>\n<h4><a id=\"34_DatagramChannel__211\"></a>3.4 DatagramChannel ç¤ºä¾‹</h4>\n<p>å®¢æˆ·ç«¯å‘é€ï¼ŒæœåŠ¡ç«¯æ¥æ”¶çš„ä¾‹å­</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">DatagramChannelDemo</span> {\n\n    <span class=\"hljs-comment\">//å‘é€å®ç°</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">sendDatagram</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//æ‰“å¼€DatagramChannel</span>\n        <span class=\"hljs-type\">DatagramChannel</span> <span class=\"hljs-variable\">sendChannel</span> <span class=\"hljs-operator\">=</span> DatagramChannel.open();\n        <span class=\"hljs-type\">InetSocketAddress</span> <span class=\"hljs-variable\">sendAddress</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>, <span class=\"hljs-number\">9999</span>);\n\n        <span class=\"hljs-comment\">//å‘é€</span>\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>){\n            <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.wrap(<span class=\"hljs-string\">&quot;å‘é€Jzj&quot;</span>.getBytes(StandardCharsets.UTF_8));\n            sendChannel.send(buffer,sendAddress);\n            System.out.println(<span class=\"hljs-string\">&quot;å·²ç»å®Œæˆå‘é€&quot;</span>);\n            Thread.sleep(<span class=\"hljs-number\">1000</span>);\n        }\n    }\n\n\n    <span class=\"hljs-comment\">//æ¥æ”¶å®ç°</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">receiveDatagram</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//æ‰“å¼€DatagramChannel</span>\n        <span class=\"hljs-type\">DatagramChannel</span> <span class=\"hljs-variable\">receiveChannel</span> <span class=\"hljs-operator\">=</span> DatagramChannel.open();\n        <span class=\"hljs-type\">InetSocketAddress</span> <span class=\"hljs-variable\">receiveAddress</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">9999</span>);\n        <span class=\"hljs-comment\">//ç»‘å®š</span>\n        receiveChannel.bind(receiveAddress);\n        <span class=\"hljs-comment\">//Buffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">receiveBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>){\n            receiveBuffer.clear();\n            <span class=\"hljs-type\">SocketAddress</span> <span class=\"hljs-variable\">socketAddress</span> <span class=\"hljs-operator\">=</span> receiveChannel.receive(receiveBuffer);\n            receiveBuffer.flip();\n            System.out.println(socketAddress.toString());\n            System.out.println(Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).decode(receiveBuffer));\n        }\n    }\n\n    <span class=\"hljs-comment\">//è¿æ¥ read å’Œ write</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">testConnect</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//æ‰“å¼€DatagramChannel</span>\n        <span class=\"hljs-type\">DatagramChannel</span> <span class=\"hljs-variable\">connChannel</span> <span class=\"hljs-operator\">=</span> DatagramChannel.open();\n        <span class=\"hljs-comment\">//ç»‘å®š</span>\n        connChannel.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">9999</span>));\n        <span class=\"hljs-comment\">//è¿æ¥</span>\n        connChannel.connect(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>,<span class=\"hljs-number\">9999</span>));\n        <span class=\"hljs-comment\">//writeæ–¹æ³•</span>\n        connChannel.write(ByteBuffer.wrap(<span class=\"hljs-string\">&quot;å‘é€Jzj&quot;</span>.getBytes(StandardCharsets.UTF_8)));\n        <span class=\"hljs-comment\">//buffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">readBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>){\n            readBuffer.clear();\n            connChannel.read(readBuffer);\n            readBuffer.flip();\n            System.out.println(Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>).decode(readBuffer));\n        }\n    }\n}\n</code></div></pre>\n');
INSERT INTO `article_content` VALUES ('68c89984823c939509f7601517b358ad', '### 1 Selector ç®€ä»‹\n#### 1.1 Selector å’Œ Channel å…³ç³»\nSelector ä¸€èˆ¬ç§° ä¸ºé€‰æ‹©å™¨ ï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸º å¤šè·¯å¤ç”¨å™¨ ã€‚å®ƒæ˜¯ Java NIO æ ¸å¿ƒç»„ä»¶ä¸­ çš„ä¸€ä¸ªï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ª NIO Channelï¼ˆé€šé“ï¼‰çš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚å¦‚ æ­¤å¯ä»¥å®ç°å•çº¿ç¨‹ç®¡ç†å¤šä¸ª channels,ä¹Ÿå°±æ˜¯å¯ä»¥ç®¡ç†å¤šä¸ªç½‘ç»œé“¾æ¥ã€‚\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/7ae9446e0bca4a518b305073e07475d0.png)\n\n:::\n\nä½¿ç”¨ Selector çš„å¥½å¤„åœ¨äºï¼š ä½¿ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥å°±å¯ä»¥æ¥å¤„ç†é€šé“äº†ï¼Œ ç›¸æ¯”ä½¿ç”¨å¤šä¸ª çº¿ç¨‹ï¼Œé¿å…äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ã€‚\n\n#### 1.2 å¯é€‰æ‹©é€šé“(SelectableChannel)\nï¼ˆ1ï¼‰ä¸æ˜¯æ‰€æœ‰çš„ Channel éƒ½å¯ä»¥è¢« Selector å¤ç”¨çš„ã€‚æ¯”æ–¹è¯´ï¼ŒFileChannel å°±ä¸èƒ½ è¢«é€‰æ‹©å™¨å¤ç”¨ã€‚åˆ¤æ–­ä¸€ä¸ª Channel èƒ½è¢« Selector å¤ç”¨ï¼Œæœ‰ä¸€ä¸ªå‰æï¼šåˆ¤æ–­ä»–æ˜¯å¦ç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡ç±» SelectableChannelã€‚å¦‚æœç»§æ‰¿äº† SelectableChannelï¼Œåˆ™å¯ä»¥è¢«å¤ ç”¨ï¼Œå¦åˆ™ä¸èƒ½ã€‚\n\nï¼ˆ2ï¼‰SelectableChannel ç±»æä¾›äº†å®ç°é€šé“çš„å¯é€‰æ‹©æ€§æ‰€éœ€è¦çš„å…¬å…±æ–¹æ³•ã€‚å®ƒæ˜¯æ‰€æœ‰ æ”¯æŒå°±ç»ªæ£€æŸ¥çš„é€šé“ç±»çš„çˆ¶ç±»ã€‚æ‰€æœ‰ socket é€šé“ï¼Œéƒ½ç»§æ‰¿äº† SelectableChannel ç±» éƒ½æ˜¯å¯é€‰æ‹©çš„ï¼ŒåŒ…æ‹¬ä»ç®¡é“(Pipe)å¯¹è±¡çš„ä¸­è·å¾—çš„é€šé“ã€‚è€Œ FileChannel ç±»ï¼Œæ²¡æœ‰ç»§ æ‰¿ SelectableChannelï¼Œå› æ­¤æ˜¯ä¸æ˜¯å¯é€‰é€šé“ã€‚\n\nï¼ˆ3ï¼‰ä¸€ä¸ªé€šé“å¯ä»¥è¢«æ³¨å†Œåˆ°å¤šä¸ªé€‰æ‹©å™¨ä¸Šï¼Œä½†å¯¹æ¯ä¸ªé€‰æ‹©å™¨è€Œè¨€åªèƒ½è¢«æ³¨å†Œä¸€æ¬¡ã€‚é€š é“å’Œé€‰æ‹©å™¨ä¹‹é—´çš„å…³ç³»ï¼Œä½¿ç”¨æ³¨å†Œçš„æ–¹å¼å®Œæˆã€‚SelectableChannel å¯ä»¥è¢«æ³¨å†Œåˆ° Selector å¯¹è±¡ä¸Šï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šé€šé“çš„å“ªäº›æ“ä½œï¼Œæ˜¯ Selector æ„Ÿå…´è¶£çš„ã€‚\n\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/4f68bfeb91434f1eb900f948f52e0dae.png)\n\n:::\n\n#### 1.3 Channel æ³¨å†Œåˆ° Selector\nï¼ˆ1ï¼‰ä½¿ç”¨ Channel.registerï¼ˆSelector selï¼Œint opsï¼‰æ–¹æ³•ï¼Œå°†ä¸€ä¸ªé€šé“æ³¨å†Œåˆ°ä¸€ä¸ª é€‰æ‹©å™¨æ—¶ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šé€šé“è¦æ³¨å†Œçš„é€‰æ‹©å™¨ã€‚ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šé€‰æ‹©å™¨éœ€è¦æŸ¥è¯¢ çš„é€šé“æ“ä½œã€‚ \nï¼ˆ2ï¼‰å¯ä»¥ä¾›é€‰æ‹©å™¨æŸ¥è¯¢çš„é€šé“æ“ä½œï¼Œä»ç±»å‹æ¥åˆ†ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å››ç§ï¼š\n- å¯è¯» : SelectionKey.OP_READ\n- å¯å†™ : SelectionKey.OP_WRITE\n- è¿æ¥ : SelectionKey.OP_CONNECT\n- æ¥æ”¶ : SelectionKey.OP_ACCEPT\n\nå¦‚æœ Selector å¯¹é€šé“çš„å¤šæ“ä½œç±»å‹æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç”¨â€œä½æˆ–â€æ“ä½œç¬¦æ¥å®ç°ï¼š æ¯”å¦‚ï¼šint key = SelectionKey.OP_READ | SelectionKey.OP_WRITE ;\n\nï¼ˆ3ï¼‰é€‰æ‹©å™¨æŸ¥è¯¢çš„ä¸æ˜¯é€šé“çš„æ“ä½œï¼Œè€Œæ˜¯é€šé“çš„æŸä¸ªæ“ä½œçš„ä¸€ç§å°±ç»ªçŠ¶æ€ã€‚ä»€ä¹ˆæ˜¯æ“ ä½œçš„å°±ç»ªçŠ¶æ€ï¼Ÿä¸€æ—¦é€šé“å…·å¤‡å®ŒæˆæŸä¸ªæ“ä½œçš„æ¡ä»¶ï¼Œè¡¨ç¤ºè¯¥é€šé“çš„æŸä¸ªæ“ä½œå·²ç»å°±ç»ªï¼Œ å°±å¯ä»¥è¢« Selector æŸ¥è¯¢åˆ°ï¼Œç¨‹åºå¯ä»¥å¯¹é€šé“è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚æ¯”æ–¹è¯´ï¼ŒæŸä¸ª SocketChannel é€šé“å¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œåˆ™å¤„äºâ€œè¿æ¥å°±ç»ªâ€(OP_CONNECT)ã€‚ å†æ¯”æ–¹è¯´ï¼Œä¸€ä¸ª ServerSocketChannel æœåŠ¡å™¨é€šé“å‡†å¤‡å¥½æ¥æ”¶æ–°è¿›å…¥çš„è¿æ¥ï¼Œåˆ™å¤„äº â€œæ¥æ”¶å°±ç»ªâ€ï¼ˆOP_ACCEPTï¼‰çŠ¶æ€ã€‚è¿˜æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæœ‰æ•°æ®å¯è¯»çš„é€šé“ï¼Œå¯ä»¥è¯´æ˜¯ â€œè¯»å°±ç»ªâ€(OP_READ)ã€‚ä¸€ä¸ªç­‰å¾…å†™æ•°æ®çš„é€šé“å¯ä»¥è¯´æ˜¯â€œå†™å°±ç»ªâ€(OP_WRITE)ã€‚\n\n#### 1.4 é€‰æ‹©é”®(SelectionKey)\nï¼ˆ1ï¼‰Channel æ³¨å†Œåˆ°åï¼Œå¹¶ä¸”ä¸€æ—¦é€šé“å¤„äºæŸç§å°±ç»ªçš„çŠ¶æ€ï¼Œå°±å¯ä»¥è¢«é€‰æ‹©å™¨æŸ¥è¯¢åˆ°ã€‚ è¿™ä¸ªå·¥ä½œï¼Œä½¿ç”¨é€‰æ‹©å™¨ Selector çš„ selectï¼ˆï¼‰æ–¹æ³•å®Œæˆã€‚select æ–¹æ³•çš„ä½œç”¨ï¼Œå¯¹æ„Ÿå…´ è¶£çš„é€šé“æ“ä½œï¼Œè¿›è¡Œå°±ç»ªçŠ¶æ€çš„æŸ¥è¯¢ã€‚\n\nï¼ˆ2ï¼‰Selector å¯ä»¥ä¸æ–­çš„æŸ¥è¯¢ Channel ä¸­å‘ç”Ÿçš„æ“ä½œçš„å°±ç»ªçŠ¶æ€ã€‚å¹¶ä¸”æŒ‘é€‰æ„Ÿå…´è¶£ çš„æ“ä½œå°±ç»ªçŠ¶æ€ã€‚ä¸€æ—¦é€šé“æœ‰æ“ä½œçš„å°±ç»ªçŠ¶æ€è¾¾æˆï¼Œå¹¶ä¸”æ˜¯ Selector æ„Ÿå…´è¶£çš„æ“ä½œï¼Œ å°±ä¼šè¢« Selector é€‰ä¸­ï¼Œæ”¾å…¥é€‰æ‹©é”®é›†åˆä¸­ã€‚\n\nï¼ˆ3ï¼‰ä¸€ä¸ªé€‰æ‹©é”®ï¼Œé¦–å…ˆæ˜¯åŒ…å«äº†æ³¨å†Œåœ¨ Selector çš„é€šé“æ“ä½œçš„ç±»å‹ï¼Œæ¯”æ–¹è¯´ SelectionKey.OP_READã€‚ä¹ŸåŒ…å«äº†ç‰¹å®šçš„é€šé“ä¸ç‰¹å®šçš„é€‰æ‹©å™¨ä¹‹é—´çš„æ³¨å†Œå…³ç³»ã€‚\n\nå¼€å‘åº”ç”¨ç¨‹åºæ˜¯ï¼Œé€‰æ‹©é”®æ˜¯ç¼–ç¨‹çš„å…³é”®ã€‚NIO çš„ç¼–ç¨‹ï¼Œå°±æ˜¯æ ¹æ®å¯¹åº”çš„é€‰æ‹©é”®ï¼Œè¿›è¡Œ ä¸åŒçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚\n\nï¼ˆ4ï¼‰é€‰æ‹©é”®çš„æ¦‚å¿µï¼Œå’Œäº‹ä»¶çš„æ¦‚å¿µæ¯”è¾ƒç›¸ä¼¼ã€‚ä¸€ä¸ªé€‰æ‹©é”®ç±»ä¼¼ç›‘å¬å™¨æ¨¡å¼é‡Œè¾¹çš„ä¸€ä¸ª äº‹ä»¶ã€‚ç”±äº Selector ä¸æ˜¯äº‹ä»¶è§¦å‘çš„æ¨¡å¼ï¼Œè€Œæ˜¯ä¸»åŠ¨å»æŸ¥è¯¢çš„æ¨¡å¼ï¼Œæ‰€ä»¥ä¸å«äº‹ä»¶ Eventï¼Œè€Œæ˜¯å« SelectionKey é€‰æ‹©é”®ã€‚\n\n### 2 Selector çš„ä½¿ç”¨æ–¹æ³•\n\n#### 2.1 Selector çš„åˆ›å»º\né€šè¿‡è°ƒç”¨ Selector.open()æ–¹æ³•åˆ›å»ºä¸€ä¸ª Selector å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š\n```java\n// 1ã€è·å– Selector é€‰æ‹©å™¨ \nSelector selector = Selector.open();\n```\n#### 2.2 æ³¨å†Œ Channel åˆ° Selector\nè¦å®ç° Selector ç®¡ç† Channelï¼Œéœ€è¦å°† channel æ³¨å†Œåˆ°ç›¸åº”çš„ Selector ä¸Š\n```java\n// 1ã€è·å– Selector é€‰æ‹©å™¨ \nSelector selector = Selector.open(); \n// 2ã€è·å–é€šé“ \nServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); \n// 3.è®¾ç½®ä¸ºéé˜»å¡ \nserverSocketChannel.configureBlocking(false); \n// 4ã€ç»‘å®šè¿æ¥ \nserverSocketChannel.bind(new InetSocketAddress(9999)); \n// 5ã€å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,å¹¶åˆ¶å®šç›‘å¬äº‹ä»¶ä¸ºï¼šâ€œæ¥æ”¶â€äº‹ä»¶ \nserverSocketChannel.register(selector,SelectionKey.OP_ACCEPT);\n```\nä¸Šé¢é€šè¿‡è°ƒç”¨é€šé“çš„ register()æ–¹æ³•ä¼šå°†å®ƒæ³¨å†Œåˆ°ä¸€ä¸ªé€‰æ‹©å™¨ä¸Šã€‚ é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼š\n\nï¼ˆ1ï¼‰ä¸ Selector ä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒChannel å¿…é¡»å¤„äºéé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ IllegalBlockingModeExceptionã€‚è¿™æ„å‘³ç€ï¼ŒFileChannel ä¸èƒ½ä¸ Selector ä¸€èµ·ä½¿ç”¨ï¼Œå›  ä¸º FileChannel ä¸èƒ½åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ï¼Œè€Œå¥—æ¥å­—ç›¸å…³çš„æ‰€æœ‰çš„é€šé“éƒ½å¯ä»¥ã€‚ \n\nï¼ˆ2ï¼‰ä¸€ä¸ªé€šé“ï¼Œå¹¶æ²¡æœ‰ä¸€å®šè¦æ”¯æŒæ‰€æœ‰çš„å››ç§æ“ä½œã€‚æ¯”å¦‚æœåŠ¡å™¨é€šé“ ServerSocketChannel æ”¯æŒ Accept æ¥å—æ“ä½œï¼Œè€Œ SocketChannel å®¢æˆ·ç«¯é€šé“åˆ™ä¸æ”¯æŒã€‚ å¯ä»¥é€šè¿‡é€šé“ä¸Šçš„ validOps()æ–¹æ³•ï¼Œæ¥è·å–ç‰¹å®šé€šé“ä¸‹æ‰€æœ‰æ”¯æŒçš„æ“ä½œé›†åˆã€‚\n\n#### 2.3 è½®è¯¢æŸ¥è¯¢å°±ç»ªæ“ä½œ\n\nï¼ˆ1ï¼‰é€šè¿‡ Selector çš„ selectï¼ˆï¼‰æ–¹æ³•ï¼Œå¯ä»¥æŸ¥è¯¢å‡ºå·²ç»å°±ç»ªçš„é€šé“æ“ä½œï¼Œè¿™äº›å°±ç»ªçš„ çŠ¶æ€é›†åˆï¼ŒåŒ…å­˜åœ¨ä¸€ä¸ªå…ƒç´ æ˜¯ SelectionKey å¯¹è±¡çš„ Set é›†åˆä¸­ã€‚\n\nï¼ˆ2ï¼‰ä¸‹é¢æ˜¯ Selector å‡ ä¸ªé‡è½½çš„æŸ¥è¯¢ select()æ–¹æ³•ï¼š\n- select():é˜»å¡åˆ°è‡³å°‘æœ‰ä¸€ä¸ªé€šé“åœ¨ä½ æ³¨å†Œçš„äº‹ä»¶ä¸Šå°±ç»ªäº†ã€‚\n- select(long timeout)ï¼šå’Œ select()ä¸€æ ·ï¼Œä½†æœ€é•¿é˜»å¡äº‹ä»¶ä¸º timeout æ¯«ç§’ã€‚\n- selectNow():éé˜»å¡ï¼Œåªè¦æœ‰é€šé“å°±ç»ªå°±ç«‹åˆ»è¿”å›ã€‚\n\nselect()æ–¹æ³•è¿”å›çš„ int å€¼ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘é€šé“å·²ç»å°±ç»ªï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œæ˜¯è‡ªå‰ä¸€æ¬¡ select æ–¹æ³•ä»¥æ¥åˆ°è¿™ä¸€æ¬¡ select æ–¹æ³•ä¹‹é—´çš„æ—¶é—´æ®µä¸Šï¼Œæœ‰å¤šå°‘é€šé“å˜æˆå°±ç»ªçŠ¶æ€ã€‚\n\nä¾‹å¦‚ï¼šé¦–æ¬¡è°ƒç”¨ select()æ–¹æ³•ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé€šé“å˜æˆå°±ç»ªçŠ¶æ€ï¼Œè¿”å›äº† 1ï¼Œè‹¥å†æ¬¡è°ƒç”¨ select()æ–¹æ³•ï¼Œå¦‚æœå¦ä¸€ä¸ªé€šé“å°±ç»ªäº†ï¼Œå®ƒä¼šå†æ¬¡è¿”å› 1ã€‚å¦‚æœå¯¹ç¬¬ä¸€ä¸ªå°±ç»ªçš„ channel æ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œç°åœ¨å°±æœ‰ä¸¤ä¸ªå°±ç»ªçš„é€šé“ï¼Œä½†åœ¨æ¯æ¬¡ select()æ–¹æ³•è°ƒç”¨ä¹‹é—´ï¼Œ åªæœ‰ä¸€ä¸ªé€šé“å°±ç»ªäº†ã€‚\n\nä¸€æ—¦è°ƒç”¨ select()æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ä¸º 0 æ—¶ï¼Œåœ¨ Selector ä¸­æœ‰ä¸€ä¸ª selectedKeys()æ–¹ æ³•ï¼Œç”¨æ¥è®¿é—®å·²é€‰æ‹©é”®é›†åˆï¼Œè¿­ä»£é›†åˆçš„æ¯ä¸€ä¸ªé€‰æ‹©é”®å…ƒç´ ï¼Œæ ¹æ®å°±ç»ªæ“ä½œçš„ç±»å‹ï¼Œ å®Œæˆå¯¹åº”çš„æ“ä½œï¼š\n```java\nSet selectedKeys = selector.selectedKeys(); \nIterator keyIterator = selectedKeys.iterator();\nwhile (iterator.hasNext()) {\n            SelectionKey key = iterator.next();\n            if (key.isAcceptable()) {\n                // a connection was accepted by a ServerSocketChannel.\n            } else if (key.isConnectable()) {\n                // a connection was established with a remote server.\n            } else if (key.isReadable()) {\n                // a channel is ready for reading\n            } else if (key.isWritable()) {\n                // a channel is ready for writing\n            }\n        }\n```\n#### 2.4 åœæ­¢é€‰æ‹©çš„æ–¹æ³•\né€‰æ‹©å™¨æ‰§è¡Œé€‰æ‹©çš„è¿‡ç¨‹ï¼Œç³»ç»Ÿåº•å±‚ä¼šä¾æ¬¡è¯¢é—®æ¯ä¸ªé€šé“æ˜¯å¦å·²ç»å°±ç»ªï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ ä¼šé€ æˆè°ƒç”¨çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€,é‚£ä¹ˆæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼å¯ä»¥å”¤é†’åœ¨ selectï¼ˆï¼‰æ–¹æ³•ä¸­ é˜»å¡çš„çº¿ç¨‹ã€‚\n\nwakeup()æ–¹æ³• ï¼šé€šè¿‡è°ƒç”¨ Selector å¯¹è±¡çš„ wakeupï¼ˆï¼‰æ–¹æ³•è®©å¤„åœ¨é˜»å¡çŠ¶æ€çš„ select()æ–¹æ³•ç«‹åˆ»è¿”å›è¯¥æ–¹æ³•ä½¿å¾—é€‰æ‹©å™¨ä¸Šçš„ç¬¬ä¸€ä¸ªè¿˜æ²¡æœ‰è¿”å›çš„é€‰æ‹©æ“ä½œç«‹å³è¿”å›ã€‚å¦‚æœå½“å‰æ²¡æœ‰è¿›è¡Œä¸­ çš„é€‰æ‹©æ“ä½œï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å¯¹ select()æ–¹æ³•çš„ä¸€æ¬¡è°ƒç”¨å°†ç«‹å³è¿”å›ã€‚\n\nclose()æ–¹æ³• ï¼šé€šè¿‡ closeï¼ˆï¼‰æ–¹æ³•å…³é—­ Selectorã€‚\n\nè¯¥æ–¹æ³•ä½¿å¾—ä»»ä½•ä¸€ä¸ªåœ¨é€‰æ‹©æ“ä½œä¸­é˜»å¡çš„çº¿ç¨‹éƒ½è¢«å”¤é†’ï¼ˆç±»ä¼¼ wakeupï¼ˆï¼‰ï¼‰ï¼ŒåŒæ—¶ ä½¿å¾—æ³¨å†Œåˆ°è¯¥ Selector çš„æ‰€æœ‰ Channel è¢«æ³¨é”€ï¼Œæ‰€æœ‰çš„é”®å°†è¢«å–æ¶ˆï¼Œä½†æ˜¯ Channel æœ¬èº«å¹¶ä¸ä¼šå…³é—­ã€‚\n\n### 3 NIO ç¼–ç¨‹æ­¥éª¤\nç¬¬ä¸€æ­¥ï¼šåˆ›å»º Selector é€‰æ‹©å™¨ \nç¬¬äºŒæ­¥ï¼šåˆ›å»º ServerSocketChannel é€šé“ï¼Œå¹¶ç»‘å®šç›‘å¬ç«¯å£ \nç¬¬ä¸‰æ­¥ï¼šè®¾ç½® Channel é€šé“æ˜¯éé˜»å¡æ¨¡å¼ \nç¬¬å››æ­¥ï¼šæŠŠ Channel æ³¨å†Œåˆ° Socketor é€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬è¿æ¥äº‹ä»¶ \nç¬¬äº”æ­¥ï¼šè°ƒç”¨ Selector çš„ select æ–¹æ³•ï¼ˆå¾ªç¯è°ƒç”¨ï¼‰ï¼Œç›‘æµ‹é€šé“çš„å°±ç»ªçŠ¶å†µ \nç¬¬å…­æ­¥ï¼šè°ƒç”¨ selectKeys æ–¹æ³•è·å–å°±ç»ª channel é›†åˆ \nç¬¬ä¸ƒæ­¥ï¼šéå†å°±ç»ª channel é›†åˆï¼Œåˆ¤æ–­å°±ç»ªäº‹ä»¶ç±»å‹ï¼Œå®ç°å…·ä½“çš„ä¸šåŠ¡æ“ä½œ \nç¬¬å…«æ­¥ï¼šæ ¹æ®ä¸šåŠ¡ï¼Œå†³å®šæ˜¯å¦éœ€è¦å†æ¬¡æ³¨å†Œç›‘å¬äº‹ä»¶ï¼Œé‡å¤æ‰§è¡Œç¬¬ä¸‰æ­¥æ“ä½œ\n\n### 4 ç¤ºä¾‹ä»£ç \n\n#### 4.1 æœåŠ¡ç«¯ä»£ç \n```java\n//æœåŠ¡ç«¯\n    @Test\n    public void serverDemo() throws Exception {\n        //è·å–æœåŠ¡ç«¯é€šé“\n        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();\n        //åˆ‡æ¢éé˜»å¡æ¨¡å¼\n        serverSocketChannel.configureBlocking(false);\n        //åˆ›å»ºbuffer\n        ByteBuffer serverByteBuffer = ByteBuffer.allocate(1024);\n        //ç»‘å®šç«¯å£å·\n        serverSocketChannel.bind(new InetSocketAddress(9999));\n        //è·å–selectoré€‰æ‹©å™¨\n        Selector selector = Selector.open();\n        //é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ï¼Œ\n        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\n        //é€‰æ‹©å™¨è¿›è¡Œè½®è¯¢\n        while (selector.select()>0){\n            Set<SelectionKey> selectionKeys = selector.selectedKeys();\n            Iterator<SelectionKey> iterator = selectionKeys.iterator();\n            while (iterator.hasNext()){\n                SelectionKey next = iterator.next();\n                //åˆ¤æ–­ä»€ä¹ˆæ“ä½œ\n                if(next.isAcceptable()){\n                    //è·å–é“¾æ¥\n                    SocketChannel accept = serverSocketChannel.accept();\n                    //åˆ‡æ¢éé˜»å¡æ¨¡å¼\n                    accept.configureBlocking(false);\n                    //æ³¨å†Œ\n                    accept.register(selector,SelectionKey.OP_READ);\n                }else if(next.isReadable()){\n                    SocketChannel channel = (SocketChannel) next.channel();\n                    ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n                    //è¯»å–æ•°æ®\n                    int length =0;\n                    while ((length = channel.read(byteBuffer))>0){\n                        byteBuffer.flip();\n                        System.out.println(new String(byteBuffer.array(),0,length));\n                        byteBuffer.clear();\n                    }\n                }\n            }\n            iterator.remove();\n        }\n    }\n```\n#### 4.2 å®¢æˆ·ç«¯ä»£ç \n```java\npublic static void main(String[] args) throws Exception{\n        //è·å–é€šé“ï¼Œç»‘å®šä¸»æœºç«¯å£å·\n        SocketChannel socketChannel = SocketChannel.open(new InetSocketAddress(\"127.0.0.1\",9999));\n        //åˆ‡æ¢éé˜»å¡æ¨¡å¼\n        socketChannel.configureBlocking(false);\n\n        //åˆ›å»ºbuffer\n        ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n\n        Scanner scanner = new Scanner(System.in);\n        while (scanner.hasNext()){\n            String str = scanner.next();\n            //å†™å…¥bufferæ•°æ®\n            byteBuffer.put((new Date() +\"--->\"+str).getBytes(StandardCharsets.UTF_8));\n            //æ¨¡å¼åˆ‡æ¢\n            byteBuffer.flip();\n            //å†™å…¥é€šé“\n            socketChannel.write(byteBuffer);\n            //å…³é—­\n            byteBuffer.clear();\n        }\n\n    }\n```\n', '2022-10-09 10:56:26', '2022-10-09 15:59:38', '<h3><a id=\"1_Selector__0\"></a>1 Selector ç®€ä»‹</h3>\n<h4><a id=\"11_Selector__Channel__1\"></a>1.1 Selector å’Œ Channel å…³ç³»</h4>\n<p>Selector ä¸€èˆ¬ç§° ä¸ºé€‰æ‹©å™¨ ï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸º å¤šè·¯å¤ç”¨å™¨ ã€‚å®ƒæ˜¯ Java NIO æ ¸å¿ƒç»„ä»¶ä¸­ çš„ä¸€ä¸ªï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ª NIO Channelï¼ˆé€šé“ï¼‰çš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚å¦‚ æ­¤å¯ä»¥å®ç°å•çº¿ç¨‹ç®¡ç†å¤šä¸ª channels,ä¹Ÿå°±æ˜¯å¯ä»¥ç®¡ç†å¤šä¸ªç½‘ç»œé“¾æ¥ã€‚</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/7ae9446e0bca4a518b305073e07475d0.png\" alt=\"image.png\" /></p>\n</div>\n<p>ä½¿ç”¨ Selector çš„å¥½å¤„åœ¨äºï¼š ä½¿ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥å°±å¯ä»¥æ¥å¤„ç†é€šé“äº†ï¼Œ ç›¸æ¯”ä½¿ç”¨å¤šä¸ª çº¿ç¨‹ï¼Œé¿å…äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ã€‚</p>\n<h4><a id=\"12_SelectableChannel_11\"></a>1.2 å¯é€‰æ‹©é€šé“(SelectableChannel)</h4>\n<p>ï¼ˆ1ï¼‰ä¸æ˜¯æ‰€æœ‰çš„ Channel éƒ½å¯ä»¥è¢« Selector å¤ç”¨çš„ã€‚æ¯”æ–¹è¯´ï¼ŒFileChannel å°±ä¸èƒ½ è¢«é€‰æ‹©å™¨å¤ç”¨ã€‚åˆ¤æ–­ä¸€ä¸ª Channel èƒ½è¢« Selector å¤ç”¨ï¼Œæœ‰ä¸€ä¸ªå‰æï¼šåˆ¤æ–­ä»–æ˜¯å¦ç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡ç±» SelectableChannelã€‚å¦‚æœç»§æ‰¿äº† SelectableChannelï¼Œåˆ™å¯ä»¥è¢«å¤ ç”¨ï¼Œå¦åˆ™ä¸èƒ½ã€‚</p>\n<p>ï¼ˆ2ï¼‰SelectableChannel ç±»æä¾›äº†å®ç°é€šé“çš„å¯é€‰æ‹©æ€§æ‰€éœ€è¦çš„å…¬å…±æ–¹æ³•ã€‚å®ƒæ˜¯æ‰€æœ‰ æ”¯æŒå°±ç»ªæ£€æŸ¥çš„é€šé“ç±»çš„çˆ¶ç±»ã€‚æ‰€æœ‰ socket é€šé“ï¼Œéƒ½ç»§æ‰¿äº† SelectableChannel ç±» éƒ½æ˜¯å¯é€‰æ‹©çš„ï¼ŒåŒ…æ‹¬ä»ç®¡é“(Pipe)å¯¹è±¡çš„ä¸­è·å¾—çš„é€šé“ã€‚è€Œ FileChannel ç±»ï¼Œæ²¡æœ‰ç»§ æ‰¿ SelectableChannelï¼Œå› æ­¤æ˜¯ä¸æ˜¯å¯é€‰é€šé“ã€‚</p>\n<p>ï¼ˆ3ï¼‰ä¸€ä¸ªé€šé“å¯ä»¥è¢«æ³¨å†Œåˆ°å¤šä¸ªé€‰æ‹©å™¨ä¸Šï¼Œä½†å¯¹æ¯ä¸ªé€‰æ‹©å™¨è€Œè¨€åªèƒ½è¢«æ³¨å†Œä¸€æ¬¡ã€‚é€š é“å’Œé€‰æ‹©å™¨ä¹‹é—´çš„å…³ç³»ï¼Œä½¿ç”¨æ³¨å†Œçš„æ–¹å¼å®Œæˆã€‚SelectableChannel å¯ä»¥è¢«æ³¨å†Œåˆ° Selector å¯¹è±¡ä¸Šï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šé€šé“çš„å“ªäº›æ“ä½œï¼Œæ˜¯ Selector æ„Ÿå…´è¶£çš„ã€‚</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/4f68bfeb91434f1eb900f948f52e0dae.png\" alt=\"image.png\" /></p>\n</div>\n<h4><a id=\"13_Channel__Selector_24\"></a>1.3 Channel æ³¨å†Œåˆ° Selector</h4>\n<p>ï¼ˆ1ï¼‰ä½¿ç”¨ Channel.registerï¼ˆSelector selï¼Œint opsï¼‰æ–¹æ³•ï¼Œå°†ä¸€ä¸ªé€šé“æ³¨å†Œåˆ°ä¸€ä¸ª é€‰æ‹©å™¨æ—¶ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šé€šé“è¦æ³¨å†Œçš„é€‰æ‹©å™¨ã€‚ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šé€‰æ‹©å™¨éœ€è¦æŸ¥è¯¢ çš„é€šé“æ“ä½œã€‚<br />\nï¼ˆ2ï¼‰å¯ä»¥ä¾›é€‰æ‹©å™¨æŸ¥è¯¢çš„é€šé“æ“ä½œï¼Œä»ç±»å‹æ¥åˆ†ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å››ç§ï¼š</p>\n<ul>\n<li>å¯è¯» : SelectionKey.OP_READ</li>\n<li>å¯å†™ : SelectionKey.OP_WRITE</li>\n<li>è¿æ¥ : SelectionKey.OP_CONNECT</li>\n<li>æ¥æ”¶ : SelectionKey.OP_ACCEPT</li>\n</ul>\n<p>å¦‚æœ Selector å¯¹é€šé“çš„å¤šæ“ä½œç±»å‹æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç”¨â€œä½æˆ–â€æ“ä½œç¬¦æ¥å®ç°ï¼š æ¯”å¦‚ï¼šint key = SelectionKey.OP_READ | SelectionKey.OP_WRITE ;</p>\n<p>ï¼ˆ3ï¼‰é€‰æ‹©å™¨æŸ¥è¯¢çš„ä¸æ˜¯é€šé“çš„æ“ä½œï¼Œè€Œæ˜¯é€šé“çš„æŸä¸ªæ“ä½œçš„ä¸€ç§å°±ç»ªçŠ¶æ€ã€‚ä»€ä¹ˆæ˜¯æ“ ä½œçš„å°±ç»ªçŠ¶æ€ï¼Ÿä¸€æ—¦é€šé“å…·å¤‡å®ŒæˆæŸä¸ªæ“ä½œçš„æ¡ä»¶ï¼Œè¡¨ç¤ºè¯¥é€šé“çš„æŸä¸ªæ“ä½œå·²ç»å°±ç»ªï¼Œ å°±å¯ä»¥è¢« Selector æŸ¥è¯¢åˆ°ï¼Œç¨‹åºå¯ä»¥å¯¹é€šé“è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚æ¯”æ–¹è¯´ï¼ŒæŸä¸ª SocketChannel é€šé“å¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œåˆ™å¤„äºâ€œè¿æ¥å°±ç»ªâ€(OP_CONNECT)ã€‚ å†æ¯”æ–¹è¯´ï¼Œä¸€ä¸ª ServerSocketChannel æœåŠ¡å™¨é€šé“å‡†å¤‡å¥½æ¥æ”¶æ–°è¿›å…¥çš„è¿æ¥ï¼Œåˆ™å¤„äº â€œæ¥æ”¶å°±ç»ªâ€ï¼ˆOP_ACCEPTï¼‰çŠ¶æ€ã€‚è¿˜æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæœ‰æ•°æ®å¯è¯»çš„é€šé“ï¼Œå¯ä»¥è¯´æ˜¯ â€œè¯»å°±ç»ªâ€(OP_READ)ã€‚ä¸€ä¸ªç­‰å¾…å†™æ•°æ®çš„é€šé“å¯ä»¥è¯´æ˜¯â€œå†™å°±ç»ªâ€(OP_WRITE)ã€‚</p>\n<h4><a id=\"14_SelectionKey_36\"></a>1.4 é€‰æ‹©é”®(SelectionKey)</h4>\n<p>ï¼ˆ1ï¼‰Channel æ³¨å†Œåˆ°åï¼Œå¹¶ä¸”ä¸€æ—¦é€šé“å¤„äºæŸç§å°±ç»ªçš„çŠ¶æ€ï¼Œå°±å¯ä»¥è¢«é€‰æ‹©å™¨æŸ¥è¯¢åˆ°ã€‚ è¿™ä¸ªå·¥ä½œï¼Œä½¿ç”¨é€‰æ‹©å™¨ Selector çš„ selectï¼ˆï¼‰æ–¹æ³•å®Œæˆã€‚select æ–¹æ³•çš„ä½œç”¨ï¼Œå¯¹æ„Ÿå…´ è¶£çš„é€šé“æ“ä½œï¼Œè¿›è¡Œå°±ç»ªçŠ¶æ€çš„æŸ¥è¯¢ã€‚</p>\n<p>ï¼ˆ2ï¼‰Selector å¯ä»¥ä¸æ–­çš„æŸ¥è¯¢ Channel ä¸­å‘ç”Ÿçš„æ“ä½œçš„å°±ç»ªçŠ¶æ€ã€‚å¹¶ä¸”æŒ‘é€‰æ„Ÿå…´è¶£ çš„æ“ä½œå°±ç»ªçŠ¶æ€ã€‚ä¸€æ—¦é€šé“æœ‰æ“ä½œçš„å°±ç»ªçŠ¶æ€è¾¾æˆï¼Œå¹¶ä¸”æ˜¯ Selector æ„Ÿå…´è¶£çš„æ“ä½œï¼Œ å°±ä¼šè¢« Selector é€‰ä¸­ï¼Œæ”¾å…¥é€‰æ‹©é”®é›†åˆä¸­ã€‚</p>\n<p>ï¼ˆ3ï¼‰ä¸€ä¸ªé€‰æ‹©é”®ï¼Œé¦–å…ˆæ˜¯åŒ…å«äº†æ³¨å†Œåœ¨ Selector çš„é€šé“æ“ä½œçš„ç±»å‹ï¼Œæ¯”æ–¹è¯´ SelectionKey.OP_READã€‚ä¹ŸåŒ…å«äº†ç‰¹å®šçš„é€šé“ä¸ç‰¹å®šçš„é€‰æ‹©å™¨ä¹‹é—´çš„æ³¨å†Œå…³ç³»ã€‚</p>\n<p>å¼€å‘åº”ç”¨ç¨‹åºæ˜¯ï¼Œé€‰æ‹©é”®æ˜¯ç¼–ç¨‹çš„å…³é”®ã€‚NIO çš„ç¼–ç¨‹ï¼Œå°±æ˜¯æ ¹æ®å¯¹åº”çš„é€‰æ‹©é”®ï¼Œè¿›è¡Œ ä¸åŒçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚</p>\n<p>ï¼ˆ4ï¼‰é€‰æ‹©é”®çš„æ¦‚å¿µï¼Œå’Œäº‹ä»¶çš„æ¦‚å¿µæ¯”è¾ƒç›¸ä¼¼ã€‚ä¸€ä¸ªé€‰æ‹©é”®ç±»ä¼¼ç›‘å¬å™¨æ¨¡å¼é‡Œè¾¹çš„ä¸€ä¸ª äº‹ä»¶ã€‚ç”±äº Selector ä¸æ˜¯äº‹ä»¶è§¦å‘çš„æ¨¡å¼ï¼Œè€Œæ˜¯ä¸»åŠ¨å»æŸ¥è¯¢çš„æ¨¡å¼ï¼Œæ‰€ä»¥ä¸å«äº‹ä»¶ Eventï¼Œè€Œæ˜¯å« SelectionKey é€‰æ‹©é”®ã€‚</p>\n<h3><a id=\"2_Selector__47\"></a>2 Selector çš„ä½¿ç”¨æ–¹æ³•</h3>\n<h4><a id=\"21_Selector__49\"></a>2.1 Selector çš„åˆ›å»º</h4>\n<p>é€šè¿‡è°ƒç”¨ Selector.open()æ–¹æ³•åˆ›å»ºä¸€ä¸ª Selector å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">// 1ã€è·å– Selector é€‰æ‹©å™¨ </span>\n<span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n</code></div></pre>\n<h4><a id=\"22__Channel__Selector_55\"></a>2.2 æ³¨å†Œ Channel åˆ° Selector</h4>\n<p>è¦å®ç° Selector ç®¡ç† Channelï¼Œéœ€è¦å°† channel æ³¨å†Œåˆ°ç›¸åº”çš„ Selector ä¸Š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">// 1ã€è·å– Selector é€‰æ‹©å™¨ </span>\n<span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open(); \n<span class=\"hljs-comment\">// 2ã€è·å–é€šé“ </span>\n<span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">serverSocketChannel</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open(); \n<span class=\"hljs-comment\">// 3.è®¾ç½®ä¸ºéé˜»å¡ </span>\nserverSocketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>); \n<span class=\"hljs-comment\">// 4ã€ç»‘å®šè¿æ¥ </span>\nserverSocketChannel.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">9999</span>)); \n<span class=\"hljs-comment\">// 5ã€å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,å¹¶åˆ¶å®šç›‘å¬äº‹ä»¶ä¸ºï¼šâ€œæ¥æ”¶â€äº‹ä»¶ </span>\nserverSocketChannel.register(selector,SelectionKey.OP_ACCEPT);\n</code></div></pre>\n<p>ä¸Šé¢é€šè¿‡è°ƒç”¨é€šé“çš„ register()æ–¹æ³•ä¼šå°†å®ƒæ³¨å†Œåˆ°ä¸€ä¸ªé€‰æ‹©å™¨ä¸Šã€‚ é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>\n<p>ï¼ˆ1ï¼‰ä¸ Selector ä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒChannel å¿…é¡»å¤„äºéé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸ IllegalBlockingModeExceptionã€‚è¿™æ„å‘³ç€ï¼ŒFileChannel ä¸èƒ½ä¸ Selector ä¸€èµ·ä½¿ç”¨ï¼Œå›  ä¸º FileChannel ä¸èƒ½åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ï¼Œè€Œå¥—æ¥å­—ç›¸å…³çš„æ‰€æœ‰çš„é€šé“éƒ½å¯ä»¥ã€‚</p>\n<p>ï¼ˆ2ï¼‰ä¸€ä¸ªé€šé“ï¼Œå¹¶æ²¡æœ‰ä¸€å®šè¦æ”¯æŒæ‰€æœ‰çš„å››ç§æ“ä½œã€‚æ¯”å¦‚æœåŠ¡å™¨é€šé“ ServerSocketChannel æ”¯æŒ Accept æ¥å—æ“ä½œï¼Œè€Œ SocketChannel å®¢æˆ·ç«¯é€šé“åˆ™ä¸æ”¯æŒã€‚ å¯ä»¥é€šè¿‡é€šé“ä¸Šçš„ validOps()æ–¹æ³•ï¼Œæ¥è·å–ç‰¹å®šé€šé“ä¸‹æ‰€æœ‰æ”¯æŒçš„æ“ä½œé›†åˆã€‚</p>\n<h4><a id=\"23__75\"></a>2.3 è½®è¯¢æŸ¥è¯¢å°±ç»ªæ“ä½œ</h4>\n<p>ï¼ˆ1ï¼‰é€šè¿‡ Selector çš„ selectï¼ˆï¼‰æ–¹æ³•ï¼Œå¯ä»¥æŸ¥è¯¢å‡ºå·²ç»å°±ç»ªçš„é€šé“æ“ä½œï¼Œè¿™äº›å°±ç»ªçš„ çŠ¶æ€é›†åˆï¼ŒåŒ…å­˜åœ¨ä¸€ä¸ªå…ƒç´ æ˜¯ SelectionKey å¯¹è±¡çš„ Set é›†åˆä¸­ã€‚</p>\n<p>ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯ Selector å‡ ä¸ªé‡è½½çš„æŸ¥è¯¢ select()æ–¹æ³•ï¼š</p>\n<ul>\n<li>select():é˜»å¡åˆ°è‡³å°‘æœ‰ä¸€ä¸ªé€šé“åœ¨ä½ æ³¨å†Œçš„äº‹ä»¶ä¸Šå°±ç»ªäº†ã€‚</li>\n<li>select(long timeout)ï¼šå’Œ select()ä¸€æ ·ï¼Œä½†æœ€é•¿é˜»å¡äº‹ä»¶ä¸º timeout æ¯«ç§’ã€‚</li>\n<li>selectNow():éé˜»å¡ï¼Œåªè¦æœ‰é€šé“å°±ç»ªå°±ç«‹åˆ»è¿”å›ã€‚</li>\n</ul>\n<p>select()æ–¹æ³•è¿”å›çš„ int å€¼ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘é€šé“å·²ç»å°±ç»ªï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œæ˜¯è‡ªå‰ä¸€æ¬¡ select æ–¹æ³•ä»¥æ¥åˆ°è¿™ä¸€æ¬¡ select æ–¹æ³•ä¹‹é—´çš„æ—¶é—´æ®µä¸Šï¼Œæœ‰å¤šå°‘é€šé“å˜æˆå°±ç»ªçŠ¶æ€ã€‚</p>\n<p>ä¾‹å¦‚ï¼šé¦–æ¬¡è°ƒç”¨ select()æ–¹æ³•ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé€šé“å˜æˆå°±ç»ªçŠ¶æ€ï¼Œè¿”å›äº† 1ï¼Œè‹¥å†æ¬¡è°ƒç”¨ select()æ–¹æ³•ï¼Œå¦‚æœå¦ä¸€ä¸ªé€šé“å°±ç»ªäº†ï¼Œå®ƒä¼šå†æ¬¡è¿”å› 1ã€‚å¦‚æœå¯¹ç¬¬ä¸€ä¸ªå°±ç»ªçš„ channel æ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œç°åœ¨å°±æœ‰ä¸¤ä¸ªå°±ç»ªçš„é€šé“ï¼Œä½†åœ¨æ¯æ¬¡ select()æ–¹æ³•è°ƒç”¨ä¹‹é—´ï¼Œ åªæœ‰ä¸€ä¸ªé€šé“å°±ç»ªäº†ã€‚</p>\n<p>ä¸€æ—¦è°ƒç”¨ select()æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ä¸º 0 æ—¶ï¼Œåœ¨ Selector ä¸­æœ‰ä¸€ä¸ª selectedKeys()æ–¹ æ³•ï¼Œç”¨æ¥è®¿é—®å·²é€‰æ‹©é”®é›†åˆï¼Œè¿­ä»£é›†åˆçš„æ¯ä¸€ä¸ªé€‰æ‹©é”®å…ƒç´ ï¼Œæ ¹æ®å°±ç»ªæ“ä½œçš„ç±»å‹ï¼Œ å®Œæˆå¯¹åº”çš„æ“ä½œï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">Set</span> <span class=\"hljs-variable\">selectedKeys</span> <span class=\"hljs-operator\">=</span> selector.selectedKeys(); \n<span class=\"hljs-type\">Iterator</span> <span class=\"hljs-variable\">keyIterator</span> <span class=\"hljs-operator\">=</span> selectedKeys.iterator();\n<span class=\"hljs-keyword\">while</span> (iterator.hasNext()) {\n            <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">key</span> <span class=\"hljs-operator\">=</span> iterator.next();\n            <span class=\"hljs-keyword\">if</span> (key.isAcceptable()) {\n                <span class=\"hljs-comment\">// a connection was accepted by a ServerSocketChannel.</span>\n            } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (key.isConnectable()) {\n                <span class=\"hljs-comment\">// a connection was established with a remote server.</span>\n            } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (key.isReadable()) {\n                <span class=\"hljs-comment\">// a channel is ready for reading</span>\n            } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (key.isWritable()) {\n                <span class=\"hljs-comment\">// a channel is ready for writing</span>\n            }\n        }\n</code></div></pre>\n<h4><a id=\"24__105\"></a>2.4 åœæ­¢é€‰æ‹©çš„æ–¹æ³•</h4>\n<p>é€‰æ‹©å™¨æ‰§è¡Œé€‰æ‹©çš„è¿‡ç¨‹ï¼Œç³»ç»Ÿåº•å±‚ä¼šä¾æ¬¡è¯¢é—®æ¯ä¸ªé€šé“æ˜¯å¦å·²ç»å°±ç»ªï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ ä¼šé€ æˆè°ƒç”¨çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€,é‚£ä¹ˆæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼å¯ä»¥å”¤é†’åœ¨ selectï¼ˆï¼‰æ–¹æ³•ä¸­ é˜»å¡çš„çº¿ç¨‹ã€‚</p>\n<p>wakeup()æ–¹æ³• ï¼šé€šè¿‡è°ƒç”¨ Selector å¯¹è±¡çš„ wakeupï¼ˆï¼‰æ–¹æ³•è®©å¤„åœ¨é˜»å¡çŠ¶æ€çš„ select()æ–¹æ³•ç«‹åˆ»è¿”å›è¯¥æ–¹æ³•ä½¿å¾—é€‰æ‹©å™¨ä¸Šçš„ç¬¬ä¸€ä¸ªè¿˜æ²¡æœ‰è¿”å›çš„é€‰æ‹©æ“ä½œç«‹å³è¿”å›ã€‚å¦‚æœå½“å‰æ²¡æœ‰è¿›è¡Œä¸­ çš„é€‰æ‹©æ“ä½œï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å¯¹ select()æ–¹æ³•çš„ä¸€æ¬¡è°ƒç”¨å°†ç«‹å³è¿”å›ã€‚</p>\n<p>close()æ–¹æ³• ï¼šé€šè¿‡ closeï¼ˆï¼‰æ–¹æ³•å…³é—­ Selectorã€‚</p>\n<p>è¯¥æ–¹æ³•ä½¿å¾—ä»»ä½•ä¸€ä¸ªåœ¨é€‰æ‹©æ“ä½œä¸­é˜»å¡çš„çº¿ç¨‹éƒ½è¢«å”¤é†’ï¼ˆç±»ä¼¼ wakeupï¼ˆï¼‰ï¼‰ï¼ŒåŒæ—¶ ä½¿å¾—æ³¨å†Œåˆ°è¯¥ Selector çš„æ‰€æœ‰ Channel è¢«æ³¨é”€ï¼Œæ‰€æœ‰çš„é”®å°†è¢«å–æ¶ˆï¼Œä½†æ˜¯ Channel æœ¬èº«å¹¶ä¸ä¼šå…³é—­ã€‚</p>\n<h3><a id=\"3_NIO__114\"></a>3 NIO ç¼–ç¨‹æ­¥éª¤</h3>\n<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Selector é€‰æ‹©å™¨<br />\nç¬¬äºŒæ­¥ï¼šåˆ›å»º ServerSocketChannel é€šé“ï¼Œå¹¶ç»‘å®šç›‘å¬ç«¯å£<br />\nç¬¬ä¸‰æ­¥ï¼šè®¾ç½® Channel é€šé“æ˜¯éé˜»å¡æ¨¡å¼<br />\nç¬¬å››æ­¥ï¼šæŠŠ Channel æ³¨å†Œåˆ° Socketor é€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬è¿æ¥äº‹ä»¶<br />\nç¬¬äº”æ­¥ï¼šè°ƒç”¨ Selector çš„ select æ–¹æ³•ï¼ˆå¾ªç¯è°ƒç”¨ï¼‰ï¼Œç›‘æµ‹é€šé“çš„å°±ç»ªçŠ¶å†µ<br />\nç¬¬å…­æ­¥ï¼šè°ƒç”¨ selectKeys æ–¹æ³•è·å–å°±ç»ª channel é›†åˆ<br />\nç¬¬ä¸ƒæ­¥ï¼šéå†å°±ç»ª channel é›†åˆï¼Œåˆ¤æ–­å°±ç»ªäº‹ä»¶ç±»å‹ï¼Œå®ç°å…·ä½“çš„ä¸šåŠ¡æ“ä½œ<br />\nç¬¬å…«æ­¥ï¼šæ ¹æ®ä¸šåŠ¡ï¼Œå†³å®šæ˜¯å¦éœ€è¦å†æ¬¡æ³¨å†Œç›‘å¬äº‹ä»¶ï¼Œé‡å¤æ‰§è¡Œç¬¬ä¸‰æ­¥æ“ä½œ</p>\n<h3><a id=\"4__124\"></a>4 ç¤ºä¾‹ä»£ç </h3>\n<h4><a id=\"41__126\"></a>4.1 æœåŠ¡ç«¯ä»£ç </h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//æœåŠ¡ç«¯</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">serverDemo</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//è·å–æœåŠ¡ç«¯é€šé“</span>\n        <span class=\"hljs-type\">ServerSocketChannel</span> <span class=\"hljs-variable\">serverSocketChannel</span> <span class=\"hljs-operator\">=</span> ServerSocketChannel.open();\n        <span class=\"hljs-comment\">//åˆ‡æ¢éé˜»å¡æ¨¡å¼</span>\n        serverSocketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n        <span class=\"hljs-comment\">//åˆ›å»ºbuffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">serverByteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-comment\">//ç»‘å®šç«¯å£å·</span>\n        serverSocketChannel.bind(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-number\">9999</span>));\n        <span class=\"hljs-comment\">//è·å–selectoré€‰æ‹©å™¨</span>\n        <span class=\"hljs-type\">Selector</span> <span class=\"hljs-variable\">selector</span> <span class=\"hljs-operator\">=</span> Selector.open();\n        <span class=\"hljs-comment\">//é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ï¼Œ</span>\n        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);\n        <span class=\"hljs-comment\">//é€‰æ‹©å™¨è¿›è¡Œè½®è¯¢</span>\n        <span class=\"hljs-keyword\">while</span> (selector.select()&gt;<span class=\"hljs-number\">0</span>){\n            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();\n            Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();\n            <span class=\"hljs-keyword\">while</span> (iterator.hasNext()){\n                <span class=\"hljs-type\">SelectionKey</span> <span class=\"hljs-variable\">next</span> <span class=\"hljs-operator\">=</span> iterator.next();\n                <span class=\"hljs-comment\">//åˆ¤æ–­ä»€ä¹ˆæ“ä½œ</span>\n                <span class=\"hljs-keyword\">if</span>(next.isAcceptable()){\n                    <span class=\"hljs-comment\">//è·å–é“¾æ¥</span>\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">accept</span> <span class=\"hljs-operator\">=</span> serverSocketChannel.accept();\n                    <span class=\"hljs-comment\">//åˆ‡æ¢éé˜»å¡æ¨¡å¼</span>\n                    accept.configureBlocking(<span class=\"hljs-literal\">false</span>);\n                    <span class=\"hljs-comment\">//æ³¨å†Œ</span>\n                    accept.register(selector,SelectionKey.OP_READ);\n                }<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(next.isReadable()){\n                    <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> (SocketChannel) next.channel();\n                    <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n                    <span class=\"hljs-comment\">//è¯»å–æ•°æ®</span>\n                    <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span><span class=\"hljs-number\">0</span>;\n                    <span class=\"hljs-keyword\">while</span> ((length = channel.read(byteBuffer))&gt;<span class=\"hljs-number\">0</span>){\n                        byteBuffer.flip();\n                        System.out.println(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(byteBuffer.array(),<span class=\"hljs-number\">0</span>,length));\n                        byteBuffer.clear();\n                    }\n                }\n            }\n            iterator.remove();\n        }\n    }\n</code></div></pre>\n<h4><a id=\"42__173\"></a>4.2 å®¢æˆ·ç«¯ä»£ç </h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//è·å–é€šé“ï¼Œç»‘å®šä¸»æœºç«¯å£å·</span>\n        <span class=\"hljs-type\">SocketChannel</span> <span class=\"hljs-variable\">socketChannel</span> <span class=\"hljs-operator\">=</span> SocketChannel.open(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">InetSocketAddress</span>(<span class=\"hljs-string\">&quot;127.0.0.1&quot;</span>,<span class=\"hljs-number\">9999</span>));\n        <span class=\"hljs-comment\">//åˆ‡æ¢éé˜»å¡æ¨¡å¼</span>\n        socketChannel.configureBlocking(<span class=\"hljs-literal\">false</span>);\n\n        <span class=\"hljs-comment\">//åˆ›å»ºbuffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n\n        <span class=\"hljs-type\">Scanner</span> <span class=\"hljs-variable\">scanner</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Scanner</span>(System.in);\n        <span class=\"hljs-keyword\">while</span> (scanner.hasNext()){\n            <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">str</span> <span class=\"hljs-operator\">=</span> scanner.next();\n            <span class=\"hljs-comment\">//å†™å…¥bufferæ•°æ®</span>\n            byteBuffer.put((<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Date</span>() +<span class=\"hljs-string\">&quot;---&gt;&quot;</span>+str).getBytes(StandardCharsets.UTF_8));\n            <span class=\"hljs-comment\">//æ¨¡å¼åˆ‡æ¢</span>\n            byteBuffer.flip();\n            <span class=\"hljs-comment\">//å†™å…¥é€šé“</span>\n            socketChannel.write(byteBuffer);\n            <span class=\"hljs-comment\">//å…³é—­</span>\n            byteBuffer.clear();\n        }\n\n    }\n</code></div></pre>\n');
INSERT INTO `article_content` VALUES ('6ad6bbb7161e5ad89760b8ca830870ef', '### 1 IOæ¦‚è¿°\nIO çš„æ“ä½œæ–¹å¼é€šå¸¸åˆ†ä¸ºå‡ ç§ï¼šåŒæ­¥é˜»å¡ BIOã€åŒæ­¥éé˜»å¡ NIOã€å¼‚æ­¥éé˜»å¡ AIOã€‚\n\n- åœ¨ JDK1.4 ä¹‹å‰ï¼Œæˆ‘ä»¬å»ºç«‹ç½‘ç»œè¿æ¥çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯ BIO æ¨¡å¼ã€‚\n- Java NIOï¼ˆNew IO æˆ– Non Blocking IOï¼‰æ˜¯ä» Java 1.4 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„ IO APIï¼Œå¯ä»¥æ›¿ä»£æ ‡å‡†çš„ Java IO APIã€‚NIO æ”¯æŒé¢å‘ç¼“å†²åŒºçš„ã€åŸºäºé€šé“çš„ IO æ“ä½œã€‚ NIO å°†ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚BIO ä¸ NIO ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ä¸åŒæ˜¯ï¼Œ æˆ‘ä»¬ä½¿ç”¨ BIO çš„æ—¶å€™å¾€å¾€ä¼šå¼•å…¥å¤šçº¿ç¨‹ï¼Œæ¯ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼›è€Œ NIO åˆ™æ˜¯ ä½¿ç”¨å•çº¿ç¨‹æˆ–è€…åªä½¿ç”¨å°‘é‡çš„å¤šçº¿ç¨‹ï¼Œè®©è¿æ¥å…±ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚\n- AIO ä¹Ÿå°±æ˜¯ NIO 2ï¼Œåœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„ IO æ¨¡å‹ã€‚\n\n\nä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»è¿™å‡ ç§ IO æ–¹å¼\n\n### 2 é˜»å¡ IO (BIO)\né˜»å¡ IOï¼ˆBIOï¼‰æ˜¯æœ€ä¼ ç»Ÿçš„ä¸€ç§ IO æ¨¡å‹ï¼Œå³åœ¨è¯»å†™æ•°æ®è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿé˜»å¡ç°è±¡ï¼Œç›´è‡³ æœ‰å¯ä¾›è¯»å–çš„æ•°æ®æˆ–è€…æ•°æ®èƒ½å¤Ÿå†™å…¥ã€‚\n\n- åœ¨ BIO æ¨¡å¼ä¸­ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹ä¸€ä¸ªçº¿ç¨‹ï¼Œç”±è¯¥çº¿ç¨‹å•ç‹¬è´Ÿè´£ å¤„ç†ä¸€ä¸ªå®¢æˆ·è¯·æ±‚ï¼Œè¿™ç§æ¨¡å¼è™½ç„¶ç®€å•æ–¹ä¾¿ï¼Œä½†ç”±äºæœåŠ¡å™¨ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥éƒ½é‡‡ ç”¨ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼Œä½¿å¾—èµ„æºå ç”¨éå¸¸å¤§ã€‚å› æ­¤ï¼Œå½“è¿æ¥æ•°é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå¦‚æœå†æœ‰ ç”¨æˆ·è¯·æ±‚è¿æ¥ï¼Œç›´æ¥ä¼šå¯¼è‡´èµ„æºç“¶é¢ˆï¼Œä¸¥é‡çš„å¯èƒ½ä¼šç›´æ¥å¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚\n- å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜ï¼Œéƒ½é‡‡ç”¨äº†çº¿ç¨‹æ± æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§ å°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°±ä»çº¿ç¨‹æ± ä¸­å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼Œå½“å®¢æˆ·ç«¯å¤„ ç†å®Œæ“ä½œä¹‹åï¼Œå°±ä¼šé‡Šæ”¾å¯¹çº¿ç¨‹çš„å ç”¨ã€‚å› æ­¤è¿™æ ·å°±é¿å…ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½è¦åˆ›å»ºçº¿ ç¨‹å¸¦æ¥çš„èµ„æºæµªè´¹ï¼Œä½¿å¾—çº¿ç¨‹å¯ä»¥é‡ç”¨ã€‚ä½†çº¿ç¨‹æ± ä¹Ÿæœ‰å®ƒçš„å¼Šç«¯ï¼Œå¦‚æœè¿æ¥å¤§å¤šæ˜¯é•¿ è¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½è¢«å ç”¨ï¼Œé‚£ä¹ˆå½“å†æœ‰å®¢æˆ·ç«¯è¯·æ±‚ è¿æ¥æ—¶ï¼Œç”±äºæ²¡æœ‰ç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿æ¥å¤±è´¥ã€‚ä¼ ç»Ÿçš„ BIO æ¨¡å¼å¦‚ä¸‹ å›¾æ‰€ç¤ºï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/86e940e7fb5e478aa334c15a9d8d8e8e.png)\n\n:::\n\n\n### 3 éé˜»å¡ IO(NIO)\nåŸºäº BIO çš„å„ç§å¼Šç«¯ï¼Œåœ¨ JDK1.4 å¼€å§‹å‡ºç°äº†é«˜æ€§èƒ½ IO è®¾è®¡æ¨¡å¼éé˜»å¡ IOï¼ˆNIOï¼‰ã€‚\n\n- NIO é‡‡ç”¨éé˜»å¡æ¨¡å¼ï¼ŒåŸºäº Reactor æ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼ŒI/O è°ƒç”¨ä¸ä¼šè¢«é˜»å¡ï¼Œå®ƒ çš„å®ç°è¿‡ç¨‹æ˜¯ï¼šä¼šå…ˆå¯¹æ¯ä¸ªå®¢æˆ·ç«¯æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œç„¶åæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨å»è½®è¯¢æ¯ ä¸ªå®¢æˆ·ç«¯æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¾¿é¡ºåºå¤„ç†æ¯ä¸ªäº‹ä»¶ï¼Œå½“æ‰€æœ‰äº‹ä»¶å¤„ç† å®Œä¹‹åï¼Œä¾¿å†è½¬å»ç»§ç»­è½®è¯¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/33ee136a8a2d491887385a59a60c952a.png)\n\n:::\n\n\n- NIO ä¸­å®ç°éé˜»å¡ I/O çš„æ ¸å¿ƒå¯¹è±¡å°±æ˜¯ Selectorï¼ŒSelector å°±æ˜¯æ³¨å†Œå„ç§ I/O äº‹ä»¶åœ°æ–¹ï¼Œè€Œä¸”å½“æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±æ˜¯è¿™ä¸ªå¯¹è±¡å‘Šè¯‰æˆ‘ä»¬æ‰€å‘ç”Ÿçš„äº‹ä»¶ï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/bfd0b9ea9f8f4e72bdace86e7596c0ef.png)\n\n:::\n\n\n- NIO çš„æœ€é‡è¦çš„åœ°æ–¹æ˜¯å½“ä¸€ä¸ªè¿æ¥åˆ›å»ºåï¼Œä¸éœ€è¦å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿æ¥ä¼šè¢« æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šé¢ï¼Œä¸€ä¸ªé€‰æ‹©å™¨çº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ä¸ªè¿æ¥ï¼Œç³»ç»Ÿä¸å¿…åˆ› å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€é”€ã€‚\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/c1b3c7c99b8c4c70bacebc1db33a3b07.png)\n\n:::\n\n\n### 4 å¼‚æ­¥éé˜»å¡ IO(AIO)\n- AIO ä¹Ÿå°±æ˜¯ NIO 2ï¼Œåœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡ çš„ IO æ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ AIO æ¨¡å¼ä¸éœ€è¦selector æ“ä½œï¼Œè€Œæ˜¯æ˜¯äº‹ä»¶é©±åŠ¨å½¢å¼ï¼Œä¹Ÿå°±æ˜¯å½“å®¢æˆ·ç«¯å‘é€æ•°æ®ä¹‹åï¼Œä¼šä¸»åŠ¨é€šçŸ¥æœ åŠ¡å™¨ï¼Œæ¥ç€æœåŠ¡å™¨å†è¿›è¡Œè¯»å†™æ“ä½œã€‚\n- Java çš„ AIO API å…¶å®å°±æ˜¯ Proactor æ¨¡å¼çš„åº”ç”¨ï¼Œå’Œ Reactor æ¨¡å¼ç±»ä¼¼ã€‚ Reactor å’Œ Proactor æ¨¡å¼çš„ä¸»è¦åŒºåˆ«å°±æ˜¯çœŸæ­£çš„è¯»å–å’Œå†™å…¥æ“ä½œæ˜¯æœ‰è°æ¥å®Œæˆçš„ï¼Œ Reactor ä¸­éœ€è¦åº”ç”¨ç¨‹åºè‡ªå·±è¯»å–æˆ–è€…å†™å…¥æ•°æ®ï¼Œè€Œ Proactor æ¨¡å¼ä¸­ï¼Œåº”ç”¨ç¨‹åºä¸éœ€ è¦è¿›è¡Œå®é™…çš„è¯»å†™è¿‡ç¨‹ï¼Œå®ƒåªéœ€è¦ä»ç¼“å­˜åŒºè¯»å–æˆ–è€…å†™å…¥å³å¯ï¼Œæ“ä½œç³»ç»Ÿä¼šè¯»å–ç¼“å­˜ åŒºæˆ–è€…å†™å…¥ç¼“å­˜åŒºåˆ°çœŸæ­£çš„ IO è®¾å¤‡ã€‚\n\n### 5 NIO æ¦‚è¿°\nJava NIO ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š\n1. Channels\n2. Buffers\n3. Selectors\n\nè™½ç„¶ Java NIO ä¸­é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç±»å’Œç»„ä»¶ï¼Œä½† Channelï¼ŒBuffer å’Œ Selector æ„æˆ äº†æ ¸å¿ƒçš„ APIã€‚å…¶å®ƒç»„ä»¶ï¼Œå¦‚ Pipe å’Œ FileLockï¼Œåªä¸è¿‡æ˜¯ä¸ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å…±åŒä½¿ç”¨çš„ å·¥å…·ç±»ã€‚\n\n#### 5.1 Channel\né¦–å…ˆè¯´ä¸€ä¸‹ Channelï¼Œå¯ä»¥ç¿»è¯‘æˆâ€œé€šé“â€ã€‚Channel å’Œ IO ä¸­çš„ Stream(æµ)æ˜¯å·®ä¸ å¤šä¸€ä¸ªç­‰çº§çš„ã€‚åªä¸è¿‡ Stream æ˜¯å•å‘çš„ï¼Œè­¬å¦‚ï¼šInputStream, OutputStream.è€Œ Channel æ˜¯åŒå‘çš„ï¼Œæ—¢å¯ä»¥ç”¨æ¥è¿›è¡Œè¯»æ“ä½œï¼Œåˆå¯ä»¥ç”¨æ¥è¿›è¡Œå†™æ“ä½œã€‚\n\nNIO ä¸­çš„ Channel çš„ä¸»è¦å®ç°æœ‰ï¼šFileChannelã€DatagramChannelã€ SocketChannel å’Œ ServerSocketChannelï¼Œè¿™é‡Œçœ‹åå­—å°±å¯ä»¥çŒœå‡ºä¸ªæ‰€ä»¥ç„¶æ¥ï¼šåˆ†åˆ« å¯ä»¥å¯¹åº”æ–‡ä»¶ IOã€UDP å’Œ TCPï¼ˆServer å’Œ Clientï¼‰ã€‚\n\n#### 5.2 Buffer\nNIO ä¸­çš„å…³é”® Buffer å®ç°æœ‰ï¼šByteBuffer, CharBuffer, DoubleBuffer, FloatBuffer, IntBuffer, LongBuffer, ShortBufferï¼Œåˆ†åˆ«å¯¹åº”åŸºæœ¬æ•°æ®ç±»å‹: byte, char, double, float, int, long, shortã€‚\n\n#### 5.3 Selector\nSelector è¿è¡Œå•çº¿ç¨‹å¤„ç†å¤šä¸ª Channelï¼Œå¦‚æœä½ çš„åº”ç”¨æ‰“å¼€äº†å¤šä¸ªé€šé“ï¼Œä½†æ¯ä¸ªè¿æ¥ çš„æµé‡éƒ½å¾ˆä½ï¼Œä½¿ç”¨ Selector å°±ä¼šå¾ˆæ–¹ä¾¿ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ä¸­ã€‚è¦ä½¿ç”¨ Selector, å¾—å‘ Selector æ³¨å†Œ Channelï¼Œç„¶åè°ƒç”¨å®ƒçš„ select()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä¸€ç›´ é˜»å¡åˆ°æŸä¸ªæ³¨å†Œçš„é€šé“æœ‰äº‹ä»¶å°±ç»ªã€‚ä¸€æ—¦è¿™ä¸ªæ–¹æ³•è¿”å›ï¼Œçº¿ç¨‹å°±å¯ä»¥å¤„ç†è¿™äº›äº‹ä»¶ï¼Œ äº‹ä»¶çš„ä¾‹å­æœ‰å¦‚æ–°çš„è¿æ¥è¿›æ¥ã€æ•°æ®æ¥æ”¶ç­‰ã€‚\n\n#### 5.4 Channel Buffer Selector ä¸‰è€…å…³ç³»\n\n- ä¸€ä¸ª Channel å°±åƒä¸€ä¸ªæµï¼Œåªæ˜¯ Channel æ˜¯åŒå‘çš„ï¼ŒChannel è¯»æ•°æ®åˆ° Bufferï¼Œ Buffer å†™æ•°æ®åˆ° Channelã€‚\n\n\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/917086f4944c4bb1b15cc4e756622905.png)\n\n:::\n\n\n- ä¸€ä¸ª selector å…è®¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª channelã€‚\n\n\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/0209d1cac2b74cf5bd7345fd87888c9b.png)\n\n:::\n', '2022-09-30 14:45:15', '2022-09-30 15:13:52', '<h3><a id=\"1_IO_0\"></a>1 IOæ¦‚è¿°</h3>\n<p>IO çš„æ“ä½œæ–¹å¼é€šå¸¸åˆ†ä¸ºå‡ ç§ï¼šåŒæ­¥é˜»å¡ BIOã€åŒæ­¥éé˜»å¡ NIOã€å¼‚æ­¥éé˜»å¡ AIOã€‚</p>\n<ul>\n<li>åœ¨ JDK1.4 ä¹‹å‰ï¼Œæˆ‘ä»¬å»ºç«‹ç½‘ç»œè¿æ¥çš„æ—¶å€™é‡‡ç”¨çš„æ˜¯ BIO æ¨¡å¼ã€‚</li>\n<li>Java NIOï¼ˆNew IO æˆ– Non Blocking IOï¼‰æ˜¯ä» Java 1.4 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ä¸€ä¸ªæ–°çš„ IO APIï¼Œå¯ä»¥æ›¿ä»£æ ‡å‡†çš„ Java IO APIã€‚NIO æ”¯æŒé¢å‘ç¼“å†²åŒºçš„ã€åŸºäºé€šé“çš„ IO æ“ä½œã€‚ NIO å°†ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶çš„è¯»å†™æ“ä½œã€‚BIO ä¸ NIO ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„ä¸åŒæ˜¯ï¼Œ æˆ‘ä»¬ä½¿ç”¨ BIO çš„æ—¶å€™å¾€å¾€ä¼šå¼•å…¥å¤šçº¿ç¨‹ï¼Œæ¯ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼›è€Œ NIO åˆ™æ˜¯ ä½¿ç”¨å•çº¿ç¨‹æˆ–è€…åªä½¿ç”¨å°‘é‡çš„å¤šçº¿ç¨‹ï¼Œè®©è¿æ¥å…±ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚</li>\n<li>AIO ä¹Ÿå°±æ˜¯ NIO 2ï¼Œåœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„ IO æ¨¡å‹ã€‚</li>\n</ul>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»è¿™å‡ ç§ IO æ–¹å¼</p>\n<h3><a id=\"2__IO_BIO_10\"></a>2 é˜»å¡ IO (BIO)</h3>\n<p>é˜»å¡ IOï¼ˆBIOï¼‰æ˜¯æœ€ä¼ ç»Ÿçš„ä¸€ç§ IO æ¨¡å‹ï¼Œå³åœ¨è¯»å†™æ•°æ®è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿé˜»å¡ç°è±¡ï¼Œç›´è‡³ æœ‰å¯ä¾›è¯»å–çš„æ•°æ®æˆ–è€…æ•°æ®èƒ½å¤Ÿå†™å…¥ã€‚</p>\n<ul>\n<li>åœ¨ BIO æ¨¡å¼ä¸­ï¼ŒæœåŠ¡å™¨ä¼šä¸ºæ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å»ºç«‹ä¸€ä¸ªçº¿ç¨‹ï¼Œç”±è¯¥çº¿ç¨‹å•ç‹¬è´Ÿè´£ å¤„ç†ä¸€ä¸ªå®¢æˆ·è¯·æ±‚ï¼Œè¿™ç§æ¨¡å¼è™½ç„¶ç®€å•æ–¹ä¾¿ï¼Œä½†ç”±äºæœåŠ¡å™¨ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥éƒ½é‡‡ ç”¨ä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼Œä½¿å¾—èµ„æºå ç”¨éå¸¸å¤§ã€‚å› æ­¤ï¼Œå½“è¿æ¥æ•°é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå¦‚æœå†æœ‰ ç”¨æˆ·è¯·æ±‚è¿æ¥ï¼Œç›´æ¥ä¼šå¯¼è‡´èµ„æºç“¶é¢ˆï¼Œä¸¥é‡çš„å¯èƒ½ä¼šç›´æ¥å¯¼è‡´æœåŠ¡å™¨å´©æºƒã€‚</li>\n<li>å¤§å¤šæ•°æƒ…å†µä¸‹ä¸ºäº†é¿å…ä¸Šè¿°é—®é¢˜ï¼Œéƒ½é‡‡ç”¨äº†çº¿ç¨‹æ± æ¨¡å‹ã€‚ä¹Ÿå°±æ˜¯åˆ›å»ºä¸€ä¸ªå›ºå®šå¤§ å°çš„çº¿ç¨‹æ± ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå°±ä»çº¿ç¨‹æ± ä¸­å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼Œå½“å®¢æˆ·ç«¯å¤„ ç†å®Œæ“ä½œä¹‹åï¼Œå°±ä¼šé‡Šæ”¾å¯¹çº¿ç¨‹çš„å ç”¨ã€‚å› æ­¤è¿™æ ·å°±é¿å…ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½è¦åˆ›å»ºçº¿ ç¨‹å¸¦æ¥çš„èµ„æºæµªè´¹ï¼Œä½¿å¾—çº¿ç¨‹å¯ä»¥é‡ç”¨ã€‚ä½†çº¿ç¨‹æ± ä¹Ÿæœ‰å®ƒçš„å¼Šç«¯ï¼Œå¦‚æœè¿æ¥å¤§å¤šæ˜¯é•¿ è¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½è¢«å ç”¨ï¼Œé‚£ä¹ˆå½“å†æœ‰å®¢æˆ·ç«¯è¯·æ±‚ è¿æ¥æ—¶ï¼Œç”±äºæ²¡æœ‰ç©ºé—²çº¿ç¨‹æ¥å¤„ç†ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¿æ¥å¤±è´¥ã€‚ä¼ ç»Ÿçš„ BIO æ¨¡å¼å¦‚ä¸‹ å›¾æ‰€ç¤ºï¼š</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/86e940e7fb5e478aa334c15a9d8d8e8e.png\" alt=\"image.png\" /></p>\n</div>\n<h3><a id=\"3__IONIO_22\"></a>3 éé˜»å¡ IO(NIO)</h3>\n<p>åŸºäº BIO çš„å„ç§å¼Šç«¯ï¼Œåœ¨ JDK1.4 å¼€å§‹å‡ºç°äº†é«˜æ€§èƒ½ IO è®¾è®¡æ¨¡å¼éé˜»å¡ IOï¼ˆNIOï¼‰ã€‚</p>\n<ul>\n<li>NIO é‡‡ç”¨éé˜»å¡æ¨¡å¼ï¼ŒåŸºäº Reactor æ¨¡å¼çš„å·¥ä½œæ–¹å¼ï¼ŒI/O è°ƒç”¨ä¸ä¼šè¢«é˜»å¡ï¼Œå®ƒ çš„å®ç°è¿‡ç¨‹æ˜¯ï¼šä¼šå…ˆå¯¹æ¯ä¸ªå®¢æˆ·ç«¯æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œç„¶åæœ‰ä¸€ä¸ªçº¿ç¨‹ä¸“é—¨å»è½®è¯¢æ¯ ä¸ªå®¢æˆ·ç«¯æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œå½“æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œä¾¿é¡ºåºå¤„ç†æ¯ä¸ªäº‹ä»¶ï¼Œå½“æ‰€æœ‰äº‹ä»¶å¤„ç† å®Œä¹‹åï¼Œä¾¿å†è½¬å»ç»§ç»­è½®è¯¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/33ee136a8a2d491887385a59a60c952a.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>NIO ä¸­å®ç°éé˜»å¡ I/O çš„æ ¸å¿ƒå¯¹è±¡å°±æ˜¯ Selectorï¼ŒSelector å°±æ˜¯æ³¨å†Œå„ç§ I/O äº‹ä»¶åœ°æ–¹ï¼Œè€Œä¸”å½“æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±æ˜¯è¿™ä¸ªå¯¹è±¡å‘Šè¯‰æˆ‘ä»¬æ‰€å‘ç”Ÿçš„äº‹ä»¶ï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/bfd0b9ea9f8f4e72bdace86e7596c0ef.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>NIO çš„æœ€é‡è¦çš„åœ°æ–¹æ˜¯å½“ä¸€ä¸ªè¿æ¥åˆ›å»ºåï¼Œä¸éœ€è¦å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¿æ¥ä¼šè¢« æ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šé¢ï¼Œä¸€ä¸ªé€‰æ‹©å™¨çº¿ç¨‹å¯ä»¥åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ä¸ªè¿æ¥ï¼Œç³»ç»Ÿä¸å¿…åˆ› å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä¹Ÿä¸å¿…ç»´æŠ¤è¿™äº›çº¿ç¨‹ï¼Œä»è€Œå¤§å¤§å‡å°äº†ç³»ç»Ÿçš„å¼€é”€ã€‚</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/c1b3c7c99b8c4c70bacebc1db33a3b07.png\" alt=\"image.png\" /></p>\n</div>\n<h3><a id=\"4__IOAIO_49\"></a>4 å¼‚æ­¥éé˜»å¡ IO(AIO)</h3>\n<ul>\n<li>AIO ä¹Ÿå°±æ˜¯ NIO 2ï¼Œåœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡ çš„ IO æ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ AIO æ¨¡å¼ä¸éœ€è¦selector æ“ä½œï¼Œè€Œæ˜¯æ˜¯äº‹ä»¶é©±åŠ¨å½¢å¼ï¼Œä¹Ÿå°±æ˜¯å½“å®¢æˆ·ç«¯å‘é€æ•°æ®ä¹‹åï¼Œä¼šä¸»åŠ¨é€šçŸ¥æœ åŠ¡å™¨ï¼Œæ¥ç€æœåŠ¡å™¨å†è¿›è¡Œè¯»å†™æ“ä½œã€‚</li>\n<li>Java çš„ AIO API å…¶å®å°±æ˜¯ Proactor æ¨¡å¼çš„åº”ç”¨ï¼Œå’Œ Reactor æ¨¡å¼ç±»ä¼¼ã€‚ Reactor å’Œ Proactor æ¨¡å¼çš„ä¸»è¦åŒºåˆ«å°±æ˜¯çœŸæ­£çš„è¯»å–å’Œå†™å…¥æ“ä½œæ˜¯æœ‰è°æ¥å®Œæˆçš„ï¼Œ Reactor ä¸­éœ€è¦åº”ç”¨ç¨‹åºè‡ªå·±è¯»å–æˆ–è€…å†™å…¥æ•°æ®ï¼Œè€Œ Proactor æ¨¡å¼ä¸­ï¼Œåº”ç”¨ç¨‹åºä¸éœ€ è¦è¿›è¡Œå®é™…çš„è¯»å†™è¿‡ç¨‹ï¼Œå®ƒåªéœ€è¦ä»ç¼“å­˜åŒºè¯»å–æˆ–è€…å†™å…¥å³å¯ï¼Œæ“ä½œç³»ç»Ÿä¼šè¯»å–ç¼“å­˜ åŒºæˆ–è€…å†™å…¥ç¼“å­˜åŒºåˆ°çœŸæ­£çš„ IO è®¾å¤‡ã€‚</li>\n</ul>\n<h3><a id=\"5_NIO__53\"></a>5 NIO æ¦‚è¿°</h3>\n<p>Java NIO ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ç»„æˆï¼š</p>\n<ol>\n<li>Channels</li>\n<li>Buffers</li>\n<li>Selectors</li>\n</ol>\n<p>è™½ç„¶ Java NIO ä¸­é™¤æ­¤ä¹‹å¤–è¿˜æœ‰å¾ˆå¤šç±»å’Œç»„ä»¶ï¼Œä½† Channelï¼ŒBuffer å’Œ Selector æ„æˆ äº†æ ¸å¿ƒçš„ APIã€‚å…¶å®ƒç»„ä»¶ï¼Œå¦‚ Pipe å’Œ FileLockï¼Œåªä¸è¿‡æ˜¯ä¸ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å…±åŒä½¿ç”¨çš„ å·¥å…·ç±»ã€‚</p>\n<h4><a id=\"51_Channel_61\"></a>5.1 Channel</h4>\n<p>é¦–å…ˆè¯´ä¸€ä¸‹ Channelï¼Œå¯ä»¥ç¿»è¯‘æˆâ€œé€šé“â€ã€‚Channel å’Œ IO ä¸­çš„ Stream(æµ)æ˜¯å·®ä¸ å¤šä¸€ä¸ªç­‰çº§çš„ã€‚åªä¸è¿‡ Stream æ˜¯å•å‘çš„ï¼Œè­¬å¦‚ï¼šInputStream, OutputStream.è€Œ Channel æ˜¯åŒå‘çš„ï¼Œæ—¢å¯ä»¥ç”¨æ¥è¿›è¡Œè¯»æ“ä½œï¼Œåˆå¯ä»¥ç”¨æ¥è¿›è¡Œå†™æ“ä½œã€‚</p>\n<p>NIO ä¸­çš„ Channel çš„ä¸»è¦å®ç°æœ‰ï¼šFileChannelã€DatagramChannelã€ SocketChannel å’Œ ServerSocketChannelï¼Œè¿™é‡Œçœ‹åå­—å°±å¯ä»¥çŒœå‡ºä¸ªæ‰€ä»¥ç„¶æ¥ï¼šåˆ†åˆ« å¯ä»¥å¯¹åº”æ–‡ä»¶ IOã€UDP å’Œ TCPï¼ˆServer å’Œ Clientï¼‰ã€‚</p>\n<h4><a id=\"52_Buffer_66\"></a>5.2 Buffer</h4>\n<p>NIO ä¸­çš„å…³é”® Buffer å®ç°æœ‰ï¼šByteBuffer, CharBuffer, DoubleBuffer, FloatBuffer, IntBuffer, LongBuffer, ShortBufferï¼Œåˆ†åˆ«å¯¹åº”åŸºæœ¬æ•°æ®ç±»å‹: byte, char, double, float, int, long, shortã€‚</p>\n<h4><a id=\"53_Selector_69\"></a>5.3 Selector</h4>\n<p>Selector è¿è¡Œå•çº¿ç¨‹å¤„ç†å¤šä¸ª Channelï¼Œå¦‚æœä½ çš„åº”ç”¨æ‰“å¼€äº†å¤šä¸ªé€šé“ï¼Œä½†æ¯ä¸ªè¿æ¥ çš„æµé‡éƒ½å¾ˆä½ï¼Œä½¿ç”¨ Selector å°±ä¼šå¾ˆæ–¹ä¾¿ã€‚ä¾‹å¦‚åœ¨ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ä¸­ã€‚è¦ä½¿ç”¨ Selector, å¾—å‘ Selector æ³¨å†Œ Channelï¼Œç„¶åè°ƒç”¨å®ƒçš„ select()æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä¸€ç›´ é˜»å¡åˆ°æŸä¸ªæ³¨å†Œçš„é€šé“æœ‰äº‹ä»¶å°±ç»ªã€‚ä¸€æ—¦è¿™ä¸ªæ–¹æ³•è¿”å›ï¼Œçº¿ç¨‹å°±å¯ä»¥å¤„ç†è¿™äº›äº‹ä»¶ï¼Œ äº‹ä»¶çš„ä¾‹å­æœ‰å¦‚æ–°çš„è¿æ¥è¿›æ¥ã€æ•°æ®æ¥æ”¶ç­‰ã€‚</p>\n<h4><a id=\"54_Channel_Buffer_Selector__72\"></a>5.4 Channel Buffer Selector ä¸‰è€…å…³ç³»</h4>\n<ul>\n<li>ä¸€ä¸ª Channel å°±åƒä¸€ä¸ªæµï¼Œåªæ˜¯ Channel æ˜¯åŒå‘çš„ï¼ŒChannel è¯»æ•°æ®åˆ° Bufferï¼Œ Buffer å†™æ•°æ®åˆ° Channelã€‚</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/917086f4944c4bb1b15cc4e756622905.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>ä¸€ä¸ª selector å…è®¸ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª channelã€‚</li>\n</ul>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/0209d1cac2b74cf5bd7345fd87888c9b.png\" alt=\"image.png\" /></p>\n</div>\n');
INSERT INTO `article_content` VALUES ('6bb0a02f479905e24398dfe187c49641', '### 1 Path\n#### 1.1 Path ç®€ä»‹\nJava Path æ¥å£æ˜¯ Java NIO æ›´æ–°çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ Java NIO ä¸€èµ·å·²ç»åŒ…æ‹¬åœ¨ Java6 å’Œ Java7 ä¸­ã€‚Java Path æ¥å£æ˜¯åœ¨ Java7 ä¸­æ·»åŠ åˆ° Java NIO çš„ã€‚Path æ¥å£ä½äº java.nio.file åŒ…ä¸­ï¼Œæ‰€ä»¥ Path æ¥å£çš„å®Œå…¨é™å®šåç§°ä¸º java.nio.file.Pathã€‚\n\nJava Path å®ä¾‹è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ã€‚ä¸€ä¸ªè·¯å¾„å¯ä»¥æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªç›®å½•ã€‚è·¯å¾„ å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚ç»å¯¹è·¯å¾„åŒ…å«ä»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•åˆ°å®ƒæŒ‡å‘çš„ æ–‡ä»¶æˆ–ç›®å½•çš„å®Œæ•´è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„åŒ…å«ç›¸å¯¹äºå…¶ä»–è·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚\n\nåœ¨è®¸å¤šæ–¹é¢ï¼Œjava.nio.file.Path æ¥å£ç±»ä¼¼äº java.io.File ç±»ï¼Œä½†æ˜¯æœ‰ä¸€äº›å·®åˆ«ã€‚ä¸è¿‡ï¼Œ åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Path æ¥å£æ¥æ›¿æ¢ File ç±»çš„ä½¿ç”¨ã€‚\n\n#### 1.2 åˆ›å»º Path å®ä¾‹\n\nä½¿ç”¨ java.nio.file.Path å®ä¾‹å¿…é¡»åˆ›å»ºä¸€ä¸ª Path å®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨ Paths ç±» (java.nio.file.Paths)ä¸­çš„é™æ€æ–¹æ³• Paths.get()æ¥åˆ›å»ºè·¯å¾„å®ä¾‹ã€‚\n\nç¤ºä¾‹ä»£ç :\n\n```java\npublic static void main(String[] args) {\n        //åˆ›å»ºPathå®ä¾‹\n        Path path = Paths.get(\"d:\\\\111.txt\");\n    }\n```\nä¸Šè¿°ä»£ç ï¼Œå¯ä»¥ç†è§£ä¸ºï¼ŒPaths.get()æ–¹æ³•æ˜¯ Path å®ä¾‹çš„å·¥å‚æ–¹æ³•ã€‚\n\n#### 1.3 åˆ›å»ºç»å¯¹è·¯å¾„\n\nï¼ˆ1ï¼‰åˆ›å»ºç»å¯¹è·¯å¾„ï¼Œé€šè¿‡è°ƒç”¨ Paths.get()æ–¹æ³•ï¼Œç»™å®šç»å¯¹è·¯å¾„æ–‡ä»¶ä½œä¸ºå‚æ•°æ¥å®Œæˆã€‚\n\nç¤ºä¾‹ä»£ç ï¼š\n```java\nPath path = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n```\nä¸Šè¿°ä»£ç ä¸­ï¼Œç»å¯¹è·¯å¾„æ˜¯ d:\\atguigu\\001.txtã€‚åœ¨ Java å­—ç¬¦ä¸²ä¸­ï¼Œ \\æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œ éœ€è¦ç¼–å†™\\\\ï¼Œå‘Šè¯‰ Java ç¼–è¯‘å™¨åœ¨å­—ç¬¦ä¸²ä¸­å†™å…¥ä¸€ä¸ª\\å­—ç¬¦ã€‚\n\nï¼ˆ2ï¼‰å¦‚æœåœ¨ Linuxã€MacOS ç­‰æ“ä½œå­—ä½“ä¸Šï¼Œä¸Šé¢çš„ç»å¯¹è·¯å¾„å¯èƒ½å¦‚ä¸‹:\n\n```java\nPath path = Paths.get(\"/home/jakobjenkov/myfile.txt\");\n```\n\nç»å¯¹è·¯å¾„ç°åœ¨ä¸º/home/jakobjenkov/myfile.txt.\n\nï¼ˆ3ï¼‰å¦‚æœåœ¨ Windows æœºå™¨ä¸Šä½¿ç”¨äº†ä»/å¼€å§‹çš„è·¯å¾„ï¼Œé‚£ä¹ˆè·¯å¾„å°†è¢«è§£é‡Šä¸ºç›¸å¯¹äºå½“ å‰é©±åŠ¨å™¨ã€‚\n\n#### 1.4 åˆ›å»ºç›¸å¯¹è·¯å¾„\nJava NIO Path ç±»ä¹Ÿå¯ä»¥ç”¨äºå¤„ç†ç›¸å¯¹è·¯å¾„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Paths.get(basePath, relativePath)æ–¹æ³•åˆ›å»ºä¸€ä¸ªç›¸å¯¹è·¯å¾„ã€‚\n\nç¤ºä¾‹ä»£ç :\n\n```java\n//ä»£ç  1 \nPath projects = Paths.get(\"d:\\\\atguigu\", \"projects\"); \n//ä»£ç  2 \nPath file = Paths.get(\"d:\\\\atguigu\", \"projects\\\\002.txt\");\n```\nä»£ç  1 åˆ›å»ºäº†ä¸€ä¸ª Java Path çš„å®ä¾‹ï¼ŒæŒ‡å‘è·¯å¾„(ç›®å½•):d:\\atguigu\\projects \nä»£ç  2 åˆ›å»ºäº†ä¸€ä¸ª Path çš„å®ä¾‹ï¼ŒæŒ‡å‘è·¯å¾„(æ–‡ä»¶):d:\\atguigu\\projects\\002.txt\n\n#### 1.5 Path.normalize()\nPath æ¥å£çš„ normalize()æ–¹æ³•å¯ä»¥ä½¿è·¯å¾„æ ‡å‡†åŒ–ã€‚æ ‡å‡†åŒ–æ„å‘³ç€å®ƒå°†ç§»é™¤æ‰€æœ‰åœ¨è·¯å¾„ å­—ç¬¦ä¸²çš„ä¸­é—´çš„.å’Œ..ä»£ç ï¼Œå¹¶è§£æè·¯å¾„å­—ç¬¦ä¸²æ‰€å¼•ç”¨çš„è·¯å¾„ã€‚\n\nPath.normalize()ç¤ºä¾‹:\n```java\nString originalPath = \"d:\\\\atguigu\\\\projects\\\\..\\\\yygh-project\"; \nPath path1 = Paths.get(originalPath); \nSystem.out.println(\"path1 = \" + path1); \nPath path2 = path1.normalize(); \nSystem.out.println(\"path2 = \" + path2);\n```\nè¾“å‡ºç»“æœï¼šæ ‡å‡†åŒ–çš„è·¯å¾„ä¸åŒ…å« projects\\..éƒ¨åˆ†\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/99340617865d41659cbde12e476c8b64.png)\n\n:::\n\n### 2 Files\nJava NIO Files ç±»(java.nio.file.Files)æä¾›äº†å‡ ç§æ“ä½œæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶çš„æ–¹æ³•ã€‚ä»¥ä¸‹ å†…å®¹ä»‹ç» Java NIO Files æœ€å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚java.nio.file.Files ç±»ä¸ java.nio.file.Path å®ä¾‹ä¸€èµ·å·¥ä½œï¼Œå› æ­¤åœ¨å­¦ä¹  Files ç±»ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ Path ç±»ã€‚\n\n#### 2.1 Files.createDirectory()\nFiles.createDirectory()æ–¹æ³•ï¼Œç”¨äºæ ¹æ® Path å®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• \nç¤ºä¾‹ï¼š\n```java\n   	Path path = Paths.get(\"d:\\\\sgg\");  \n   	try {\n            Path newDir = Files.createDirectory(path);\n        } catch (FileAlreadyExistsException e) {\n            // ç›®å½•å·²ç»å­˜åœ¨\n        } catch (IOException e) {\n            // å…¶ä»–å‘ç”Ÿçš„å¼‚å¸¸\n            e.printStackTrace();\n        }\n```\nç¬¬ä¸€è¡Œåˆ›å»ºè¡¨ç¤ºè¦åˆ›å»ºçš„ç›®å½•çš„ Path å®ä¾‹ã€‚åœ¨ try-catch å—ä¸­ï¼Œç”¨è·¯å¾„ä½œä¸ºå‚æ•°è°ƒç”¨ Files.createDirectory()æ–¹æ³•ã€‚å¦‚æœåˆ›å»ºç›®å½•æˆåŠŸï¼Œå°†è¿”å›ä¸€ä¸ª Path å®ä¾‹ï¼Œè¯¥å®ä¾‹æŒ‡ å‘æ–°åˆ›å»ºçš„è·¯å¾„ã€‚\n\nå¦‚æœè¯¥ç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™æ˜¯æŠ›å‡ºä¸€ä¸ª java.nio.file.FileAlreadyExistsExceptionã€‚å¦‚æœ å‡ºç°å…¶ä»–é”™è¯¯ï¼Œå¯èƒ½ä¼šæŠ›å‡º IOExceptionã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦çš„æ–°ç›®å½•çš„çˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œ åˆ™å¯èƒ½ä¼šæŠ›å‡º IOExceptionã€‚\n\n#### 2.2 Files.copy()\n- Files.copy()æ–¹æ³•ä»ä¸€ä¸ªè·¯å¾„æ‹·è´ä¸€ä¸ªæ–‡ä»¶åˆ°å¦å¤–ä¸€ä¸ªç›®å½•\nç¤ºä¾‹ï¼š\n```java\n	Path sourcePath = Paths.get(\"d:\\\\atguigu\\\\01.txt\");\n        Path destinationPath = Paths.get(\"d:\\\\atguigu\\\\002.txt\");\n        try {\n            Files.copy(sourcePath, destinationPath);\n        } catch (FileAlreadyExistsException e) {\n            // ç›®å½•å·²ç»å­˜åœ¨ \n        } catch (IOException e) { // å…¶ä»–å‘ç”Ÿçš„å¼‚å¸¸ \n            e.printStackTrace();\n        }\n```\n\né¦–å…ˆï¼Œè¯¥ç¤ºä¾‹åˆ›å»ºä¸¤ä¸ª Path å®ä¾‹ã€‚ç„¶åï¼Œè¿™ä¸ªä¾‹å­è°ƒç”¨ Files.copy()ï¼Œå°†ä¸¤ä¸ª Path å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è¿™å¯ä»¥è®©æºè·¯å¾„å¼•ç”¨çš„æ–‡ä»¶è¢«å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„å¼•ç”¨çš„æ–‡ä»¶ä¸­ã€‚\n\nå¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª java.nio.file.FileAlreadyExistsException å¼‚å¸¸ã€‚ å¦‚æœæœ‰å…¶ä»–é”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ª IOExceptionã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†è¯¥æ–‡ä»¶å¤åˆ¶åˆ°ä¸å­˜åœ¨çš„ ç›®å½•ï¼Œåˆ™ä¼šæŠ›å‡º IOExceptionã€‚\n- è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶\nFiles.copy()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡ç¤º copy()æ–¹æ³•è¦† ç›–ç°æœ‰çš„æ–‡ä»¶ã€‚\n```java\nFiles.copy(sourcePath, destinationPath, StandardCopyOption.REPLACE_EXISTING);\n```\n#### 2.3 Files.move()\nFiles.move()ç”¨äºå°†æ–‡ä»¶ä»ä¸€ä¸ªè·¯å¾„ç§»åŠ¨åˆ°å¦ä¸€ä¸ªè·¯å¾„ã€‚ç§»åŠ¨æ–‡ä»¶ä¸é‡å‘½åç›¸åŒï¼Œä½†æ˜¯ ç§»åŠ¨æ–‡ä»¶æ—¢å¯ä»¥ç§»åŠ¨åˆ°ä¸åŒçš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥åœ¨ç›¸åŒçš„æ“ä½œä¸­æ›´æ”¹å®ƒçš„åç§°ã€‚\n\nç¤ºä¾‹ï¼š\n```java\n	Path sourcePath = Paths.get(\"d:\\\\atguigu\\\\01.txt\");\n        Path destinationPath = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n        try {\n            Files.move(sourcePath, destinationPath, StandardCopyOption.REPLACE_EXISTING);\n        } catch (IOException e) {\n            //ç§»åŠ¨æ–‡ä»¶å¤±è´¥ \n            e.printStackTrace();\n        }\n```\nFiles.move()çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°å‘Šè¯‰ Files.move()æ–¹æ³•æ¥è¦†ç›–ç›®æ ‡è·¯å¾„ä¸Šçš„ä»»ä½• ç°æœ‰æ–‡ä»¶ã€‚\n\n#### 2.4 Files.delete()\nFiles.delete()æ–¹æ³•å¯ä»¥åˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ã€‚\nç¤ºä¾‹ï¼š\n```java\n	Path path = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n        try {\n            Files.delete(path);\n        } catch (IOException e) {\n            // åˆ é™¤æ–‡ä»¶å¤±è´¥\n            e.printStackTrace();\n        }\n```\nåˆ›å»ºæŒ‡å‘è¦åˆ é™¤çš„æ–‡ä»¶çš„ Pathã€‚ç„¶åè°ƒç”¨ Files.delete()æ–¹æ³•ã€‚å¦‚æœ Files.delete()ä¸ èƒ½åˆ é™¤æ–‡ä»¶(ä¾‹å¦‚ï¼Œæ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨)ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª IOExceptionã€‚\n\n#### 2.5 Files.walkFileTree()\nï¼ˆ1ï¼‰Files.walkFileTree()æ–¹æ³•åŒ…å«é€’å½’éå†ç›®å½•æ ‘åŠŸèƒ½ï¼Œå°† Path å®ä¾‹å’Œ FileVisitor ä½œä¸ºå‚æ•°ã€‚Path å®ä¾‹æŒ‡å‘è¦éå†çš„ç›®å½•ï¼ŒFileVisitor åœ¨éå†æœŸé—´è¢«è°ƒç”¨ã€‚\n\nï¼ˆ2ï¼‰FileVisitor æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¿…é¡»è‡ªå·±å®ç° FileVisitor æ¥å£ï¼Œå¹¶å°†å®ç°çš„å®ä¾‹ä¼ é€’ç»™ walkFileTree()æ–¹æ³•ã€‚åœ¨ç›®å½•éå†è¿‡ç¨‹ä¸­ï¼Œæ‚¨çš„ FileVisitor å®ç°çš„æ¯ä¸ªæ–¹æ³•éƒ½å°†è¢«è°ƒç”¨ã€‚ å¦‚æœä¸éœ€è¦å®ç°æ‰€æœ‰è¿™äº›æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥æ‰©å±• SimpleFileVisitor ç±»ï¼Œå®ƒåŒ…å« FileVisitor æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚\n\nï¼ˆ3ï¼‰FileVisitor æ¥å£çš„æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªéƒ½è¿”å›ä¸€ä¸ª FileVisitResult æšä¸¾å®ä¾‹ã€‚ FileVisitResult æšä¸¾åŒ…å«ä»¥ä¸‹å››ä¸ªé€‰é¡¹\n1. CONTINUE ç»§ç»­\n2. TERMINATE ç»ˆæ­¢\n3. SKIP_SIBLING è·³è¿‡åŒçº§\n4. SKIP_SUBTREE è·³è¿‡å­çº§\n\nï¼ˆ4ï¼‰æŸ¥æ‰¾ä¸€ä¸ªåä¸º 001.txt çš„æ–‡ä»¶ç¤ºä¾‹ï¼š\n```java\npublic static void main(String[] args) {\n        Path rootPath = Paths.get(\"d:\\\\\");\n        String fileToFind = File.separator + \"111.txt\";\n        try {\n            Files.walkFileTree(rootPath,new SimpleFileVisitor<Path>(){\n                @Override\n                public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException {\n                    String fileString = file.toAbsolutePath().toString();\n                    //System.out.println(\"pathString = \" + fileString);\n                    if(fileString.endsWith(fileToFind)){\n                        System.out.println(\"file found at path: \" + file.toAbsolutePath());\n                        return FileVisitResult.TERMINATE;\n                    }\n                    return FileVisitResult.CONTINUE;\n                }\n            });\n        } catch (Exception e){\n            e.printStackTrace();\n        }\n    }\n```\n\n\nï¼ˆ5ï¼‰java.nio.file.Files ç±»åŒ…å«è®¸å¤šå…¶ä»–çš„å‡½æ•°ï¼Œæœ‰å…³è¿™äº›æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ java.nio.file.Files ç±»çš„ JavaDocã€‚\n\n### 3 AsynchronousFileChannel\nåœ¨ Java 7 ä¸­ï¼ŒJava NIO ä¸­æ·»åŠ äº† AsynchronousFileChannelï¼Œä¹Ÿå°±æ˜¯æ˜¯å¼‚æ­¥åœ°å°†æ•° æ®å†™å…¥æ–‡ä»¶ã€‚\n\n#### 3.1 åˆ›å»º AsynchronousFileChannel\né€šè¿‡é™æ€æ–¹æ³• open()åˆ›å»º\nç¤ºä¾‹ï¼š\n```java\npublic static void main(String[] args) {\n        Path path = Paths.get(\"d:\\\\atguigu\\\\01.txt\");\n        try {\n            AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n```\nopen()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å‘ä¸ AsynchronousFileChannel ç›¸å…³è”æ–‡ä»¶çš„ Path å®ä¾‹ã€‚\n\nç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“å¼€é€‰é¡¹ï¼Œå®ƒå‘Šè¯‰ AsynchronousFileChannel åœ¨æ–‡ä»¶ä¸Šæ‰§ è¡Œä»€ä¹ˆæ“ä½œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† StandardOpenOption.READ é€‰é¡¹ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶ å°†è¢«æ‰“å¼€é˜…è¯»ã€‚\n\n#### 3.2 é€šè¿‡ Future è¯»å–æ•°æ®\nå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä» AsynchronousFileChannel è¯»å–æ•°æ®ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯è°ƒç”¨è¿”å› Future çš„ read()æ–¹æ³•\nç¤ºä¾‹ï¼š\n```java\npublic static void main(String[] args) {\n        Path path = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n        AsynchronousFileChannel fileChannel = null;\n        try {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        long position = 0;\n        Future<Integer> operation = fileChannel.read(buffer, position);\n        while (!operation.isDone()) ;\n        buffer.flip();\n        byte[] data = new byte[buffer.limit()];\n        buffer.get(data);\n        System.out.println(new String(data));\n        buffer.clear();\n    }\n```\nä¸Šè¿°ä»£ç ï¼š\nï¼ˆ1ï¼‰åˆ›å»ºäº†ä¸€ä¸ª AsynchronousFileChannelã€‚\nï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª ByteBufferï¼Œå®ƒè¢«ä¼ é€’ç»™ read()æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œä»¥åŠä¸€ä¸ª 0 çš„ä½ç½®ã€‚\nï¼ˆ3ï¼‰åœ¨è°ƒç”¨ read()ä¹‹åï¼Œå¾ªç¯ï¼Œç›´åˆ°è¿”å›çš„ isDone()æ–¹æ³•è¿”å› trueã€‚\nï¼ˆ4ï¼‰è¯»å–æ“ä½œå®Œæˆåï¼Œæ•°æ®è¯»å–åˆ° ByteBuffer ä¸­ï¼Œç„¶åæ‰“å°åˆ° System.out ä¸­ã€‚\n\n#### 3.3 é€šè¿‡ CompletionHandler è¯»å–æ•°æ®\nç¬¬äºŒç§æ–¹æ³•æ˜¯è°ƒç”¨ read()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ä¸ª CompletionHandler ä½œä¸ºå‚æ•°\nç¤ºä¾‹ï¼š\n```java\n    @Test\n    public void test01() {\n        Path path = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n        AsynchronousFileChannel fileChannel = null;\n        try {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        long position = 0;\n        fileChannel.read(buffer, position, buffer, new CompletionHandler<Integer, ByteBuffer>() {\n            @Override\n            public void completed(Integer result, ByteBuffer attachment) {\n                System.out.println(\"result = \" + result);\n                attachment.flip();\n                byte[] data = new byte[attachment.limit()];\n                attachment.get(data);\n                System.out.println(new String(data));\n                attachment.clear();\n            }\n\n            @Override\n            public void failed(Throwable exc, ByteBuffer attachment) {\n            }\n        });\n    }\n```\nï¼ˆ1ï¼‰è¯»å–æ“ä½œå®Œæˆï¼Œå°†è°ƒç”¨ CompletionHandler çš„ completed()æ–¹æ³•ã€‚\nï¼ˆ2ï¼‰å¯¹äº completed()æ–¹æ³•çš„å‚æ•°ä¼ é€’ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬è¯»å–äº†å¤šå°‘å­—èŠ‚ï¼Œä»¥åŠ ä¼ é€’ç»™ read()æ–¹æ³•çš„â€œé™„ä»¶â€ã€‚â€œé™„ä»¶â€æ˜¯ read()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚åœ¨æœ¬ä»£ç ä¸­ï¼Œ å®ƒæ˜¯ ByteBufferï¼Œæ•°æ®ä¹Ÿè¢«è¯»å–ã€‚\nï¼ˆ3ï¼‰å¦‚æœè¯»å–æ“ä½œå¤±è´¥ï¼Œåˆ™å°†è°ƒç”¨ CompletionHandler çš„ failed()æ–¹æ³•ã€‚\n\n#### 3.4 é€šè¿‡ Future å†™æ•°æ®\nå’Œè¯»å–ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†æ•°æ®å†™å…¥ä¸€ä¸ª AsynchronousFileChannel\nç¤ºä¾‹ï¼š\n```java\n    @Test\n    public void test01() {\n        Path path = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n        AsynchronousFileChannel fileChannel = null;\n        try {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        long position = 0;\n        buffer.put(\"atguigu data\".getBytes());\n        buffer.flip();\n        Future<Integer> operation = fileChannel.write(buffer, position);\n        buffer.clear();\n        while (!operation.isDone()) ;\n        System.out.println(\"Write over\");\n    }\n```\né¦–å…ˆï¼ŒAsynchronousFileChannel ä»¥å†™æ¨¡å¼æ‰“å¼€ã€‚ç„¶ååˆ›å»ºä¸€ä¸ª ByteBufferï¼Œå¹¶å°† ä¸€äº›æ•°æ®å†™å…¥å…¶ä¸­ã€‚ç„¶åï¼ŒByteBuffer ä¸­çš„æ•°æ®è¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œç¤ºä¾‹æ£€æŸ¥è¿” å›çš„ Futureï¼Œä»¥æŸ¥çœ‹å†™æ“ä½œå®Œæˆæ—¶çš„æƒ…å†µã€‚\n\næ³¨æ„ï¼Œæ–‡ä»¶å¿…é¡»å·²ç»å­˜åœ¨ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ write()æ–¹æ³•å°†æŠ›å‡ºä¸€ä¸ª java.nio.file.NoSuchFileExceptionã€‚\n\n#### 3.5 é€šè¿‡ CompletionHandler å†™æ•°æ®\nç¤ºä¾‹ï¼š\n```java\n    @Test\n    public void test01() {\n        Path path = Paths.get(\"d:\\\\atguigu\\\\001.txt\");\n        if (!Files.exists(path)) {\n            try {\n                Files.createFile(path);\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n        AsynchronousFileChannel fileChannel = null;\n        try {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        long position = 0;\n        buffer.put(\"atguigu data\".getBytes());\n        buffer.flip();\n        fileChannel.write(buffer, position, buffer, new CompletionHandler<Integer, ByteBuffer>() {\n            @Override\n            public void completed(Integer result, ByteBuffer attachment) {\n                System.out.println(\"bytes written: \" + result);\n            }\n\n            @Override\n            public void failed(Throwable exc, ByteBuffer attachment) {\n                System.out.println(\"Write failed\");\n                exc.printStackTrace();\n            }\n        });\n    }\n```\nå½“å†™æ“ä½œå®Œæˆæ—¶ï¼Œå°†ä¼šè°ƒç”¨ CompletionHandler çš„ completed()æ–¹æ³•ã€‚å¦‚æœå†™å¤±è´¥ï¼Œ åˆ™ä¼šè°ƒç”¨ failed()æ–¹æ³•ã€‚\n\n### 4 å­—ç¬¦é›†ï¼ˆCharsetï¼‰\njava ä¸­ä½¿ç”¨ Charset æ¥è¡¨ç¤ºå­—ç¬¦é›†ç¼–ç å¯¹è±¡\n\nCharset å¸¸ç”¨é™æ€æ–¹æ³•\n```java\npublic static Charset forName(String charsetName)//é€šè¿‡ç¼–ç ç±»å‹è·å¾— Charset å¯¹ è±¡\n```\n```java\npublic static SortedMap<String,Charset> availableCharsets()//è·å¾—ç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰ ç¼–ç æ–¹å¼\n```\n```java\npublic static Charset defaultCharset()//è·å¾—è™šæ‹Ÿæœºé»˜è®¤çš„ç¼–ç æ–¹å¼\n```\n```java\npublic static boolean isSupported(String charsetName)//åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥ç¼–ç ç±»å‹\n```\n\n\nCharset å¸¸ç”¨æ™®é€šæ–¹æ³•\n```java\npublic final String name()//è·å¾— Charset å¯¹è±¡çš„ç¼–ç ç±»å‹(String)\n```\n\n\n```java\npublic abstract CharsetEncoder newEncoder()//è·å¾—ç¼–ç å™¨å¯¹è±¡\n```\n\n```java\npublic abstract CharsetDecoder newDecoder()//è·å¾—è§£ç å™¨å¯¹è±¡\n```\nä»£ç ç¤ºä¾‹ï¼š\n\n```java\npublic static void main(String[] args) throws Exception {\n        // è·å–CharSetå¯¹è±¡\n        Charset charset = Charset.forName(\"UTF-8\");\n        //è·å–ç¼–ç å™¨å¯¹è±¡\n        CharsetEncoder charsetEncoder = charset.newEncoder();\n        //åˆ›å»ºç¼“å†²åŒº\n        CharBuffer charBuffer = CharBuffer.allocate(1024);\n        charBuffer.put(\"jzjæ¼«æ¼«é•¿è·¯\");\n        charBuffer.flip();\n        //ç¼–ç \n        ByteBuffer byteBuffer = charsetEncoder.encode(charBuffer);\n        System.out.println(\"ç¼–ç ä¹‹åç»“æœï¼š\");\n        for (int i = 0; i < byteBuffer.limit(); i++) {\n            System.out.println(byteBuffer.get());\n        }\n        //è·å–è§£ç å™¨å¯¹è±¡\n        byteBuffer.flip();\n        CharsetDecoder charsetDecoder = charset.newDecoder();\n        //è§£ç \n        CharBuffer decode = charsetDecoder.decode(byteBuffer);\n        System.out.println(\"è§£ç åï¼š\");\n        System.out.println(decode.toString());\n        //ä½¿ç”¨GBKè§£ç \n        Charset charset1 = Charset.forName(\"GBK\");\n        byteBuffer.flip();\n        CharBuffer charBuffer2 = charset1.decode(byteBuffer);\n        System.out.println(\"ä½¿ç”¨å…¶ä»–ç¼–ç è¿›è¡Œè§£ç ï¼š\");\n        System.out.println(charBuffer2);\n\n        //è·å–CharSetæ‰€æ”¯æŒçš„å­—ç¬¦ç¼–ç \n        Map<String, Charset> map = Charset.availableCharsets();\n        Set<Map.Entry<String, Charset>> set = map.entrySet();\n        for (Map.Entry<String, Charset> entry : set) {\n            System.out.println(entry.getKey()+\"=\"+entry.getValue().toString());\n        }\n    }\n```\n', '2022-10-09 17:29:00', '2022-10-12 11:30:16', '<h3><a id=\"1_Path_0\"></a>1 Path</h3>\n<h4><a id=\"11_Path__1\"></a>1.1 Path ç®€ä»‹</h4>\n<p>Java Path æ¥å£æ˜¯ Java NIO æ›´æ–°çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ Java NIO ä¸€èµ·å·²ç»åŒ…æ‹¬åœ¨ Java6 å’Œ Java7 ä¸­ã€‚Java Path æ¥å£æ˜¯åœ¨ Java7 ä¸­æ·»åŠ åˆ° Java NIO çš„ã€‚Path æ¥å£ä½äº java.nio.file åŒ…ä¸­ï¼Œæ‰€ä»¥ Path æ¥å£çš„å®Œå…¨é™å®šåç§°ä¸º java.nio.file.Pathã€‚</p>\n<p>Java Path å®ä¾‹è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ã€‚ä¸€ä¸ªè·¯å¾„å¯ä»¥æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªç›®å½•ã€‚è·¯å¾„ å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚ç»å¯¹è·¯å¾„åŒ…å«ä»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•åˆ°å®ƒæŒ‡å‘çš„ æ–‡ä»¶æˆ–ç›®å½•çš„å®Œæ•´è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„åŒ…å«ç›¸å¯¹äºå…¶ä»–è·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚</p>\n<p>åœ¨è®¸å¤šæ–¹é¢ï¼Œjava.nio.file.Path æ¥å£ç±»ä¼¼äº java.io.File ç±»ï¼Œä½†æ˜¯æœ‰ä¸€äº›å·®åˆ«ã€‚ä¸è¿‡ï¼Œ åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Path æ¥å£æ¥æ›¿æ¢ File ç±»çš„ä½¿ç”¨ã€‚</p>\n<h4><a id=\"12__Path__8\"></a>1.2 åˆ›å»º Path å®ä¾‹</h4>\n<p>ä½¿ç”¨ java.nio.file.Path å®ä¾‹å¿…é¡»åˆ›å»ºä¸€ä¸ª Path å®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨ Paths ç±» (java.nio.file.Paths)ä¸­çš„é™æ€æ–¹æ³• Paths.get()æ¥åˆ›å»ºè·¯å¾„å®ä¾‹ã€‚</p>\n<p>ç¤ºä¾‹ä»£ç :</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-comment\">//åˆ›å»ºPathå®ä¾‹</span>\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>);\n    }\n</code></div></pre>\n<p>ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥ç†è§£ä¸ºï¼ŒPaths.get()æ–¹æ³•æ˜¯ Path å®ä¾‹çš„å·¥å‚æ–¹æ³•ã€‚</p>\n<h4><a id=\"13__22\"></a>1.3 åˆ›å»ºç»å¯¹è·¯å¾„</h4>\n<p>ï¼ˆ1ï¼‰åˆ›å»ºç»å¯¹è·¯å¾„ï¼Œé€šè¿‡è°ƒç”¨ Paths.get()æ–¹æ³•ï¼Œç»™å®šç»å¯¹è·¯å¾„æ–‡ä»¶ä½œä¸ºå‚æ•°æ¥å®Œæˆã€‚</p>\n<p>ç¤ºä¾‹ä»£ç ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n</code></div></pre>\n<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œç»å¯¹è·¯å¾„æ˜¯ d:\\atguigu\\001.txtã€‚åœ¨ Java å­—ç¬¦ä¸²ä¸­ï¼Œ \\æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œ éœ€è¦ç¼–å†™\\ï¼Œå‘Šè¯‰ Java ç¼–è¯‘å™¨åœ¨å­—ç¬¦ä¸²ä¸­å†™å…¥ä¸€ä¸ª\\å­—ç¬¦ã€‚</p>\n<p>ï¼ˆ2ï¼‰å¦‚æœåœ¨ Linuxã€MacOS ç­‰æ“ä½œå­—ä½“ä¸Šï¼Œä¸Šé¢çš„ç»å¯¹è·¯å¾„å¯èƒ½å¦‚ä¸‹:</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;/home/jakobjenkov/myfile.txt&quot;</span>);\n</code></div></pre>\n<p>ç»å¯¹è·¯å¾„ç°åœ¨ä¸º/home/jakobjenkov/myfile.txt.</p>\n<p>ï¼ˆ3ï¼‰å¦‚æœåœ¨ Windows æœºå™¨ä¸Šä½¿ç”¨äº†ä»/å¼€å§‹çš„è·¯å¾„ï¼Œé‚£ä¹ˆè·¯å¾„å°†è¢«è§£é‡Šä¸ºç›¸å¯¹äºå½“ å‰é©±åŠ¨å™¨ã€‚</p>\n<h4><a id=\"14__42\"></a>1.4 åˆ›å»ºç›¸å¯¹è·¯å¾„</h4>\n<p>Java NIO Path ç±»ä¹Ÿå¯ä»¥ç”¨äºå¤„ç†ç›¸å¯¹è·¯å¾„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ Paths.get(basePath, relativePath)æ–¹æ³•åˆ›å»ºä¸€ä¸ªç›¸å¯¹è·¯å¾„ã€‚</p>\n<p>ç¤ºä¾‹ä»£ç :</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//ä»£ç  1 </span>\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">projects</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu&quot;</span>, <span class=\"hljs-string\">&quot;projects&quot;</span>); \n<span class=\"hljs-comment\">//ä»£ç  2 </span>\n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">file</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu&quot;</span>, <span class=\"hljs-string\">&quot;projects\\\\002.txt&quot;</span>);\n</code></div></pre>\n<p>ä»£ç  1 åˆ›å»ºäº†ä¸€ä¸ª Java Path çš„å®ä¾‹ï¼ŒæŒ‡å‘è·¯å¾„(ç›®å½•):d:\\atguigu\\projects<br />\nä»£ç  2 åˆ›å»ºäº†ä¸€ä¸ª Path çš„å®ä¾‹ï¼ŒæŒ‡å‘è·¯å¾„(æ–‡ä»¶):d:\\atguigu\\projects\\002.txt</p>\n<h4><a id=\"15_Pathnormalize_56\"></a>1.5 Path.normalize()</h4>\n<p>Path æ¥å£çš„ normalize()æ–¹æ³•å¯ä»¥ä½¿è·¯å¾„æ ‡å‡†åŒ–ã€‚æ ‡å‡†åŒ–æ„å‘³ç€å®ƒå°†ç§»é™¤æ‰€æœ‰åœ¨è·¯å¾„ å­—ç¬¦ä¸²çš„ä¸­é—´çš„.å’Œâ€¦ä»£ç ï¼Œå¹¶è§£æè·¯å¾„å­—ç¬¦ä¸²æ‰€å¼•ç”¨çš„è·¯å¾„ã€‚</p>\n<p>Path.normalize()ç¤ºä¾‹:</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">originalPath</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\projects\\\\..\\\\yygh-project&quot;</span>; \n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path1</span> <span class=\"hljs-operator\">=</span> Paths.get(originalPath); \nSystem.out.println(<span class=\"hljs-string\">&quot;path1 = &quot;</span> + path1); \n<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path2</span> <span class=\"hljs-operator\">=</span> path1.normalize(); \nSystem.out.println(<span class=\"hljs-string\">&quot;path2 = &quot;</span> + path2);\n</code></div></pre>\n<p>è¾“å‡ºç»“æœï¼šæ ‡å‡†åŒ–çš„è·¯å¾„ä¸åŒ…å« projectsâ€¦éƒ¨åˆ†</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/99340617865d41659cbde12e476c8b64.png\" alt=\"image.png\" /></p>\n</div>\n<h3><a id=\"2_Files_74\"></a>2 Files</h3>\n<p>Java NIO Files ç±»(java.nio.file.Files)æä¾›äº†å‡ ç§æ“ä½œæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶çš„æ–¹æ³•ã€‚ä»¥ä¸‹ å†…å®¹ä»‹ç» Java NIO Files æœ€å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚java.nio.file.Files ç±»ä¸ java.nio.file.Path å®ä¾‹ä¸€èµ·å·¥ä½œï¼Œå› æ­¤åœ¨å­¦ä¹  Files ç±»ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ Path ç±»ã€‚</p>\n<h4><a id=\"21_FilescreateDirectory_77\"></a>2.1 Files.createDirectory()</h4>\n<p>Files.createDirectory()æ–¹æ³•ï¼Œç”¨äºæ ¹æ® Path å®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•<br />\nç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">   	<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\sgg&quot;</span>);  \n   	<span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">newDir</span> <span class=\"hljs-operator\">=</span> Files.createDirectory(path);\n        } <span class=\"hljs-keyword\">catch</span> (FileAlreadyExistsException e) {\n            <span class=\"hljs-comment\">// ç›®å½•å·²ç»å­˜åœ¨</span>\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            <span class=\"hljs-comment\">// å…¶ä»–å‘ç”Ÿçš„å¼‚å¸¸</span>\n            e.printStackTrace();\n        }\n</code></div></pre>\n<p>ç¬¬ä¸€è¡Œåˆ›å»ºè¡¨ç¤ºè¦åˆ›å»ºçš„ç›®å½•çš„ Path å®ä¾‹ã€‚åœ¨ try-catch å—ä¸­ï¼Œç”¨è·¯å¾„ä½œä¸ºå‚æ•°è°ƒç”¨ Files.createDirectory()æ–¹æ³•ã€‚å¦‚æœåˆ›å»ºç›®å½•æˆåŠŸï¼Œå°†è¿”å›ä¸€ä¸ª Path å®ä¾‹ï¼Œè¯¥å®ä¾‹æŒ‡ å‘æ–°åˆ›å»ºçš„è·¯å¾„ã€‚</p>\n<p>å¦‚æœè¯¥ç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™æ˜¯æŠ›å‡ºä¸€ä¸ª java.nio.file.FileAlreadyExistsExceptionã€‚å¦‚æœ å‡ºç°å…¶ä»–é”™è¯¯ï¼Œå¯èƒ½ä¼šæŠ›å‡º IOExceptionã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦çš„æ–°ç›®å½•çš„çˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œ åˆ™å¯èƒ½ä¼šæŠ›å‡º IOExceptionã€‚</p>\n<h4><a id=\"22_Filescopy_95\"></a>2.2 Files.copy()</h4>\n<ul>\n<li>Files.copy()æ–¹æ³•ä»ä¸€ä¸ªè·¯å¾„æ‹·è´ä¸€ä¸ªæ–‡ä»¶åˆ°å¦å¤–ä¸€ä¸ªç›®å½•<br />\nç¤ºä¾‹ï¼š</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\">	<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">sourcePath</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\01.txt&quot;</span>);\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">destinationPath</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\002.txt&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            Files.copy(sourcePath, destinationPath);\n        } <span class=\"hljs-keyword\">catch</span> (FileAlreadyExistsException e) {\n            <span class=\"hljs-comment\">// ç›®å½•å·²ç»å­˜åœ¨ </span>\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) { <span class=\"hljs-comment\">// å…¶ä»–å‘ç”Ÿçš„å¼‚å¸¸ </span>\n            e.printStackTrace();\n        }\n</code></div></pre>\n<p>é¦–å…ˆï¼Œè¯¥ç¤ºä¾‹åˆ›å»ºä¸¤ä¸ª Path å®ä¾‹ã€‚ç„¶åï¼Œè¿™ä¸ªä¾‹å­è°ƒç”¨ Files.copy()ï¼Œå°†ä¸¤ä¸ª Path å®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è¿™å¯ä»¥è®©æºè·¯å¾„å¼•ç”¨çš„æ–‡ä»¶è¢«å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„å¼•ç”¨çš„æ–‡ä»¶ä¸­ã€‚</p>\n<p>å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ª java.nio.file.FileAlreadyExistsException å¼‚å¸¸ã€‚ å¦‚æœæœ‰å…¶ä»–é”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ª IOExceptionã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†è¯¥æ–‡ä»¶å¤åˆ¶åˆ°ä¸å­˜åœ¨çš„ ç›®å½•ï¼Œåˆ™ä¼šæŠ›å‡º IOExceptionã€‚</p>\n<ul>\n<li>è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶<br />\nFiles.copy()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡ç¤º copy()æ–¹æ³•è¦† ç›–ç°æœ‰çš„æ–‡ä»¶ã€‚</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\">Files.copy(sourcePath, destinationPath, StandardCopyOption.REPLACE_EXISTING);\n</code></div></pre>\n<h4><a id=\"23_Filesmove_118\"></a>2.3 Files.move()</h4>\n<p>Files.move()ç”¨äºå°†æ–‡ä»¶ä»ä¸€ä¸ªè·¯å¾„ç§»åŠ¨åˆ°å¦ä¸€ä¸ªè·¯å¾„ã€‚ç§»åŠ¨æ–‡ä»¶ä¸é‡å‘½åç›¸åŒï¼Œä½†æ˜¯ ç§»åŠ¨æ–‡ä»¶æ—¢å¯ä»¥ç§»åŠ¨åˆ°ä¸åŒçš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥åœ¨ç›¸åŒçš„æ“ä½œä¸­æ›´æ”¹å®ƒçš„åç§°ã€‚</p>\n<p>ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">	<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">sourcePath</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\01.txt&quot;</span>);\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">destinationPath</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            Files.move(sourcePath, destinationPath, StandardCopyOption.REPLACE_EXISTING);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            <span class=\"hljs-comment\">//ç§»åŠ¨æ–‡ä»¶å¤±è´¥ </span>\n            e.printStackTrace();\n        }\n</code></div></pre>\n<p>Files.move()çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°å‘Šè¯‰ Files.move()æ–¹æ³•æ¥è¦†ç›–ç›®æ ‡è·¯å¾„ä¸Šçš„ä»»ä½• ç°æœ‰æ–‡ä»¶ã€‚</p>\n<h4><a id=\"24_Filesdelete_134\"></a>2.4 Files.delete()</h4>\n<p>Files.delete()æ–¹æ³•å¯ä»¥åˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ã€‚<br />\nç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">	<span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            Files.delete(path);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            <span class=\"hljs-comment\">// åˆ é™¤æ–‡ä»¶å¤±è´¥</span>\n            e.printStackTrace();\n        }\n</code></div></pre>\n<p>åˆ›å»ºæŒ‡å‘è¦åˆ é™¤çš„æ–‡ä»¶çš„ Pathã€‚ç„¶åè°ƒç”¨ Files.delete()æ–¹æ³•ã€‚å¦‚æœ Files.delete()ä¸ èƒ½åˆ é™¤æ–‡ä»¶(ä¾‹å¦‚ï¼Œæ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨)ï¼Œä¼šæŠ›å‡ºä¸€ä¸ª IOExceptionã€‚</p>\n<h4><a id=\"25_FileswalkFileTree_148\"></a>2.5 Files.walkFileTree()</h4>\n<p>ï¼ˆ1ï¼‰Files.walkFileTree()æ–¹æ³•åŒ…å«é€’å½’éå†ç›®å½•æ ‘åŠŸèƒ½ï¼Œå°† Path å®ä¾‹å’Œ FileVisitor ä½œä¸ºå‚æ•°ã€‚Path å®ä¾‹æŒ‡å‘è¦éå†çš„ç›®å½•ï¼ŒFileVisitor åœ¨éå†æœŸé—´è¢«è°ƒç”¨ã€‚</p>\n<p>ï¼ˆ2ï¼‰FileVisitor æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¿…é¡»è‡ªå·±å®ç° FileVisitor æ¥å£ï¼Œå¹¶å°†å®ç°çš„å®ä¾‹ä¼ é€’ç»™ walkFileTree()æ–¹æ³•ã€‚åœ¨ç›®å½•éå†è¿‡ç¨‹ä¸­ï¼Œæ‚¨çš„ FileVisitor å®ç°çš„æ¯ä¸ªæ–¹æ³•éƒ½å°†è¢«è°ƒç”¨ã€‚ å¦‚æœä¸éœ€è¦å®ç°æ‰€æœ‰è¿™äº›æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥æ‰©å±• SimpleFileVisitor ç±»ï¼Œå®ƒåŒ…å« FileVisitor æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚</p>\n<p>ï¼ˆ3ï¼‰FileVisitor æ¥å£çš„æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªéƒ½è¿”å›ä¸€ä¸ª FileVisitResult æšä¸¾å®ä¾‹ã€‚ FileVisitResult æšä¸¾åŒ…å«ä»¥ä¸‹å››ä¸ªé€‰é¡¹</p>\n<ol>\n<li>CONTINUE ç»§ç»­</li>\n<li>TERMINATE ç»ˆæ­¢</li>\n<li>SKIP_SIBLING è·³è¿‡åŒçº§</li>\n<li>SKIP_SUBTREE è·³è¿‡å­çº§</li>\n</ol>\n<p>ï¼ˆ4ï¼‰æŸ¥æ‰¾ä¸€ä¸ªåä¸º 001.txt çš„æ–‡ä»¶ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">rootPath</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\&quot;</span>);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">fileToFind</span> <span class=\"hljs-operator\">=</span> File.separator + <span class=\"hljs-string\">&quot;111.txt&quot;</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            Files.walkFileTree(rootPath,<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">SimpleFileVisitor</span>&lt;Path&gt;(){\n                <span class=\"hljs-meta\">@Override</span>\n                <span class=\"hljs-keyword\">public</span> FileVisitResult <span class=\"hljs-title function_\">visitFile</span><span class=\"hljs-params\">(Path file, BasicFileAttributes attrs)</span> <span class=\"hljs-keyword\">throws</span> IOException {\n                    <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">fileString</span> <span class=\"hljs-operator\">=</span> file.toAbsolutePath().toString();\n                    <span class=\"hljs-comment\">//System.out.println(&quot;pathString = &quot; + fileString);</span>\n                    <span class=\"hljs-keyword\">if</span>(fileString.endsWith(fileToFind)){\n                        System.out.println(<span class=\"hljs-string\">&quot;file found at path: &quot;</span> + file.toAbsolutePath());\n                        <span class=\"hljs-keyword\">return</span> FileVisitResult.TERMINATE;\n                    }\n                    <span class=\"hljs-keyword\">return</span> FileVisitResult.CONTINUE;\n                }\n            });\n        } <span class=\"hljs-keyword\">catch</span> (Exception e){\n            e.printStackTrace();\n        }\n    }\n</code></div></pre>\n<p>ï¼ˆ5ï¼‰java.nio.file.Files ç±»åŒ…å«è®¸å¤šå…¶ä»–çš„å‡½æ•°ï¼Œæœ‰å…³è¿™äº›æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ java.nio.file.Files ç±»çš„ JavaDocã€‚</p>\n<h3><a id=\"3_AsynchronousFileChannel_186\"></a>3 AsynchronousFileChannel</h3>\n<p>åœ¨ Java 7 ä¸­ï¼ŒJava NIO ä¸­æ·»åŠ äº† AsynchronousFileChannelï¼Œä¹Ÿå°±æ˜¯æ˜¯å¼‚æ­¥åœ°å°†æ•° æ®å†™å…¥æ–‡ä»¶ã€‚</p>\n<h4><a id=\"31__AsynchronousFileChannel_189\"></a>3.1 åˆ›å»º AsynchronousFileChannel</h4>\n<p>é€šè¿‡é™æ€æ–¹æ³• open()åˆ›å»º<br />\nç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\01.txt&quot;</span>);\n        <span class=\"hljs-keyword\">try</span> {\n            <span class=\"hljs-type\">AsynchronousFileChannel</span> <span class=\"hljs-variable\">fileChannel</span> <span class=\"hljs-operator\">=</span> AsynchronousFileChannel.open(path, StandardOpenOption.READ);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            e.printStackTrace();\n        }\n    }\n</code></div></pre>\n<p>open()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å‘ä¸ AsynchronousFileChannel ç›¸å…³è”æ–‡ä»¶çš„ Path å®ä¾‹ã€‚</p>\n<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“å¼€é€‰é¡¹ï¼Œå®ƒå‘Šè¯‰ AsynchronousFileChannel åœ¨æ–‡ä»¶ä¸Šæ‰§ è¡Œä»€ä¹ˆæ“ä½œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† StandardOpenOption.READ é€‰é¡¹ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶ å°†è¢«æ‰“å¼€é˜…è¯»ã€‚</p>\n<h4><a id=\"32__Future__206\"></a>3.2 é€šè¿‡ Future è¯»å–æ•°æ®</h4>\n<p>å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä» AsynchronousFileChannel è¯»å–æ•°æ®ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯è°ƒç”¨è¿”å› Future çš„ read()æ–¹æ³•<br />\nç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> {\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n        <span class=\"hljs-type\">AsynchronousFileChannel</span> <span class=\"hljs-variable\">fileChannel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            e.printStackTrace();\n        }\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">position</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        Future&lt;Integer&gt; operation = fileChannel.read(buffer, position);\n        <span class=\"hljs-keyword\">while</span> (!operation.isDone()) ;\n        buffer.flip();\n        <span class=\"hljs-type\">byte</span>[] data = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[buffer.limit()];\n        buffer.get(data);\n        System.out.println(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(data));\n        buffer.clear();\n    }\n</code></div></pre>\n<p>ä¸Šè¿°ä»£ç ï¼š<br />\nï¼ˆ1ï¼‰åˆ›å»ºäº†ä¸€ä¸ª AsynchronousFileChannelã€‚<br />\nï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ª ByteBufferï¼Œå®ƒè¢«ä¼ é€’ç»™ read()æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œä»¥åŠä¸€ä¸ª 0 çš„ä½ç½®ã€‚<br />\nï¼ˆ3ï¼‰åœ¨è°ƒç”¨ read()ä¹‹åï¼Œå¾ªç¯ï¼Œç›´åˆ°è¿”å›çš„ isDone()æ–¹æ³•è¿”å› trueã€‚<br />\nï¼ˆ4ï¼‰è¯»å–æ“ä½œå®Œæˆåï¼Œæ•°æ®è¯»å–åˆ° ByteBuffer ä¸­ï¼Œç„¶åæ‰“å°åˆ° System.out ä¸­ã€‚</p>\n<h4><a id=\"33__CompletionHandler__235\"></a>3.3 é€šè¿‡ CompletionHandler è¯»å–æ•°æ®</h4>\n<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯è°ƒç”¨ read()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ä¸ª CompletionHandler ä½œä¸ºå‚æ•°<br />\nç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test01</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n        <span class=\"hljs-type\">AsynchronousFileChannel</span> <span class=\"hljs-variable\">fileChannel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            e.printStackTrace();\n        }\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">position</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        fileChannel.read(buffer, position, buffer, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CompletionHandler</span>&lt;Integer, ByteBuffer&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">completed</span><span class=\"hljs-params\">(Integer result, ByteBuffer attachment)</span> {\n                System.out.println(<span class=\"hljs-string\">&quot;result = &quot;</span> + result);\n                attachment.flip();\n                <span class=\"hljs-type\">byte</span>[] data = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">byte</span>[attachment.limit()];\n                attachment.get(data);\n                System.out.println(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(data));\n                attachment.clear();\n            }\n\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">failed</span><span class=\"hljs-params\">(Throwable exc, ByteBuffer attachment)</span> {\n            }\n        });\n    }\n</code></div></pre>\n<p>ï¼ˆ1ï¼‰è¯»å–æ“ä½œå®Œæˆï¼Œå°†è°ƒç”¨ CompletionHandler çš„ completed()æ–¹æ³•ã€‚<br />\nï¼ˆ2ï¼‰å¯¹äº completed()æ–¹æ³•çš„å‚æ•°ä¼ é€’ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬è¯»å–äº†å¤šå°‘å­—èŠ‚ï¼Œä»¥åŠ ä¼ é€’ç»™ read()æ–¹æ³•çš„â€œé™„ä»¶â€ã€‚â€œé™„ä»¶â€æ˜¯ read()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚åœ¨æœ¬ä»£ç ä¸­ï¼Œ å®ƒæ˜¯ ByteBufferï¼Œæ•°æ®ä¹Ÿè¢«è¯»å–ã€‚<br />\nï¼ˆ3ï¼‰å¦‚æœè¯»å–æ“ä½œå¤±è´¥ï¼Œåˆ™å°†è°ƒç”¨ CompletionHandler çš„ failed()æ–¹æ³•ã€‚</p>\n<h4><a id=\"34__Future__271\"></a>3.4 é€šè¿‡ Future å†™æ•°æ®</h4>\n<p>å’Œè¯»å–ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†æ•°æ®å†™å…¥ä¸€ä¸ª AsynchronousFileChannel<br />\nç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test01</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n        <span class=\"hljs-type\">AsynchronousFileChannel</span> <span class=\"hljs-variable\">fileChannel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            e.printStackTrace();\n        }\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">position</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        buffer.put(<span class=\"hljs-string\">&quot;atguigu data&quot;</span>.getBytes());\n        buffer.flip();\n        Future&lt;Integer&gt; operation = fileChannel.write(buffer, position);\n        buffer.clear();\n        <span class=\"hljs-keyword\">while</span> (!operation.isDone()) ;\n        System.out.println(<span class=\"hljs-string\">&quot;Write over&quot;</span>);\n    }\n</code></div></pre>\n<p>é¦–å…ˆï¼ŒAsynchronousFileChannel ä»¥å†™æ¨¡å¼æ‰“å¼€ã€‚ç„¶ååˆ›å»ºä¸€ä¸ª ByteBufferï¼Œå¹¶å°† ä¸€äº›æ•°æ®å†™å…¥å…¶ä¸­ã€‚ç„¶åï¼ŒByteBuffer ä¸­çš„æ•°æ®è¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œç¤ºä¾‹æ£€æŸ¥è¿” å›çš„ Futureï¼Œä»¥æŸ¥çœ‹å†™æ“ä½œå®Œæˆæ—¶çš„æƒ…å†µã€‚</p>\n<p>æ³¨æ„ï¼Œæ–‡ä»¶å¿…é¡»å·²ç»å­˜åœ¨ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ write()æ–¹æ³•å°†æŠ›å‡ºä¸€ä¸ª java.nio.file.NoSuchFileExceptionã€‚</p>\n<h4><a id=\"35__CompletionHandler__298\"></a>3.5 é€šè¿‡ CompletionHandler å†™æ•°æ®</h4>\n<p>ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test01</span><span class=\"hljs-params\">()</span> {\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(<span class=\"hljs-string\">&quot;d:\\\\atguigu\\\\001.txt&quot;</span>);\n        <span class=\"hljs-keyword\">if</span> (!Files.exists(path)) {\n            <span class=\"hljs-keyword\">try</span> {\n                Files.createFile(path);\n            } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n                e.printStackTrace();\n            }\n        }\n        <span class=\"hljs-type\">AsynchronousFileChannel</span> <span class=\"hljs-variable\">fileChannel</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-literal\">null</span>;\n        <span class=\"hljs-keyword\">try</span> {\n            fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE);\n        } <span class=\"hljs-keyword\">catch</span> (IOException e) {\n            e.printStackTrace();\n        }\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">position</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        buffer.put(<span class=\"hljs-string\">&quot;atguigu data&quot;</span>.getBytes());\n        buffer.flip();\n        fileChannel.write(buffer, position, buffer, <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">CompletionHandler</span>&lt;Integer, ByteBuffer&gt;() {\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">completed</span><span class=\"hljs-params\">(Integer result, ByteBuffer attachment)</span> {\n                System.out.println(<span class=\"hljs-string\">&quot;bytes written: &quot;</span> + result);\n            }\n\n            <span class=\"hljs-meta\">@Override</span>\n            <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">failed</span><span class=\"hljs-params\">(Throwable exc, ByteBuffer attachment)</span> {\n                System.out.println(<span class=\"hljs-string\">&quot;Write failed&quot;</span>);\n                exc.printStackTrace();\n            }\n        });\n    }\n</code></div></pre>\n<p>å½“å†™æ“ä½œå®Œæˆæ—¶ï¼Œå°†ä¼šè°ƒç”¨ CompletionHandler çš„ completed()æ–¹æ³•ã€‚å¦‚æœå†™å¤±è´¥ï¼Œ åˆ™ä¼šè°ƒç”¨ failed()æ–¹æ³•ã€‚</p>\n<h3><a id=\"4_Charset_337\"></a>4 å­—ç¬¦é›†ï¼ˆCharsetï¼‰</h3>\n<p>java ä¸­ä½¿ç”¨ Charset æ¥è¡¨ç¤ºå­—ç¬¦é›†ç¼–ç å¯¹è±¡</p>\n<p>Charset å¸¸ç”¨é™æ€æ–¹æ³•</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> Charset <span class=\"hljs-title function_\">forName</span><span class=\"hljs-params\">(String charsetName)</span><span class=\"hljs-comment\">//é€šè¿‡ç¼–ç ç±»å‹è·å¾— Charset å¯¹ è±¡</span>\n</code></div></pre>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> SortedMap&lt;String,Charset&gt; <span class=\"hljs-title function_\">availableCharsets</span><span class=\"hljs-params\">()</span><span class=\"hljs-comment\">//è·å¾—ç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰ ç¼–ç æ–¹å¼</span>\n</code></div></pre>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> Charset <span class=\"hljs-title function_\">defaultCharset</span><span class=\"hljs-params\">()</span><span class=\"hljs-comment\">//è·å¾—è™šæ‹Ÿæœºé»˜è®¤çš„ç¼–ç æ–¹å¼</span>\n</code></div></pre>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isSupported</span><span class=\"hljs-params\">(String charsetName)</span><span class=\"hljs-comment\">//åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥ç¼–ç ç±»å‹</span>\n</code></div></pre>\n<p>Charset å¸¸ç”¨æ™®é€šæ–¹æ³•</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">final</span> String <span class=\"hljs-title function_\">name</span><span class=\"hljs-params\">()</span><span class=\"hljs-comment\">//è·å¾— Charset å¯¹è±¡çš„ç¼–ç ç±»å‹(String)</span>\n</code></div></pre>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> CharsetEncoder <span class=\"hljs-title function_\">newEncoder</span><span class=\"hljs-params\">()</span><span class=\"hljs-comment\">//è·å¾—ç¼–ç å™¨å¯¹è±¡</span>\n</code></div></pre>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> CharsetDecoder <span class=\"hljs-title function_\">newDecoder</span><span class=\"hljs-params\">()</span><span class=\"hljs-comment\">//è·å¾—è§£ç å™¨å¯¹è±¡</span>\n</code></div></pre>\n<p>ä»£ç ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">// è·å–CharSetå¯¹è±¡</span>\n        <span class=\"hljs-type\">Charset</span> <span class=\"hljs-variable\">charset</span> <span class=\"hljs-operator\">=</span> Charset.forName(<span class=\"hljs-string\">&quot;UTF-8&quot;</span>);\n        <span class=\"hljs-comment\">//è·å–ç¼–ç å™¨å¯¹è±¡</span>\n        <span class=\"hljs-type\">CharsetEncoder</span> <span class=\"hljs-variable\">charsetEncoder</span> <span class=\"hljs-operator\">=</span> charset.newEncoder();\n        <span class=\"hljs-comment\">//åˆ›å»ºç¼“å†²åŒº</span>\n        <span class=\"hljs-type\">CharBuffer</span> <span class=\"hljs-variable\">charBuffer</span> <span class=\"hljs-operator\">=</span> CharBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        charBuffer.put(<span class=\"hljs-string\">&quot;jzjæ¼«æ¼«é•¿è·¯&quot;</span>);\n        charBuffer.flip();\n        <span class=\"hljs-comment\">//ç¼–ç </span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> charsetEncoder.encode(charBuffer);\n        System.out.println(<span class=\"hljs-string\">&quot;ç¼–ç ä¹‹åç»“æœï¼š&quot;</span>);\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; byteBuffer.limit(); i++) {\n            System.out.println(byteBuffer.get());\n        }\n        <span class=\"hljs-comment\">//è·å–è§£ç å™¨å¯¹è±¡</span>\n        byteBuffer.flip();\n        <span class=\"hljs-type\">CharsetDecoder</span> <span class=\"hljs-variable\">charsetDecoder</span> <span class=\"hljs-operator\">=</span> charset.newDecoder();\n        <span class=\"hljs-comment\">//è§£ç </span>\n        <span class=\"hljs-type\">CharBuffer</span> <span class=\"hljs-variable\">decode</span> <span class=\"hljs-operator\">=</span> charsetDecoder.decode(byteBuffer);\n        System.out.println(<span class=\"hljs-string\">&quot;è§£ç åï¼š&quot;</span>);\n        System.out.println(decode.toString());\n        <span class=\"hljs-comment\">//ä½¿ç”¨GBKè§£ç </span>\n        <span class=\"hljs-type\">Charset</span> <span class=\"hljs-variable\">charset1</span> <span class=\"hljs-operator\">=</span> Charset.forName(<span class=\"hljs-string\">&quot;GBK&quot;</span>);\n        byteBuffer.flip();\n        <span class=\"hljs-type\">CharBuffer</span> <span class=\"hljs-variable\">charBuffer2</span> <span class=\"hljs-operator\">=</span> charset1.decode(byteBuffer);\n        System.out.println(<span class=\"hljs-string\">&quot;ä½¿ç”¨å…¶ä»–ç¼–ç è¿›è¡Œè§£ç ï¼š&quot;</span>);\n        System.out.println(charBuffer2);\n\n        <span class=\"hljs-comment\">//è·å–CharSetæ‰€æ”¯æŒçš„å­—ç¬¦ç¼–ç </span>\n        Map&lt;String, Charset&gt; map = Charset.availableCharsets();\n        Set&lt;Map.Entry&lt;String, Charset&gt;&gt; set = map.entrySet();\n        <span class=\"hljs-keyword\">for</span> (Map.Entry&lt;String, Charset&gt; entry : set) {\n            System.out.println(entry.getKey()+<span class=\"hljs-string\">&quot;=&quot;</span>+entry.getValue().toString());\n        }\n    }\n</code></div></pre>\n');
INSERT INTO `article_content` VALUES ('8556d1aadfebf82abaa7e2159d499d8b', '### 1 Buffer ç®€ä»‹\nJava NIO ä¸­çš„ Buffer ç”¨äºå’Œ NIO é€šé“è¿›è¡Œäº¤äº’ã€‚æ•°æ®æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œä»ç¼“å†² åŒºå†™å…¥åˆ°é€šé“ä¸­çš„ã€‚\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/ff63cf22b4fb456fa17b1bd67c58204d.png)\n\n:::\n\nç¼“å†²åŒº ==æœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜== ã€‚è¿™å—å†…å­˜è¢«åŒ…è£… æˆ NIO Buffer å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥æ–¹ä¾¿çš„è®¿é—®è¯¥å—å†…å­˜ã€‚ç¼“å†²åŒºå®é™…ä¸Šæ˜¯ ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œæ›´ç›´æ¥çš„è¯´ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ==åœ¨ NIO åº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†² åŒºå¤„ç†çš„== ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ï¼› åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå®ƒä¹Ÿæ˜¯å†™å…¥åˆ° ç¼“å†²åŒºä¸­çš„ï¼›ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯å°†å®ƒæ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚è€Œåœ¨é¢å‘æµ I/O ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç›´æ¥å†™å…¥æˆ–è€…ç›´æ¥å°†æ•°æ®è¯»å–åˆ° Stream å¯¹è±¡ä¸­ã€‚ åœ¨ NIO ä¸­ï¼Œæ‰€æœ‰çš„ç¼“å†²åŒºç±»å‹éƒ½ç»§æ‰¿äºæŠ½è±¡ç±» Bufferï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ ByteBufferï¼Œ å¯¹äº Java ä¸­çš„åŸºæœ¬ç±»å‹ï¼ŒåŸºæœ¬éƒ½æœ‰ä¸€ä¸ªå…·ä½“ Buffer ç±»å‹ä¸ä¹‹ç›¸å¯¹åº”ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»§ æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/e77b8d6b861b430c9dec09ed3d4b54e3.png)\n\n:::\n\n### 2 Buffer çš„åŸºæœ¬ç”¨æ³•\n\nä½¿ç”¨ Buffer è¯»å†™æ•°æ®ï¼Œä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š\n- å†™å…¥æ•°æ®åˆ° Buffer\n- è°ƒç”¨ flip()æ–¹æ³•\n- ä» Buffer ä¸­è¯»å–æ•°æ®\n- è°ƒç”¨ clear()æ–¹æ³•æˆ–è€… compact()æ–¹æ³•\n\n\nå½“å‘ buffer å†™å…¥æ•°æ®æ—¶ï¼Œbuffer ä¼šè®°å½•ä¸‹å†™äº†å¤šå°‘æ•°æ®ã€‚ä¸€æ—¦è¦è¯»å–æ•°æ®ï¼Œéœ€è¦é€šè¿‡ flip()æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–ä¹‹å‰å†™å…¥åˆ° buffer çš„æ‰€æœ‰æ•°æ®ã€‚ä¸€æ—¦è¯»å®Œäº†æ‰€æœ‰çš„æ•°æ®ï¼Œå°±éœ€è¦æ¸…ç©ºç¼“å†²åŒºï¼Œè®©å®ƒå¯ä»¥å†æ¬¡è¢«å†™å…¥ã€‚æœ‰ ä¸¤ç§æ–¹å¼èƒ½æ¸…ç©ºç¼“å†²åŒºï¼šè°ƒç”¨ clear()æˆ– compact()æ–¹æ³•ã€‚clear()æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†² åŒºã€‚compact()æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ã€‚ä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ· å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚\n\nä½¿ç”¨ Buffer çš„ä¾‹å­ï¼š\n```java\npublic class BufferDemo01 {\n    @Test\n    public void buffer01() throws Exception {\n        //FileChannel\n        RandomAccessFile aFile = new RandomAccessFile(\"d:\\\\111.txt\",\"rw\");\n        FileChannel channel = aFile.getChannel();\n        //åˆ›å»ºbuffer,å¤§å°\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        //è¯»\n        int bytesRead = channel.read(buffer);\n        while (bytesRead != -1){\n            //readæ¨¡å¼\n            buffer.flip();\n            while (buffer.hasRemaining()){\n                System.out.println((char)buffer.get());\n            }\n            buffer.clear();\n            bytesRead = channel.read(buffer);\n        }\n        aFile.close();\n    }\n\n    @Test\n    public void buffer02() throws Exception{\n        //åˆ›å»ºbuffer\n        IntBuffer buffer = IntBuffer.allocate(8);\n        //buffer æ”¾\n        for (int i = 0; i < buffer.capacity(); i++) {\n            int j =2*(i+1);\n            buffer.put(j);\n        }\n        //é‡ç½®ç¼“å†²åŒº\n        buffer.flip();\n        //è·å–\n        while (buffer.hasRemaining()){\n            int i = buffer.get();\n            System.out.println(i+\" \");\n        }\n    }\n}\n```\n### 3 Buffer çš„ capacityã€position å’Œ limit\nä¸ºäº†ç†è§£ Buffer çš„å·¥ä½œåŸç†ï¼Œéœ€è¦ç†Ÿæ‚‰å®ƒçš„ä¸‰ä¸ªå±æ€§ï¼š\n- Capacity\n- Position\n- limit\n\nposition å’Œ limit çš„å«ä¹‰å–å†³äº Buffer å¤„åœ¨è¯»æ¨¡å¼è¿˜æ˜¯å†™æ¨¡å¼ã€‚ä¸ç®¡ Buffer å¤„åœ¨ä»€ä¹ˆ æ¨¡å¼ï¼Œcapacity çš„å«ä¹‰æ€»æ˜¯ä¸€æ ·çš„ã€‚\nè¿™é‡Œæœ‰ä¸€ä¸ªå…³äº capacityï¼Œposition å’Œ limit åœ¨è¯»å†™æ¨¡å¼ä¸­çš„è¯´æ˜\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/1d35274b372541158b8b959ff27ddeb1.png)\n\n:::\n\n- capacity\nä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBuffer æœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°å€¼ï¼Œä¹Ÿå«â€œcapacityâ€.ä½ åªèƒ½å¾€é‡Œå†™ capacity ä¸ª byteã€longï¼Œchar ç­‰ç±»å‹ã€‚ä¸€æ—¦ Buffer æ»¡äº†ï¼Œéœ€è¦å°†å…¶æ¸…ç©ºï¼ˆé€šè¿‡è¯»æ•° æ®æˆ–è€…æ¸…é™¤æ•°æ®ï¼‰æ‰èƒ½ç»§ç»­å†™æ•°æ®å¾€é‡Œå†™æ•°æ®ã€‚\n- position\n1ï¼‰å†™æ•°æ®åˆ° Buffer ä¸­æ—¶ï¼Œposition è¡¨ç¤ºå†™å…¥æ•°æ®çš„å½“å‰ä½ç½®ï¼Œposition çš„åˆå§‹å€¼ä¸º 0ã€‚å½“ä¸€ä¸ª byteã€long ç­‰æ•°æ®å†™åˆ° Buffer åï¼Œ position ä¼šå‘ä¸‹ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯æ’å…¥ æ•°æ®çš„ Buffer å•å…ƒã€‚position æœ€å¤§å¯ä¸º capacity â€“ 1ï¼ˆå› ä¸º position çš„åˆå§‹å€¼ä¸º 0ï¼‰ã€‚\n2ï¼‰è¯»æ•°æ®åˆ° Buffer ä¸­æ—¶ï¼Œposition è¡¨ç¤ºè¯»å…¥æ•°æ®çš„å½“å‰ä½ç½®ï¼Œå¦‚ position=2 æ—¶è¡¨ ç¤ºå·²å¼€å§‹è¯»å…¥äº† 3 ä¸ª byteï¼Œæˆ–ä»ç¬¬ 3 ä¸ª byte å¼€å§‹è¯»å–ã€‚é€šè¿‡ ByteBuffer.flip()åˆ‡æ¢åˆ° è¯»æ¨¡å¼æ—¶ position ä¼šè¢«é‡ç½®ä¸º 0ï¼Œå½“ Buffer ä» position è¯»å…¥æ•°æ®åï¼Œposition ä¼šä¸‹ ç§»åˆ°ä¸‹ä¸€ä¸ªå¯è¯»å…¥çš„æ•°æ® Buffer å•å…ƒã€‚\n\n- limit\n1ï¼‰å†™æ•°æ®æ—¶ï¼Œlimit è¡¨ç¤ºå¯å¯¹ Buffer æœ€å¤šå†™å…¥å¤šå°‘ä¸ªæ•°æ®ã€‚å†™æ¨¡å¼ä¸‹ï¼Œlimit ç­‰äº Buffer çš„ capacityã€‚\n2ï¼‰è¯»æ•°æ®æ—¶ï¼Œlimit è¡¨ç¤º Buffer é‡Œæœ‰å¤šå°‘å¯è¯»æ•°æ®ï¼ˆnot null çš„æ•°æ®ï¼‰ï¼Œå› æ­¤èƒ½è¯»åˆ° ä¹‹å‰å†™å…¥çš„æ‰€æœ‰æ•°æ®ï¼ˆlimit è¢«è®¾ç½®æˆå·²å†™æ•°æ®çš„æ•°é‡ï¼Œè¿™ä¸ªå€¼åœ¨å†™æ¨¡å¼ä¸‹å°±æ˜¯ positionï¼‰ã€‚\n\n### 4 Buffer çš„ç±»å‹\nJava NIO æœ‰ä»¥ä¸‹ Buffer ç±»å‹\n- ByteBuffer\n- MappedByteBuffer\n- CharBuffer\n- DoubleBuffer\n- FloatBuffer\n- IntBuffer\n- LongBuffer\n- ShortBuffer\n\n\nè¿™äº› Buffer ç±»å‹ä»£è¡¨äº†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡ charï¼Œshortï¼Œintï¼Œ longï¼Œfloat æˆ– double ç±»å‹æ¥æ“ä½œç¼“å†²åŒºä¸­çš„å­—èŠ‚ã€‚\n\n### 5 Buffer åˆ†é…å’Œå†™æ•°æ®\n#### 5.1 Buffer åˆ†é…\nè¦æƒ³è·å¾—ä¸€ä¸ª Buffer å¯¹è±¡é¦–å…ˆè¦è¿›è¡Œåˆ†é…ã€‚ æ¯ä¸€ä¸ª Buffer ç±»éƒ½æœ‰ä¸€ä¸ª allocate æ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ†é… 48 å­—èŠ‚ capacity çš„ ByteBuffer çš„ä¾‹å­ã€‚\n```java\nByteBuffer buf = ByteBuffer.allocate(48);\n```\nè¿™æ˜¯åˆ†é…ä¸€ä¸ªå¯å­˜å‚¨ 1024 ä¸ªå­—ç¬¦çš„ CharBufferï¼š\n```java\nCharBuffer buf = CharBuffer.allocate(1024);\n```\n#### 5.2 å‘ Buffer ä¸­å†™æ•°æ®\nå†™æ•°æ®åˆ° Buffer æœ‰ä¸¤ç§æ–¹å¼ï¼š\nï¼ˆ1ï¼‰ä» Channel å†™åˆ° Bufferã€‚\nï¼ˆ2ï¼‰é€šè¿‡ Buffer çš„ put()æ–¹æ³•å†™åˆ° Buffer é‡Œã€‚\nä» Channel å†™åˆ° Buffer çš„ä¾‹å­\n```java\nint bytesRead = inChannel.read(buf); //read into buffer\n```\né€šè¿‡ put æ–¹æ³•å†™ Buffer çš„ä¾‹å­ï¼š\n```java\nbuf.put(127);\n```\nput æ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼æŠŠæ•°æ®å†™å…¥åˆ° Buffer ä¸­ã€‚ä¾‹å¦‚ï¼Œ å†™åˆ°ä¸€ä¸ª æŒ‡å®šçš„ä½ç½®ï¼Œæˆ–è€…æŠŠä¸€ä¸ªå­—èŠ‚æ•°ç»„å†™å…¥åˆ° Buffer\n#### 5.3 flip()æ–¹æ³•\nflip æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚è°ƒç”¨ flip()æ–¹æ³•ä¼šå°† position è®¾å› 0ï¼Œå¹¶ å°† limit è®¾ç½®æˆä¹‹å‰ position çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œposition ç°åœ¨ç”¨äºæ ‡è®°è¯»çš„ä½ç½®ï¼Œ limit è¡¨ç¤ºä¹‹å‰å†™è¿›äº†å¤šå°‘ä¸ª byteã€char ç­‰ ï¼ˆç°åœ¨èƒ½è¯»å–å¤šå°‘ä¸ª byteã€char ç­‰ï¼‰ã€‚\n\n### 6 ä» Buffer ä¸­è¯»å–æ•°æ®\nä» Buffer ä¸­è¯»å–æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š\nï¼ˆ1ï¼‰ä» Buffer è¯»å–æ•°æ®åˆ° Channelã€‚ \nï¼ˆ2ï¼‰ä½¿ç”¨ get()æ–¹æ³•ä» Buffer ä¸­è¯»å–æ•°æ®ã€‚\nä» Buffer è¯»å–æ•°æ®åˆ° Channel çš„ä¾‹å­ï¼š\n```java\n//read from buffer into channel. \nint bytesWritten = inChannel.write(buf);\n```\nä½¿ç”¨ get()æ–¹æ³•ä» Buffer ä¸­è¯»å–æ•°æ®çš„ä¾‹å­\n```java\nbyte aByte = buf.get();\n```\nget æ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼ä» Buffer ä¸­è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»æŒ‡å®š position è¯»å–ï¼Œæˆ–è€…ä» Buffer ä¸­è¯»å–æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ã€‚\n\n### 7 Buffer å‡ ä¸ªæ–¹æ³•\n#### 7.1 rewind()æ–¹æ³•\nBuffer.rewind()å°† position è®¾å› 0ï¼Œæ‰€ä»¥ä½ å¯ä»¥é‡è¯» Buffer ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚limit ä¿ æŒä¸å˜ï¼Œä»ç„¶è¡¨ç¤ºèƒ½ä» Buffer ä¸­è¯»å–å¤šå°‘ä¸ªå…ƒç´ ï¼ˆbyteã€char ç­‰ï¼‰ã€‚\n\n#### 7.2 clear()ä¸ compact()æ–¹æ³•\nä¸€æ—¦è¯»å®Œ Buffer ä¸­çš„æ•°æ®ï¼Œéœ€è¦è®© Buffer å‡†å¤‡å¥½å†æ¬¡è¢«å†™å…¥ã€‚å¯ä»¥é€šè¿‡ clear()æˆ– compact()æ–¹æ³•æ¥å®Œæˆã€‚\n\nå¦‚æœè°ƒç”¨çš„æ˜¯ clear()æ–¹æ³•ï¼Œposition å°†è¢«è®¾å› 0ï¼Œlimit è¢«è®¾ç½®æˆ capacity çš„å€¼ã€‚æ¢ å¥è¯è¯´ï¼ŒBuffer è¢«æ¸…ç©ºäº†ã€‚Buffer ä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä» å“ªé‡Œå¼€å§‹å¾€ Buffer é‡Œå†™æ•°æ®ã€‚\n\nå¦‚æœ Buffer ä¸­æœ‰ä¸€äº›æœªè¯»çš„æ•°æ®ï¼Œè°ƒç”¨ clear()æ–¹æ³•ï¼Œæ•°æ®å°†â€œè¢«é—å¿˜â€ï¼Œæ„å‘³ç€ä¸å† æœ‰ä»»ä½•æ ‡è®°ä¼šå‘Šè¯‰ä½ å“ªäº›æ•°æ®è¢«è¯»è¿‡ï¼Œå“ªäº›è¿˜æ²¡æœ‰ã€‚\n\nå¦‚æœ Buffer ä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå…ˆå†™äº›æ•°æ®ï¼Œ é‚£ä¹ˆä½¿ç”¨ compact()æ–¹æ³•ã€‚\n\ncompact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ° Buffer èµ·å§‹å¤„ã€‚ç„¶åå°† position è®¾åˆ°æœ€åä¸€ ä¸ªæœªè¯»å…ƒç´ æ­£åé¢ã€‚limit å±æ€§ä¾ç„¶åƒ clear()æ–¹æ³•ä¸€æ ·ï¼Œè®¾ç½®æˆ capacityã€‚ç°åœ¨ Buffer å‡†å¤‡å¥½å†™æ•°æ®äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ®ã€‚\n\n#### 7.3 mark()ä¸ reset()æ–¹æ³•\né€šè¿‡è°ƒç”¨ Buffer.mark()æ–¹æ³•ï¼Œå¯ä»¥æ ‡è®° Buffer ä¸­çš„ä¸€ä¸ªç‰¹å®š positionã€‚ä¹‹åå¯ä»¥é€š è¿‡è°ƒç”¨ Buffer.reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ª positionã€‚ä¾‹å¦‚ï¼š\n```java\nbuffer.mark(); \n//call buffer.get() a couple of times, e.g. during parsing. buffer.reset();\n//set position back to mark.\n```\n### 8 ç¼“å†²åŒºæ“ä½œ\n#### 8.1 ç¼“å†²åŒºåˆ†ç‰‡\nåœ¨ NIO ä¸­ï¼Œé™¤äº†å¯ä»¥åˆ†é…æˆ–è€…åŒ…è£…ä¸€ä¸ªç¼“å†²åŒºå¯¹è±¡å¤–ï¼Œè¿˜å¯ä»¥æ ¹æ®ç°æœ‰çš„ç¼“å†²åŒºå¯¹è±¡ æ¥åˆ›å»ºä¸€ä¸ªå­ç¼“å†²åŒºï¼Œå³åœ¨ç°æœ‰ç¼“å†²åŒºä¸Šåˆ‡å‡ºä¸€ç‰‡æ¥ä½œä¸ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œä½†ç°æœ‰çš„ ç¼“å†²åŒºä¸åˆ›å»ºçš„å­ç¼“å†²åŒºåœ¨åº•å±‚æ•°ç»„å±‚é¢ä¸Šæ˜¯æ•°æ®å…±äº«çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç¼“å†²åŒºç›¸å½“ äºæ˜¯ç°æœ‰ç¼“å†²åŒºçš„ä¸€ä¸ªè§†å›¾çª—å£ã€‚è°ƒç”¨ slice()æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç¼“å†²åŒºã€‚\n\n```java\n//ç¼“å†²åŒºåˆ†ç‰‡\n    @Test\n    public void test01(){\n        ByteBuffer buffer = ByteBuffer.allocate(10);\n        for (int i = 0; i < buffer.capacity(); i++) {\n            buffer.put((byte)i);\n        }\n        //åˆ›å»ºå­ç¼“å†²åŒº\n        buffer.position(3);\n        buffer.limit(7);\n        ByteBuffer slice = buffer.slice();\n\n        //æ”¹å˜å­ç¼“å†²åŒºå†…å®¹\n        for (int i = 0; i < slice.capacity(); i++) {\n            byte b = slice.get(i);\n            b*=10;\n            slice.put(i,b);\n        }\n        buffer.position(0);\n        buffer.limit(buffer.capacity());\n        while (buffer.remaining()>0){\n            System.out.println(buffer.get());\n        }\n    }\n```\n\n#### 8.2 åªè¯»ç¼“å†²åŒº\n\nåªè¯»ç¼“å†²åŒºéå¸¸ç®€å•ï¼Œå¯ä»¥è¯»å–å®ƒä»¬ï¼Œä½†æ˜¯ä¸èƒ½å‘å®ƒä»¬å†™å…¥æ•°æ®ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ç¼“å†² åŒºçš„ asReadOnlyBuffer()æ–¹æ³•ï¼Œå°†ä»»ä½•å¸¸è§„ç¼“å†²åŒºè½¬ æ¢ä¸ºåªè¯»ç¼“å†²åŒºï¼Œè¿™ä¸ªæ–¹æ³•è¿”å› ä¸€ä¸ªä¸åŸç¼“å†²åŒºå®Œå…¨ç›¸åŒçš„ç¼“å†²åŒºï¼Œå¹¶ä¸åŸç¼“å†²åŒºå…±äº«æ•°æ®ï¼Œåªä¸è¿‡å®ƒæ˜¯åªè¯»çš„ã€‚å¦‚ æœåŸç¼“å†²åŒºçš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåªè¯»ç¼“å†²åŒºçš„å†…å®¹ä¹Ÿéšä¹‹å‘ç”Ÿå˜åŒ–ï¼š\n\n```java\n//åªè¯»ç¼“å†²åŒº\n    @Test\n    public void test02(){\n        ByteBuffer buffer = ByteBuffer.allocate(10);\n        for (int i = 0; i < buffer.capacity(); i++) {\n            buffer.put((byte)i);\n        }\n        //åˆ›å»ºåªè¯»ç¼“å†²åŒº\n        ByteBuffer readOnlyBuffer = buffer.asReadOnlyBuffer();\n\n        for (int i = 0; i < buffer.capacity(); i++) {\n            byte b = buffer.get(i);\n            b*=10;\n            buffer.put(i,b);\n        }\n        readOnlyBuffer.position(0);\n        readOnlyBuffer.limit(buffer.capacity());\n        while (readOnlyBuffer.remaining()>0){\n            System.out.println(readOnlyBuffer.get());\n        }\n    }\n```\nå¦‚æœå°è¯•ä¿®æ”¹åªè¯»ç¼“å†²åŒºçš„å†…å®¹ï¼Œåˆ™ä¼šæŠ¥ ReadOnlyBufferException å¼‚å¸¸ã€‚åªè¯»ç¼“å†² åŒºå¯¹äºä¿æŠ¤æ•°æ®å¾ˆæœ‰ç”¨ã€‚åœ¨å°†ç¼“å†²åŒºä¼ é€’ç»™æŸä¸ª å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæ— æ³•çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ å¦ä¼šä¿®æ”¹ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚åˆ›å»ºä¸€ä¸ªåªè¯»çš„ç¼“å†²åŒºå¯ä»¥ä¿è¯è¯¥ç¼“å†²åŒºä¸ä¼šè¢«ä¿®æ”¹ã€‚åª å¯ä»¥æŠŠå¸¸è§„ç¼“å†²åŒºè½¬æ¢ä¸ºåªè¯»ç¼“å†²åŒºï¼Œè€Œä¸èƒ½å°†åªè¯»çš„ç¼“å†²åŒºè½¬æ¢ä¸ºå¯å†™çš„ç¼“å†²åŒºã€‚\n\n#### 8.3 ç›´æ¥ç¼“å†²åŒº\nç›´æ¥ç¼“å†²åŒºæ˜¯ä¸ºåŠ å¿« I/O é€Ÿåº¦ï¼Œä½¿ç”¨ä¸€ç§ç‰¹æ®Šæ–¹å¼ä¸ºå…¶åˆ†é…å†…å­˜çš„ç¼“å†²åŒºï¼ŒJDK æ–‡æ¡£ ä¸­çš„æè¿°ä¸ºï¼šç»™å®šä¸€ä¸ªç›´æ¥å­—èŠ‚ç¼“å†²åŒºï¼ŒJava è™šæ‹Ÿæœºå°†å°½æœ€å¤§åŠªåŠ›ç›´æ¥å¯¹å®ƒæ‰§è¡Œæœ¬æœº I/O æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡è°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿçš„æœ¬æœº I/O æ“ä½œä¹‹å‰(æˆ–ä¹‹å)ï¼Œ å°è¯•é¿å…å°†ç¼“å†²åŒºçš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºä¸­ æˆ–è€…ä»ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºä¸­æ‹·è´æ•°æ®ã€‚ è¦åˆ†é…ç›´æ¥ç¼“å†²åŒºï¼Œéœ€è¦è°ƒç”¨ allocateDirect()æ–¹æ³•ï¼Œè€Œä¸æ˜¯ allocate()æ–¹æ³•ï¼Œä½¿ç”¨æ–¹ å¼ä¸æ™®é€šç¼“å†²åŒºå¹¶æ— åŒºåˆ«ã€‚\næ‹·è´æ–‡ä»¶ç¤ºä¾‹ï¼š\n```java\n//ç›´æ¥ç¼“å†²åŒº\n    @Test\n    public void test03() throws Exception {\n        String infile = \"D:\\\\111.txt\";\n        FileInputStream fin = new FileInputStream(infile);\n        FileChannel finChannel = fin.getChannel();\n\n        String outfile = \"D:\\\\222.txt\";\n        FileOutputStream fout = new FileOutputStream(outfile);\n        FileChannel foutChannel = fout.getChannel();\n\n        //åˆ›å»ºç›´æ¥ç¼“å†²åŒº\n        ByteBuffer buffer = ByteBuffer.allocateDirect(1024);\n        while (true){\n            buffer.clear();\n            int r = finChannel.read(buffer);\n            if(r==-1){\n                break;\n            }\n            buffer.flip();\n            foutChannel.write(buffer);\n        }\n    }\n```\n\n#### 8.4 å†…å­˜æ˜ å°„æ–‡ä»¶ I/O\nå†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€š é“çš„ I/O å¿«çš„å¤šã€‚å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯é€šè¿‡ä½¿æ–‡ä»¶ä¸­çš„æ•°æ®å‡ºç°ä¸º å†…å­˜æ•°ç»„çš„å†…å®¹æ¥ å®Œæˆçš„ï¼Œè¿™å…¶åˆå¬èµ·æ¥ä¼¼ä¹ä¸è¿‡å°±æ˜¯å°†æ•´ä¸ªæ–‡ä»¶è¯»åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯äº‹å®ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰æ–‡ä»¶ä¸­å®é™…è¯»å–æˆ–è€…å†™å…¥çš„éƒ¨åˆ†æ‰ä¼šæ˜ å°„åˆ°å†…å­˜ä¸­ã€‚ ç¤ºä¾‹ä»£ç ï¼š\n\n```java\nstatic private final int start = 0; \nstatic private final int size = 1024;\n\n//å†…å­˜æ˜ å°„æ–‡ä»¶\n    @Test\n    public void test04() throws Exception{\n        RandomAccessFile raf = new RandomAccessFile(\"d:\\\\111.txt\", \"rw\");\n        FileChannel fc = raf.getChannel();\n        MappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, start, size);\n        mbb.put(0, (byte) 97);\n        mbb.put(1023, (byte) 122);\n        raf.close();\n    }\n```\n', '2022-10-08 16:37:01', '2022-10-09 10:48:29', '<h3><a id=\"1_Buffer__0\"></a>1 Buffer ç®€ä»‹</h3>\n<p>Java NIO ä¸­çš„ Buffer ç”¨äºå’Œ NIO é€šé“è¿›è¡Œäº¤äº’ã€‚æ•°æ®æ˜¯ä»é€šé“è¯»å…¥ç¼“å†²åŒºï¼Œä»ç¼“å†² åŒºå†™å…¥åˆ°é€šé“ä¸­çš„ã€‚</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/ff63cf22b4fb456fa17b1bd67c58204d.png\" alt=\"image.png\" /></p>\n</div>\n<p>ç¼“å†²åŒº <mark>æœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜</mark> ã€‚è¿™å—å†…å­˜è¢«åŒ…è£… æˆ NIO Buffer å¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥æ–¹ä¾¿çš„è®¿é—®è¯¥å—å†…å­˜ã€‚ç¼“å†²åŒºå®é™…ä¸Šæ˜¯ ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œæ›´ç›´æ¥çš„è¯´ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ<mark>åœ¨ NIO åº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†² åŒºå¤„ç†çš„</mark> ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ï¼› åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå®ƒä¹Ÿæ˜¯å†™å…¥åˆ° ç¼“å†²åŒºä¸­çš„ï¼›ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯å°†å®ƒæ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚è€Œåœ¨é¢å‘æµ I/O ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç›´æ¥å†™å…¥æˆ–è€…ç›´æ¥å°†æ•°æ®è¯»å–åˆ° Stream å¯¹è±¡ä¸­ã€‚ åœ¨ NIO ä¸­ï¼Œæ‰€æœ‰çš„ç¼“å†²åŒºç±»å‹éƒ½ç»§æ‰¿äºæŠ½è±¡ç±» Bufferï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ ByteBufferï¼Œ å¯¹äº Java ä¸­çš„åŸºæœ¬ç±»å‹ï¼ŒåŸºæœ¬éƒ½æœ‰ä¸€ä¸ªå…·ä½“ Buffer ç±»å‹ä¸ä¹‹ç›¸å¯¹åº”ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»§ æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/e77b8d6b861b430c9dec09ed3d4b54e3.png\" alt=\"image.png\" /></p>\n</div>\n<h3><a id=\"2_Buffer__15\"></a>2 Buffer çš„åŸºæœ¬ç”¨æ³•</h3>\n<p>ä½¿ç”¨ Buffer è¯»å†™æ•°æ®ï¼Œä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p>\n<ul>\n<li>å†™å…¥æ•°æ®åˆ° Buffer</li>\n<li>è°ƒç”¨ flip()æ–¹æ³•</li>\n<li>ä» Buffer ä¸­è¯»å–æ•°æ®</li>\n<li>è°ƒç”¨ clear()æ–¹æ³•æˆ–è€… compact()æ–¹æ³•</li>\n</ul>\n<p>å½“å‘ buffer å†™å…¥æ•°æ®æ—¶ï¼Œbuffer ä¼šè®°å½•ä¸‹å†™äº†å¤šå°‘æ•°æ®ã€‚ä¸€æ—¦è¦è¯»å–æ•°æ®ï¼Œéœ€è¦é€šè¿‡ flip()æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–ä¹‹å‰å†™å…¥åˆ° buffer çš„æ‰€æœ‰æ•°æ®ã€‚ä¸€æ—¦è¯»å®Œäº†æ‰€æœ‰çš„æ•°æ®ï¼Œå°±éœ€è¦æ¸…ç©ºç¼“å†²åŒºï¼Œè®©å®ƒå¯ä»¥å†æ¬¡è¢«å†™å…¥ã€‚æœ‰ ä¸¤ç§æ–¹å¼èƒ½æ¸…ç©ºç¼“å†²åŒºï¼šè°ƒç”¨ clear()æˆ– compact()æ–¹æ³•ã€‚clear()æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†² åŒºã€‚compact()æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ã€‚ä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ· å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚</p>\n<p>ä½¿ç”¨ Buffer çš„ä¾‹å­ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BufferDemo01</span> {\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">buffer01</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//FileChannel</span>\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">aFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>,<span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> aFile.getChannel();\n        <span class=\"hljs-comment\">//åˆ›å»ºbuffer,å¤§å°</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-comment\">//è¯»</span>\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">bytesRead</span> <span class=\"hljs-operator\">=</span> channel.read(buffer);\n        <span class=\"hljs-keyword\">while</span> (bytesRead != -<span class=\"hljs-number\">1</span>){\n            <span class=\"hljs-comment\">//readæ¨¡å¼</span>\n            buffer.flip();\n            <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()){\n                System.out.println((<span class=\"hljs-type\">char</span>)buffer.get());\n            }\n            buffer.clear();\n            bytesRead = channel.read(buffer);\n        }\n        aFile.close();\n    }\n\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">buffer02</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//åˆ›å»ºbuffer</span>\n        <span class=\"hljs-type\">IntBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> IntBuffer.allocate(<span class=\"hljs-number\">8</span>);\n        <span class=\"hljs-comment\">//buffer æ”¾</span>\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; buffer.capacity(); i++) {\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">j</span> <span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span>*(i+<span class=\"hljs-number\">1</span>);\n            buffer.put(j);\n        }\n        <span class=\"hljs-comment\">//é‡ç½®ç¼“å†²åŒº</span>\n        buffer.flip();\n        <span class=\"hljs-comment\">//è·å–</span>\n        <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()){\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> buffer.get();\n            System.out.println(i+<span class=\"hljs-string\">&quot; &quot;</span>);\n        }\n    }\n}\n</code></div></pre>\n<h3><a id=\"3_Buffer__capacityposition__limit_69\"></a>3 Buffer çš„ capacityã€position å’Œ limit</h3>\n<p>ä¸ºäº†ç†è§£ Buffer çš„å·¥ä½œåŸç†ï¼Œéœ€è¦ç†Ÿæ‚‰å®ƒçš„ä¸‰ä¸ªå±æ€§ï¼š</p>\n<ul>\n<li>Capacity</li>\n<li>Position</li>\n<li>limit</li>\n</ul>\n<p>position å’Œ limit çš„å«ä¹‰å–å†³äº Buffer å¤„åœ¨è¯»æ¨¡å¼è¿˜æ˜¯å†™æ¨¡å¼ã€‚ä¸ç®¡ Buffer å¤„åœ¨ä»€ä¹ˆ æ¨¡å¼ï¼Œcapacity çš„å«ä¹‰æ€»æ˜¯ä¸€æ ·çš„ã€‚<br />\nè¿™é‡Œæœ‰ä¸€ä¸ªå…³äº capacityï¼Œposition å’Œ limit åœ¨è¯»å†™æ¨¡å¼ä¸­çš„è¯´æ˜</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/08/1d35274b372541158b8b959ff27ddeb1.png\" alt=\"image.png\" /></p>\n</div>\n<ul>\n<li>\n<p>capacity<br />\nä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBuffer æœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°å€¼ï¼Œä¹Ÿå«â€œcapacityâ€.ä½ åªèƒ½å¾€é‡Œå†™ capacity ä¸ª byteã€longï¼Œchar ç­‰ç±»å‹ã€‚ä¸€æ—¦ Buffer æ»¡äº†ï¼Œéœ€è¦å°†å…¶æ¸…ç©ºï¼ˆé€šè¿‡è¯»æ•° æ®æˆ–è€…æ¸…é™¤æ•°æ®ï¼‰æ‰èƒ½ç»§ç»­å†™æ•°æ®å¾€é‡Œå†™æ•°æ®ã€‚</p>\n</li>\n<li>\n<p>position<br />\n1ï¼‰å†™æ•°æ®åˆ° Buffer ä¸­æ—¶ï¼Œposition è¡¨ç¤ºå†™å…¥æ•°æ®çš„å½“å‰ä½ç½®ï¼Œposition çš„åˆå§‹å€¼ä¸º 0ã€‚å½“ä¸€ä¸ª byteã€long ç­‰æ•°æ®å†™åˆ° Buffer åï¼Œ position ä¼šå‘ä¸‹ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯æ’å…¥ æ•°æ®çš„ Buffer å•å…ƒã€‚position æœ€å¤§å¯ä¸º capacity â€“ 1ï¼ˆå› ä¸º position çš„åˆå§‹å€¼ä¸º 0ï¼‰ã€‚<br />\n2ï¼‰è¯»æ•°æ®åˆ° Buffer ä¸­æ—¶ï¼Œposition è¡¨ç¤ºè¯»å…¥æ•°æ®çš„å½“å‰ä½ç½®ï¼Œå¦‚ position=2 æ—¶è¡¨ ç¤ºå·²å¼€å§‹è¯»å…¥äº† 3 ä¸ª byteï¼Œæˆ–ä»ç¬¬ 3 ä¸ª byte å¼€å§‹è¯»å–ã€‚é€šè¿‡ ByteBuffer.flip()åˆ‡æ¢åˆ° è¯»æ¨¡å¼æ—¶ position ä¼šè¢«é‡ç½®ä¸º 0ï¼Œå½“ Buffer ä» position è¯»å…¥æ•°æ®åï¼Œposition ä¼šä¸‹ ç§»åˆ°ä¸‹ä¸€ä¸ªå¯è¯»å…¥çš„æ•°æ® Buffer å•å…ƒã€‚</p>\n</li>\n<li>\n<p>limit<br />\n1ï¼‰å†™æ•°æ®æ—¶ï¼Œlimit è¡¨ç¤ºå¯å¯¹ Buffer æœ€å¤šå†™å…¥å¤šå°‘ä¸ªæ•°æ®ã€‚å†™æ¨¡å¼ä¸‹ï¼Œlimit ç­‰äº Buffer çš„ capacityã€‚<br />\n2ï¼‰è¯»æ•°æ®æ—¶ï¼Œlimit è¡¨ç¤º Buffer é‡Œæœ‰å¤šå°‘å¯è¯»æ•°æ®ï¼ˆnot null çš„æ•°æ®ï¼‰ï¼Œå› æ­¤èƒ½è¯»åˆ° ä¹‹å‰å†™å…¥çš„æ‰€æœ‰æ•°æ®ï¼ˆlimit è¢«è®¾ç½®æˆå·²å†™æ•°æ®çš„æ•°é‡ï¼Œè¿™ä¸ªå€¼åœ¨å†™æ¨¡å¼ä¸‹å°±æ˜¯ positionï¼‰ã€‚</p>\n</li>\n</ul>\n<h3><a id=\"4_Buffer__93\"></a>4 Buffer çš„ç±»å‹</h3>\n<p>Java NIO æœ‰ä»¥ä¸‹ Buffer ç±»å‹</p>\n<ul>\n<li>ByteBuffer</li>\n<li>MappedByteBuffer</li>\n<li>CharBuffer</li>\n<li>DoubleBuffer</li>\n<li>FloatBuffer</li>\n<li>IntBuffer</li>\n<li>LongBuffer</li>\n<li>ShortBuffer</li>\n</ul>\n<p>è¿™äº› Buffer ç±»å‹ä»£è¡¨äº†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡ charï¼Œshortï¼Œintï¼Œ longï¼Œfloat æˆ– double ç±»å‹æ¥æ“ä½œç¼“å†²åŒºä¸­çš„å­—èŠ‚ã€‚</p>\n<h3><a id=\"5_Buffer__107\"></a>5 Buffer åˆ†é…å’Œå†™æ•°æ®</h3>\n<h4><a id=\"51_Buffer__108\"></a>5.1 Buffer åˆ†é…</h4>\n<p>è¦æƒ³è·å¾—ä¸€ä¸ª Buffer å¯¹è±¡é¦–å…ˆè¦è¿›è¡Œåˆ†é…ã€‚ æ¯ä¸€ä¸ª Buffer ç±»éƒ½æœ‰ä¸€ä¸ª allocate æ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ†é… 48 å­—èŠ‚ capacity çš„ ByteBuffer çš„ä¾‹å­ã€‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">48</span>);\n</code></div></pre>\n<p>è¿™æ˜¯åˆ†é…ä¸€ä¸ªå¯å­˜å‚¨ 1024 ä¸ªå­—ç¬¦çš„ CharBufferï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">CharBuffer</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> CharBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n</code></div></pre>\n<h4><a id=\"52__Buffer__117\"></a>5.2 å‘ Buffer ä¸­å†™æ•°æ®</h4>\n<p>å†™æ•°æ®åˆ° Buffer æœ‰ä¸¤ç§æ–¹å¼ï¼š<br />\nï¼ˆ1ï¼‰ä» Channel å†™åˆ° Bufferã€‚<br />\nï¼ˆ2ï¼‰é€šè¿‡ Buffer çš„ put()æ–¹æ³•å†™åˆ° Buffer é‡Œã€‚<br />\nä» Channel å†™åˆ° Buffer çš„ä¾‹å­</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">bytesRead</span> <span class=\"hljs-operator\">=</span> inChannel.read(buf); <span class=\"hljs-comment\">//read into buffer</span>\n</code></div></pre>\n<p>é€šè¿‡ put æ–¹æ³•å†™ Buffer çš„ä¾‹å­ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buf.put(<span class=\"hljs-number\">127</span>);\n</code></div></pre>\n<p>put æ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼æŠŠæ•°æ®å†™å…¥åˆ° Buffer ä¸­ã€‚ä¾‹å¦‚ï¼Œ å†™åˆ°ä¸€ä¸ª æŒ‡å®šçš„ä½ç½®ï¼Œæˆ–è€…æŠŠä¸€ä¸ªå­—èŠ‚æ•°ç»„å†™å…¥åˆ° Buffer</p>\n<h4><a id=\"53_flip_130\"></a>5.3 flip()æ–¹æ³•</h4>\n<p>flip æ–¹æ³•å°† Buffer ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼ã€‚è°ƒç”¨ flip()æ–¹æ³•ä¼šå°† position è®¾å› 0ï¼Œå¹¶ å°† limit è®¾ç½®æˆä¹‹å‰ position çš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œposition ç°åœ¨ç”¨äºæ ‡è®°è¯»çš„ä½ç½®ï¼Œ limit è¡¨ç¤ºä¹‹å‰å†™è¿›äº†å¤šå°‘ä¸ª byteã€char ç­‰ ï¼ˆç°åœ¨èƒ½è¯»å–å¤šå°‘ä¸ª byteã€char ç­‰ï¼‰ã€‚</p>\n<h3><a id=\"6__Buffer__133\"></a>6 ä» Buffer ä¸­è¯»å–æ•°æ®</h3>\n<p>ä» Buffer ä¸­è¯»å–æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š<br />\nï¼ˆ1ï¼‰ä» Buffer è¯»å–æ•°æ®åˆ° Channelã€‚<br />\nï¼ˆ2ï¼‰ä½¿ç”¨ get()æ–¹æ³•ä» Buffer ä¸­è¯»å–æ•°æ®ã€‚<br />\nä» Buffer è¯»å–æ•°æ®åˆ° Channel çš„ä¾‹å­ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//read from buffer into channel. </span>\n<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">bytesWritten</span> <span class=\"hljs-operator\">=</span> inChannel.write(buf);\n</code></div></pre>\n<p>ä½¿ç”¨ get()æ–¹æ³•ä» Buffer ä¸­è¯»å–æ•°æ®çš„ä¾‹å­</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">aByte</span> <span class=\"hljs-operator\">=</span> buf.get();\n</code></div></pre>\n<p>get æ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼ä» Buffer ä¸­è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»æŒ‡å®š position è¯»å–ï¼Œæˆ–è€…ä» Buffer ä¸­è¯»å–æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ã€‚</p>\n<h3><a id=\"7_Buffer__148\"></a>7 Buffer å‡ ä¸ªæ–¹æ³•</h3>\n<h4><a id=\"71_rewind_149\"></a>7.1 rewind()æ–¹æ³•</h4>\n<p>Buffer.rewind()å°† position è®¾å› 0ï¼Œæ‰€ä»¥ä½ å¯ä»¥é‡è¯» Buffer ä¸­çš„æ‰€æœ‰æ•°æ®ã€‚limit ä¿ æŒä¸å˜ï¼Œä»ç„¶è¡¨ç¤ºèƒ½ä» Buffer ä¸­è¯»å–å¤šå°‘ä¸ªå…ƒç´ ï¼ˆbyteã€char ç­‰ï¼‰ã€‚</p>\n<h4><a id=\"72_clear_compact_152\"></a>7.2 clear()ä¸ compact()æ–¹æ³•</h4>\n<p>ä¸€æ—¦è¯»å®Œ Buffer ä¸­çš„æ•°æ®ï¼Œéœ€è¦è®© Buffer å‡†å¤‡å¥½å†æ¬¡è¢«å†™å…¥ã€‚å¯ä»¥é€šè¿‡ clear()æˆ– compact()æ–¹æ³•æ¥å®Œæˆã€‚</p>\n<p>å¦‚æœè°ƒç”¨çš„æ˜¯ clear()æ–¹æ³•ï¼Œposition å°†è¢«è®¾å› 0ï¼Œlimit è¢«è®¾ç½®æˆ capacity çš„å€¼ã€‚æ¢ å¥è¯è¯´ï¼ŒBuffer è¢«æ¸…ç©ºäº†ã€‚Buffer ä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä» å“ªé‡Œå¼€å§‹å¾€ Buffer é‡Œå†™æ•°æ®ã€‚</p>\n<p>å¦‚æœ Buffer ä¸­æœ‰ä¸€äº›æœªè¯»çš„æ•°æ®ï¼Œè°ƒç”¨ clear()æ–¹æ³•ï¼Œæ•°æ®å°†â€œè¢«é—å¿˜â€ï¼Œæ„å‘³ç€ä¸å† æœ‰ä»»ä½•æ ‡è®°ä¼šå‘Šè¯‰ä½ å“ªäº›æ•°æ®è¢«è¯»è¿‡ï¼Œå“ªäº›è¿˜æ²¡æœ‰ã€‚</p>\n<p>å¦‚æœ Buffer ä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå…ˆå†™äº›æ•°æ®ï¼Œ é‚£ä¹ˆä½¿ç”¨ compact()æ–¹æ³•ã€‚</p>\n<p>compact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ° Buffer èµ·å§‹å¤„ã€‚ç„¶åå°† position è®¾åˆ°æœ€åä¸€ ä¸ªæœªè¯»å…ƒç´ æ­£åé¢ã€‚limit å±æ€§ä¾ç„¶åƒ clear()æ–¹æ³•ä¸€æ ·ï¼Œè®¾ç½®æˆ capacityã€‚ç°åœ¨ Buffer å‡†å¤‡å¥½å†™æ•°æ®äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ®ã€‚</p>\n<h4><a id=\"73_mark_reset_163\"></a>7.3 mark()ä¸ reset()æ–¹æ³•</h4>\n<p>é€šè¿‡è°ƒç”¨ Buffer.mark()æ–¹æ³•ï¼Œå¯ä»¥æ ‡è®° Buffer ä¸­çš„ä¸€ä¸ªç‰¹å®š positionã€‚ä¹‹åå¯ä»¥é€š è¿‡è°ƒç”¨ Buffer.reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ª positionã€‚ä¾‹å¦‚ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">buffer.mark(); \n<span class=\"hljs-comment\">//call buffer.get() a couple of times, e.g. during parsing. buffer.reset();</span>\n<span class=\"hljs-comment\">//set position back to mark.</span>\n</code></div></pre>\n<h3><a id=\"8__170\"></a>8 ç¼“å†²åŒºæ“ä½œ</h3>\n<h4><a id=\"81__171\"></a>8.1 ç¼“å†²åŒºåˆ†ç‰‡</h4>\n<p>åœ¨ NIO ä¸­ï¼Œé™¤äº†å¯ä»¥åˆ†é…æˆ–è€…åŒ…è£…ä¸€ä¸ªç¼“å†²åŒºå¯¹è±¡å¤–ï¼Œè¿˜å¯ä»¥æ ¹æ®ç°æœ‰çš„ç¼“å†²åŒºå¯¹è±¡ æ¥åˆ›å»ºä¸€ä¸ªå­ç¼“å†²åŒºï¼Œå³åœ¨ç°æœ‰ç¼“å†²åŒºä¸Šåˆ‡å‡ºä¸€ç‰‡æ¥ä½œä¸ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œä½†ç°æœ‰çš„ ç¼“å†²åŒºä¸åˆ›å»ºçš„å­ç¼“å†²åŒºåœ¨åº•å±‚æ•°ç»„å±‚é¢ä¸Šæ˜¯æ•°æ®å…±äº«çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç¼“å†²åŒºç›¸å½“ äºæ˜¯ç°æœ‰ç¼“å†²åŒºçš„ä¸€ä¸ªè§†å›¾çª—å£ã€‚è°ƒç”¨ slice()æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç¼“å†²åŒºã€‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//ç¼“å†²åŒºåˆ†ç‰‡</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test01</span><span class=\"hljs-params\">()</span>{\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">10</span>);\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; buffer.capacity(); i++) {\n            buffer.put((<span class=\"hljs-type\">byte</span>)i);\n        }\n        <span class=\"hljs-comment\">//åˆ›å»ºå­ç¼“å†²åŒº</span>\n        buffer.position(<span class=\"hljs-number\">3</span>);\n        buffer.limit(<span class=\"hljs-number\">7</span>);\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">slice</span> <span class=\"hljs-operator\">=</span> buffer.slice();\n\n        <span class=\"hljs-comment\">//æ”¹å˜å­ç¼“å†²åŒºå†…å®¹</span>\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; slice.capacity(); i++) {\n            <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">b</span> <span class=\"hljs-operator\">=</span> slice.get(i);\n            b*=<span class=\"hljs-number\">10</span>;\n            slice.put(i,b);\n        }\n        buffer.position(<span class=\"hljs-number\">0</span>);\n        buffer.limit(buffer.capacity());\n        <span class=\"hljs-keyword\">while</span> (buffer.remaining()&gt;<span class=\"hljs-number\">0</span>){\n            System.out.println(buffer.get());\n        }\n    }\n</code></div></pre>\n<h4><a id=\"82__201\"></a>8.2 åªè¯»ç¼“å†²åŒº</h4>\n<p>åªè¯»ç¼“å†²åŒºéå¸¸ç®€å•ï¼Œå¯ä»¥è¯»å–å®ƒä»¬ï¼Œä½†æ˜¯ä¸èƒ½å‘å®ƒä»¬å†™å…¥æ•°æ®ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ç¼“å†² åŒºçš„ asReadOnlyBuffer()æ–¹æ³•ï¼Œå°†ä»»ä½•å¸¸è§„ç¼“å†²åŒºè½¬ æ¢ä¸ºåªè¯»ç¼“å†²åŒºï¼Œè¿™ä¸ªæ–¹æ³•è¿”å› ä¸€ä¸ªä¸åŸç¼“å†²åŒºå®Œå…¨ç›¸åŒçš„ç¼“å†²åŒºï¼Œå¹¶ä¸åŸç¼“å†²åŒºå…±äº«æ•°æ®ï¼Œåªä¸è¿‡å®ƒæ˜¯åªè¯»çš„ã€‚å¦‚ æœåŸç¼“å†²åŒºçš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåªè¯»ç¼“å†²åŒºçš„å†…å®¹ä¹Ÿéšä¹‹å‘ç”Ÿå˜åŒ–ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//åªè¯»ç¼“å†²åŒº</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test02</span><span class=\"hljs-params\">()</span>{\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">10</span>);\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; buffer.capacity(); i++) {\n            buffer.put((<span class=\"hljs-type\">byte</span>)i);\n        }\n        <span class=\"hljs-comment\">//åˆ›å»ºåªè¯»ç¼“å†²åŒº</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">readOnlyBuffer</span> <span class=\"hljs-operator\">=</span> buffer.asReadOnlyBuffer();\n\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">i</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; i &lt; buffer.capacity(); i++) {\n            <span class=\"hljs-type\">byte</span> <span class=\"hljs-variable\">b</span> <span class=\"hljs-operator\">=</span> buffer.get(i);\n            b*=<span class=\"hljs-number\">10</span>;\n            buffer.put(i,b);\n        }\n        readOnlyBuffer.position(<span class=\"hljs-number\">0</span>);\n        readOnlyBuffer.limit(buffer.capacity());\n        <span class=\"hljs-keyword\">while</span> (readOnlyBuffer.remaining()&gt;<span class=\"hljs-number\">0</span>){\n            System.out.println(readOnlyBuffer.get());\n        }\n    }\n</code></div></pre>\n<p>å¦‚æœå°è¯•ä¿®æ”¹åªè¯»ç¼“å†²åŒºçš„å†…å®¹ï¼Œåˆ™ä¼šæŠ¥ ReadOnlyBufferException å¼‚å¸¸ã€‚åªè¯»ç¼“å†² åŒºå¯¹äºä¿æŠ¤æ•°æ®å¾ˆæœ‰ç”¨ã€‚åœ¨å°†ç¼“å†²åŒºä¼ é€’ç»™æŸä¸ª å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæ— æ³•çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯ å¦ä¼šä¿®æ”¹ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚åˆ›å»ºä¸€ä¸ªåªè¯»çš„ç¼“å†²åŒºå¯ä»¥ä¿è¯è¯¥ç¼“å†²åŒºä¸ä¼šè¢«ä¿®æ”¹ã€‚åª å¯ä»¥æŠŠå¸¸è§„ç¼“å†²åŒºè½¬æ¢ä¸ºåªè¯»ç¼“å†²åŒºï¼Œè€Œä¸èƒ½å°†åªè¯»çš„ç¼“å†²åŒºè½¬æ¢ä¸ºå¯å†™çš„ç¼“å†²åŒºã€‚</p>\n<h4><a id=\"83__230\"></a>8.3 ç›´æ¥ç¼“å†²åŒº</h4>\n<p>ç›´æ¥ç¼“å†²åŒºæ˜¯ä¸ºåŠ å¿« I/O é€Ÿåº¦ï¼Œä½¿ç”¨ä¸€ç§ç‰¹æ®Šæ–¹å¼ä¸ºå…¶åˆ†é…å†…å­˜çš„ç¼“å†²åŒºï¼ŒJDK æ–‡æ¡£ ä¸­çš„æè¿°ä¸ºï¼šç»™å®šä¸€ä¸ªç›´æ¥å­—èŠ‚ç¼“å†²åŒºï¼ŒJava è™šæ‹Ÿæœºå°†å°½æœ€å¤§åŠªåŠ›ç›´æ¥å¯¹å®ƒæ‰§è¡Œæœ¬æœº I/O æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡è°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿçš„æœ¬æœº I/O æ“ä½œä¹‹å‰(æˆ–ä¹‹å)ï¼Œ å°è¯•é¿å…å°†ç¼“å†²åŒºçš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºä¸­ æˆ–è€…ä»ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºä¸­æ‹·è´æ•°æ®ã€‚ è¦åˆ†é…ç›´æ¥ç¼“å†²åŒºï¼Œéœ€è¦è°ƒç”¨ allocateDirect()æ–¹æ³•ï¼Œè€Œä¸æ˜¯ allocate()æ–¹æ³•ï¼Œä½¿ç”¨æ–¹ å¼ä¸æ™®é€šç¼“å†²åŒºå¹¶æ— åŒºåˆ«ã€‚<br />\næ‹·è´æ–‡ä»¶ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//ç›´æ¥ç¼“å†²åŒº</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test03</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">infile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;D:\\\\111.txt&quot;</span>;\n        <span class=\"hljs-type\">FileInputStream</span> <span class=\"hljs-variable\">fin</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileInputStream</span>(infile);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">finChannel</span> <span class=\"hljs-operator\">=</span> fin.getChannel();\n\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">outfile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;D:\\\\222.txt&quot;</span>;\n        <span class=\"hljs-type\">FileOutputStream</span> <span class=\"hljs-variable\">fout</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileOutputStream</span>(outfile);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">foutChannel</span> <span class=\"hljs-operator\">=</span> fout.getChannel();\n\n        <span class=\"hljs-comment\">//åˆ›å»ºç›´æ¥ç¼“å†²åŒº</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocateDirect(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-keyword\">while</span> (<span class=\"hljs-literal\">true</span>){\n            buffer.clear();\n            <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">r</span> <span class=\"hljs-operator\">=</span> finChannel.read(buffer);\n            <span class=\"hljs-keyword\">if</span>(r==-<span class=\"hljs-number\">1</span>){\n                <span class=\"hljs-keyword\">break</span>;\n            }\n            buffer.flip();\n            foutChannel.write(buffer);\n        }\n    }\n</code></div></pre>\n<h4><a id=\"84__IO_259\"></a>8.4 å†…å­˜æ˜ å°„æ–‡ä»¶ I/O</h4>\n<p>å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€š é“çš„ I/O å¿«çš„å¤šã€‚å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯é€šè¿‡ä½¿æ–‡ä»¶ä¸­çš„æ•°æ®å‡ºç°ä¸º å†…å­˜æ•°ç»„çš„å†…å®¹æ¥ å®Œæˆçš„ï¼Œè¿™å…¶åˆå¬èµ·æ¥ä¼¼ä¹ä¸è¿‡å°±æ˜¯å°†æ•´ä¸ªæ–‡ä»¶è¯»åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯äº‹å®ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰æ–‡ä»¶ä¸­å®é™…è¯»å–æˆ–è€…å†™å…¥çš„éƒ¨åˆ†æ‰ä¼šæ˜ å°„åˆ°å†…å­˜ä¸­ã€‚ ç¤ºä¾‹ä»£ç ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">start</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>; \n<span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">size</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1024</span>;\n\n<span class=\"hljs-comment\">//å†…å­˜æ˜ å°„æ–‡ä»¶</span>\n    <span class=\"hljs-meta\">@Test</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">test04</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">raf</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">fc</span> <span class=\"hljs-operator\">=</span> raf.getChannel();\n        <span class=\"hljs-type\">MappedByteBuffer</span> <span class=\"hljs-variable\">mbb</span> <span class=\"hljs-operator\">=</span> fc.map(FileChannel.MapMode.READ_WRITE, start, size);\n        mbb.put(<span class=\"hljs-number\">0</span>, (<span class=\"hljs-type\">byte</span>) <span class=\"hljs-number\">97</span>);\n        mbb.put(<span class=\"hljs-number\">1023</span>, (<span class=\"hljs-type\">byte</span>) <span class=\"hljs-number\">122</span>);\n        raf.close();\n    }\n</code></div></pre>\n');
INSERT INTO `article_content` VALUES ('ace86a2c5d5c94e559bbfe3158d342fc', '### 1 Channel æ¦‚è¿°\nJava NIO çš„é€šé“ç±»ä¼¼æµï¼Œä½†åˆæœ‰äº›ä¸åŒï¼š\n1. æ—¢å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ°é€šé“ã€‚ä½†æµçš„è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ã€‚\n2. é€šé“å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ã€‚\n3. é€šé“ä¸­çš„æ•°æ®æ€»æ˜¯è¦å…ˆè¯»åˆ°ä¸€ä¸ª Bufferï¼Œæˆ–è€…æ€»æ˜¯è¦ä»ä¸€ä¸ª Buffer ä¸­å†™å…¥ã€‚\n\næ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œä»é€šé“è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥æ•°æ®åˆ°é€šé“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/1e486540ca1647729ae0d8ec82573a98.png)\n\n:::\n\n### 2 Channel å®ç°\nä¸‹é¢æ˜¯ Java NIO ä¸­æœ€é‡è¦çš„ Channel çš„å®ç°ï¼š\n1. FileChannelï¼ˆä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼‰\n2. DatagramChannelï¼ˆèƒ½é€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ï¼‰\n3. SocketChannelï¼ˆèƒ½é€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ï¼‰\n4. ServerSocketChannelï¼ˆå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œåƒ Web æœåŠ¡å™¨é‚£æ ·ã€‚å¯¹ æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelï¼‰\n\næ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›é€šé“æ¶µç›–äº† UDP å’Œ TCP ç½‘ç»œ IOï¼Œä»¥åŠæ–‡ä»¶ IO\n\n### 3 FileChannel ä»‹ç»å’Œç¤ºä¾‹\nFileChannel ç±»å¯ä»¥å®ç°å¸¸ç”¨çš„ readï¼Œwrite ä»¥åŠ scatter/gather æ“ä½œï¼ŒåŒæ—¶å®ƒä¹Ÿæ ä¾›äº†å¾ˆå¤šä¸“ç”¨äºæ–‡ä»¶çš„æ–°æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸­çš„è®¸å¤šéƒ½æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„æ–‡ä»¶æ“ä½œã€‚\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/04651f0d2f5a4406a16a901e27f75f95.png)\n\n:::\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ FileChannel è¯»å–æ•°æ®åˆ° Buffer ä¸­çš„ç¤ºä¾‹ï¼š\n```java\npublic class FileChannelDemo01 {\n    //FileChannelè¯»å–æ•°æ®åˆ°bufferä¸­\n    public static void main(String[] args) throws Exception {\n        //åˆ›å»ºFileChannel\n        RandomAccessFile accessFile = new RandomAccessFile(\"d:\\\\333.txt\", \"rw\");\n        FileChannel channel = accessFile.getChannel();\n        //åˆ›å»ºBuffer\n        ByteBuffer  buf = ByteBuffer.allocate(1024);\n        //è¯»å–æ•°æ®åˆ°bufferä¸­\n        int bytesRead = channel.read(buf);\n        while (bytesRead !=-1){\n            System.out.println(\"è¯»å–äº†ï¼š\"+bytesRead);\n            buf.flip();\n            while (buf.hasRemaining()){\n                System.out.println((char) buf.get());\n            }\n            buf.clear();\n            bytesRead = channel.read(buf);\n        }\n        accessFile.close();\n        System.out.println(\"ç»“æŸäº†\");\n    }\n}\n```\n\nBuffer é€šå¸¸çš„æ“ä½œ\n1. å°†æ•°æ®å†™å…¥ç¼“å†²åŒº\n2. è°ƒç”¨ buffer.flip() åè½¬è¯»å†™æ¨¡å¼\n3. ä»ç¼“å†²åŒºè¯»å–æ•°æ®\n4. è°ƒç”¨ buffer.clear() æˆ– buffer.compact() æ¸…é™¤ç¼“å†²åŒºå†…å®¹\n\n### 4 FileChannel æ“ä½œè¯¦è§£\n\n#### 4.1 æ‰“å¼€ FileChannel\nåœ¨ä½¿ç”¨ FileChannel ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰“å¼€å®ƒã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ‰“å¼€ä¸€ä¸ª FileChannelï¼Œéœ€è¦é€šè¿‡ä½¿ç”¨ä¸€ä¸ª InputStreamã€OutputStream æˆ– RandomAccessFile æ¥è·å–ä¸€ä¸ª FileChannel å®ä¾‹ã€‚ä¸‹é¢æ˜¯é€šè¿‡ RandomAccessFile æ‰“å¼€ FileChannel çš„ç¤ºä¾‹ï¼š\n```java\nRandomAccessFile accessFile = new RandomAccessFile(\"d:\\\\333.txt\", \"rw\");\nFileChannel channel = accessFile.getChannel();\n```\n#### 4.2 ä» FileChannel è¯»å–æ•°æ®\nè°ƒç”¨å¤šä¸ª read()æ–¹æ³•ä¹‹ä¸€ä» FileChannel ä¸­è¯»å–æ•°æ®ã€‚å¦‚ï¼š\n```java\nByteBuffer  buf = ByteBuffer.allocate(1024);\n//è¯»å–æ•°æ®åˆ°bufferä¸­\nint bytesRead = channel.read(buf);\n```\né¦–å…ˆï¼Œåˆ†é…ä¸€ä¸ª Bufferã€‚ä» FileChannel ä¸­è¯»å–çš„æ•°æ®å°†è¢«è¯»åˆ° Buffer ä¸­ã€‚ç„¶åï¼Œè°ƒ ç”¨ FileChannel.read()æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†æ•°æ®ä» FileChannel è¯»å–åˆ° Buffer ä¸­ã€‚read() æ–¹æ³•è¿”å›çš„ int å€¼è¡¨ç¤ºäº†æœ‰å¤šå°‘å­—èŠ‚è¢«è¯»åˆ°äº† Buffer ä¸­ã€‚å¦‚æœè¿”å›-1ï¼Œè¡¨ç¤ºåˆ°äº†æ–‡ä»¶ æœ«å°¾ã€‚\n\n####4.3 å‘ FileChannel å†™æ•°æ®\nä½¿ç”¨ FileChannel.write()æ–¹æ³•å‘ FileChannel å†™æ•°æ®ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª Bufferã€‚ å¦‚ï¼š\n```java\npublic class FileChannelDemo02 {\n    public static void main(String[] args) throws Exception {\n        RandomAccessFile accessFile = new RandomAccessFile(\"d:\\\\111.txt\", \"rw\");\n        FileChannel channel = accessFile.getChannel();\n        //åˆ›å»ºBufferå¯¹è±¡\n        ByteBuffer buffer = ByteBuffer.allocate(1024);\n        String newData = \"hello word\";\n        buffer.clear();\n        //å†™å…¥å†…å®¹\n        buffer.put(newData.getBytes(StandardCharsets.UTF_8));\n        buffer.flip();\n        //FileChannelå®Œæˆæœ€ç»ˆå®ç°\n        while (buffer.hasRemaining()){\n            channel.write(buffer);\n        }\n        channel.close();\n    }\n}\n```\n#### 4.4 å…³é—­ FileChannel\nç”¨å®Œ FileChannel åå¿…é¡»å°†å…¶å…³é—­ã€‚å¦‚ï¼š\n```java\nchannel.close();\n```\n\n#### 4.5 FileChannel çš„ position æ–¹æ³•\næœ‰æ—¶å¯èƒ½éœ€è¦åœ¨ FileChannel çš„æŸä¸ªç‰¹å®šä½ç½®è¿›è¡Œæ•°æ®çš„è¯»/å†™æ“ä½œã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ position()æ–¹æ³•è·å– FileChannel çš„å½“å‰ä½ç½®ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ position(long pos)æ–¹ æ³•è®¾ç½® FileChannel çš„å½“å‰ä½ç½®ã€‚\n\nè¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­:\n```java\nlong pos = channel.position(); \nchannel.position(pos +123);\n```\nå¦‚æœå°†ä½ç½®è®¾ç½®åœ¨æ–‡ä»¶ç»“æŸç¬¦ä¹‹åï¼Œç„¶åè¯•å›¾ä»æ–‡ä»¶é€šé“ä¸­è¯»å–æ•°æ®ï¼Œè¯»æ–¹æ³•å°†è¿”å›- 1 ï¼ˆæ–‡ä»¶ç»“æŸæ ‡å¿—ï¼‰ã€‚\nå¦‚æœå°†ä½ç½®è®¾ç½®åœ¨æ–‡ä»¶ç»“æŸç¬¦ä¹‹åï¼Œç„¶åå‘é€šé“ä¸­å†™æ•°æ®ï¼Œæ–‡ä»¶å°†æ’‘å¤§åˆ°å½“å‰ä½ç½®å¹¶ å†™å…¥æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´â€œæ–‡ä»¶ç©ºæ´â€ï¼Œç£ç›˜ä¸Šç‰©ç†æ–‡ä»¶ä¸­å†™å…¥çš„æ•°æ®é—´æœ‰ç©ºéš™ã€‚\n\n#### 4.6 FileChannel çš„ size æ–¹æ³•\nFileChannel å®ä¾‹çš„ size()æ–¹æ³•å°†è¿”å›è¯¥å®ä¾‹æ‰€å…³è”æ–‡ä»¶çš„å¤§å°ã€‚å¦‚:\n\n```java\nlong fileSize = channel.size();\n```\n#### 4.7 FileChannel çš„ truncate æ–¹æ³•\nå¯ä»¥ä½¿ç”¨ FileChannel.truncate()æ–¹æ³•æˆªå–ä¸€ä¸ªæ–‡ä»¶ã€‚æˆªå–æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å°†ä¸­æŒ‡å®šé•¿åº¦ åé¢çš„éƒ¨åˆ†å°†è¢«åˆ é™¤ã€‚å¦‚ï¼š\n\n```java\nchannel.truncate(1024);\n```\nè¿™ä¸ªä¾‹å­æˆªå–æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚ã€‚\n\n#### 4.8 FileChannel çš„ force æ–¹æ³•\n\nFileChannel.force()æ–¹æ³•å°†é€šé“é‡Œå°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®å¼ºåˆ¶å†™åˆ°ç£ç›˜ä¸Šã€‚å‡ºäºæ€§èƒ½æ–¹ é¢çš„è€ƒè™‘ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯å†™å…¥åˆ° FileChannel é‡Œçš„ æ•°æ®ä¸€å®šä¼šå³æ—¶å†™åˆ°ç£ç›˜ä¸Šã€‚è¦ä¿è¯è¿™ä¸€ç‚¹ï¼Œéœ€è¦è°ƒç”¨ force()æ–¹æ³•ã€‚\n\nforce()æ–¹æ³•æœ‰ä¸€ä¸ª boolean ç±»å‹çš„å‚æ•°ï¼ŒæŒ‡æ˜æ˜¯å¦åŒæ—¶å°†æ–‡ä»¶å…ƒæ•°æ®ï¼ˆæƒé™ä¿¡æ¯ç­‰ï¼‰ å†™åˆ°ç£ç›˜ä¸Šã€‚\n\n#### 4.9 FileChannel çš„ transferTo å’Œ transferFrom æ–¹æ³•\né€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼š\nå¦‚æœä¸¤ä¸ªé€šé“ä¸­æœ‰ä¸€ä¸ªæ˜¯ FileChannelï¼Œé‚£ä½ å¯ä»¥ç›´æ¥å°†æ•°æ®ä»ä¸€ä¸ª channel ä¼ è¾“åˆ° å¦å¤–ä¸€ä¸ª channel\n- transferFrom()æ–¹æ³•\nFileChannel çš„ transferFrom()æ–¹æ³•å¯ä»¥å°†æ•°æ®ä»æºé€šé“ä¼ è¾“åˆ° FileChannel ä¸­ï¼ˆè¯‘ è€…æ³¨ï¼šè¿™ä¸ªæ–¹æ³•åœ¨ JDK æ–‡æ¡£ä¸­çš„è§£é‡Šä¸ºå°†å­—èŠ‚ä»ç»™å®šçš„å¯è¯»å–å­—èŠ‚é€šé“ä¼ è¾“åˆ°æ­¤é€šé“ çš„æ–‡ä»¶ä¸­ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª FileChannel å®Œæˆæ–‡ä»¶é—´çš„å¤åˆ¶çš„ä¾‹å­ï¼š\n```java\npublic class FileChannelDemo03 {\n    public static void main(String[] args)  throws Exception{\n        //åˆ›å»ºä¸¤ä¸ªé€šé“\n        RandomAccessFile aFile = new RandomAccessFile(\"d:\\\\111.txt\", \"rw\");\n        FileChannel fromChannel = aFile.getChannel();\n\n        RandomAccessFile bFile = new RandomAccessFile(\"d:\\\\02.txt\", \"rw\");\n        FileChannel toChannel = bFile.getChannel();\n        //fromChannel ä¼ è¾“åˆ° toChannel\n        long position = 0;\n        long size = fromChannel.size();\n        toChannel.transferFrom(fromChannel,position,size);\n\n        aFile.close();\n        bFile.close();\n        System.out.println(\"over!\");\n    }\n}\n```\n\næ–¹æ³•çš„è¾“å…¥å‚æ•° position è¡¨ç¤ºä» position å¤„å¼€å§‹å‘ç›®æ ‡æ–‡ä»¶å†™å…¥æ•°æ®ï¼Œcount è¡¨ç¤ºæœ€ å¤šä¼ è¾“çš„å­—èŠ‚æ•°ã€‚å¦‚æœæºé€šé“çš„å‰©ä½™ç©ºé—´å°äº count ä¸ªå­—èŠ‚ï¼Œåˆ™æ‰€ä¼ è¾“çš„å­—èŠ‚æ•°è¦å° äºè¯·æ±‚çš„å­—èŠ‚æ•°ã€‚æ­¤å¤–è¦æ³¨æ„ï¼Œåœ¨ SoketChannel çš„å®ç°ä¸­ï¼ŒSocketChannel åªä¼šä¼  è¾“æ­¤åˆ»å‡†å¤‡å¥½çš„æ•°æ®ï¼ˆå¯èƒ½ä¸è¶³ count å­—èŠ‚ï¼‰ã€‚å› æ­¤ï¼ŒSocketChannel å¯èƒ½ä¸ä¼šå°†è¯· æ±‚çš„æ‰€æœ‰æ•°æ®(count ä¸ªå­—èŠ‚)å…¨éƒ¨ä¼ è¾“åˆ° FileChannel ä¸­ã€‚\n\n- transferTo()æ–¹æ³•\n\ntransferTo()æ–¹æ³•å°†æ•°æ®ä» FileChannel ä¼ è¾“åˆ°å…¶ä»–çš„ channel ä¸­ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ª transferTo()æ–¹æ³•çš„ä¾‹å­ï¼š\n```java\npublic class FileChannelDemo04 {\n    public static void main(String[] args) throws Exception {\n        //åˆ›å»ºä¸¤ä¸ªé€šé“\n        RandomAccessFile aFile = new RandomAccessFile(\"d:\\\\111.txt\", \"rw\");\n        FileChannel fromChannel = aFile.getChannel();\n        RandomAccessFile bFile = new RandomAccessFile(\"d:\\\\03.txt\", \"rw\");\n        FileChannel toChannel = bFile.getChannel();\n        long position = 0;\n        long count = fromChannel.size();\n        fromChannel.transferTo(position, count, toChannel);\n        aFile.close();\n        bFile.close();\n        System.out.println(\"over!\");\n    }\n}\n```\n### 5 Scatter/Gather\nJava NIO å¼€å§‹æ”¯æŒ scatter/gatherï¼Œscatter/gather ç”¨äºæè¿°ä» Channel ä¸­è¯»å–æˆ– è€…å†™å…¥åˆ° Channel çš„æ“ä½œã€‚\n\n==åˆ†æ•£==ï¼ˆscatterï¼‰ä» Channel ä¸­è¯»å–æ˜¯æŒ‡åœ¨è¯»æ“ä½œæ—¶å°†è¯»å–çš„æ•°æ®å†™å…¥å¤šä¸ª buffer ä¸­ã€‚ å› æ­¤ï¼ŒChannel å°†ä» Channel ä¸­è¯»å–çš„æ•°æ®â€œåˆ†æ•£ï¼ˆscatterï¼‰â€åˆ°å¤šä¸ª Buffer ä¸­ã€‚\n\n==èšé›†==ï¼ˆgatherï¼‰å†™å…¥ Channel æ˜¯æŒ‡åœ¨å†™æ“ä½œæ—¶å°†å¤šä¸ª buffer çš„æ•°æ®å†™å…¥åŒä¸€ä¸ª Channelï¼Œå› æ­¤ï¼ŒChannel å°†å¤šä¸ª Buffer ä¸­çš„æ•°æ®â€œèšé›†ï¼ˆgatherï¼‰â€åå‘é€åˆ° Channelã€‚\n\nscatter / gather ç»å¸¸ç”¨äºéœ€è¦å°†ä¼ è¾“çš„æ•°æ®åˆ†å¼€å¤„ç†çš„åœºåˆï¼Œä¾‹å¦‚ä¼ è¾“ä¸€ä¸ªç”±æ¶ˆæ¯å¤´ å’Œæ¶ˆæ¯ä½“ç»„æˆçš„æ¶ˆæ¯ï¼Œä½ å¯èƒ½ä¼šå°†æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å¤´åˆ†æ•£åˆ°ä¸åŒçš„ buffer ä¸­ï¼Œè¿™æ ·ä½ å¯ ä»¥æ–¹ä¾¿çš„å¤„ç†æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ã€‚\n\n#### 5.1 Scattering Reads\nScattering Reads æ˜¯æŒ‡æ•°æ®ä»ä¸€ä¸ª channel è¯»å–åˆ°å¤šä¸ª buffer ä¸­ã€‚å¦‚ä¸‹å›¾æè¿°ï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/3020d19255734776aea5f650ebd4946b.png)\n\n:::\n\n```java\nByteBuffer header = ByteBuffer.allocate(128); \nByteBuffer body = ByteBuffer.allocate(1024);\nByteBuffer[] bufferArray = { header, body }; \nchannel.read(bufferArray);\n```\næ³¨æ„ buffer é¦–å…ˆè¢«æ’å…¥åˆ°æ•°ç»„ï¼Œç„¶åå†å°†æ•°ç»„ä½œä¸º channel.read() çš„è¾“å…¥å‚æ•°ã€‚ read()æ–¹æ³•æŒ‰ç…§ buffer åœ¨æ•°ç»„ä¸­çš„é¡ºåºå°†ä» channel ä¸­è¯»å–çš„æ•°æ®å†™å…¥åˆ° bufferï¼Œå½“ ä¸€ä¸ª buffer è¢«å†™æ»¡åï¼Œchannel ç´§æ¥ç€å‘å¦ä¸€ä¸ª buffer ä¸­å†™ã€‚\n\nScattering Reads åœ¨ç§»åŠ¨ä¸‹ä¸€ä¸ª buffer å‰ï¼Œå¿…é¡»å¡«æ»¡å½“å‰çš„ bufferï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒ ä¸é€‚ç”¨äºåŠ¨æ€æ¶ˆæ¯(è¯‘è€…æ³¨ï¼šæ¶ˆæ¯å¤§å°ä¸å›ºå®š)ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå­˜åœ¨æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œ æ¶ˆæ¯å¤´å¿…é¡»å®Œæˆå¡«å……ï¼ˆä¾‹å¦‚ 128byteï¼‰ï¼ŒScattering Reads æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚\n\n#### 5.2 Gathering Writes\nGathering Writes æ˜¯æŒ‡æ•°æ®ä»å¤šä¸ª buffer å†™å…¥åˆ°åŒä¸€ä¸ª channelã€‚å¦‚ä¸‹å›¾æè¿°ï¼š\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/175b692f36164285b91181519562fc1f.png)\n\n:::\n\n```java\nByteBuffer header = ByteBuffer.allocate(128); \nByteBuffer body = ByteBuffer.allocate(1024); \n//write data into buffers \nByteBuffer[] bufferArray = { header, body }; \nchannel.write(bufferArray);\n```\n\nbuffers æ•°ç»„æ˜¯ write()æ–¹æ³•çš„å…¥å‚ï¼Œwrite()æ–¹æ³•ä¼šæŒ‰ç…§ buffer åœ¨æ•°ç»„ä¸­çš„é¡ºåºï¼Œå°†æ•° æ®å†™å…¥åˆ° channelï¼Œæ³¨æ„åªæœ‰ position å’Œ limit ä¹‹é—´çš„æ•°æ®æ‰ä¼šè¢«å†™å…¥ã€‚å› æ­¤ï¼Œå¦‚æœ ä¸€ä¸ª buffer çš„å®¹é‡ä¸º 128byteï¼Œä½†æ˜¯ä»…ä»…åŒ…å« 58byte çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ 58byte çš„æ•° æ®å°†è¢«å†™å…¥åˆ° channel ä¸­ã€‚å› æ­¤ä¸ Scattering Reads ç›¸åï¼ŒGathering Writes èƒ½è¾ƒ å¥½çš„å¤„ç†åŠ¨æ€æ¶ˆæ¯ã€‚', '2022-09-30 15:13:36', '2022-10-08 16:25:20', '<h3><a id=\"1_Channel__0\"></a>1 Channel æ¦‚è¿°</h3>\n<p>Java NIO çš„é€šé“ç±»ä¼¼æµï¼Œä½†åˆæœ‰äº›ä¸åŒï¼š</p>\n<ol>\n<li>æ—¢å¯ä»¥ä»é€šé“ä¸­è¯»å–æ•°æ®ï¼Œåˆå¯ä»¥å†™æ•°æ®åˆ°é€šé“ã€‚ä½†æµçš„è¯»å†™é€šå¸¸æ˜¯å•å‘çš„ã€‚</li>\n<li>é€šé“å¯ä»¥å¼‚æ­¥åœ°è¯»å†™ã€‚</li>\n<li>é€šé“ä¸­çš„æ•°æ®æ€»æ˜¯è¦å…ˆè¯»åˆ°ä¸€ä¸ª Bufferï¼Œæˆ–è€…æ€»æ˜¯è¦ä»ä¸€ä¸ª Buffer ä¸­å†™å…¥ã€‚</li>\n</ol>\n<p>æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œä»é€šé“è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºï¼Œä»ç¼“å†²åŒºå†™å…¥æ•°æ®åˆ°é€šé“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/1e486540ca1647729ae0d8ec82573a98.png\" alt=\"image.png\" /></p>\n</div>\n<h3><a id=\"2_Channel__13\"></a>2 Channel å®ç°</h3>\n<p>ä¸‹é¢æ˜¯ Java NIO ä¸­æœ€é‡è¦çš„ Channel çš„å®ç°ï¼š</p>\n<ol>\n<li>FileChannelï¼ˆä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼‰</li>\n<li>DatagramChannelï¼ˆèƒ½é€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ï¼‰</li>\n<li>SocketChannelï¼ˆèƒ½é€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­çš„æ•°æ®ï¼‰</li>\n<li>ServerSocketChannelï¼ˆå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œåƒ Web æœåŠ¡å™¨é‚£æ ·ã€‚å¯¹ æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannelï¼‰</li>\n</ol>\n<p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›é€šé“æ¶µç›–äº† UDP å’Œ TCP ç½‘ç»œ IOï¼Œä»¥åŠæ–‡ä»¶ IO</p>\n<h3><a id=\"3_FileChannel__22\"></a>3 FileChannel ä»‹ç»å’Œç¤ºä¾‹</h3>\n<p>FileChannel ç±»å¯ä»¥å®ç°å¸¸ç”¨çš„ readï¼Œwrite ä»¥åŠ scatter/gather æ“ä½œï¼ŒåŒæ—¶å®ƒä¹Ÿæ ä¾›äº†å¾ˆå¤šä¸“ç”¨äºæ–‡ä»¶çš„æ–°æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ä¸­çš„è®¸å¤šéƒ½æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„æ–‡ä»¶æ“ä½œã€‚</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/04651f0d2f5a4406a16a901e27f75f95.png\" alt=\"image.png\" /></p>\n</div>\n<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ FileChannel è¯»å–æ•°æ®åˆ° Buffer ä¸­çš„ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FileChannelDemo01</span> {\n    <span class=\"hljs-comment\">//FileChannelè¯»å–æ•°æ®åˆ°bufferä¸­</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//åˆ›å»ºFileChannel</span>\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">accessFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\333.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> accessFile.getChannel();\n        <span class=\"hljs-comment\">//åˆ›å»ºBuffer</span>\n        <span class=\"hljs-type\">ByteBuffer</span>  <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-comment\">//è¯»å–æ•°æ®åˆ°bufferä¸­</span>\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">bytesRead</span> <span class=\"hljs-operator\">=</span> channel.read(buf);\n        <span class=\"hljs-keyword\">while</span> (bytesRead !=-<span class=\"hljs-number\">1</span>){\n            System.out.println(<span class=\"hljs-string\">&quot;è¯»å–äº†ï¼š&quot;</span>+bytesRead);\n            buf.flip();\n            <span class=\"hljs-keyword\">while</span> (buf.hasRemaining()){\n                System.out.println((<span class=\"hljs-type\">char</span>) buf.get());\n            }\n            buf.clear();\n            bytesRead = channel.read(buf);\n        }\n        accessFile.close();\n        System.out.println(<span class=\"hljs-string\">&quot;ç»“æŸäº†&quot;</span>);\n    }\n}\n</code></div></pre>\n<p>Buffer é€šå¸¸çš„æ“ä½œ</p>\n<ol>\n<li>å°†æ•°æ®å†™å…¥ç¼“å†²åŒº</li>\n<li>è°ƒç”¨ buffer.flip() åè½¬è¯»å†™æ¨¡å¼</li>\n<li>ä»ç¼“å†²åŒºè¯»å–æ•°æ®</li>\n<li>è°ƒç”¨ buffer.clear() æˆ– buffer.compact() æ¸…é™¤ç¼“å†²åŒºå†…å®¹</li>\n</ol>\n<h3><a id=\"4_FileChannel__63\"></a>4 FileChannel æ“ä½œè¯¦è§£</h3>\n<h4><a id=\"41__FileChannel_65\"></a>4.1 æ‰“å¼€ FileChannel</h4>\n<p>åœ¨ä½¿ç”¨ FileChannel ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰“å¼€å®ƒã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥æ‰“å¼€ä¸€ä¸ª FileChannelï¼Œéœ€è¦é€šè¿‡ä½¿ç”¨ä¸€ä¸ª InputStreamã€OutputStream æˆ– RandomAccessFile æ¥è·å–ä¸€ä¸ª FileChannel å®ä¾‹ã€‚ä¸‹é¢æ˜¯é€šè¿‡ RandomAccessFile æ‰“å¼€ FileChannel çš„ç¤ºä¾‹ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">accessFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\333.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n<span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> accessFile.getChannel();\n</code></div></pre>\n<h4><a id=\"42__FileChannel__71\"></a>4.2 ä» FileChannel è¯»å–æ•°æ®</h4>\n<p>è°ƒç”¨å¤šä¸ª read()æ–¹æ³•ä¹‹ä¸€ä» FileChannel ä¸­è¯»å–æ•°æ®ã€‚å¦‚ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuffer</span>  <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n<span class=\"hljs-comment\">//è¯»å–æ•°æ®åˆ°bufferä¸­</span>\n<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">bytesRead</span> <span class=\"hljs-operator\">=</span> channel.read(buf);\n</code></div></pre>\n<p>é¦–å…ˆï¼Œåˆ†é…ä¸€ä¸ª Bufferã€‚ä» FileChannel ä¸­è¯»å–çš„æ•°æ®å°†è¢«è¯»åˆ° Buffer ä¸­ã€‚ç„¶åï¼Œè°ƒ ç”¨ FileChannel.read()æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°†æ•°æ®ä» FileChannel è¯»å–åˆ° Buffer ä¸­ã€‚read() æ–¹æ³•è¿”å›çš„ int å€¼è¡¨ç¤ºäº†æœ‰å¤šå°‘å­—èŠ‚è¢«è¯»åˆ°äº† Buffer ä¸­ã€‚å¦‚æœè¿”å›-1ï¼Œè¡¨ç¤ºåˆ°äº†æ–‡ä»¶ æœ«å°¾ã€‚</p>\n<p>####4.3 å‘ FileChannel å†™æ•°æ®<br />\nä½¿ç”¨ FileChannel.write()æ–¹æ³•å‘ FileChannel å†™æ•°æ®ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª Bufferã€‚ å¦‚ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FileChannelDemo02</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">accessFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> accessFile.getChannel();\n        <span class=\"hljs-comment\">//åˆ›å»ºBufferå¯¹è±¡</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">newData</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;hello word&quot;</span>;\n        buffer.clear();\n        <span class=\"hljs-comment\">//å†™å…¥å†…å®¹</span>\n        buffer.put(newData.getBytes(StandardCharsets.UTF_8));\n        buffer.flip();\n        <span class=\"hljs-comment\">//FileChannelå®Œæˆæœ€ç»ˆå®ç°</span>\n        <span class=\"hljs-keyword\">while</span> (buffer.hasRemaining()){\n            channel.write(buffer);\n        }\n        channel.close();\n    }\n}\n</code></div></pre>\n<h4><a id=\"44__FileChannel_102\"></a>4.4 å…³é—­ FileChannel</h4>\n<p>ç”¨å®Œ FileChannel åå¿…é¡»å°†å…¶å…³é—­ã€‚å¦‚ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">channel.close();\n</code></div></pre>\n<h4><a id=\"45_FileChannel__position__108\"></a>4.5 FileChannel çš„ position æ–¹æ³•</h4>\n<p>æœ‰æ—¶å¯èƒ½éœ€è¦åœ¨ FileChannel çš„æŸä¸ªç‰¹å®šä½ç½®è¿›è¡Œæ•°æ®çš„è¯»/å†™æ“ä½œã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ position()æ–¹æ³•è·å– FileChannel çš„å½“å‰ä½ç½®ã€‚ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨ position(long pos)æ–¹ æ³•è®¾ç½® FileChannel çš„å½“å‰ä½ç½®ã€‚</p>\n<p>è¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­:</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">pos</span> <span class=\"hljs-operator\">=</span> channel.position(); \nchannel.position(pos +<span class=\"hljs-number\">123</span>);\n</code></div></pre>\n<p>å¦‚æœå°†ä½ç½®è®¾ç½®åœ¨æ–‡ä»¶ç»“æŸç¬¦ä¹‹åï¼Œç„¶åè¯•å›¾ä»æ–‡ä»¶é€šé“ä¸­è¯»å–æ•°æ®ï¼Œè¯»æ–¹æ³•å°†è¿”å›- 1 ï¼ˆæ–‡ä»¶ç»“æŸæ ‡å¿—ï¼‰ã€‚<br />\nå¦‚æœå°†ä½ç½®è®¾ç½®åœ¨æ–‡ä»¶ç»“æŸç¬¦ä¹‹åï¼Œç„¶åå‘é€šé“ä¸­å†™æ•°æ®ï¼Œæ–‡ä»¶å°†æ’‘å¤§åˆ°å½“å‰ä½ç½®å¹¶ å†™å…¥æ•°æ®ã€‚è¿™å¯èƒ½å¯¼è‡´â€œæ–‡ä»¶ç©ºæ´â€ï¼Œç£ç›˜ä¸Šç‰©ç†æ–‡ä»¶ä¸­å†™å…¥çš„æ•°æ®é—´æœ‰ç©ºéš™ã€‚</p>\n<h4><a id=\"46_FileChannel__size__119\"></a>4.6 FileChannel çš„ size æ–¹æ³•</h4>\n<p>FileChannel å®ä¾‹çš„ size()æ–¹æ³•å°†è¿”å›è¯¥å®ä¾‹æ‰€å…³è”æ–‡ä»¶çš„å¤§å°ã€‚å¦‚:</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">fileSize</span> <span class=\"hljs-operator\">=</span> channel.size();\n</code></div></pre>\n<h4><a id=\"47_FileChannel__truncate__125\"></a>4.7 FileChannel çš„ truncate æ–¹æ³•</h4>\n<p>å¯ä»¥ä½¿ç”¨ FileChannel.truncate()æ–¹æ³•æˆªå–ä¸€ä¸ªæ–‡ä»¶ã€‚æˆªå–æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å°†ä¸­æŒ‡å®šé•¿åº¦ åé¢çš„éƒ¨åˆ†å°†è¢«åˆ é™¤ã€‚å¦‚ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">channel.truncate(<span class=\"hljs-number\">1024</span>);\n</code></div></pre>\n<p>è¿™ä¸ªä¾‹å­æˆªå–æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚ã€‚</p>\n<h4><a id=\"48_FileChannel__force__133\"></a>4.8 FileChannel çš„ force æ–¹æ³•</h4>\n<p>FileChannel.force()æ–¹æ³•å°†é€šé“é‡Œå°šæœªå†™å…¥ç£ç›˜çš„æ•°æ®å¼ºåˆ¶å†™åˆ°ç£ç›˜ä¸Šã€‚å‡ºäºæ€§èƒ½æ–¹ é¢çš„è€ƒè™‘ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥æ— æ³•ä¿è¯å†™å…¥åˆ° FileChannel é‡Œçš„ æ•°æ®ä¸€å®šä¼šå³æ—¶å†™åˆ°ç£ç›˜ä¸Šã€‚è¦ä¿è¯è¿™ä¸€ç‚¹ï¼Œéœ€è¦è°ƒç”¨ force()æ–¹æ³•ã€‚</p>\n<p>force()æ–¹æ³•æœ‰ä¸€ä¸ª boolean ç±»å‹çš„å‚æ•°ï¼ŒæŒ‡æ˜æ˜¯å¦åŒæ—¶å°†æ–‡ä»¶å…ƒæ•°æ®ï¼ˆæƒé™ä¿¡æ¯ç­‰ï¼‰ å†™åˆ°ç£ç›˜ä¸Šã€‚</p>\n<h4><a id=\"49_FileChannel__transferTo__transferFrom__139\"></a>4.9 FileChannel çš„ transferTo å’Œ transferFrom æ–¹æ³•</h4>\n<p>é€šé“ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼š<br />\nå¦‚æœä¸¤ä¸ªé€šé“ä¸­æœ‰ä¸€ä¸ªæ˜¯ FileChannelï¼Œé‚£ä½ å¯ä»¥ç›´æ¥å°†æ•°æ®ä»ä¸€ä¸ª channel ä¼ è¾“åˆ° å¦å¤–ä¸€ä¸ª channel</p>\n<ul>\n<li>transferFrom()æ–¹æ³•<br />\nFileChannel çš„ transferFrom()æ–¹æ³•å¯ä»¥å°†æ•°æ®ä»æºé€šé“ä¼ è¾“åˆ° FileChannel ä¸­ï¼ˆè¯‘ è€…æ³¨ï¼šè¿™ä¸ªæ–¹æ³•åœ¨ JDK æ–‡æ¡£ä¸­çš„è§£é‡Šä¸ºå°†å­—èŠ‚ä»ç»™å®šçš„å¯è¯»å–å­—èŠ‚é€šé“ä¼ è¾“åˆ°æ­¤é€šé“ çš„æ–‡ä»¶ä¸­ï¼‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª FileChannel å®Œæˆæ–‡ä»¶é—´çš„å¤åˆ¶çš„ä¾‹å­ï¼š</li>\n</ul>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FileChannelDemo03</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span>  <span class=\"hljs-keyword\">throws</span> Exception{\n        <span class=\"hljs-comment\">//åˆ›å»ºä¸¤ä¸ªé€šé“</span>\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">aFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">fromChannel</span> <span class=\"hljs-operator\">=</span> aFile.getChannel();\n\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">bFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\02.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">toChannel</span> <span class=\"hljs-operator\">=</span> bFile.getChannel();\n        <span class=\"hljs-comment\">//fromChannel ä¼ è¾“åˆ° toChannel</span>\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">position</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">size</span> <span class=\"hljs-operator\">=</span> fromChannel.size();\n        toChannel.transferFrom(fromChannel,position,size);\n\n        aFile.close();\n        bFile.close();\n        System.out.println(<span class=\"hljs-string\">&quot;over!&quot;</span>);\n    }\n}\n</code></div></pre>\n<p>æ–¹æ³•çš„è¾“å…¥å‚æ•° position è¡¨ç¤ºä» position å¤„å¼€å§‹å‘ç›®æ ‡æ–‡ä»¶å†™å…¥æ•°æ®ï¼Œcount è¡¨ç¤ºæœ€ å¤šä¼ è¾“çš„å­—èŠ‚æ•°ã€‚å¦‚æœæºé€šé“çš„å‰©ä½™ç©ºé—´å°äº count ä¸ªå­—èŠ‚ï¼Œåˆ™æ‰€ä¼ è¾“çš„å­—èŠ‚æ•°è¦å° äºè¯·æ±‚çš„å­—èŠ‚æ•°ã€‚æ­¤å¤–è¦æ³¨æ„ï¼Œåœ¨ SoketChannel çš„å®ç°ä¸­ï¼ŒSocketChannel åªä¼šä¼  è¾“æ­¤åˆ»å‡†å¤‡å¥½çš„æ•°æ®ï¼ˆå¯èƒ½ä¸è¶³ count å­—èŠ‚ï¼‰ã€‚å› æ­¤ï¼ŒSocketChannel å¯èƒ½ä¸ä¼šå°†è¯· æ±‚çš„æ‰€æœ‰æ•°æ®(count ä¸ªå­—èŠ‚)å…¨éƒ¨ä¼ è¾“åˆ° FileChannel ä¸­ã€‚</p>\n<ul>\n<li>transferTo()æ–¹æ³•</li>\n</ul>\n<p>transferTo()æ–¹æ³•å°†æ•°æ®ä» FileChannel ä¼ è¾“åˆ°å…¶ä»–çš„ channel ä¸­ã€‚<br />\nä¸‹é¢æ˜¯ä¸€ä¸ª transferTo()æ–¹æ³•çš„ä¾‹å­ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FileChannelDemo04</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//åˆ›å»ºä¸¤ä¸ªé€šé“</span>\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">aFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">fromChannel</span> <span class=\"hljs-operator\">=</span> aFile.getChannel();\n        <span class=\"hljs-type\">RandomAccessFile</span> <span class=\"hljs-variable\">bFile</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">RandomAccessFile</span>(<span class=\"hljs-string\">&quot;d:\\\\03.txt&quot;</span>, <span class=\"hljs-string\">&quot;rw&quot;</span>);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">toChannel</span> <span class=\"hljs-operator\">=</span> bFile.getChannel();\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">position</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-type\">long</span> <span class=\"hljs-variable\">count</span> <span class=\"hljs-operator\">=</span> fromChannel.size();\n        fromChannel.transferTo(position, count, toChannel);\n        aFile.close();\n        bFile.close();\n        System.out.println(<span class=\"hljs-string\">&quot;over!&quot;</span>);\n    }\n}\n</code></div></pre>\n<h3><a id=\"5_ScatterGather_188\"></a>5 Scatter/Gather</h3>\n<p>Java NIO å¼€å§‹æ”¯æŒ scatter/gatherï¼Œscatter/gather ç”¨äºæè¿°ä» Channel ä¸­è¯»å–æˆ– è€…å†™å…¥åˆ° Channel çš„æ“ä½œã€‚</p>\n<p><mark>åˆ†æ•£</mark>ï¼ˆscatterï¼‰ä» Channel ä¸­è¯»å–æ˜¯æŒ‡åœ¨è¯»æ“ä½œæ—¶å°†è¯»å–çš„æ•°æ®å†™å…¥å¤šä¸ª buffer ä¸­ã€‚ å› æ­¤ï¼ŒChannel å°†ä» Channel ä¸­è¯»å–çš„æ•°æ®â€œåˆ†æ•£ï¼ˆscatterï¼‰â€åˆ°å¤šä¸ª Buffer ä¸­ã€‚</p>\n<p><mark>èšé›†</mark>ï¼ˆgatherï¼‰å†™å…¥ Channel æ˜¯æŒ‡åœ¨å†™æ“ä½œæ—¶å°†å¤šä¸ª buffer çš„æ•°æ®å†™å…¥åŒä¸€ä¸ª Channelï¼Œå› æ­¤ï¼ŒChannel å°†å¤šä¸ª Buffer ä¸­çš„æ•°æ®â€œèšé›†ï¼ˆgatherï¼‰â€åå‘é€åˆ° Channelã€‚</p>\n<p>scatter / gather ç»å¸¸ç”¨äºéœ€è¦å°†ä¼ è¾“çš„æ•°æ®åˆ†å¼€å¤„ç†çš„åœºåˆï¼Œä¾‹å¦‚ä¼ è¾“ä¸€ä¸ªç”±æ¶ˆæ¯å¤´ å’Œæ¶ˆæ¯ä½“ç»„æˆçš„æ¶ˆæ¯ï¼Œä½ å¯èƒ½ä¼šå°†æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å¤´åˆ†æ•£åˆ°ä¸åŒçš„ buffer ä¸­ï¼Œè¿™æ ·ä½ å¯ ä»¥æ–¹ä¾¿çš„å¤„ç†æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ã€‚</p>\n<h4><a id=\"51_Scattering_Reads_197\"></a>5.1 Scattering Reads</h4>\n<p>Scattering Reads æ˜¯æŒ‡æ•°æ®ä»ä¸€ä¸ª channel è¯»å–åˆ°å¤šä¸ª buffer ä¸­ã€‚å¦‚ä¸‹å›¾æè¿°ï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/3020d19255734776aea5f650ebd4946b.png\" alt=\"image.png\" /></p>\n</div>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">header</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">128</span>); \n<span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">body</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\nByteBuffer[] bufferArray = { header, body }; \nchannel.read(bufferArray);\n</code></div></pre>\n<p>æ³¨æ„ buffer é¦–å…ˆè¢«æ’å…¥åˆ°æ•°ç»„ï¼Œç„¶åå†å°†æ•°ç»„ä½œä¸º channel.read() çš„è¾“å…¥å‚æ•°ã€‚ read()æ–¹æ³•æŒ‰ç…§ buffer åœ¨æ•°ç»„ä¸­çš„é¡ºåºå°†ä» channel ä¸­è¯»å–çš„æ•°æ®å†™å…¥åˆ° bufferï¼Œå½“ ä¸€ä¸ª buffer è¢«å†™æ»¡åï¼Œchannel ç´§æ¥ç€å‘å¦ä¸€ä¸ª buffer ä¸­å†™ã€‚</p>\n<p>Scattering Reads åœ¨ç§»åŠ¨ä¸‹ä¸€ä¸ª buffer å‰ï¼Œå¿…é¡»å¡«æ»¡å½“å‰çš„ bufferï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒ ä¸é€‚ç”¨äºåŠ¨æ€æ¶ˆæ¯(è¯‘è€…æ³¨ï¼šæ¶ˆæ¯å¤§å°ä¸å›ºå®š)ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå­˜åœ¨æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œ æ¶ˆæ¯å¤´å¿…é¡»å®Œæˆå¡«å……ï¼ˆä¾‹å¦‚ 128byteï¼‰ï¼ŒScattering Reads æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</p>\n<h4><a id=\"52_Gathering_Writes_215\"></a>5.2 Gathering Writes</h4>\n<p>Gathering Writes æ˜¯æŒ‡æ•°æ®ä»å¤šä¸ª buffer å†™å…¥åˆ°åŒä¸€ä¸ª channelã€‚å¦‚ä¸‹å›¾æè¿°ï¼š</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/09/30/175b692f36164285b91181519562fc1f.png\" alt=\"image.png\" /></p>\n</div>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">header</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">128</span>); \n<span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">body</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>); \n<span class=\"hljs-comment\">//write data into buffers </span>\nByteBuffer[] bufferArray = { header, body }; \nchannel.write(bufferArray);\n</code></div></pre>\n<p>buffers æ•°ç»„æ˜¯ write()æ–¹æ³•çš„å…¥å‚ï¼Œwrite()æ–¹æ³•ä¼šæŒ‰ç…§ buffer åœ¨æ•°ç»„ä¸­çš„é¡ºåºï¼Œå°†æ•° æ®å†™å…¥åˆ° channelï¼Œæ³¨æ„åªæœ‰ position å’Œ limit ä¹‹é—´çš„æ•°æ®æ‰ä¼šè¢«å†™å…¥ã€‚å› æ­¤ï¼Œå¦‚æœ ä¸€ä¸ª buffer çš„å®¹é‡ä¸º 128byteï¼Œä½†æ˜¯ä»…ä»…åŒ…å« 58byte çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ 58byte çš„æ•° æ®å°†è¢«å†™å…¥åˆ° channel ä¸­ã€‚å› æ­¤ä¸ Scattering Reads ç›¸åï¼ŒGathering Writes èƒ½è¾ƒ å¥½çš„å¤„ç†åŠ¨æ€æ¶ˆæ¯ã€‚</p>\n');
INSERT INTO `article_content` VALUES ('edb409243c0e1b8a819fe729b6566ab2', '### 1 Pipe\n\nJava NIO ç®¡é“æ˜¯ 2 ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿æ¥ã€‚Pipe æœ‰ä¸€ä¸ª source é€šé“å’Œä¸€ä¸ª sink é€šé“ã€‚æ•°æ®ä¼šè¢«å†™åˆ° sink é€šé“ï¼Œä» source é€šé“è¯»å–ã€‚\n\n::: hljs-center\n\n![image.png](https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/2f9b2e23b0414df2a415fbd52fca6338.png)\n\n:::\n\n#### 1.1 åˆ›å»ºç®¡é“\né€šè¿‡ Pipe.open()æ–¹æ³•æ‰“å¼€ç®¡é“ã€‚\n```java\nPipe pipe = Pipe.open();\n```\n\n#### 1.2 å†™å…¥ç®¡é“\nè¦å‘ç®¡é“å†™æ•°æ®ï¼Œéœ€è¦è®¿é—® sink é€šé“ã€‚ï¼š\n```java\nPipe.SinkChannel sinkChannel = pipe.sink();\n```\n\né€šè¿‡è°ƒç”¨ SinkChannel çš„ write()æ–¹æ³•ï¼Œå°†æ•°æ®å†™å…¥ SinkChannelï¼š\n```java\nString newData = \"New String to write to file...\" + System.currentTimeMillis(); \nByteBuffer buf = ByteBuffer.allocate(48); \nbuf.clear(); buf.put(newData.getBytes()); \nbuf.flip(); \nwhile(buf.hasRemaining()) { \nsinkChannel.write(buf); \n}\n```\n\n#### 1.3 ä»ç®¡é“è¯»å–æ•°æ®\nä»è¯»å–ç®¡é“çš„æ•°æ®ï¼Œéœ€è¦è®¿é—® source é€šé“ï¼Œåƒè¿™æ ·ï¼š\n```java\nPipe.SourceChannel sourceChannel = pipe.source();\n```\n\nè°ƒç”¨ source é€šé“çš„ read()æ–¹æ³•æ¥è¯»å–æ•°æ®ï¼š\n```java\nByteBuffer buf = ByteBuffer.allocate(48); \nint bytesRead = sourceChannel.read(buf);\n```\nread()æ–¹æ³•è¿”å›çš„ int å€¼ä¼šå‘Šè¯‰æˆ‘ä»¬å¤šå°‘å­—èŠ‚è¢«è¯»è¿›äº†ç¼“å†²åŒºã€‚\n\n#### 1.4 ç¤ºä¾‹\n```java\npublic static void main(String[] args) throws Exception {\n        //è·å–ç®¡é“\n        Pipe pipe = Pipe.open();\n        //è·å–sinké€šé“\n        Pipe.SinkChannel sinkChannel = pipe.sink();\n        //åˆ›å»ºç¼“å†²åŒº\n        ByteBuffer byteBuffer = ByteBuffer.allocate(1024);\n        byteBuffer.put(\"Jzjzzzz\".getBytes(StandardCharsets.UTF_8));\n        byteBuffer.flip();\n        //å†™å…¥æ•°æ®\n        sinkChannel.write(byteBuffer);\n        //è·å–sourceé€šé“\n        Pipe.SourceChannel sourceChannel = pipe.source();\n        //åˆ›å»ºç¼“å†²åŒº,è¯»å–æ•°æ®\n        //ByteBuffer byteBuffer2 = ByteBuffer.allocate(1024);\n        byteBuffer.flip();\n        int length = sourceChannel.read(byteBuffer);\n        System.out.println(new String(byteBuffer.array(),0,length));\n        //å…³é—­é€šé“\n        sourceChannel.close();\n        sinkChannel.close();\n    }\n```\n\n### 2 FileLock\n\n#### 2.1 FileLock ç®€ä»‹\næ–‡ä»¶é”åœ¨ OS ä¸­å¾ˆå¸¸è§ï¼Œå¦‚æœå¤šä¸ªç¨‹åºåŒæ—¶è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¾ˆå®¹æ˜“å› ä¸ºæ–‡ä»¶ æ•°æ®ä¸åŒæ­¥è€Œå‡ºç°é—®é¢˜ã€‚ç»™æ–‡ä»¶åŠ ä¸€ä¸ªé”ï¼ŒåŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç¨‹åºä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œ æˆ–è€…ç¨‹åºéƒ½åªèƒ½è¯»æ­¤æ–‡ä»¶ï¼Œè¿™å°±è§£å†³äº†åŒæ­¥é—®é¢˜ã€‚\n\næ–‡ä»¶é”æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚æ–‡ä»¶é”å¯ä»¥è§£å†³å¤šä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®ã€ä¿®æ”¹åŒ ä¸€ä¸ªæ–‡ä»¶çš„é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ã€ä¿®æ”¹åŒä¸€æ–‡ä»¶çš„é—®é¢˜ã€‚ä½¿ç”¨æ–‡ä»¶é”æ—¶ï¼Œ åŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹ï¼Œå¯ä»¥åŒæ—¶è®¿é—®ã€ä¿®æ”¹æ­¤æ–‡ä»¶ã€‚\n\næ–‡ä»¶é”æ˜¯å½“å‰ç¨‹åºæ‰€å±çš„ JVM å®ä¾‹æŒæœ‰çš„ï¼Œä¸€æ—¦è·å–åˆ°æ–‡ä»¶é”ï¼ˆå¯¹æ–‡ä»¶åŠ é”ï¼‰ï¼Œè¦è°ƒç”¨ release()ï¼Œæˆ–è€…å…³é—­å¯¹åº”çš„ FileChannel å¯¹è±¡ï¼Œæˆ–è€…å½“å‰ JVM é€€å‡ºï¼Œæ‰ä¼šé‡Šæ”¾è¿™ä¸ªé”ã€‚\n\nä¸€æ—¦æŸä¸ªè¿›ç¨‹ï¼ˆæ¯”å¦‚è¯´ JVM å®ä¾‹ï¼‰å¯¹æŸä¸ªæ–‡ä»¶åŠ é”ï¼Œåˆ™åœ¨é‡Šæ”¾è¿™ä¸ªé”ä¹‹å‰ï¼Œæ­¤è¿›ç¨‹ä¸ èƒ½å†å¯¹æ­¤æ–‡ä»¶åŠ é”ï¼Œå°±æ˜¯è¯´ JVM å®ä¾‹åœ¨åŒä¸€æ–‡ä»¶ä¸Šçš„æ–‡ä»¶é”æ˜¯ä¸é‡å çš„ï¼ˆè¿›ç¨‹çº§åˆ«ä¸ èƒ½é‡å¤åœ¨åŒä¸€æ–‡ä»¶ä¸Šè·å–é”ï¼‰ã€‚\n\n#### 2.2 æ–‡ä»¶é”åˆ†ç±»\n==æ’å®ƒé”==ï¼šåˆå«ç‹¬å é”ã€‚å¯¹æ–‡ä»¶åŠ æ’å®ƒé”åï¼Œè¯¥è¿›ç¨‹å¯ä»¥å¯¹æ­¤æ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œè¯¥è¿›ç¨‹ç‹¬ å æ­¤æ–‡ä»¶ï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½è¯»å†™æ­¤æ–‡ä»¶ï¼Œç›´åˆ°è¯¥è¿›ç¨‹é‡Šæ”¾æ–‡ä»¶é”ã€‚\n\n==å…±äº«é”==ï¼šæŸä¸ªè¿›ç¨‹å¯¹æ–‡ä»¶åŠ å…±äº«é”ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿå¯ä»¥è®¿é—®æ­¤æ–‡ä»¶ï¼Œä½†è¿™äº›è¿›ç¨‹éƒ½åªèƒ½ è¯»æ­¤æ–‡ä»¶ï¼Œä¸èƒ½å†™ã€‚çº¿ç¨‹æ˜¯å®‰å…¨çš„ã€‚åªè¦è¿˜æœ‰ä¸€ä¸ªè¿›ç¨‹æŒæœ‰å…±äº«é”ï¼Œæ­¤æ–‡ä»¶å°±åªèƒ½è¯»ï¼Œ ä¸èƒ½å†™ã€‚\n\n#### 2.3 ä½¿ç”¨ç¤ºä¾‹\n```java\n//åˆ›å»º FileChannel å¯¹è±¡ï¼Œæ–‡ä»¶é”åªèƒ½é€šè¿‡ FileChannel å¯¹è±¡æ¥ä½¿ç”¨ \nFileChannel fileChannel=new FileOutputStream(\"./1.txt\").getChannel(); \n//å¯¹æ–‡ä»¶åŠ é” \nFileLock lock=fileChannel.lock(); \n//å¯¹æ­¤æ–‡ä»¶è¿›è¡Œä¸€äº›è¯»å†™æ“ä½œã€‚ \n//....... \n//é‡Šæ”¾é” \nlock.release();\n```\næ–‡ä»¶é”è¦é€šè¿‡ FileChannel å¯¹è±¡ä½¿ç”¨ã€‚\n\n#### 2.4 è·å–æ–‡ä»¶é”æ–¹æ³•\næœ‰ 4 ç§è·å–æ–‡ä»¶é”çš„æ–¹æ³•ï¼š\n- lock() //å¯¹æ•´ä¸ªæ–‡ä»¶åŠ é”ï¼Œé»˜è®¤ä¸ºæ’å®ƒé”ã€‚\n- lock(long position, long size, booean shared) //è‡ªå®šä¹‰åŠ é”æ–¹å¼ã€‚å‰ 2 ä¸ªå‚æ•° æŒ‡å®šè¦åŠ é”çš„éƒ¨åˆ†ï¼ˆå¯ä»¥åªå¯¹æ­¤æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹åŠ é”ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å€¼æŒ‡å®šæ˜¯å¦æ˜¯å…±äº«é”ã€‚\n- tryLock() //å¯¹æ•´ä¸ªæ–‡ä»¶åŠ é”ï¼Œé»˜è®¤ä¸ºæ’å®ƒé”ã€‚\n- tryLock(long position, long size, booean shared) //è‡ªå®šä¹‰åŠ é”æ–¹å¼ã€‚\n\nå¦‚æœæŒ‡å®šä¸ºå…±äº«é”ï¼Œåˆ™å…¶å®ƒè¿›ç¨‹å¯è¯»æ­¤æ–‡ä»¶ï¼Œæ‰€æœ‰è¿›ç¨‹å‡ä¸èƒ½å†™æ­¤æ–‡ä»¶ï¼Œå¦‚æœæŸè¿›ç¨‹ è¯•å›¾å¯¹æ­¤æ–‡ä»¶è¿›è¡Œå†™æ“ä½œï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\n\n#### 2.5 lock ä¸ tryLock çš„åŒºåˆ«\n\nlock æ˜¯é˜»å¡å¼çš„ï¼Œå¦‚æœæœªè·å–åˆ°æ–‡ä»¶é”ï¼Œä¼šä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è·å–æ–‡ä»¶é”ã€‚\n\ntryLock å’Œ lock çš„ä½œç”¨ç›¸åŒï¼Œåªä¸è¿‡ tryLock æ˜¯éé˜»å¡å¼çš„ï¼ŒtryLock æ˜¯å°è¯•è·å–æ–‡ ä»¶é”ï¼Œè·å–æˆåŠŸå°±è¿”å›é”å¯¹è±¡ï¼Œå¦åˆ™è¿”å› nullï¼Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚\n\n#### 2.6 FileLock ä¸¤ä¸ªæ–¹æ³•\n```java\nboolean isShared() //æ­¤æ–‡ä»¶é”æ˜¯å¦æ˜¯å…±äº«é” \nboolean isValid() //æ­¤æ–‡ä»¶é”æ˜¯å¦è¿˜æœ‰æ•ˆ\n```\nåœ¨æŸäº› OS ä¸Šï¼Œå¯¹æŸä¸ªæ–‡ä»¶åŠ é”åï¼Œä¸èƒ½å¯¹æ­¤æ–‡ä»¶ä½¿ç”¨é€šé“æ˜ å°„ã€‚\n\n#### 2.7 å®Œæ•´ä¾‹å­\n```java\npublic class FileLockDemo01 {\n    public static void main(String[] args) throws Exception {\n        String input = \"Jzj\";\n        System.out.println(\"input:\"+input);\n        ByteBuffer buffer = ByteBuffer.wrap(input.getBytes(StandardCharsets.UTF_8));\n\n        String filePath = \"d:\\\\111.txt\";\n        Path path = Paths.get(filePath);\n        FileChannel channel = FileChannel.open(\n                path,\n                StandardOpenOption.WRITE,\n                StandardOpenOption.APPEND);\n        channel.position(channel.size()-1);\n\n        //åŠ é”\n        FileLock lock = channel.lock(0L,Long.MAX_VALUE,true);\n        System.out.println(\"æ˜¯å¦å…±äº«é”:\"+lock.isShared());\n\n        channel.write(buffer);\n        channel.close();\n        //è¯»æ–‡ä»¶\n        readFile(filePath);\n    }\n\n    private static void readFile(String filePath) throws Exception {\n        FileReader fileReader = new FileReader(filePath);\n        BufferedReader bufferedReader = new BufferedReader(fileReader);\n        String tr = bufferedReader.readLine();\n        System.out.println(\"è¯»å–å‡ºå†…å®¹:\");\n        while (tr != null){\n            System.out.println(\" \" +tr);\n            tr = bufferedReader.readLine();\n        }\n        fileReader.close();\n        bufferedReader.close();\n    }\n}\n```\n', '2022-10-09 16:52:29', '2022-10-09 17:23:51', '<h3><a id=\"1_Pipe_0\"></a>1 Pipe</h3>\n<p>Java NIO ç®¡é“æ˜¯ 2 ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿æ¥ã€‚Pipe æœ‰ä¸€ä¸ª source é€šé“å’Œä¸€ä¸ª sink é€šé“ã€‚æ•°æ®ä¼šè¢«å†™åˆ° sink é€šé“ï¼Œä» source é€šé“è¯»å–ã€‚</p>\n<div class=\"hljs-center\">\n<p><img src=\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/09/2f9b2e23b0414df2a415fbd52fca6338.png\" alt=\"image.png\" /></p>\n</div>\n<h4><a id=\"11__10\"></a>1.1 åˆ›å»ºç®¡é“</h4>\n<p>é€šè¿‡ Pipe.open()æ–¹æ³•æ‰“å¼€ç®¡é“ã€‚</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">Pipe</span> <span class=\"hljs-variable\">pipe</span> <span class=\"hljs-operator\">=</span> Pipe.open();\n</code></div></pre>\n<h4><a id=\"12__16\"></a>1.2 å†™å…¥ç®¡é“</h4>\n<p>è¦å‘ç®¡é“å†™æ•°æ®ï¼Œéœ€è¦è®¿é—® sink é€šé“ã€‚ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">Pipe.<span class=\"hljs-type\">SinkChannel</span> <span class=\"hljs-variable\">sinkChannel</span> <span class=\"hljs-operator\">=</span> pipe.sink();\n</code></div></pre>\n<p>é€šè¿‡è°ƒç”¨ SinkChannel çš„ write()æ–¹æ³•ï¼Œå°†æ•°æ®å†™å…¥ SinkChannelï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">newData</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;New String to write to file...&quot;</span> + System.currentTimeMillis(); \n<span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">48</span>); \nbuf.clear(); buf.put(newData.getBytes()); \nbuf.flip(); \n<span class=\"hljs-keyword\">while</span>(buf.hasRemaining()) { \nsinkChannel.write(buf); \n}\n</code></div></pre>\n<h4><a id=\"13__33\"></a>1.3 ä»ç®¡é“è¯»å–æ•°æ®</h4>\n<p>ä»è¯»å–ç®¡é“çš„æ•°æ®ï¼Œéœ€è¦è®¿é—® source é€šé“ï¼Œåƒè¿™æ ·ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\">Pipe.<span class=\"hljs-type\">SourceChannel</span> <span class=\"hljs-variable\">sourceChannel</span> <span class=\"hljs-operator\">=</span> pipe.source();\n</code></div></pre>\n<p>è°ƒç”¨ source é€šé“çš„ read()æ–¹æ³•æ¥è¯»å–æ•°æ®ï¼š</p>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buf</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">48</span>); \n<span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">bytesRead</span> <span class=\"hljs-operator\">=</span> sourceChannel.read(buf);\n</code></div></pre>\n<p>read()æ–¹æ³•è¿”å›çš„ int å€¼ä¼šå‘Šè¯‰æˆ‘ä»¬å¤šå°‘å­—èŠ‚è¢«è¯»è¿›äº†ç¼“å†²åŒºã€‚</p>\n<h4><a id=\"14__46\"></a>1.4 ç¤ºä¾‹</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-comment\">//è·å–ç®¡é“</span>\n        <span class=\"hljs-type\">Pipe</span> <span class=\"hljs-variable\">pipe</span> <span class=\"hljs-operator\">=</span> Pipe.open();\n        <span class=\"hljs-comment\">//è·å–sinké€šé“</span>\n        Pipe.<span class=\"hljs-type\">SinkChannel</span> <span class=\"hljs-variable\">sinkChannel</span> <span class=\"hljs-operator\">=</span> pipe.sink();\n        <span class=\"hljs-comment\">//åˆ›å»ºç¼“å†²åŒº</span>\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">byteBuffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.allocate(<span class=\"hljs-number\">1024</span>);\n        byteBuffer.put(<span class=\"hljs-string\">&quot;Jzjzzzz&quot;</span>.getBytes(StandardCharsets.UTF_8));\n        byteBuffer.flip();\n        <span class=\"hljs-comment\">//å†™å…¥æ•°æ®</span>\n        sinkChannel.write(byteBuffer);\n        <span class=\"hljs-comment\">//è·å–sourceé€šé“</span>\n        Pipe.<span class=\"hljs-type\">SourceChannel</span> <span class=\"hljs-variable\">sourceChannel</span> <span class=\"hljs-operator\">=</span> pipe.source();\n        <span class=\"hljs-comment\">//åˆ›å»ºç¼“å†²åŒº,è¯»å–æ•°æ®</span>\n        <span class=\"hljs-comment\">//ByteBuffer byteBuffer2 = ByteBuffer.allocate(1024);</span>\n        byteBuffer.flip();\n        <span class=\"hljs-type\">int</span> <span class=\"hljs-variable\">length</span> <span class=\"hljs-operator\">=</span> sourceChannel.read(byteBuffer);\n        System.out.println(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">String</span>(byteBuffer.array(),<span class=\"hljs-number\">0</span>,length));\n        <span class=\"hljs-comment\">//å…³é—­é€šé“</span>\n        sourceChannel.close();\n        sinkChannel.close();\n    }\n</code></div></pre>\n<h3><a id=\"2_FileLock_72\"></a>2 FileLock</h3>\n<h4><a id=\"21_FileLock__74\"></a>2.1 FileLock ç®€ä»‹</h4>\n<p>æ–‡ä»¶é”åœ¨ OS ä¸­å¾ˆå¸¸è§ï¼Œå¦‚æœå¤šä¸ªç¨‹åºåŒæ—¶è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¾ˆå®¹æ˜“å› ä¸ºæ–‡ä»¶ æ•°æ®ä¸åŒæ­¥è€Œå‡ºç°é—®é¢˜ã€‚ç»™æ–‡ä»¶åŠ ä¸€ä¸ªé”ï¼ŒåŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç¨‹åºä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œ æˆ–è€…ç¨‹åºéƒ½åªèƒ½è¯»æ­¤æ–‡ä»¶ï¼Œè¿™å°±è§£å†³äº†åŒæ­¥é—®é¢˜ã€‚</p>\n<p>æ–‡ä»¶é”æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚æ–‡ä»¶é”å¯ä»¥è§£å†³å¤šä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®ã€ä¿®æ”¹åŒ ä¸€ä¸ªæ–‡ä»¶çš„é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ã€ä¿®æ”¹åŒä¸€æ–‡ä»¶çš„é—®é¢˜ã€‚ä½¿ç”¨æ–‡ä»¶é”æ—¶ï¼Œ åŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹ï¼Œå¯ä»¥åŒæ—¶è®¿é—®ã€ä¿®æ”¹æ­¤æ–‡ä»¶ã€‚</p>\n<p>æ–‡ä»¶é”æ˜¯å½“å‰ç¨‹åºæ‰€å±çš„ JVM å®ä¾‹æŒæœ‰çš„ï¼Œä¸€æ—¦è·å–åˆ°æ–‡ä»¶é”ï¼ˆå¯¹æ–‡ä»¶åŠ é”ï¼‰ï¼Œè¦è°ƒç”¨ release()ï¼Œæˆ–è€…å…³é—­å¯¹åº”çš„ FileChannel å¯¹è±¡ï¼Œæˆ–è€…å½“å‰ JVM é€€å‡ºï¼Œæ‰ä¼šé‡Šæ”¾è¿™ä¸ªé”ã€‚</p>\n<p>ä¸€æ—¦æŸä¸ªè¿›ç¨‹ï¼ˆæ¯”å¦‚è¯´ JVM å®ä¾‹ï¼‰å¯¹æŸä¸ªæ–‡ä»¶åŠ é”ï¼Œåˆ™åœ¨é‡Šæ”¾è¿™ä¸ªé”ä¹‹å‰ï¼Œæ­¤è¿›ç¨‹ä¸ èƒ½å†å¯¹æ­¤æ–‡ä»¶åŠ é”ï¼Œå°±æ˜¯è¯´ JVM å®ä¾‹åœ¨åŒä¸€æ–‡ä»¶ä¸Šçš„æ–‡ä»¶é”æ˜¯ä¸é‡å çš„ï¼ˆè¿›ç¨‹çº§åˆ«ä¸ èƒ½é‡å¤åœ¨åŒä¸€æ–‡ä»¶ä¸Šè·å–é”ï¼‰ã€‚</p>\n<h4><a id=\"22__83\"></a>2.2 æ–‡ä»¶é”åˆ†ç±»</h4>\n<p><mark>æ’å®ƒé”</mark>ï¼šåˆå«ç‹¬å é”ã€‚å¯¹æ–‡ä»¶åŠ æ’å®ƒé”åï¼Œè¯¥è¿›ç¨‹å¯ä»¥å¯¹æ­¤æ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œè¯¥è¿›ç¨‹ç‹¬ å æ­¤æ–‡ä»¶ï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½è¯»å†™æ­¤æ–‡ä»¶ï¼Œç›´åˆ°è¯¥è¿›ç¨‹é‡Šæ”¾æ–‡ä»¶é”ã€‚</p>\n<p><mark>å…±äº«é”</mark>ï¼šæŸä¸ªè¿›ç¨‹å¯¹æ–‡ä»¶åŠ å…±äº«é”ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿå¯ä»¥è®¿é—®æ­¤æ–‡ä»¶ï¼Œä½†è¿™äº›è¿›ç¨‹éƒ½åªèƒ½ è¯»æ­¤æ–‡ä»¶ï¼Œä¸èƒ½å†™ã€‚çº¿ç¨‹æ˜¯å®‰å…¨çš„ã€‚åªè¦è¿˜æœ‰ä¸€ä¸ªè¿›ç¨‹æŒæœ‰å…±äº«é”ï¼Œæ­¤æ–‡ä»¶å°±åªèƒ½è¯»ï¼Œ ä¸èƒ½å†™ã€‚</p>\n<h4><a id=\"23__88\"></a>2.3 ä½¿ç”¨ç¤ºä¾‹</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-comment\">//åˆ›å»º FileChannel å¯¹è±¡ï¼Œæ–‡ä»¶é”åªèƒ½é€šè¿‡ FileChannel å¯¹è±¡æ¥ä½¿ç”¨ </span>\nFileChannel fileChannel=<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileOutputStream</span>(<span class=\"hljs-string\">&quot;./1.txt&quot;</span>).getChannel(); \n<span class=\"hljs-comment\">//å¯¹æ–‡ä»¶åŠ é” </span>\nFileLock lock=fileChannel.lock(); \n<span class=\"hljs-comment\">//å¯¹æ­¤æ–‡ä»¶è¿›è¡Œä¸€äº›è¯»å†™æ“ä½œã€‚ </span>\n<span class=\"hljs-comment\">//....... </span>\n<span class=\"hljs-comment\">//é‡Šæ”¾é” </span>\nlock.release();\n</code></div></pre>\n<p>æ–‡ä»¶é”è¦é€šè¿‡ FileChannel å¯¹è±¡ä½¿ç”¨ã€‚</p>\n<h4><a id=\"24__101\"></a>2.4 è·å–æ–‡ä»¶é”æ–¹æ³•</h4>\n<p>æœ‰ 4 ç§è·å–æ–‡ä»¶é”çš„æ–¹æ³•ï¼š</p>\n<ul>\n<li>lock() //å¯¹æ•´ä¸ªæ–‡ä»¶åŠ é”ï¼Œé»˜è®¤ä¸ºæ’å®ƒé”ã€‚</li>\n<li>lock(long position, long size, booean shared) //è‡ªå®šä¹‰åŠ é”æ–¹å¼ã€‚å‰ 2 ä¸ªå‚æ•° æŒ‡å®šè¦åŠ é”çš„éƒ¨åˆ†ï¼ˆå¯ä»¥åªå¯¹æ­¤æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹åŠ é”ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å€¼æŒ‡å®šæ˜¯å¦æ˜¯å…±äº«é”ã€‚</li>\n<li>tryLock() //å¯¹æ•´ä¸ªæ–‡ä»¶åŠ é”ï¼Œé»˜è®¤ä¸ºæ’å®ƒé”ã€‚</li>\n<li>tryLock(long position, long size, booean shared) //è‡ªå®šä¹‰åŠ é”æ–¹å¼ã€‚</li>\n</ul>\n<p>å¦‚æœæŒ‡å®šä¸ºå…±äº«é”ï¼Œåˆ™å…¶å®ƒè¿›ç¨‹å¯è¯»æ­¤æ–‡ä»¶ï¼Œæ‰€æœ‰è¿›ç¨‹å‡ä¸èƒ½å†™æ­¤æ–‡ä»¶ï¼Œå¦‚æœæŸè¿›ç¨‹ è¯•å›¾å¯¹æ­¤æ–‡ä»¶è¿›è¡Œå†™æ“ä½œï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<h4><a id=\"25_lock__tryLock__110\"></a>2.5 lock ä¸ tryLock çš„åŒºåˆ«</h4>\n<p>lock æ˜¯é˜»å¡å¼çš„ï¼Œå¦‚æœæœªè·å–åˆ°æ–‡ä»¶é”ï¼Œä¼šä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è·å–æ–‡ä»¶é”ã€‚</p>\n<p>tryLock å’Œ lock çš„ä½œç”¨ç›¸åŒï¼Œåªä¸è¿‡ tryLock æ˜¯éé˜»å¡å¼çš„ï¼ŒtryLock æ˜¯å°è¯•è·å–æ–‡ ä»¶é”ï¼Œè·å–æˆåŠŸå°±è¿”å›é”å¯¹è±¡ï¼Œå¦åˆ™è¿”å› nullï¼Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</p>\n<h4><a id=\"26_FileLock__116\"></a>2.6 FileLock ä¸¤ä¸ªæ–¹æ³•</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isShared</span><span class=\"hljs-params\">()</span> <span class=\"hljs-comment\">//æ­¤æ–‡ä»¶é”æ˜¯å¦æ˜¯å…±äº«é” </span>\n<span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">isValid</span><span class=\"hljs-params\">()</span> <span class=\"hljs-comment\">//æ­¤æ–‡ä»¶é”æ˜¯å¦è¿˜æœ‰æ•ˆ</span>\n</code></div></pre>\n<p>åœ¨æŸäº› OS ä¸Šï¼Œå¯¹æŸä¸ªæ–‡ä»¶åŠ é”åï¼Œä¸èƒ½å¯¹æ­¤æ–‡ä»¶ä½¿ç”¨é€šé“æ˜ å°„ã€‚</p>\n<h4><a id=\"27__123\"></a>2.7 å®Œæ•´ä¾‹å­</h4>\n<pre><div class=\"hljs\"><code class=\"lang-java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">FileLockDemo01</span> {\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">input</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;Jzj&quot;</span>;\n        System.out.println(<span class=\"hljs-string\">&quot;input:&quot;</span>+input);\n        <span class=\"hljs-type\">ByteBuffer</span> <span class=\"hljs-variable\">buffer</span> <span class=\"hljs-operator\">=</span> ByteBuffer.wrap(input.getBytes(StandardCharsets.UTF_8));\n\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">filePath</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&quot;d:\\\\111.txt&quot;</span>;\n        <span class=\"hljs-type\">Path</span> <span class=\"hljs-variable\">path</span> <span class=\"hljs-operator\">=</span> Paths.get(filePath);\n        <span class=\"hljs-type\">FileChannel</span> <span class=\"hljs-variable\">channel</span> <span class=\"hljs-operator\">=</span> FileChannel.open(\n                path,\n                StandardOpenOption.WRITE,\n                StandardOpenOption.APPEND);\n        channel.position(channel.size()-<span class=\"hljs-number\">1</span>);\n\n        <span class=\"hljs-comment\">//åŠ é”</span>\n        <span class=\"hljs-type\">FileLock</span> <span class=\"hljs-variable\">lock</span> <span class=\"hljs-operator\">=</span> channel.lock(<span class=\"hljs-number\">0L</span>,Long.MAX_VALUE,<span class=\"hljs-literal\">true</span>);\n        System.out.println(<span class=\"hljs-string\">&quot;æ˜¯å¦å…±äº«é”:&quot;</span>+lock.isShared());\n\n        channel.write(buffer);\n        channel.close();\n        <span class=\"hljs-comment\">//è¯»æ–‡ä»¶</span>\n        readFile(filePath);\n    }\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">readFile</span><span class=\"hljs-params\">(String filePath)</span> <span class=\"hljs-keyword\">throws</span> Exception {\n        <span class=\"hljs-type\">FileReader</span> <span class=\"hljs-variable\">fileReader</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">FileReader</span>(filePath);\n        <span class=\"hljs-type\">BufferedReader</span> <span class=\"hljs-variable\">bufferedReader</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BufferedReader</span>(fileReader);\n        <span class=\"hljs-type\">String</span> <span class=\"hljs-variable\">tr</span> <span class=\"hljs-operator\">=</span> bufferedReader.readLine();\n        System.out.println(<span class=\"hljs-string\">&quot;è¯»å–å‡ºå†…å®¹:&quot;</span>);\n        <span class=\"hljs-keyword\">while</span> (tr != <span class=\"hljs-literal\">null</span>){\n            System.out.println(<span class=\"hljs-string\">&quot; &quot;</span> +tr);\n            tr = bufferedReader.readLine();\n        }\n        fileReader.close();\n        bufferedReader.close();\n    }\n}\n</code></div></pre>\n');

-- ----------------------------
-- Table structure for article_inform
-- ----------------------------
DROP TABLE IF EXISTS `article_inform`;
CREATE TABLE `article_inform`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'æ–‡ç« id',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'åˆ›å»ºè€…',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çŠ¶æ€ï¼ˆ0-ä¸‹æ¶ï¼Œ1-å‘å¸ƒï¼‰',
  `article_title` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ç« æ ‡é¢˜',
  `introduce` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç®€ä»‹',
  `log_img` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ ‡é¢˜å›¾',
  `article_type` char(5) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ç« åˆ†ç±»',
  `article_tag` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ç« æ ‡ç­¾',
  `top_status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦ç½®é¡¶ï¼ˆ0-ä¸ç½®é¡¶ï¼Œ1-ç½®é¡¶ï¼‰',
  `origin_status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦åŸåˆ›ï¼ˆ0-åŸåˆ›ï¼Œ1-è½¬è½½ï¼‰',
  `comment_status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦å¼€å¯è¯„è®ºï¼ˆ0-ä¸å¼€å¯ï¼Œ1-å¼€å¯ï¼‰',
  `click_rate` bigint(20) NULL DEFAULT NULL COMMENT 'æ–‡ç« ç‚¹å‡»é‡',
  `number_like` bigint(20) NULL DEFAULT NULL COMMENT 'ç‚¹èµæ•°',
  `aggregate_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å½’æ¡£id',
  `sort` int(11) NULL DEFAULT NULL COMMENT 'æ’åº',
  `comment_number` int(11) NULL DEFAULT NULL COMMENT 'è¯„è®ºæ•°',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'æ–‡ç« åŸºç¡€ä¿¡æ¯' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of article_inform
-- ----------------------------
INSERT INTO `article_inform` VALUES ('33eaafbcb8d03c1eb2de9de8d49a6fe7', '2022-10-12 11:33:21', '2022-10-13 16:33:15', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆå¤šäººèŠå¤©å®¤ï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆå¤šäººèŠå¤©å®¤ï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/12/f76ad4dd2b594cb18cf9707153efd0d0.jpg', '0', '0,10', '0', '1', '0', 6, 1, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('542c782529c33704c5f67d6e03ee939e', '2022-10-14 15:23:35', '2022-10-14 15:46:50', 'æ¼«æ¼«å‰è·¯', '1', 'Nettyï¼ˆå…¥é—¨ï¼‰', 'é»‘é©¬Nettyå…¥é—¨ç¬”è®°', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg', '0', '0,11', '0', '1', '0', 16, 0, 'ac578e0aba0f32dffd9d1a10a159b04c', 0, 0);
INSERT INTO `article_inform` VALUES ('57f718d5122663a93110cf52264e929b', '2022-10-31 15:17:57', '2022-10-31 15:18:45', 'æ¼«æ¼«å‰è·¯', '1', 'EasyExcelç™¾ä¸‡æ•°æ®å¯¼å‡º', 'ä½¿ç”¨EasyExcelå¯¼å‡ºç™¾ä¸‡æ•°æ®', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/31/7e66508406ec40d98d514d08587ae007.jpg', '0', '0,4', '0', '0', '0', 2, 0, '', 0, 0);
INSERT INTO `article_inform` VALUES ('5dc9ccb15fe3224878945a842f7f6427', '2022-09-30 16:30:45', '2022-10-13 14:34:41', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆSocketChannelï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆSocketChannelï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/09/30/535d7be3e8614d5b92d3b4567f005bef.jpg', '0', '0,10', '0', '1', '0', 16, 1, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('68c89984823c939509f7601517b358ad', '2022-10-09 10:56:26', '2022-10-13 15:49:15', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆSelectorï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆSelectorï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/09/dd6766ece27b4fcf90dcd0a5167297d0.jpg', '0', '0,10', '0', '1', '0', 6, 0, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('6ad6bbb7161e5ad89760b8ca830870ef', '2022-09-30 14:45:15', '2022-10-14 10:52:09', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆæ¦‚è¿°ï¼‰', 'Java ç½‘ç»œç¼–ç¨‹ç³»åˆ—ä¹‹ NIO', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/09/30/dfae8c0b0a2b4577aa268401bf0c60e4.jpg', '0', '0,10', '0', '1', '0', 25, 0, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('6bb0a02f479905e24398dfe187c49641', '2022-10-09 17:29:00', '2022-10-13 16:32:00', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆå…¶ä»–ï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆå…¶ä»–ï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/09/1671f73bdd3140f3a2cc646e948d98f0.jpg', '0', '0,10', '0', '1', '0', 8, 0, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('8556d1aadfebf82abaa7e2159d499d8b', '2022-10-08 16:37:01', '2022-10-13 15:45:44', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆBufferï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆBufferï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/08/ad90335701f84465b105d9548cc6f992.jpg', '0', '0,10', '0', '1', '0', 15, 0, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('ace86a2c5d5c94e559bbfe3158d342fc', '2022-09-30 15:13:36', '2022-10-13 11:06:10', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆChannelï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆChannelï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/09/30/9022fbc5907d4e4ebe016e4d8976ce9d.jpg', '0', '0,10', '0', '1', '0', 24, 0, '6af32c16a767b5a74dc711d8d688236f', 0, 0);
INSERT INTO `article_inform` VALUES ('edb409243c0e1b8a819fe729b6566ab2', '2022-10-09 16:52:29', '2022-10-13 16:31:39', 'æ¼«æ¼«å‰è·¯', '1', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆPipe å’Œ FileLockï¼‰', 'Javaç½‘ç»œç¼–ç¨‹-NIOï¼ˆPipe å’Œ FileLockï¼‰', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/09/e0f6fb09458242b08216b9cbeec18f1b.jpg', '0', '0,10', '0', '1', '0', 2, 0, '6af32c16a767b5a74dc711d8d688236f', 0, 0);

-- ----------------------------
-- Table structure for article_summary
-- ----------------------------
DROP TABLE IF EXISTS `article_summary`;
CREATE TABLE `article_summary`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å½’æ¡£è¡¨id',
  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å½’æ¡£åç§°',
  `banner` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å½’æ¡£å›¾',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çŠ¶æ€',
  `top_status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦æ˜¾ç¤ºåœ¨é¦–é¡µ',
  `author` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ä½œè€…',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'æ–‡ç« å½’æ¡£' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of article_summary
-- ----------------------------
INSERT INTO `article_summary` VALUES ('09d7c62e8f9d0348782c6381e2c0b6c0', 'é˜¿é‡Œäº‘OSS', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleSummary/2022/09/26/03b075772ba346ecbe91110f6fd9b4f4.jpg', '2022-09-26 10:02:59', '2022-09-26 10:02:59', '1', NULL, 'æ¼«æ¼«é•¿è·¯');
INSERT INTO `article_summary` VALUES ('6af32c16a767b5a74dc711d8d688236f', 'å°šç¡…è°·NIOç¬”è®°', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleSummary/2022/09/30/2662e8eef71d439e81c62ba7cb850bd0.jpg', '2022-09-30 15:07:37', '2022-09-30 15:07:37', '1', NULL, 'æ¼«æ¼«å‰è·¯');
INSERT INTO `article_summary` VALUES ('ac578e0aba0f32dffd9d1a10a159b04c', 'å°šç¡…è°·Nettyç¬”è®°', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleSummary/2022/09/30/e380b7f1034443fea069c6e3db3e2aab.jpg', '2022-09-30 15:08:49', '2022-09-30 15:08:49', '1', NULL, 'æ¼«æ¼«å‰è·¯');
INSERT INTO `article_summary` VALUES ('f796f398a0dd7e44a3e407837250f3c1', 'å°šç¡…è°·MySQLç¬”è®°', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleSummary/2022/09/30/4b416e9fee76496498e692c76eb59542.jpg', '2022-09-30 15:08:21', '2022-09-30 15:08:21', '1', NULL, 'æ¼«æ¼«å‰è·¯');

-- ----------------------------
-- Table structure for friend_link
-- ----------------------------
DROP TABLE IF EXISTS `friend_link`;
CREATE TABLE `friend_link`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'id',
  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'é“¾æ¥åç§°',
  `link` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'é“¾æ¥',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `status` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çŠ¶æ€',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'å‹æƒ…é“¾æ¥' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of friend_link
-- ----------------------------
INSERT INTO `friend_link` VALUES ('d855c662eddc70853cee7304bb1c1b05', 'Jzjzzzz', 'https://www.jzjzzzz.icu/', '2022-09-10 00:50:33', '2022-09-10 00:50:33', '1');

-- ----------------------------
-- Table structure for gallery
-- ----------------------------
DROP TABLE IF EXISTS `gallery`;
CREATE TABLE `gallery`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'id',
  `img_address` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å›¾ç‰‡åœ°å€',
  `create_time` datetime NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `status` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'çŠ¶æ€',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'å›¾é›†' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of gallery
-- ----------------------------
INSERT INTO `gallery` VALUES ('03a99c7b12edf4afdc22555223dd6578', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/24/7e9fc5305e3e40ac95f56d1424d7d9ef.jpg', '2022-09-24 20:24:07', '2022-09-24 20:24:07', '1');
INSERT INTO `gallery` VALUES ('1d6ac129b136aa5f3cfb8499da523010', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/30/96e53ccf50044613b931282b1a8c6765.jpg', '2022-09-30 14:45:40', '2022-09-30 14:45:40', '1');
INSERT INTO `gallery` VALUES ('56c84ccbfc3c047eb1519db2347c4c4b', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/24/7aa46f57b11341ffac4512901d331ca2.jpg', '2022-09-24 20:53:35', '2022-09-24 20:53:35', '1');
INSERT INTO `gallery` VALUES ('74a56a311f6909b8584ed82be5cbf421', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/24/c2662067ad0946908572136e5ccd83a0.jpg', '2022-09-24 20:26:44', '2022-09-24 20:26:44', '1');
INSERT INTO `gallery` VALUES ('768b183cdbb975413bfbe9cc5d7d4ba4', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/30/45b13c6c457a41bcacf5b2ec962ec190.jpg', '2022-09-30 14:45:33', '2022-09-30 14:45:33', '1');
INSERT INTO `gallery` VALUES ('a79d7c800d159273df96311ece81dd59', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/30/456dc869a1cf4898b12f3cf5db848d01.jpg', '2022-09-30 14:45:48', '2022-09-30 14:45:48', '1');
INSERT INTO `gallery` VALUES ('b079b8bd7ea66bf73023aa653f4d7f89', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/24/e770e59ba7c5499cbbfd00e1b500437a.jpg', '2022-09-24 21:00:37', '2022-09-24 21:00:37', '1');
INSERT INTO `gallery` VALUES ('b9d7fcea75c0cc18c5e7c04ef5968dd1', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/30/6d8895578d8d43d9ad6771b1f5630a70.jpg', '2022-09-30 14:45:28', '2022-09-30 14:45:28', '1');
INSERT INTO `gallery` VALUES ('d798f3e5f208c754a7511f1f2d4a1fd0', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/24/9dd1d99171cc47c59ae05e989520afba.jpg', '2022-09-24 20:26:48', '2022-09-24 20:26:48', '1');
INSERT INTO `gallery` VALUES ('ecec1412dcc54c4d92110e1bccccea60', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/gallery/2022/09/24/cfb8c7582ccd48f28e6bfb0c92dc5507.jpg', '2022-09-24 20:25:28', '2022-09-24 20:25:28', '1');

-- ----------------------------
-- Table structure for gen_table
-- ----------------------------
DROP TABLE IF EXISTS `gen_table`;
CREATE TABLE `gen_table`  (
  `table_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `table_name` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'è¡¨åç§°',
  `table_comment` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'è¡¨æè¿°',
  `sub_table_name` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å…³è”å­è¡¨çš„è¡¨å',
  `sub_table_fk_name` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å­è¡¨å…³è”çš„å¤–é”®å',
  `class_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å®ä½“ç±»åç§°',
  `tpl_category` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT 'crud' COMMENT 'ä½¿ç”¨çš„æ¨¡æ¿ï¼ˆcrudå•è¡¨æ“ä½œ treeæ ‘è¡¨æ“ä½œï¼‰',
  `package_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç”ŸæˆåŒ…è·¯å¾„',
  `module_name` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç”Ÿæˆæ¨¡å—å',
  `business_name` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç”Ÿæˆä¸šåŠ¡å',
  `function_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç”ŸæˆåŠŸèƒ½å',
  `function_author` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç”ŸæˆåŠŸèƒ½ä½œè€…',
  `gen_type` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '0' COMMENT 'ç”Ÿæˆä»£ç æ–¹å¼ï¼ˆ0zipå‹ç¼©åŒ… 1è‡ªå®šä¹‰è·¯å¾„ï¼‰',
  `gen_path` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '/' COMMENT 'ç”Ÿæˆè·¯å¾„ï¼ˆä¸å¡«é»˜è®¤é¡¹ç›®è·¯å¾„ï¼‰',
  `options` varchar(1000) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å…¶å®ƒç”Ÿæˆé€‰é¡¹',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `remark` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`table_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ä»£ç ç”Ÿæˆä¸šåŠ¡è¡¨' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of gen_table
-- ----------------------------

-- ----------------------------
-- Table structure for gen_table_column
-- ----------------------------
DROP TABLE IF EXISTS `gen_table_column`;
CREATE TABLE `gen_table_column`  (
  `column_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ç¼–å·',
  `table_id` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å½’å±è¡¨ç¼–å·',
  `column_name` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'åˆ—åç§°',
  `column_comment` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'åˆ—æè¿°',
  `column_type` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'åˆ—ç±»å‹',
  `java_type` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'JAVAç±»å‹',
  `java_field` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'JAVAå­—æ®µå',
  `is_pk` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦ä¸»é”®ï¼ˆ1æ˜¯ï¼‰',
  `is_increment` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦è‡ªå¢ï¼ˆ1æ˜¯ï¼‰',
  `is_required` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦å¿…å¡«ï¼ˆ1æ˜¯ï¼‰',
  `is_insert` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦ä¸ºæ’å…¥å­—æ®µï¼ˆ1æ˜¯ï¼‰',
  `is_edit` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦ç¼–è¾‘å­—æ®µï¼ˆ1æ˜¯ï¼‰',
  `is_list` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦åˆ—è¡¨å­—æ®µï¼ˆ1æ˜¯ï¼‰',
  `is_query` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¯å¦æŸ¥è¯¢å­—æ®µï¼ˆ1æ˜¯ï¼‰',
  `query_type` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT 'EQ' COMMENT 'æŸ¥è¯¢æ–¹å¼ï¼ˆç­‰äºã€ä¸ç­‰äºã€å¤§äºã€å°äºã€èŒƒå›´ï¼‰',
  `html_type` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ˜¾ç¤ºç±»å‹ï¼ˆæ–‡æœ¬æ¡†ã€æ–‡æœ¬åŸŸã€ä¸‹æ‹‰æ¡†ã€å¤é€‰æ¡†ã€å•é€‰æ¡†ã€æ—¥æœŸæ§ä»¶ï¼‰',
  `dict_type` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å­—å…¸ç±»å‹',
  `sort` int(11) NULL DEFAULT NULL COMMENT 'æ’åº',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`column_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ä»£ç ç”Ÿæˆä¸šåŠ¡è¡¨å­—æ®µ' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of gen_table_column
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_blob_triggers
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_blob_triggers`;
CREATE TABLE `qrtz_blob_triggers`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `BLOB_DATA` blob NULL,
  PRIMARY KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) USING BTREE,
  CONSTRAINT `QRTZ_BLOB_TRIGGERS_ibfk_1` FOREIGN KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) REFERENCES `qrtz_triggers` (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_blob_triggers
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_calendars
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_calendars`;
CREATE TABLE `qrtz_calendars`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `CALENDAR_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `CALENDAR` blob NOT NULL,
  PRIMARY KEY (`SCHED_NAME`, `CALENDAR_NAME`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_calendars
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_cron_triggers
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_cron_triggers`;
CREATE TABLE `qrtz_cron_triggers`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `CRON_EXPRESSION` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TIME_ZONE_ID` varchar(80) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  PRIMARY KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) USING BTREE,
  CONSTRAINT `QRTZ_CRON_TRIGGERS_ibfk_1` FOREIGN KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) REFERENCES `qrtz_triggers` (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_cron_triggers
-- ----------------------------
INSERT INTO `qrtz_cron_triggers` VALUES ('VblogScheduler', 'com.jzj.vblog.job.ArticleCountJob', 'Article', '0 0/2 * * * ?', 'Asia/Shanghai');
INSERT INTO `qrtz_cron_triggers` VALUES ('VblogScheduler', 'com.jzj.vblog.job.HelloJob', 'Hello', '0/2 * * * * ?', 'Asia/Shanghai');

-- ----------------------------
-- Table structure for qrtz_fired_triggers
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_fired_triggers`;
CREATE TABLE `qrtz_fired_triggers`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `ENTRY_ID` varchar(95) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `INSTANCE_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `FIRED_TIME` bigint(13) NOT NULL,
  `SCHED_TIME` bigint(13) NOT NULL,
  `PRIORITY` int(11) NOT NULL,
  `STATE` varchar(16) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `JOB_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `JOB_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `IS_NONCONCURRENT` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `REQUESTS_RECOVERY` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  PRIMARY KEY (`SCHED_NAME`, `ENTRY_ID`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_fired_triggers
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_job_details
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_job_details`;
CREATE TABLE `qrtz_job_details`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `JOB_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `JOB_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `DESCRIPTION` varchar(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `JOB_CLASS_NAME` varchar(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `IS_DURABLE` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `IS_NONCONCURRENT` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `IS_UPDATE_DATA` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `REQUESTS_RECOVERY` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `JOB_DATA` blob NULL,
  PRIMARY KEY (`SCHED_NAME`, `JOB_NAME`, `JOB_GROUP`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_job_details
-- ----------------------------
INSERT INTO `qrtz_job_details` VALUES ('VblogScheduler', 'com.jzj.vblog.job.ArticleCountJob', 'Article', NULL, 'com.jzj.vblog.job.ArticleCountJob', '0', '0', '0', '0', 0xACED0005737200156F72672E71756172747A2E4A6F62446174614D61709FB083E8BFA9B0CB020000787200266F72672E71756172747A2E7574696C732E537472696E674B65794469727479466C61674D61708208E8C3FBC55D280200015A0013616C6C6F77735472616E7369656E74446174617872001D6F72672E71756172747A2E7574696C732E4469727479466C61674D617013E62EAD28760ACE0200025A000564697274794C00036D617074000F4C6A6176612F7574696C2F4D61703B787000737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C6478703F40000000000010770800000010000000007800);
INSERT INTO `qrtz_job_details` VALUES ('VblogScheduler', 'com.jzj.vblog.job.HelloJob', 'Hello', NULL, 'com.jzj.vblog.job.HelloJob', '0', '0', '0', '0', 0xACED0005737200156F72672E71756172747A2E4A6F62446174614D61709FB083E8BFA9B0CB020000787200266F72672E71756172747A2E7574696C732E537472696E674B65794469727479466C61674D61708208E8C3FBC55D280200015A0013616C6C6F77735472616E7369656E74446174617872001D6F72672E71756172747A2E7574696C732E4469727479466C61674D617013E62EAD28760ACE0200025A000564697274794C00036D617074000F4C6A6176612F7574696C2F4D61703B787000737200116A6176612E7574696C2E486173684D61700507DAC1C31660D103000246000A6C6F6164466163746F724900097468726573686F6C6478703F40000000000010770800000010000000007800);

-- ----------------------------
-- Table structure for qrtz_locks
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_locks`;
CREATE TABLE `qrtz_locks`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `LOCK_NAME` varchar(40) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  PRIMARY KEY (`SCHED_NAME`, `LOCK_NAME`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_locks
-- ----------------------------
INSERT INTO `qrtz_locks` VALUES ('VblogScheduler', 'TRIGGER_ACCESS');

-- ----------------------------
-- Table structure for qrtz_paused_trigger_grps
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_paused_trigger_grps`;
CREATE TABLE `qrtz_paused_trigger_grps`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  PRIMARY KEY (`SCHED_NAME`, `TRIGGER_GROUP`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_paused_trigger_grps
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_scheduler_state
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_scheduler_state`;
CREATE TABLE `qrtz_scheduler_state`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `INSTANCE_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `LAST_CHECKIN_TIME` bigint(13) NOT NULL,
  `CHECKIN_INTERVAL` bigint(13) NOT NULL,
  PRIMARY KEY (`SCHED_NAME`, `INSTANCE_NAME`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_scheduler_state
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_simple_triggers
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_simple_triggers`;
CREATE TABLE `qrtz_simple_triggers`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `REPEAT_COUNT` bigint(7) NOT NULL,
  `REPEAT_INTERVAL` bigint(12) NOT NULL,
  `TIMES_TRIGGERED` bigint(10) NOT NULL,
  PRIMARY KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) USING BTREE,
  CONSTRAINT `QRTZ_SIMPLE_TRIGGERS_ibfk_1` FOREIGN KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) REFERENCES `qrtz_triggers` (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_simple_triggers
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_simprop_triggers
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_simprop_triggers`;
CREATE TABLE `qrtz_simprop_triggers`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `STR_PROP_1` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `STR_PROP_2` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `STR_PROP_3` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `INT_PROP_1` int(11) NULL DEFAULT NULL,
  `INT_PROP_2` int(11) NULL DEFAULT NULL,
  `LONG_PROP_1` bigint(20) NULL DEFAULT NULL,
  `LONG_PROP_2` bigint(20) NULL DEFAULT NULL,
  `DEC_PROP_1` decimal(13, 4) NULL DEFAULT NULL,
  `DEC_PROP_2` decimal(13, 4) NULL DEFAULT NULL,
  `BOOL_PROP_1` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `BOOL_PROP_2` varchar(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  PRIMARY KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) USING BTREE,
  CONSTRAINT `QRTZ_SIMPROP_TRIGGERS_ibfk_1` FOREIGN KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) REFERENCES `qrtz_triggers` (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_simprop_triggers
-- ----------------------------

-- ----------------------------
-- Table structure for qrtz_triggers
-- ----------------------------
DROP TABLE IF EXISTS `qrtz_triggers`;
CREATE TABLE `qrtz_triggers`  (
  `SCHED_NAME` varchar(120) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `JOB_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `JOB_GROUP` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `DESCRIPTION` varchar(250) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `NEXT_FIRE_TIME` bigint(13) NULL DEFAULT NULL,
  `PREV_FIRE_TIME` bigint(13) NULL DEFAULT NULL,
  `PRIORITY` int(11) NULL DEFAULT NULL,
  `TRIGGER_STATE` varchar(16) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `TRIGGER_TYPE` varchar(8) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `START_TIME` bigint(13) NOT NULL,
  `END_TIME` bigint(13) NULL DEFAULT NULL,
  `CALENDAR_NAME` varchar(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,
  `MISFIRE_INSTR` smallint(2) NULL DEFAULT NULL,
  `JOB_DATA` blob NULL,
  PRIMARY KEY (`SCHED_NAME`, `TRIGGER_NAME`, `TRIGGER_GROUP`) USING BTREE,
  INDEX `SCHED_NAME`(`SCHED_NAME`, `JOB_NAME`, `JOB_GROUP`) USING BTREE,
  CONSTRAINT `QRTZ_TRIGGERS_ibfk_1` FOREIGN KEY (`SCHED_NAME`, `JOB_NAME`, `JOB_GROUP`) REFERENCES `qrtz_job_details` (`SCHED_NAME`, `JOB_NAME`, `JOB_GROUP`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of qrtz_triggers
-- ----------------------------
INSERT INTO `qrtz_triggers` VALUES ('VblogScheduler', 'com.jzj.vblog.job.ArticleCountJob', 'Article', 'com.jzj.vblog.job.ArticleCountJob', 'Article', NULL, 1667200920000, 1667200800000, 5, 'WAITING', 'CRON', 1661255313000, 0, NULL, 0, '');
INSERT INTO `qrtz_triggers` VALUES ('VblogScheduler', 'com.jzj.vblog.job.HelloJob', 'Hello', 'com.jzj.vblog.job.HelloJob', 'Hello', NULL, 1661249656000, 1661249654000, 5, 'PAUSED', 'CRON', 1661170536000, 0, NULL, 0, '');

-- ----------------------------
-- Table structure for sys_config
-- ----------------------------
DROP TABLE IF EXISTS `sys_config`;
CREATE TABLE `sys_config`  (
  `id` int(5) NOT NULL AUTO_INCREMENT COMMENT 'å‚æ•°ä¸»é”®',
  `config_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å‚æ•°åç§°',
  `config_key` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å‚æ•°é”®å',
  `config_value` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å‚æ•°é”®å€¼',
  `config_type` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT 'N' COMMENT 'ç³»ç»Ÿå†…ç½®ï¼ˆYæ˜¯ Nå¦ï¼‰',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `remark` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 8 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'å‚æ•°é…ç½®è¡¨' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_config
-- ----------------------------
INSERT INTO `sys_config` VALUES (1, 'ä¸»æ¡†æ¶é¡µ-é»˜è®¤çš®è‚¤æ ·å¼åç§°', 'sys.index.skinName', 'skin-blue', 'Y', 'admin', '2022-04-27 02:10:24', 'admin', '2022-07-22 02:28:46', 'è“è‰² skin-blueã€ç»¿è‰² skin-greenã€ç´«è‰² skin-purpleã€çº¢è‰² skin-redã€é»„è‰² skin-yellow');
INSERT INTO `sys_config` VALUES (3, 'ä¸»æ¡†æ¶é¡µ-ä¾§è¾¹æ ä¸»é¢˜', 'sys.index.sideTheme', 'theme-dark', 'Y', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ·±è‰²ä¸»é¢˜theme-darkï¼Œæµ…è‰²ä¸»é¢˜theme-light');
INSERT INTO `sys_config` VALUES (6, 'ossäº‘å­˜å‚¨-æ˜¯å¦å¼€å¯äº‘å­˜å‚¨', 'sys.oss.enable', 'true', 'Y', 'admin', '2022-07-27 14:52:18', 'admin', '2022-07-29 15:02:59', 'å¼€å¯äº‘å­˜å‚¨éœ€è¦é…ç½®application.ymlé‡Œçš„ossç›¸å…³å‚æ•°ï¼ˆtrueå¼€å¯ï¼Œfalseå…³é—­ï¼‰');
INSERT INTO `sys_config` VALUES (7, 'æ˜¯å¦å¼€å¯é‚®ç®±é€šçŸ¥', 'sys_email_enable', 'true', 'Y', 'admin', '2022-09-20 14:45:07', 'admin', '2022-09-23 22:16:59', 'åå°å›å¤ç•™è¨€ï¼Œé‚®ç®±é€šçŸ¥ç•™è¨€è€…,å¼€å¯éœ€è¦é…ç½®emailç›¸å…³å‚æ•° ï¼ˆtrueå¼€å¯ï¼Œfalseå…³é—­ï¼‰');

-- ----------------------------
-- Table structure for sys_count
-- ----------------------------
DROP TABLE IF EXISTS `sys_count`;
CREATE TABLE `sys_count`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'id',
  `article_count` bigint(20) NULL DEFAULT NULL COMMENT 'æ–‡ç« æ•°',
  `summary_count` bigint(20) NULL DEFAULT NULL COMMENT 'å½’æ¡£æ•°',
  `user_count` bigint(20) NULL DEFAULT NULL COMMENT 'ç”¨æˆ·æ•°',
  `click_count` bigint(20) NULL DEFAULT NULL COMMENT 'ç‚¹å‡»æ•°',
  `like_count` bigint(20) NULL DEFAULT NULL COMMENT 'ç‚¹èµæ•°',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ç»Ÿè®¡å½’æ¡£' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_count
-- ----------------------------
INSERT INTO `sys_count` VALUES ('1', 10, 4, 0, 120, 2);

-- ----------------------------
-- Table structure for sys_dict_data
-- ----------------------------
DROP TABLE IF EXISTS `sys_dict_data`;
CREATE TABLE `sys_dict_data`  (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'å­—å…¸ç¼–ç ',
  `dict_sort` int(4) NULL DEFAULT 0 COMMENT 'å­—å…¸æ’åº',
  `dict_label` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å­—å…¸æ ‡ç­¾',
  `dict_value` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å­—å…¸é”®å€¼',
  `dict_type` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å­—å…¸ç±»å‹',
  `css_class` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ ·å¼å±æ€§ï¼ˆå…¶ä»–æ ·å¼æ‰©å±•ï¼‰',
  `list_class` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'è¡¨æ ¼å›æ˜¾æ ·å¼',
  `is_default` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT 'N' COMMENT 'æ˜¯å¦é»˜è®¤ï¼ˆYæ˜¯ Nå¦ï¼‰',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '0' COMMENT 'çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `remark` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 141 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'å­—å…¸æ•°æ®è¡¨' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_dict_data
-- ----------------------------
INSERT INTO `sys_dict_data` VALUES (1, 1, 'ç”·', '0', 'sys_user_sex', '', '', 'Y', '0', 'admin', '2022-04-27 02:10:24', 'admin', '2022-07-22 06:16:44', 'æ€§åˆ«ç”·');
INSERT INTO `sys_dict_data` VALUES (2, 2, 'å¥³', '1', 'sys_user_sex', '', '', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ€§åˆ«å¥³');
INSERT INTO `sys_dict_data` VALUES (3, 3, 'æœªçŸ¥', '2', 'sys_user_sex', '', '', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ€§åˆ«æœªçŸ¥');
INSERT INTO `sys_dict_data` VALUES (4, 1, 'æ˜¾ç¤º', '0', 'sys_show_hide', '', 'primary', 'Y', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ˜¾ç¤ºèœå•');
INSERT INTO `sys_dict_data` VALUES (5, 2, 'éšè—', '1', 'sys_show_hide', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'éšè—èœå•');
INSERT INTO `sys_dict_data` VALUES (6, 1, 'æ­£å¸¸', '0', 'sys_normal_disable', '', 'primary', 'Y', '0', 'admin', '2022-04-27 02:10:24', 'admin', '2022-07-21 11:52:18', 'æ­£å¸¸çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (7, 2, 'åœç”¨', '1', 'sys_normal_disable', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'åœç”¨çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (8, 1, 'æ­£å¸¸', '0', 'sys_job_status', '', 'primary', 'Y', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ­£å¸¸çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (9, 2, 'æš‚åœ', '1', 'sys_job_status', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'åœç”¨çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (10, 1, 'é»˜è®¤', 'DEFAULT', 'sys_job_group', '', '', 'Y', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'é»˜è®¤åˆ†ç»„');
INSERT INTO `sys_dict_data` VALUES (11, 2, 'ç³»ç»Ÿ', 'SYSTEM', 'sys_job_group', '', '', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç³»ç»Ÿåˆ†ç»„');
INSERT INTO `sys_dict_data` VALUES (12, 1, 'æ˜¯', 'Y', 'sys_yes_no', '', 'primary', 'Y', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç³»ç»Ÿé»˜è®¤æ˜¯');
INSERT INTO `sys_dict_data` VALUES (13, 2, 'å¦', 'N', 'sys_yes_no', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç³»ç»Ÿé»˜è®¤å¦');
INSERT INTO `sys_dict_data` VALUES (14, 1, 'é€šçŸ¥', '1', 'sys_notice_type', '', 'warning', 'Y', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'é€šçŸ¥');
INSERT INTO `sys_dict_data` VALUES (15, 2, 'å…¬å‘Š', '2', 'sys_notice_type', '', 'success', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'å…¬å‘Š');
INSERT INTO `sys_dict_data` VALUES (16, 1, 'æ­£å¸¸', '0', 'sys_notice_status', '', 'primary', 'Y', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ­£å¸¸çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (17, 2, 'å…³é—­', '1', 'sys_notice_status', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'å…³é—­çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (18, 1, 'æ–°å¢', '1', 'sys_oper_type', '', 'info', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ–°å¢æ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (19, 2, 'ä¿®æ”¹', '2', 'sys_oper_type', '', 'info', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ä¿®æ”¹æ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (20, 3, 'åˆ é™¤', '3', 'sys_oper_type', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'åˆ é™¤æ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (21, 4, 'æˆæƒ', '4', 'sys_oper_type', '', 'primary', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æˆæƒæ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (22, 5, 'å¯¼å‡º', '5', 'sys_oper_type', '', 'warning', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'å¯¼å‡ºæ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (23, 6, 'å¯¼å…¥', '6', 'sys_oper_type', '', 'warning', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'å¯¼å…¥æ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (24, 7, 'å¼ºé€€', '7', 'sys_oper_type', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'å¼ºé€€æ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (25, 8, 'ç”Ÿæˆä»£ç ', '8', 'sys_oper_type', '', 'warning', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç”Ÿæˆæ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (26, 9, 'æ¸…ç©ºæ•°æ®', '9', 'sys_oper_type', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ¸…ç©ºæ“ä½œ');
INSERT INTO `sys_dict_data` VALUES (27, 1, 'æˆåŠŸ', '0', 'sys_common_status', '', 'primary', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ­£å¸¸çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (28, 2, 'å¤±è´¥', '1', 'sys_common_status', '', 'danger', 'N', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'åœç”¨çŠ¶æ€');
INSERT INTO `sys_dict_data` VALUES (101, 0, 'ç¼–ç¨‹', '0', 'sys_article_type', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 01:20:03', '', NULL, 'ç¼–ç¨‹');
INSERT INTO `sys_dict_data` VALUES (102, 1, 'æ—¥å¸¸', '1', 'sys_article_type', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 01:20:43', '', NULL, 'æ—¥å¸¸');
INSERT INTO `sys_dict_data` VALUES (103, 0, 'Java', '0', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 01:21:22', '', NULL, 'Java');
INSERT INTO `sys_dict_data` VALUES (104, 0, 'SQL', '1', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 01:21:38', 'admin', '2022-08-08 09:27:52', 'SQL');
INSERT INTO `sys_dict_data` VALUES (105, 1, 'ä¸‹æ¶', '0', 'sys_article_status', NULL, 'danger', 'N', '0', 'admin', '2022-07-22 19:22:30', 'admin', '2022-08-19 15:48:22', 'æ–‡ç« ä¸‹æ¶');
INSERT INTO `sys_dict_data` VALUES (106, 0, 'å‘å¸ƒ', '1', 'sys_article_status', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 19:22:53', 'admin', '2022-08-19 15:48:16', 'æ–‡ç« å‘å¸ƒ');
INSERT INTO `sys_dict_data` VALUES (107, 0, 'é»˜è®¤', '0', 'sys_article_top', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 19:24:59', 'admin', '2022-07-22 19:27:42', 'ä¸ç½®é¡¶');
INSERT INTO `sys_dict_data` VALUES (108, 0, 'ç½®é¡¶', '1', 'sys_article_top', NULL, 'success', 'N', '0', 'admin', '2022-07-22 19:25:07', 'admin', '2022-08-05 15:51:39', 'ç½®é¡¶');
INSERT INTO `sys_dict_data` VALUES (109, 0, 'åŸåˆ›', '0', 'sys_article_origin', NULL, 'success', 'N', '0', 'admin', '2022-07-22 19:27:31', 'admin', '2022-08-05 15:51:53', 'æ–‡ç« åŸåˆ›');
INSERT INTO `sys_dict_data` VALUES (110, 0, 'è½¬è½½', '1', 'sys_article_origin', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 19:28:10', '', NULL, 'è½¬è½½');
INSERT INTO `sys_dict_data` VALUES (111, 0, 'å¼€å¯', '0', 'sys_article_comment', NULL, 'primary', 'N', '0', 'admin', '2022-07-22 19:28:36', 'admin', '2022-07-22 19:28:40', 'å¼€å¯è¯„è®º');
INSERT INTO `sys_dict_data` VALUES (112, 0, 'å…³é—­', '1', 'sys_article_comment', NULL, 'danger', 'N', '0', 'admin', '2022-07-22 19:28:54', 'admin', '2022-08-05 15:52:04', 'å…³é—­è¯„è®º');
INSERT INTO `sys_dict_data` VALUES (113, 0, 'å·¥å…·', '0', 'sys_website_type', NULL, 'primary', 'N', '0', 'admin', '2022-07-26 15:28:50', '', NULL, 'å·¥å…·');
INSERT INTO `sys_dict_data` VALUES (114, 0, 'Java', '1', 'sys_website_type', NULL, 'primary', 'N', '0', 'admin', '2022-07-26 15:29:03', '', NULL, 'Java');
INSERT INTO `sys_dict_data` VALUES (115, 0, 'å‰ç«¯', '2', 'sys_website_type', NULL, 'primary', 'N', '0', 'admin', '2022-07-26 15:29:13', 'admin', '2022-07-26 15:29:18', 'å‰ç«¯');
INSERT INTO `sys_dict_data` VALUES (116, 0, 'å‘å¸ƒ', '0', 'sys_website_status', NULL, 'success', 'N', '0', 'admin', '2022-07-26 15:32:28', 'admin', '2022-09-09 16:40:26', 'å‘å¸ƒ');
INSERT INTO `sys_dict_data` VALUES (117, 0, 'ä¸‹æ¶', '1', 'sys_website_status', NULL, 'info', 'N', '0', 'admin', '2022-07-26 15:32:42', 'admin', '2022-07-27 16:36:26', 'ä¸‹æ¶');
INSERT INTO `sys_dict_data` VALUES (118, 0, 'Spring', '2', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-08-08 09:27:25', 'admin', '2022-08-08 09:27:39', 'spring');
INSERT INTO `sys_dict_data` VALUES (119, 0, 'Spring MVC', '3', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-08-08 09:28:23', '', NULL, 'Spring MVC');
INSERT INTO `sys_dict_data` VALUES (120, 0, 'MyBatis', '4', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-08-08 09:28:42', 'admin', '2022-08-08 09:28:54', 'Mybatis');
INSERT INTO `sys_dict_data` VALUES (121, 0, 'ä¸Šæ¶', '1', 'sys_summary_status', NULL, 'primary', 'N', '0', 'admin', '2022-08-11 11:31:07', 'admin', '2022-08-11 11:31:40', 'ä¸Šæ¶');
INSERT INTO `sys_dict_data` VALUES (122, 0, 'ä¸‹æ¶', '0', 'sys_summary_status', NULL, 'danger', 'N', '0', 'admin', '2022-08-11 11:31:26', 'admin', '2022-08-11 11:31:35', 'ä¸‹æ¶');
INSERT INTO `sys_dict_data` VALUES (123, 0, 'é»˜è®¤', '0', 'sys_summary_top', NULL, 'success', 'N', '0', 'admin', '2022-08-12 19:17:40', 'admin', '2022-08-12 19:43:52', 'ä¸æ˜¾ç¤ºåœ¨é¦–é¡µ');
INSERT INTO `sys_dict_data` VALUES (124, 0, 'å±•ç¤º', '1', 'sys_summary_top', NULL, 'primary', 'N', '0', 'admin', '2022-08-12 19:17:54', 'admin', '2022-08-12 19:43:48', 'æ˜¾ç¤ºåœ¨é¦–é¡µ');
INSERT INTO `sys_dict_data` VALUES (125, 0, 'BUG', '2', 'sys_article_type', NULL, 'primary', 'N', '0', 'admin', '2022-08-19 15:45:26', 'admin', '2022-08-19 15:45:32', 'BUG');
INSERT INTO `sys_dict_data` VALUES (126, 0, 'ç®—æ³•', '5', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-08-19 15:46:31', '', NULL, 'ç®—æ³•');
INSERT INTO `sys_dict_data` VALUES (127, 0, 'JUC', '6', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-08-29 09:25:52', '', NULL, 'JUC');
INSERT INTO `sys_dict_data` VALUES (128, 0, 'å‘å¸ƒ', '1', 'sys_friend_link', NULL, 'primary', 'N', '0', 'admin', '2022-09-09 16:40:51', '', NULL, 'å‘å¸ƒ');
INSERT INTO `sys_dict_data` VALUES (129, 0, 'ä¸‹æ¶', '0', 'sys_friend_link', NULL, 'danger', 'N', '0', 'admin', '2022-09-09 16:41:10', '', NULL, 'ä¸‹æ¶');
INSERT INTO `sys_dict_data` VALUES (130, 0, 'ç•™è¨€æ¿', '0', 'article_comment_type', NULL, 'primary', 'N', '0', 'admin', '2022-09-11 15:32:58', '', NULL, 'ç•™è¨€æ¿');
INSERT INTO `sys_dict_data` VALUES (131, 0, 'æ–‡ç« ', '1', 'article_comment_type', NULL, 'success', 'N', '0', 'admin', '2022-09-11 15:33:16', '', NULL, 'æ–‡ç« è¯„è®º');
INSERT INTO `sys_dict_data` VALUES (132, 0, 'æœªå›å¤', '0', 'article_comment_status', NULL, 'danger', 'N', '0', 'admin', '2022-09-11 15:35:37', 'admin', '2022-09-11 15:35:46', 'æœªå›å¤');
INSERT INTO `sys_dict_data` VALUES (133, 0, 'å·²å›å¤', '1', 'article_comment_status', NULL, 'success', 'N', '0', 'admin', '2022-09-11 15:35:58', 'admin', '2022-09-11 15:36:10', 'å·²å›å¤');
INSERT INTO `sys_dict_data` VALUES (134, 0, 'æœªå®¡æ ¸', '0', 'article_comment_audit_status', NULL, 'info', 'N', '0', 'admin', '2022-09-23 21:08:23', '', NULL, 'æœªå®¡æ ¸');
INSERT INTO `sys_dict_data` VALUES (135, 0, 'é€šè¿‡', '1', 'article_comment_audit_status', NULL, 'success', 'N', '0', 'admin', '2022-09-23 21:08:41', '', NULL, 'é€šè¿‡');
INSERT INTO `sys_dict_data` VALUES (136, 0, 'æœªé€šè¿‡', '2', 'article_comment_audit_status', NULL, 'danger', 'N', '0', 'admin', '2022-09-23 21:09:02', '', NULL, 'æœªé€šè¿‡');
INSERT INTO `sys_dict_data` VALUES (137, 0, 'OSS', '7', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-09-26 10:06:37', '', NULL, 'OSS');
INSERT INTO `sys_dict_data` VALUES (138, 0, 'çŸ­ä¿¡', '9', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-09-26 14:51:32', '', NULL, 'çŸ­ä¿¡');
INSERT INTO `sys_dict_data` VALUES (139, 0, 'NIO', '10', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-09-30 15:07:08', '', NULL, 'NIO');
INSERT INTO `sys_dict_data` VALUES (140, 0, 'Netty', '11', 'sys_article_tag', NULL, 'primary', 'N', '0', 'admin', '2022-10-14 14:57:51', 'admin', '2022-10-14 14:58:09', NULL);

-- ----------------------------
-- Table structure for sys_dict_type
-- ----------------------------
DROP TABLE IF EXISTS `sys_dict_type`;
CREATE TABLE `sys_dict_type`  (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'å­—å…¸ä¸»é”®',
  `dict_name` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å­—å…¸åç§°',
  `dict_type` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'å­—å…¸ç±»å‹',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '0' COMMENT 'çŠ¶æ€ï¼ˆ0æ­£å¸¸ 1åœç”¨ï¼‰',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `remark` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`id`) USING BTREE,
  UNIQUE INDEX `dict_type`(`dict_type`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 118 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'å­—å…¸ç±»å‹è¡¨' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_dict_type
-- ----------------------------
INSERT INTO `sys_dict_type` VALUES (1, 'ç”¨æˆ·æ€§åˆ«', 'sys_user_sex', '0', 'admin', '2022-04-27 02:10:24', 'admin', '2022-07-22 06:57:38', 'ç”¨æˆ·æ€§åˆ«åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (2, 'èœå•çŠ¶æ€', 'sys_show_hide', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'èœå•çŠ¶æ€åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (3, 'ç³»ç»Ÿå¼€å…³', 'sys_normal_disable', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç³»ç»Ÿå¼€å…³åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (4, 'ä»»åŠ¡çŠ¶æ€', 'sys_job_status', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ä»»åŠ¡çŠ¶æ€åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (5, 'ä»»åŠ¡åˆ†ç»„', 'sys_job_group', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ä»»åŠ¡åˆ†ç»„åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (6, 'ç³»ç»Ÿæ˜¯å¦', 'sys_yes_no', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç³»ç»Ÿæ˜¯å¦åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (7, 'é€šçŸ¥ç±»å‹', 'sys_notice_type', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'é€šçŸ¥ç±»å‹åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (8, 'é€šçŸ¥çŠ¶æ€', 'sys_notice_status', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'é€šçŸ¥çŠ¶æ€åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (9, 'æ“ä½œç±»å‹', 'sys_oper_type', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'æ“ä½œç±»å‹åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (10, 'ç³»ç»ŸçŠ¶æ€', 'sys_common_status', '0', 'admin', '2022-04-27 02:10:24', '', NULL, 'ç™»å½•çŠ¶æ€åˆ—è¡¨');
INSERT INTO `sys_dict_type` VALUES (100, 'æ–‡ç« åˆ†ç±»', 'sys_article_type', '0', 'admin', '2022-07-20 01:14:22', 'admin', '2022-07-22 06:17:14', 'æ–‡ç« åˆ†ç±»');
INSERT INTO `sys_dict_type` VALUES (104, 'æ–‡ç« æ ‡ç­¾', 'sys_article_tag', '0', 'admin', '2022-07-22 01:19:31', '', NULL, 'æ–‡ç« æ ‡ç­¾');
INSERT INTO `sys_dict_type` VALUES (106, 'æ–‡ç« çŠ¶æ€', 'sys_article_status', '0', 'admin', '2022-07-22 17:09:06', '', NULL, 'æ–‡ç« çŠ¶æ€');
INSERT INTO `sys_dict_type` VALUES (107, 'æ–‡ç« ç½®é¡¶', 'sys_article_top', '0', 'admin', '2022-07-22 19:23:51', '', NULL, 'æ–‡ç« æ˜¯å¦ç½®é¡¶');
INSERT INTO `sys_dict_type` VALUES (108, 'æ–‡ç« åŸåˆ›', 'sys_article_origin', '0', 'admin', '2022-07-22 19:26:02', '', NULL, 'æ–‡ç« æ˜¯å¦åŸåˆ›');
INSERT INTO `sys_dict_type` VALUES (109, 'æ–‡ç« è¯„è®º', 'sys_article_comment', '0', 'admin', '2022-07-22 19:26:44', '', NULL, 'æ˜¯å¦å¼€å¯è¯„è®º');
INSERT INTO `sys_dict_type` VALUES (110, 'èµ„æºåˆ†ç±»', 'sys_website_type', '0', 'admin', '2022-07-26 15:27:22', '', NULL, 'èµ„æºåˆ†ç±»');
INSERT INTO `sys_dict_type` VALUES (111, 'èµ„æºçŠ¶æ€', 'sys_website_status', '0', 'admin', '2022-07-26 15:32:05', '', NULL, 'èµ„æºçŠ¶æ€');
INSERT INTO `sys_dict_type` VALUES (112, 'å½’æ¡£çŠ¶æ€', 'sys_summary_status', '0', 'admin', '2022-08-11 11:30:26', '', NULL, 'å½’æ¡£çŠ¶æ€');
INSERT INTO `sys_dict_type` VALUES (113, 'å½’æ¡£ç½®é¡¶', 'sys_summary_top', '0', 'admin', '2022-08-12 19:17:03', '', NULL, 'å½’æ¡£ç½®é¡¶');
INSERT INTO `sys_dict_type` VALUES (114, 'å‹é“¾çŠ¶æ€', 'sys_friend_link', '0', 'admin', '2022-09-09 16:38:49', '', NULL, 'å‹é“¾çŠ¶æ€');
INSERT INTO `sys_dict_type` VALUES (115, 'è¯„è®ºç±»å‹', 'article_comment_type', '0', 'admin', '2022-09-11 15:32:13', '', NULL, 'è¯„è®ºç±»å‹');
INSERT INTO `sys_dict_type` VALUES (116, 'è¯„è®ºçŠ¶æ€', 'article_comment_status', '0', 'admin', '2022-09-11 15:35:16', 'admin', '2022-09-12 19:04:17', 'è¯„è®ºçŠ¶æ€');
INSERT INTO `sys_dict_type` VALUES (117, 'è¯„è®ºå®¡æ ¸çŠ¶æ€', 'article_comment_audit_status', '0', 'admin', '2022-09-23 21:08:01', '', NULL, 'è¯„è®ºå®¡æ ¸çŠ¶æ€');

-- ----------------------------
-- Table structure for sys_logininfor
-- ----------------------------
DROP TABLE IF EXISTS `sys_logininfor`;
CREATE TABLE `sys_logininfor`  (
  `info_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'è®¿é—®ID',
  `user_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'ç”¨æˆ·è´¦å·',
  `ipaddr` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'ç™»å½•IPåœ°å€',
  `login_location` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'ç™»å½•åœ°ç‚¹',
  `browser` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æµè§ˆå™¨ç±»å‹',
  `os` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ“ä½œç³»ç»Ÿ',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '0' COMMENT 'ç™»å½•çŠ¶æ€ï¼ˆ0æˆåŠŸ 1å¤±è´¥ï¼‰',
  `msg` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æç¤ºæ¶ˆæ¯',
  `login_time` datetime NULL DEFAULT NULL COMMENT 'è®¿é—®æ—¶é—´',
  PRIMARY KEY (`info_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 112 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ç³»ç»Ÿè®¿é—®è®°å½•' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_logininfor
-- ----------------------------
INSERT INTO `sys_logininfor` VALUES (100, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-04-27 02:14:22');
INSERT INTO `sys_logininfor` VALUES (101, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-05-13 07:16:40');
INSERT INTO `sys_logininfor` VALUES (102, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-11 01:19:05');
INSERT INTO `sys_logininfor` VALUES (103, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-11 06:03:09');
INSERT INTO `sys_logininfor` VALUES (104, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-11 07:08:20');
INSERT INTO `sys_logininfor` VALUES (105, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-20 00:52:08');
INSERT INTO `sys_logininfor` VALUES (106, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-21 08:29:27');
INSERT INTO `sys_logininfor` VALUES (107, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '1', 'éªŒè¯ç é”™è¯¯', '2022-07-21 09:20:15');
INSERT INTO `sys_logininfor` VALUES (108, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-21 09:20:21');
INSERT INTO `sys_logininfor` VALUES (109, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'é€€å‡ºæˆåŠŸ', '2022-07-21 09:30:15');
INSERT INTO `sys_logininfor` VALUES (110, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-21 09:30:22');
INSERT INTO `sys_logininfor` VALUES (111, 'admin', '127.0.0.1', 'å†…ç½‘IP', 'Chrome 10', 'Windows 10', '0', 'ç™»å½•æˆåŠŸ', '2022-07-21 11:05:38');

-- ----------------------------
-- Table structure for sys_notice
-- ----------------------------
DROP TABLE IF EXISTS `sys_notice`;
CREATE TABLE `sys_notice`  (
  `notice_id` int(4) NOT NULL AUTO_INCREMENT COMMENT 'å…¬å‘ŠID',
  `notice_title` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å…¬å‘Šæ ‡é¢˜',
  `notice_type` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'å…¬å‘Šç±»å‹ï¼ˆ1é€šçŸ¥ 2å…¬å‘Šï¼‰',
  `notice_content` longblob NULL COMMENT 'å…¬å‘Šå†…å®¹',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '0' COMMENT 'å…¬å‘ŠçŠ¶æ€ï¼ˆ0æ­£å¸¸ 1å…³é—­ï¼‰',
  `create_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_by` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'æ›´æ–°æ—¶é—´',
  `remark` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤‡æ³¨',
  PRIMARY KEY (`notice_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'é€šçŸ¥å…¬å‘Šè¡¨' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_notice
-- ----------------------------

-- ----------------------------
-- Table structure for sys_oper_log
-- ----------------------------
DROP TABLE IF EXISTS `sys_oper_log`;
CREATE TABLE `sys_oper_log`  (
  `oper_id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ä¸»é”®',
  `title` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ¨¡å—æ ‡é¢˜',
  `business_type` int(2) NULL DEFAULT 0 COMMENT 'ä¸šåŠ¡ç±»å‹ï¼ˆ0å…¶å®ƒ 1æ–°å¢ 2ä¿®æ”¹ 3åˆ é™¤ï¼‰',
  `method` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ–¹æ³•åç§°',
  `request_method` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'è¯·æ±‚æ–¹å¼',
  `operator_type` int(1) NULL DEFAULT 0 COMMENT 'æ“ä½œç±»åˆ«ï¼ˆ0å…¶å®ƒ 1åå°ç”¨æˆ· 2æ‰‹æœºç«¯ç”¨æˆ·ï¼‰',
  `oper_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ“ä½œäººå‘˜',
  `dept_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'éƒ¨é—¨åç§°',
  `oper_url` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'è¯·æ±‚URL',
  `oper_ip` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'ä¸»æœºåœ°å€',
  `oper_location` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'æ“ä½œåœ°ç‚¹',
  `oper_param` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'è¯·æ±‚å‚æ•°',
  `json_result` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'è¿”å›å‚æ•°',
  `status` int(1) NULL DEFAULT 0 COMMENT 'æ“ä½œçŠ¶æ€ï¼ˆ0æ­£å¸¸ 1å¼‚å¸¸ï¼‰',
  `error_msg` varchar(2000) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT '' COMMENT 'é”™è¯¯æ¶ˆæ¯',
  `oper_time` datetime NULL DEFAULT NULL COMMENT 'æ“ä½œæ—¶é—´',
  PRIMARY KEY (`oper_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 21 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'æ“ä½œæ—¥å¿—è®°å½•' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_oper_log
-- ----------------------------
INSERT INTO `sys_oper_log` VALUES (1, 'æ“ä½œæ—¥å¿—', 9, 'com.jzj.vblog.web.controller.admin.SysOperLogController.clean()', 'DELETE', 1, 'admin', NULL, '/monitor/operlog/clean', '127.0.0.1', 'å†…ç½‘IP', '{}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-13 16:34:16');
INSERT INTO `sys_oper_log` VALUES (2, 'æ–‡ç« ç®¡ç†', 3, 'com.jzj.vblog.web.controller.admin.ArticleInformController.deleteBthById()', 'DELETE', 1, 'admin', NULL, '/article/inform/c2317a9079991be3273a65254f263441,320ab09bf4402f0abb812e8530e217ea', '127.0.0.1', 'å†…ç½‘IP', '{ids=c2317a9079991be3273a65254f263441,320ab09bf4402f0abb812e8530e217ea}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 10:54:04');
INSERT INTO `sys_oper_log` VALUES (3, 'æ–‡ç« ç®¡ç†', 3, 'com.jzj.vblog.web.controller.admin.ArticleInformController.deleteBthById()', 'DELETE', 1, 'admin', NULL, '/article/inform/4fd382ced2e902c7ff6373c440b95174', '127.0.0.1', 'å†…ç½‘IP', '{ids=4fd382ced2e902c7ff6373c440b95174}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 10:54:29');
INSERT INTO `sys_oper_log` VALUES (4, 'æ–‡ç« ç®¡ç†', 3, 'com.jzj.vblog.web.controller.admin.ArticleInformController.deleteBthById()', 'DELETE', 1, 'admin', NULL, '/article/inform/0ae360525f681ccd6c35c0cda7bc87c2', '127.0.0.1', 'å†…ç½‘IP', '{ids=0ae360525f681ccd6c35c0cda7bc87c2}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 10:54:32');
INSERT INTO `sys_oper_log` VALUES (5, 'æ–‡ç« ç®¡ç†', 3, 'com.jzj.vblog.web.controller.admin.ArticleInformController.deleteBthById()', 'DELETE', 1, 'admin', NULL, '/article/inform/7d9a6f525ea2d6778e3b2a58a2d985a7', '127.0.0.1', 'å†…ç½‘IP', '{ids=7d9a6f525ea2d6778e3b2a58a2d985a7}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 10:54:34');
INSERT INTO `sys_oper_log` VALUES (6, 'å­—å…¸ç±»å‹', 1, 'com.jzj.vblog.web.controller.admin.SysDictDataController.add()', 'POST', 1, 'admin', NULL, '/system/dict/data', '127.0.0.1', 'å†…ç½‘IP', '{\"dictValue\":\"11\",\"listClass\":\"default\",\"dictSort\":0,\"updateTime\":1665730671863,\"params\":{},\"dictType\":\"sys_article_tag\",\"dictLabel\":\"Netty\",\"createBy\":\"admin\",\"createTime\":1665730671863,\"status\":\"0\"}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 14:57:51');
INSERT INTO `sys_oper_log` VALUES (7, 'å­—å…¸ç±»å‹', 2, 'com.jzj.vblog.web.controller.admin.SysDictDataController.edit()', 'PUT', 1, 'admin', NULL, '/system/dict/data', '127.0.0.1', 'å†…ç½‘IP', '{\"dictValue\":\"11\",\"listClass\":\"primary\",\"dictSort\":0,\"updateTime\":1665730689819,\"params\":{},\"dictType\":\"sys_article_tag\",\"dictLabel\":\"Netty\",\"createBy\":\"admin\",\"isDefault\":\"N\",\"createTime\":1665730671000,\"updateBy\":\"admin\",\"id\":140,\"status\":\"0\"}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 14:58:09');
INSERT INTO `sys_oper_log` VALUES (8, 'æ–‡ä»¶ç®¡ç†', 1, 'com.jzj.vblog.web.controller.UploadController.uploadImg()', 'POST', 1, 'admin', NULL, '//api/upload/uploadImg', '127.0.0.1', 'å†…ç½‘IP', 'articleLog', '{\"code\":20000,\"data\":{\"url\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/6272a5d1e471446f87be42e2091d43cd.jpg\"},\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:03:42');
INSERT INTO `sys_oper_log` VALUES (9, 'æ–‡ç« ç®¡ç†', 1, 'com.jzj.vblog.web.controller.admin.ArticleInformController.add()', 'POST', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"11\",\"introduce\":\"dfds\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/6272a5d1e471446f87be42e2091d43cd.jpg\",\"sort\":0,\"content\":\"\",\"commentStatus\":\"0\",\"htmlContent\":\"\",\"articleTag\":\"11\",\"aggregateId\":\"09d7c62e8f9d0348782c6381e2c0b6c0\",\"articleType\":\"1\",\"topStatus\":\"0\",\"originStatus\":\"0\",\"status\":\"1\"}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:03:51');
INSERT INTO `sys_oper_log` VALUES (10, 'æ–‡ç« ç®¡ç†', 3, 'com.jzj.vblog.web.controller.admin.ArticleInformController.deleteBthById()', 'DELETE', 1, 'admin', NULL, '/article/inform/e770d1bc5712e1efe9462c2017d6cf1c', '127.0.0.1', 'å†…ç½‘IP', '{ids=e770d1bc5712e1efe9462c2017d6cf1c}', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:04:09');
INSERT INTO `sys_oper_log` VALUES (11, 'æ–‡ä»¶ç®¡ç†', 1, 'com.jzj.vblog.web.controller.UploadController.uploadImg()', 'POST', 1, 'admin', NULL, '//api/upload/uploadImg', '127.0.0.1', 'å†…ç½‘IP', 'articleLog', '{\"code\":20000,\"data\":{\"url\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg\"},\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:22:59');
INSERT INTO `sys_oper_log` VALUES (12, 'æ–‡ç« ç®¡ç†', 1, 'com.jzj.vblog.web.controller.admin.ArticleInformController.add()', 'POST', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"Netty-å…¥é—¨\",\"introduce\":\"Netty-å…¥é—¨\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg\",\"sort\":0,\"content\":\"# äºŒ. Netty \\n\\n\\n\\n## 1. æ¦‚è¿°\\n\\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n```\\nNetty is an asynchronous event-driven network application framework\\nfor rapid development of maintainable high performance protocol servers & clients.\\n```\\n\\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\\n\\n\\n\\n### 1.2 Netty çš„ä½œè€…\\n\\n![](img/0005.png)\\n\\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\\n\\n\\n\\n### 1.3 Netty çš„åœ°ä½\\n\\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\\n\\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\\n\\n* Cassandra - nosql æ•°æ®åº“\\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\\n* ElasticSearch - æœç´¢å¼•æ“\\n* gRPC - rpc æ¡†æ¶\\n* Dubbo - rpc æ¡†æ¶\\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\\n\\n\\n\\n### 1.4 Netty çš„ä¼˜åŠ¿\\n\\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal => ThreadLocalï¼ŒByteBuf => ByteBuffer\\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\\n    * 2.x 2004\\n    * 3.x 2008\\n    * 4.x 2013\\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\\n\\n\\n\\n## 2. Hello World\\n\\n### 2.1 ç›®æ ‡\\n\\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\\n\\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\\n\\n\\n\\nåŠ å…¥ä¾èµ–\\n\\n```xml\\n<dependency>\\n    <groupId>io.netty</groupId>\\n    <artifactId>netty-all</artifactId>\\n    <version>4.1.39.Final</version>\\n</dependency>\\n```\\n\\n\\n\\n\\n\\n### 2.2 æœåŠ¡å™¨ç«¯\\n\\n```java\\nnew ServerBootstrap()\\n    .group(new NioEventLoopGroup()) // 1\\n    .channel(NioServerSocketChannel.class) // 2\\n    .childHandler(new ChannelInitializer<NioSocketChannel>() { // 3\\n        protected void initChannel(NioSocketChannel ch) {\\n            ch.pipeline().addLast(new StringDecoder()); // 5\\n            ch.pipeline().addLast(new SimpleChannelInboundHandler<String>() { // 6\\n                @Override\\n  ', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:23:35');
INSERT INTO `sys_oper_log` VALUES (13, 'æ–‡ç« ç®¡ç†', 2, 'com.jzj.vblog.web.controller.admin.ArticleInformController.updateById()', 'PUT', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"Nettyï¼ˆå…¥é—¨ï¼‰\",\"introduce\":\"é»‘é©¬Nettyå…¥é—¨ç¬”è®°\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg\",\"sort\":0,\"content\":\"# äºŒ. Netty \\n\\n\\n\\n## 1. æ¦‚è¿°\\n\\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n```\\nNetty is an asynchronous event-driven network application framework\\nfor rapid development of maintainable high performance protocol servers & clients.\\n```\\n\\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\\n\\n\\n\\n### 1.2 Netty çš„ä½œè€…\\n\\n![](img/0005.png)\\n\\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\\n\\n\\n\\n### 1.3 Netty çš„åœ°ä½\\n\\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\\n\\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\\n\\n* Cassandra - nosql æ•°æ®åº“\\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\\n* ElasticSearch - æœç´¢å¼•æ“\\n* gRPC - rpc æ¡†æ¶\\n* Dubbo - rpc æ¡†æ¶\\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\\n\\n\\n\\n### 1.4 Netty çš„ä¼˜åŠ¿\\n\\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal => ThreadLocalï¼ŒByteBuf => ByteBuffer\\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\\n    * 2.x 2004\\n    * 3.x 2008\\n    * 4.x 2013\\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\\n\\n\\n\\n## 2. Hello World\\n\\n### 2.1 ç›®æ ‡\\n\\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\\n\\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\\n\\n\\n\\nåŠ å…¥ä¾èµ–\\n\\n```xml\\n<dependency>\\n    <groupId>io.netty</groupId>\\n    <artifactId>netty-all</artifactId>\\n    <version>4.1.39.Final</version>\\n</dependency>\\n```\\n\\n\\n\\n\\n\\n### 2.2 æœåŠ¡å™¨ç«¯\\n\\n```java\\nnew ServerBootstrap()\\n    .group(new NioEventLoopGroup()) // 1\\n    .channel(NioServerSocketChannel.class) // 2\\n    .childHandler(new ChannelInitializer<NioSocketChannel>() { // 3\\n        protected void initChannel(NioSocketChannel ch) {\\n            ch.pipeline().addLast(new StringDecoder()); // 5\\n            ch.pipeline().addLast(new SimpleChannelInboundHandler<String>() { // 6\\n                @Override', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:26:43');
INSERT INTO `sys_oper_log` VALUES (14, 'æ–‡ç« ç®¡ç†', 2, 'com.jzj.vblog.web.controller.admin.ArticleInformController.updateById()', 'PUT', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"Nettyï¼ˆå…¥é—¨ï¼‰\",\"introduce\":\"é»‘é©¬Nettyå…¥é—¨ç¬”è®°\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg\",\"sort\":0,\"content\":\"# äºŒ. Netty \\n\\n\\n\\n## 1. æ¦‚è¿°\\n\\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n```\\nNetty is an asynchronous event-driven network application framework\\nfor rapid development of maintainable high performance protocol servers & clients.\\n```\\n\\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\\n\\n\\n\\n### 1.2 Netty çš„ä½œè€…\\n\\n![](img/0005.png)\\n\\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\\n\\n\\n\\n### 1.3 Netty çš„åœ°ä½\\n\\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\\n\\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\\n\\n* Cassandra - nosql æ•°æ®åº“\\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\\n* ElasticSearch - æœç´¢å¼•æ“\\n* gRPC - rpc æ¡†æ¶\\n* Dubbo - rpc æ¡†æ¶\\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\\n\\n\\n\\n### 1.4 Netty çš„ä¼˜åŠ¿\\n\\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal => ThreadLocalï¼ŒByteBuf => ByteBuffer\\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\\n    * 2.x 2004\\n    * 3.x 2008\\n    * 4.x 2013\\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\\n\\n\\n\\n## 2. Hello World\\n\\n### 2.1 ç›®æ ‡\\n\\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\\n\\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\\n\\n\\n\\nåŠ å…¥ä¾èµ–\\n\\n```xml\\n<dependency>\\n    <groupId>io.netty</groupId>\\n    <artifactId>netty-all</artifactId>\\n    <version>4.1.39.Final</version>\\n</dependency>\\n```\\n\\n\\n\\n\\n\\n### 2.2 æœåŠ¡å™¨ç«¯\\n\\n```java\\nnew ServerBootstrap()\\n    .group(new NioEventLoopGroup()) // 1\\n    .channel(NioServerSocketChannel.class) // 2\\n    .childHandler(new ChannelInitializer<NioSocketChannel>() { // 3\\n        protected void initChannel(NioSocketChannel ch) {\\n            ch.pipeline().addLast(new StringDecoder()); // 5\\n            ch.pipeline().addLast(new SimpleChannelInboundHandler<String>() { // 6\\n                @Override', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:28:51');
INSERT INTO `sys_oper_log` VALUES (15, 'æ–‡ç« ç®¡ç†', 2, 'com.jzj.vblog.web.controller.admin.ArticleInformController.updateById()', 'PUT', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"Nettyï¼ˆå…¥é—¨ï¼‰\",\"introduce\":\"é»‘é©¬Nettyå…¥é—¨ç¬”è®°\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg\",\"sort\":0,\"content\":\"# äºŒ. Netty \\n\\n\\n\\n## 1. æ¦‚è¿°\\n\\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n```\\nNetty is an asynchronous event-driven network application framework\\nfor rapid development of maintainable high performance protocol servers & clients.\\n```\\n\\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\\n\\n\\n\\n### 1.2 Netty çš„ä½œè€…\\n\\n![](img/0005.png)\\n\\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\\n\\n\\n\\n### 1.3 Netty çš„åœ°ä½\\n\\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\\n\\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\\n\\n* Cassandra - nosql æ•°æ®åº“\\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\\n* ElasticSearch - æœç´¢å¼•æ“\\n* gRPC - rpc æ¡†æ¶\\n* Dubbo - rpc æ¡†æ¶\\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\\n\\n\\n\\n### 1.4 Netty çš„ä¼˜åŠ¿\\n\\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal => ThreadLocalï¼ŒByteBuf => ByteBuffer\\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\\n    * 2.x 2004\\n    * 3.x 2008\\n    * 4.x 2013\\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\\n\\n\\n\\n## 2. Hello World\\n\\n### 2.1 ç›®æ ‡\\n\\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\\n\\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\\n\\n\\n\\nåŠ å…¥ä¾èµ–\\n\\n```xml\\n<dependency>\\n    <groupId>io.netty</groupId>\\n    <artifactId>netty-all</artifactId>\\n    <version>4.1.39.Final</version>\\n</dependency>\\n```\\n\\n\\n\\n\\n\\n### 2.2 æœåŠ¡å™¨ç«¯\\n\\n```java\\nnew ServerBootstrap()\\n    .group(new NioEventLoopGroup()) // 1\\n    .channel(NioServerSocketChannel.class) // 2\\n    .childHandler(new ChannelInitializer<NioSocketChannel>() { // 3\\n        protected void initChannel(NioSocketChannel ch) {\\n            ch.pipeline().addLast(new StringDecoder()); // 5\\n            ch.pipeline().addLast(new SimpleChannelInboundHandler<String>() { // 6\\n                @Override', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:30:35');
INSERT INTO `sys_oper_log` VALUES (16, 'æ–‡ç« ç®¡ç†', 2, 'com.jzj.vblog.web.controller.admin.ArticleInformController.updateById()', 'PUT', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"Nettyï¼ˆå…¥é—¨ï¼‰\",\"introduce\":\"é»‘é©¬Nettyå…¥é—¨ç¬”è®°\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/14/fb21f45fe2c04401a1b186f2f17ec80b.jpg\",\"sort\":0,\"content\":\"# äºŒ. Netty \\n\\n\\n\\n## 1. æ¦‚è¿°\\n\\n### 1.1 Netty æ˜¯ä»€ä¹ˆï¼Ÿ\\n\\n```\\nNetty is an asynchronous event-driven network application framework\\nfor rapid development of maintainable high performance protocol servers & clients.\\n```\\n\\nNetty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå¼€å‘å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç½‘ç»œæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯\\n\\n\\n\\n### 1.2 Netty çš„ä½œè€…\\n\\n![](img/0005.png)\\n\\nä»–è¿˜æ˜¯å¦ä¸€ä¸ªè‘—åç½‘ç»œåº”ç”¨æ¡†æ¶ Mina çš„é‡è¦è´¡çŒ®è€…\\n\\n\\n\\n### 1.3 Netty çš„åœ°ä½\\n\\nNetty åœ¨ Java ç½‘ç»œåº”ç”¨æ¡†æ¶ä¸­çš„åœ°ä½å°±å¥½æ¯”ï¼šSpring æ¡†æ¶åœ¨ JavaEE å¼€å‘ä¸­çš„åœ°ä½\\n\\nä»¥ä¸‹çš„æ¡†æ¶éƒ½ä½¿ç”¨äº† Nettyï¼Œå› ä¸ºå®ƒä»¬æœ‰ç½‘ç»œé€šä¿¡éœ€æ±‚ï¼\\n\\n* Cassandra - nosql æ•°æ®åº“\\n* Spark - å¤§æ•°æ®åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶\\n* Hadoop - å¤§æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨æ¡†æ¶\\n* RocketMQ - ali å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—\\n* ElasticSearch - æœç´¢å¼•æ“\\n* gRPC - rpc æ¡†æ¶\\n* Dubbo - rpc æ¡†æ¶\\n* Spring 5.x - flux api å®Œå…¨æŠ›å¼ƒäº† tomcat ï¼Œä½¿ç”¨ netty ä½œä¸ºæœåŠ¡å™¨ç«¯\\n* Zookeeper - åˆ†å¸ƒå¼åè°ƒæ¡†æ¶\\n\\n\\n\\n### 1.4 Netty çš„ä¼˜åŠ¿\\n\\n* Netty vs NIOï¼Œå·¥ä½œé‡å¤§ï¼Œbug å¤š\\n  * éœ€è¦è‡ªå·±æ„å»ºåè®®\\n  * è§£å†³ TCP ä¼ è¾“é—®é¢˜ï¼Œå¦‚ç²˜åŒ…ã€åŠåŒ…\\n  * epoll ç©ºè½®è¯¢å¯¼è‡´ CPU 100%\\n  * å¯¹ API è¿›è¡Œå¢å¼ºï¼Œä½¿ä¹‹æ›´æ˜“ç”¨ï¼Œå¦‚ FastThreadLocal => ThreadLocalï¼ŒByteBuf => ByteBuffer\\n* Netty vs å…¶å®ƒç½‘ç»œåº”ç”¨æ¡†æ¶\\n  * Mina ç”± apache ç»´æŠ¤ï¼Œå°†æ¥ 3.x ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰è¾ƒå¤§é‡æ„ï¼Œç ´å API å‘ä¸‹å…¼å®¹æ€§ï¼ŒNetty çš„å¼€å‘è¿­ä»£æ›´è¿…é€Ÿï¼ŒAPI æ›´ç®€æ´ã€æ–‡æ¡£æ›´ä¼˜ç§€\\n  * ä¹…ç»è€ƒéªŒï¼Œ16å¹´ï¼ŒNetty ç‰ˆæœ¬\\n    * 2.x 2004\\n    * 3.x 2008\\n    * 4.x 2013\\n    * 5.x å·²åºŸå¼ƒï¼ˆæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æå‡ï¼Œç»´æŠ¤æˆæœ¬é«˜ï¼‰\\n\\n\\n\\n## 2. Hello World\\n\\n### 2.1 ç›®æ ‡\\n\\nå¼€å‘ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯\\n\\n* å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€ hello, world\\n* æœåŠ¡å™¨ä»…æ¥æ”¶ï¼Œä¸è¿”å›\\n\\n\\n\\nåŠ å…¥ä¾èµ–\\n\\n```xml\\n<dependency>\\n    <groupId>io.netty</groupId>\\n    <artifactId>netty-all</artifactId>\\n    <version>4.1.39.Final</version>\\n</dependency>\\n```\\n\\n\\n\\n\\n\\n### 2.2 æœåŠ¡å™¨ç«¯\\n\\n```java\\nnew ServerBootstrap()\\n    .group(new NioEventLoopGroup()) // 1\\n    .channel(NioServerSocketChannel.class) // 2\\n    .childHandler(new ChannelInitializer<NioSocketChannel>() { // 3\\n        protected void initChannel(NioSocketChannel ch) {\\n            ch.pipeline().addLast(new StringDecoder()); // 5\\n            ch.pipeline().addLast(new SimpleChannelInboundHandler<String>() { // 6\\n                @Override', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-14 15:32:22');
INSERT INTO `sys_oper_log` VALUES (17, 'æ–‡ä»¶ç®¡ç†', 1, 'com.jzj.vblog.web.controller.UploadController.uploadImg()', 'POST', 1, 'admin', NULL, '//api/upload/uploadImg', '127.0.0.1', 'å†…ç½‘IP', 'articleLog', '{\"code\":20000,\"data\":{\"url\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/31/7e66508406ec40d98d514d08587ae007.jpg\"},\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-31 14:15:39');
INSERT INTO `sys_oper_log` VALUES (18, 'æ–‡ä»¶ç®¡ç†', 1, 'com.jzj.vblog.web.controller.UploadController.uploadImg()', 'POST', 1, 'admin', NULL, '/api/upload/uploadImg', '127.0.0.1', 'å†…ç½‘IP', 'article', '{\"code\":20000,\"data\":{\"url\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/31/2fc01ee15bfd4675bac84e6af65195fd.png\"},\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-31 14:58:52');
INSERT INTO `sys_oper_log` VALUES (19, 'æ–‡ä»¶ç®¡ç†', 1, 'com.jzj.vblog.web.controller.UploadController.uploadImg()', 'POST', 1, 'admin', NULL, '/api/upload/uploadImg', '127.0.0.1', 'å†…ç½‘IP', 'article', '{\"code\":20000,\"data\":{\"url\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/article/2022/10/31/b94f713088c449559b4cc9c49a79bb2a.png\"},\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-31 15:16:14');
INSERT INTO `sys_oper_log` VALUES (20, 'æ–‡ç« ç®¡ç†', 1, 'com.jzj.vblog.web.controller.admin.ArticleInformController.add()', 'POST', 1, 'admin', NULL, '/article/inform', '127.0.0.1', 'å†…ç½‘IP', '{\"articleTitle\":\"EasyExcelç™¾ä¸‡æ•°æ®å¯¼å‡º\",\"introduce\":\"ä½¿ç”¨EasyExcelå¯¼å‡ºç™¾ä¸‡æ•°æ®\",\"logImg\":\"https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/articleLog/2022/10/31/7e66508406ec40d98d514d08587ae007.jpg\",\"sort\":0,\"content\":\"### èƒŒæ™¯\\nå…¬å¸é¡¹ç›®æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œéƒ¨åˆ†è¡¨æ‹¥æœ‰åƒä¸‡æ•°æ®é‡ï¼Œä½†æ˜¯é¡¹ç›®é‡Œé¢å¯¼å‡ºåŠŸèƒ½é™ˆæ—§ï¼Œä½¿ç”¨çš„æ˜¯ä¼ ç»Ÿçš„POIå¯¼å‡ºï¼Œé™åˆ¶äº†å•æ¬¡å¯¼å‡ºæ•°é‡ä¸º6Wæ¡ï¼Œæ¯æ¬¡ç”¨æˆ·éœ€è¦åˆ†æ‰¹æ¬¡å¯¼å‡ºã€‚æ—¢ç„¶æœ‰éœ€æ±‚é‚£æˆ‘å°±å°è¯•èƒ½å¦è§£å†³å§ã€‚\\n\\n\\n### æœªæŠ½å–æ¨¡æ¿ç‰ˆæœ¬\\n\\nè¿™æ®µå¹¶æœªæŠ½å–æˆé€šç”¨æ¨¡æ¿ï¼Œæ³›ç”¨æ€§ä¸å¼ºï¼Œä»…æµ‹è¯•åœ¨æŒ‡å®šç±»å‹ä¸éœ€è¦è½¬æ¢ä¸‹å¯èŠ‚çœå¤šå°‘æ—¶é—´ã€‚\\n```java\\npublic void export(HttpServletRequest request, HttpServletResponse response, JSONObject params) {\\n        long start = System.currentTimeMillis();\\n        OutputStream outputStream = null;\\n        try {\\n            outputStream = response.getOutputStream();\\n            ExcelWriter writer = new ExcelWriter(outputStream, ExcelTypeEnum.XLSX);\\n            String fileName = new String((\\\"excel100w\\\").getBytes(), \\\"UTF-8\\\");\\n            //title\\n            WriteTable writeTable = new WriteTable();\\n            List<List<String>> titles = new ArrayList<>();\\n            titles.add(Arrays.asList(\\\"id\\\"));\\n            titles.add(Arrays.asList(\\\"å§“å\\\"));\\n            writeTable.setHead(titles);\\n            //è®°å½•æ€»æ•°:å®é™…ä¸­éœ€è¦æ ¹æ®æŸ¥è¯¢æ¡ä»¶è¿›è¡Œç»Ÿè®¡å³å¯\\n            Integer totalCount = baseMapper.selectCount(null);\\n            //æ¯ä¸€ä¸ªSheetå­˜æ”¾100wæ¡æ•°æ®\\n            Integer sheetDataRows = 1000000;\\n            //æ¯æ¬¡å†™å…¥çš„æ•°æ®é‡20w\\n            int writeDataRows = 200000;\\n            //è®¡ç®—éœ€è¦çš„Sheetæ•°é‡\\n            int sheetNum = totalCount % sheetDataRows == 0 ? (totalCount / sheetDataRows) : (totalCount / sheetDataRows + 1);\\n            //è®¡ç®—ä¸€èˆ¬æƒ…å†µä¸‹æ¯ä¸€ä¸ªSheetéœ€è¦å†™å…¥çš„æ¬¡æ•°(ä¸€èˆ¬æƒ…å†µä¸åŒ…å«æœ€åä¸€ä¸ªsheet,å› ä¸ºæœ€åä¸€ä¸ªsheetä¸ç¡®å®šä¼šå†™å…¥å¤šå°‘æ¡æ•°æ®)\\n            int oneSheetWriteCount = sheetDataRows / writeDataRows;\\n            //è®¡ç®—æœ€åä¸€ä¸ªsheetéœ€è¦å†™å…¥çš„æ¬¡æ•°\\n            int lastSheetWriteCount = totalCount % sheetDataRows == 0 ? oneSheetWriteCount : (totalCount % sheetDataRows % writeDataRows == 0 ? (totalCount % sheetDataRows / writeDataRows) : (totalCount % sheetDataRows / writeDataRows + 1));\\n\\n            //å¼€å§‹åˆ†æ‰¹æŸ¥è¯¢åˆ†æ¬¡å†™å…¥\\n            //æ³¨æ„è¿™æ¬¡çš„å¾ªç¯å°±éœ€è¦è¿›è¡ŒåµŒå¥—å¾ªç¯äº†,å¤–å±‚å¾ªç¯æ˜¯Sheetæ•°ç›®,å†…å±‚å¾ªç¯æ˜¯å†™å…¥æ¬¡æ•°\\n           ', '{\"code\":20000,\"msg\":\"æ“ä½œæˆåŠŸ\",\"success\":true}', 0, NULL, '2022-10-31 15:17:56');

-- ----------------------------
-- Table structure for sys_todo
-- ----------------------------
DROP TABLE IF EXISTS `sys_todo`;
CREATE TABLE `sys_todo`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'id',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `done` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çŠ¶æ€',
  `text` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å†…å®¹',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'å¤‡å¿˜å½•' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_todo
-- ----------------------------
INSERT INTO `sys_todo` VALUES ('5968d94f9d2d78f383c9cb8ee0595756', '2022-08-14 17:47:03', '2022-10-09 09:18:02', '0', 'å¥½å¥½å¥½å­¦ä¹ å¤©å¤©å‘ä¸Š');
INSERT INTO `sys_todo` VALUES ('bd8fd2b4e71b1a4efa58e5f19b26cde9', '2022-09-21 14:57:42', '2022-10-09 09:18:20', '1', 'æ˜å¤©å†™bug');
INSERT INTO `sys_todo` VALUES ('d03d1664f7f5ac853cb5b3a37770bbb6', '2022-09-26 14:22:49', '2022-10-09 09:18:12', '0', 'ä¹°æ‰‹æœº');

-- ----------------------------
-- Table structure for sys_web_information
-- ----------------------------
DROP TABLE IF EXISTS `sys_web_information`;
CREATE TABLE `sys_web_information`  (
  `id` int(11) NOT NULL COMMENT 'id',
  `web_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç½‘ç«™åç§°',
  `web_details` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç½‘ç«™è¯¦æƒ…',
  `web_avatar` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¤´åƒ',
  `qq` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'qq',
  `wechat` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¾®ä¿¡',
  `github` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'github',
  `gitee` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'gitee',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `home_banner` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'é¦–é¡µèƒŒæ™¯å›¾',
  `article_banner` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ç« èƒŒæ™¯å›¾',
  `wechat_img` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å¾®ä¿¡äºŒç»´ç ',
  `email` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'é‚®ç®±',
  `comment_img` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'è¯„è®ºå¤´åƒ',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'ç½‘ç«™åŸºæœ¬ä¿¡æ¯' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of sys_web_information
-- ----------------------------
INSERT INTO `sys_web_information` VALUES (1, 'æ¼«æ¼«å‰è·¯', '<p>é•¿è·¯æ¼«æ¼«ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</p>', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/webLogo/2022/09/16/de051c412f2f46ba92de7817496cb605.jpg', '946232976', 'fr946232976', 'https://github.com/Jzjzzzz', 'https://gitee.com/jzjzz', '2022-07-28 20:16:13', '2022-09-26 10:56:20', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/webLogo/2022/08/09/a108c42fa21a43a4940c3e08cfd33c4f.jpg', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/webLogo/2022/08/10/9d26abe18ec84eadbaa8b9f180fefee6.jpg', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/webLogo/2022/09/08/f2330c187a6040ed8a74df5aae1cb763.jpg', '946232976@qq.com', 'https://vue-vblog.oss-cn-shenzhen.aliyuncs.com/webLogo/2022/09/19/1b0d32a2d72e4ed58b7cc6ede72621b0.png');

-- ----------------------------
-- Table structure for website_resource
-- ----------------------------
DROP TABLE IF EXISTS `website_resource`;
CREATE TABLE `website_resource`  (
  `id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT 'èµ„æºç«™ç‚¹è¡¨id',
  `create_time` datetime NULL DEFAULT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NULL DEFAULT NULL COMMENT 'ä¿®æ”¹æ—¶é—´',
  `status` char(1) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'çŠ¶æ€',
  `resource_name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'èµ„æºåç§°',
  `resource_address` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'èµ„æºåœ°å€',
  `resource_img` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'èµ„æºå›¾ç‰‡',
  `resource_type` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'èµ„æºåˆ†ç±»',
  `click_rate` bigint(20) NOT NULL COMMENT 'ç‚¹å‡»é‡',
  `resource_detail` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'èµ„æºæè¿°',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci COMMENT = 'èµ„æºç«™ç‚¹' ROW_FORMAT = DYNAMIC;

-- ----------------------------
-- Records of website_resource
-- ----------------------------

SET FOREIGN_KEY_CHECKS = 1;
